(global.webpackJsonp=global.webpackJsonp||[]).push([["pages/common/good_allocation/allocation_detail/allocation_detail"],{252:
/*!*************************************************************************************************************************************************!*\
  !*** C:/Users/Administrator/Desktop/wechat/kcb_all/main.js?{"page":"pages%2Fcommon%2Fgood_allocation%2Fallocation_detail%2Fallocation_detail"} ***!
  \*************************************************************************************************************************************************/
/*! no static exports found */function(e,t,o){"use strict";(function(e){o(/*! uni-pages */4),o(/*! @dcloudio/uni-stat */5);t(o(/*! vue */2));function t(e){return e&&e.__esModule?e:{default:e}}e(t(o(/*! ./pages/common/good_allocation/allocation_detail/allocation_detail.vue */253)).default)}).call(this,o(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1).createPage)},253:
/*!**************************************************************************************************************************!*\
  !*** C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue ***!
  \**************************************************************************************************************************/
/*! no static exports found */function(e,t,o){"use strict";o.r(t);var r=o(/*! ./allocation_detail.vue?vue&type=template&id=2497f81e& */254),s=o(/*! ./allocation_detail.vue?vue&type=script&lang=js& */256);for(var u in s)"default"!==u&&function(e){o.d(t,e,function(){return s[e]})}(u);o(/*! ./allocation_detail.vue?vue&type=style&index=0&lang=css& */258);var n=o(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */70),d=Object(n.default)(s.default,r.render,r.staticRenderFns,!1,null,null,null,!1,r.components,void 0);d.options.__file="C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue",t.default=d.exports},254:
/*!*********************************************************************************************************************************************************!*\
  !*** C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=template&id=2497f81e& ***!
  \*********************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,o){"use strict";o.r(t);var r=o(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./allocation_detail.vue?vue&type=template&id=2497f81e& */255);o.d(t,"render",function(){return r.render}),o.d(t,"staticRenderFns",function(){return r.staticRenderFns}),o.d(t,"recyclableRender",function(){return r.recyclableRender}),o.d(t,"components",function(){return r.components})},255:
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=template&id=2497f81e& ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,t,o){"use strict";o.r(t),o.d(t,"render",function(){return r}),o.d(t,"staticRenderFns",function(){return u}),o.d(t,"recyclableRender",function(){return s}),o.d(t,"components",function(){});var r=function(){var e=this.$createElement,t=(this._self._c,this.nowDay.split(" "));this.$mp.data=Object.assign({},{$root:{g0:t}})},s=!1,u=[];r._withStripped=!0},256:
/*!***************************************************************************************************************************************************!*\
  !*** C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=script&lang=js& ***!
  \***************************************************************************************************************************************************/
/*! no static exports found */function(e,t,o){"use strict";o.r(t);var r=o(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./allocation_detail.vue?vue&type=script&lang=js& */257),s=o.n(r);for(var u in r)"default"!==u&&function(e){o.d(t,e,function(){return r[e]})}(u);t.default=s.a},257:
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=script&lang=js& ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s,u=a(o(/*! hydrogen-js-sdk */13)),n=a(o(/*! @/utils/common.js */77)),d=(a(o(/*! @/utils/send_temp.js */86)),a(o(/*! @/utils/print.js */87)));a(o(/*! @/utils/goods.js */88));function a(e){return e&&e.__esModule?e:{default:e}}var c=[],l={data:function(){return{products:[],stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[],all_money:0,real_money:0,total_num:0,nowDay:n.default.getDay(0,!0,!0)}},onLoad:function(){s=this,r=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.total_num+=Number(this.products[t].num);this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){s.out_stock=e.getStorageSync("out_warehouse")?e.getStorageSync("out_warehouse")[0].stock:""},methods:{formSubmit:function(t){if(this.button_disabled=!0,""==s.out_stock||null==s.out_stock)return e.showToast({title:"请选择调入仓库",icon:"none"}),void(this.button_disabled=!1);s.unique(s.products),s.addTbRecord(t)},unique:function(t){for(var o=[t[0]],r=1;r<t.length;r++){for(var u=!1,n=0;n<o.length;n++)if(t[r].header.objectId===o[n].header.objectId){if(t[r].selected_model){var d=!0,a=!1,l=void 0;try{for(var i,m=t[r].selected_model[Symbol.iterator]();!(d=(i=m.next()).done);d=!0){var f=i.value,v=!0,p=!1,g=void 0;try{for(var _,y=o[n].selected_model[Symbol.iterator]();!(v=(_=y.next()).done);v=!0){var h=_.value;h.id==f.id&&(h.num+=Number(f.num))}}catch(e){p=!0,g=e}finally{try{v||null==y.return||y.return()}finally{if(p)throw g}}}}catch(e){a=!0,l=e}finally{try{d||null==m.return||m.return()}finally{if(a)throw l}}}o[n].num+=t[r].num,u=!0}u||o.push(t[r])}console.log(o),s.products=e.getStorageSync("products"),c=o},addTbRecord:function(t){var o,d=this;e.showLoading({title:"请勿退出..."});for(var a=u.default.Pointer("stocks").set(s.out_stock.objectId),l=new Array,i=[],m=function(t){var n=u.default.Pointer("stocks");o=n.set(d.products[t].stocks.objectId);var c=u.default.Query("Bills"),m={},f=u.default.Pointer("_User").set(r),v=u.default.Pointer("_User").set(e.getStorageSync("masterId")),p=u.default.Pointer("Goods").set(d.products[t].objectId);c.set("goodsName",d.products[t].goodsName),c.set("retailPrice",d.products[t].modify_retailPrice),c.set("num",Number(d.products[t].num)),c.set("total_money",Number(d.products[t].total_money)),c.set("goodsId",p),c.set("userId",f),c.set("type",-2),c.set("opreater",v),c.set("stock",o),c.set("out_stock",a);var g={};m.goodsName=d.products[t].goodsName,m.stock=d.products[t].stocks.stock_name,m.out_stock=s.out_stock.stock_name,m.reserve=d.products[t].reserve,g.objectId=d.products[t].objectId,d.products[t].selectd_model&&(g.selected_model=d.products[t].selected_model,g.models=d.products[t].models),m.goodsId=g,m.num=Number(d.products[t].num),m.type=-2,l.push(c),i.push(m),u.default.Query("Goods").get(s.products[t].objectId).then(function(e){var o=Number(d.products[t].reserve)-Number(d.products[t].num);if(d.products[t].selected_model){var r=!0,s=!1,u=void 0;try{for(var n,a=d.products[t].selected_model[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var c=n.value,l=!0,i=!1,m=void 0;try{for(var f,v=d.products[t].models[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var p=f.value;p.id==c.id&&(p.reserve=Number(p.reserve)-Number(c.num)),delete p.num}}catch(e){i=!0,m=e}finally{try{l||null==v.return||v.return()}finally{if(i)throw m}}}}catch(e){s=!0,u=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw u}}e.set("models",d.products[t].models)}e.set("reserve",o),e.save()})},f=0;f<s.products.length;f++)m(f);u.default.Query("Bills").saveAll(l).then(function(d){for(var l=[],m=0;m<d.length;m++)l.push(d[m].success.objectId);var f=u.default.Pointer("_User").set(r),v=e.getStorageSync("masterId"),p=u.default.Pointer("_User").set(v),g=u.default.Query("order_opreations");g.set("detail",i),g.set("bills",l),g.set("beizhu",t.detail.value.input_beizhu),g.set("type",-2),g.set("opreater",p),g.set("stock",o),g.set("out_stock",a),g.set("master",f),g.set("goodsName",s.products[0].goodsName),g.save().then(function(t){t.objectId;e.hideLoading(),s.button_disabled=!1,e.setStorageSync("is_option",!0);for(var o=function(t){var o=u.default.Query("Goods");o.equalTo("goodsName","==",c[t].goodsName),o.equalTo("userId","==",r),o.equalTo("stocks","==",s.out_stock.objectId),o.find().then(function(r){var u=r;0==u.length?n.default.upload_good_withNoCan(c[t],s.out_stock,Number(c[t].num),"allocation").then(function(o){t==c.length-1&&(e.hideLoading(),e.removeStorageSync("warehouse"),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),e.showToast({title:"调拨成功"}),setTimeout(function(){e.navigateBack({delta:2})},500))}):o.get(u[0].objectId).then(function(o){if(c[t].selected_model){var r=!0,s=!1,n=void 0;try{for(var d,a=c[t].selected_model[Symbol.iterator]();!(r=(d=a.next()).done);r=!0){var l=d.value,i=!0,m=!1,f=void 0;try{for(var v,p=u[0].models[Symbol.iterator]();!(i=(v=p.next()).done);i=!0){var g=v.value;g.id==l.id&&(g.reserve=Number(g.reserve)+Number(l.num)),delete g.num}}catch(e){m=!0,f=e}finally{try{i||null==p.return||p.return()}finally{if(m)throw f}}}}catch(e){s=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw n}}o.set("models",u[0].models)}o.set("reserve",Number(u[0].reserve)+Number(c[t].num)),o.save(),t==c.length-1&&(e.hideLoading(),e.removeStorageSync("warehouse"),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),e.showToast({title:"调拨成功"}),setTimeout(function(){e.navigateBack({delta:2})},500))})})},d=0;d<c.length;d++)o(d)})},function(e){console.log("异常处理")})},add_tb_record:function(t){var o=this;e.showLoading({title:"上传中..."});for(var a,c=u.default.Pointer("stocks"),l=c.set(s.out_stock.objectId),i=new Array,m=[],f=function(f){a=c.set(o.products[f].stocks.objectId);var v=u.default.Query("Goods");v.equalTo("goodsName","==",s.products[f].goodsName),v.equalTo("userId","==",r),v.equalTo("stocks","==",s.out_stock.objectId),v.find().then(function(c){console.log(c);var v,p,g=[];if(0==c.length){if(s.products[f].selectd_model)return e.showToast({icon:"none",title:"此多规格产品未关联到此仓库"}),void(o.button_disabled=!1);n.default.upload_good_withNoCan(s.products[f],s.out_stock,Number(o.products[f].num),"allocation").then(function(c){console.log(c);var _={};_.objectId=c[1].objectId,_.reserve=Number(o.products[f].num),g[0]=_,v=Number(o.products[f].reserve)-Number(o.products[f].num),p=Number(o.products[f].num);var y=u.default.Query("Goods");y.get(s.products[f].objectId).then(function(e){e.set("reserve",v),e.save(),y.get(g[0].objectId).then(function(e){e.set("reserve",p),e.save()})});var h=u.default.Query("Bills"),b={},S=u.default.Pointer("_User").set(r),N=u.default.Pointer("_User").set(e.getStorageSync("masterId")),k=u.default.Pointer("Goods").set(o.products[f].objectId);h.set("goodsName",o.products[f].goodsName),h.set("retailPrice",o.products[f].modify_retailPrice),h.set("num",Number(o.products[f].num)),h.set("total_money",Number(o.products[f].total_money)),h.set("goodsId",k),h.set("userId",S),h.set("type",-2),h.set("opreater",N),h.set("stock",a),h.set("out_stock",l);var I={};b.goodsName=o.products[f].goodsName,b.stock=o.products[f].stocks.stock_name,b.out_stock=s.out_stock.stock_name,b.reserve=o.products[f].reserve,b.out_reserve=g[0].reserve,I.objectId=o.products[f].objectId,I.out_objectId=g[0].objectId,I.reserve=v,I.out_reserve=p,o.products[f].selectd_model&&(I.selected_model=o.products[f].selected_model,I.models=o.products[f].models),b.goodsId=I,b.num=Number(o.products[f].num),b.type=-2,i.push(h),m.push(b),f==o.products.length-1&&u.default.Query("Bills").saveAll(i).then(function(o){for(var c=[],i=0;i<o.length;i++)c.push(o[i].success.objectId);var f=u.default.Pointer("_User").set(r),v=e.getStorageSync("masterId"),p=u.default.Pointer("_User").set(v),g=u.default.Query("order_opreations");g.set("detail",m),g.set("bills",c),g.set("beizhu",t.detail.value.input_beizhu),g.set("type",-2),g.set("opreater",p),g.set("stock",a),g.set("out_stock",l),g.set("master",f),g.set("goodsName",s.products[0].goodsName),g.save().then(function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品调拨成功",icon:"success",success:function(){s.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout(function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"调拨了'"+s.products[0].goodsName+"'等"+s.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&d.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})})}else{if(g=c,v=Number(o.products[f].reserve)-Number(o.products[f].num),p=Number(g[0].reserve)+Number(o.products[f].num),o.products[f].stocks.objectId!=s.out_stock.objectId){var _=u.default.Query("Goods");_.get(g[0].objectId).then(function(e){console.log(e);var t=e;if(o.products[f].selectd_model){var r=!0,u=!1,n=void 0;try{for(var d,a=o.products[f].selected_model[Symbol.iterator]();!(r=(d=a.next()).done);r=!0){var c=d.value,l=!0,i=!1,m=void 0;try{for(var g,y=t.models[Symbol.iterator]();!(l=(g=y.next()).done);l=!0){var h=g.value;h.id==c.id&&(h.reserve=Number(h.reserve)+Number(c.num)),delete h.num}}catch(e){i=!0,m=e}finally{try{l||null==y.return||y.return()}finally{if(i)throw m}}}}catch(e){u=!0,n=e}finally{try{r||null==a.return||a.return()}finally{if(u)throw n}}e.set("models",t.models)}e.set("reserve",p),e.save(),_.get(s.products[f].objectId).then(function(e){if(o.products[f].selectd_model){var t=!0,r=!1,s=void 0;try{for(var u,n=o.products[f].selected_model[Symbol.iterator]();!(t=(u=n.next()).done);t=!0){var d=u.value,a=!0,c=!1,l=void 0;try{for(var i,m=o.products[f].models[Symbol.iterator]();!(a=(i=m.next()).done);a=!0){var p=i.value;p.id==d.id&&(p.reserve=Number(p.reserve)-Number(d.num)),delete p.num}}catch(e){c=!0,l=e}finally{try{a||null==m.return||m.return()}finally{if(c)throw l}}}}catch(e){r=!0,s=e}finally{try{t||null==n.return||n.return()}finally{if(r)throw s}}e.set("models",o.products[f].models)}e.set("reserve",v),e.save()})})}var y=u.default.Query("Bills"),h={},b=u.default.Pointer("_User").set(r),S=u.default.Pointer("_User").set(e.getStorageSync("masterId")),N=u.default.Pointer("Goods").set(o.products[f].objectId);y.set("goodsName",o.products[f].goodsName),y.set("num",Number(o.products[f].num)),y.set("goodsId",N),y.set("userId",b),y.set("type",-2),y.set("opreater",S),y.set("stock",a),y.set("out_stock",l);var k={};h.goodsName=o.products[f].goodsName,h.stock=o.products[f].stocks.stock_name,h.out_stock=s.out_stock.stock_name,h.reserve=o.products[f].reserve,h.out_reserve=g[0].reserve,k.objectId=o.products[f].objectId,k.out_objectId=g[0].objectId,k.reserve=v,k.out_reserve=p,o.products[f].selectd_model&&(k.selected_model=o.products[f].selected_model,k.models=o.products[f].models),h.goodsId=k,h.num=Number(o.products[f].num),h.type=-2,i.push(y),m.push(h),f==o.products.length-1&&u.default.Query("Bills").saveAll(i).then(function(o){for(var c=[],i=0;i<o.length;i++)c.push(o[i].success.objectId);var f=u.default.Pointer("_User").set(r),v=e.getStorageSync("masterId"),p=u.default.Pointer("_User").set(v),g=u.default.Query("order_opreations");g.set("detail",m),g.set("bills",c),g.set("beizhu",t.detail.value.input_beizhu),g.set("type",-2),g.set("opreater",p),g.set("stock",a),g.set("out_stock",l),g.set("master",f),g.set("goodsName",s.products[0].goodsName),g.save().then(function(t){var o=t.objectId;e.showToast({title:"产品调拨成功",icon:"success",success:function(){e.hideLoading(),e.setStorageSync("is_option",!0),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),setTimeout(function(){s.button_disabled=!1,n.default.log(e.getStorageSync("user").nickName+"调拨了'"+s.products[0].goodsName+"'等"+s.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&d.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})}})},v=0;v<this.products.length;v++)f(v)}}};t.default=l}).call(this,o(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1).default)},258:
/*!***********************************************************************************************************************************************************!*\
  !*** C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=style&index=0&lang=css& ***!
  \***********************************************************************************************************************************************************/
/*! no static exports found */function(e,t,o){"use strict";o.r(t);var r=o(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-1!./node_modules/css-loader??ref--6-oneOf-1-2!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./allocation_detail.vue?vue&type=style&index=0&lang=css& */259),s=o.n(r);for(var u in r)"default"!==u&&function(e){o.d(t,e,function(){return r[e]})}(u);t.default=s.a},259:
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-1!./node_modules/css-loader??ref--6-oneOf-1-2!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Administrator/Desktop/wechat/kcb_all/pages/common/good_allocation/allocation_detail/allocation_detail.vue?vue&type=style&index=0&lang=css& ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,t,o){}},[[252,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../../.sourcemap/mp-weixin/pages/common/good_allocation/allocation_detail/allocation_detail.js.map