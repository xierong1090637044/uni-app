(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/manage/good_add/good_add"],{"0969":function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement;e._self._c},a=[];t.d(o,"a",function(){return n}),t.d(o,"b",function(){return a})},"18db":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=a(t("e21e"));function a(e){return e&&e.__esModule?e:{default:e}}var r,s,c,d=function(){return t.e("components/kilvn-fa-icon/fa-icon").then(t.bind(null,"8899"))},u="",i="",l={components:{faIcon:d},data:function(){return{stocks:[{stock:{stock_name:"默认仓库"},reserve:0}],category:"",reserve:[0],goodsIcon:"",producttime:"",nousetime:"",productCode:""}},onLoad:function(){r=this,c=e.getStorageSync("uid"),e.removeStorageSync("category"),e.removeStorageSync("warehouse")},onShow:function(){if(e.getStorageSync("warehouse")&&(r.stocks=e.getStorageSync("warehouse")),e.getStorageSync("category")){r.category=e.getStorageSync("category");var o=n.default.Pointer("class_user");u=o.set(r.category.parent.objectId);var t=n.default.Pointer("second_class");i=t.set(r.category.objectId),console.log(r.category.parent.objectId,r.category.objectId," at pages\\manage\\good_add\\good_add.vue:189")}},onUnload:function(){s="",u="",i=""},methods:{scan_code:function(){e.scanCode({onlyFromCamera:!0,success:function(e){console.log("条码类型："+e.scanType," at pages\\manage\\good_add\\good_add.vue:206"),console.log("条码内容："+e.result," at pages\\manage\\good_add\\good_add.vue:207"),r.productCode=e.result}})},remove_this:function(o){console.log(o," at pages\\manage\\good_add\\good_add.vue:215"),r.stocks=r.stocks.splice(o-1,1),e.setStorageSync("warehouse",r.stocks)},change_reserve:function(e,o){console.log(e,o," at pages\\manage\\good_add\\good_add.vue:222"),r.stocks[e].reserve=Number(o.detail.value)},bindproducttimeChange:function(e){r.producttime=e.target.value},bindDateChange:function(e){r.nousetime=e.target.value},formSubmit:function(o){var t=o.detail.value;if(""==t.goodsName)e.showToast({title:"请输入产品名称",icon:"none"});else if(s){var a,c=!0,d=!1,u=void 0;try{for(var i,l=s[Symbol.iterator]();!(c=(i=l.next()).done);c=!0){var g=i.value;a=n.default.File(t.goodsName+".png",g)}}catch(f){d=!0,u=f}finally{try{c||null==l.return||l.return()}finally{if(d)throw u}}a.save().then(function(e){r.goodsIcon=JSON.parse(e).url,r.upload_good(t)})}else r.upload_good(t)},upload_image:function(){e.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){r.goodsIcon=e.tempFilePaths[0],s=e.tempFilePaths}})},upload_good:function(o){e.showLoading({title:"上传中..."});var t=n.default.Pointer("_User"),a=t.set(c),s=n.default.Query("Goods");s.equalTo("userId","==",c),s.equalTo("goodsName","==",o.goodsName),s.find().then(function(t){if(console.log(t," at pages\\manage\\good_add\\good_add.vue:286"),t.length>=1)e.showToast({title:"你的库存中已存在此产品",icon:"none"});else{var s=!0,c=!1,d=void 0;try{for(var l,g=r.stocks[Symbol.iterator]();!(s=(l=g.next()).done);s=!0){var f=l.value,m=f.reserve,v=f.stock.objectId||"",p=n.default.Pointer("stocks"),_=p.set(v),y=n.default.Query("Goods");y.set("goodsIcon",r.goodsIcon),y.set("goodsName",o.goodsName),y.set("costPrice",o.costPrice?o.costPrice:"0"),y.set("retailPrice",o.retailPrice?o.retailPrice:"0"),y.set("regNumber",o.regNumber),y.set("reserve",Number(m)),y.set("productCode",o.productCode),y.set("stocks",_),y.set("product_info",o.product_info),y.set("producer",o.producer),y.set("packingUnit",o.packingUnit),y.set("packageContent",o.packageContent),y.set("warning_num",Number(o.warning_num)),y.set("stocktype",Number(o.warning_num)>=Number(m)?0:1),e.getStorageSync("category")&&(y.set("second_class",i),y.set("goodsClass",u)),y.set("userId",a),y.save().then(function(o){e.hideLoading(),e.showToast({title:"上传成功"})}).catch(function(e){console.log(e," at pages\\manage\\good_add\\good_add.vue:328")})}}catch(h){c=!0,d=h}finally{try{s||null==g.return||g.return()}finally{if(c)throw d}}}})}}};o.default=l}).call(this,t("6e42")["default"])},"1f92":function(e,o,t){},"4a73":function(e,o,t){"use strict";t.r(o);var n=t("18db"),a=t.n(n);for(var r in n)"default"!==r&&function(e){t.d(o,e,function(){return n[e]})}(r);o["default"]=a.a},6841:function(e,o,t){"use strict";t.r(o);var n=t("0969"),a=t("4a73");for(var r in a)"default"!==r&&function(e){t.d(o,e,function(){return a[e]})}(r);t("b337");var s=t("2877"),c=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,null,null);o["default"]=c.exports},b337:function(e,o,t){"use strict";var n=t("1f92"),a=t.n(n);a.a}},[["8cf1","common/runtime","common/vendor"]]]);