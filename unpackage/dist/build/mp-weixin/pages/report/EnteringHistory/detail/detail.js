(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/report/EnteringHistory/detail/detail"],{5875:function(e,t,n){"use strict";n.r(t);var o=n("59ef"),i=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);t["default"]=i.a},"59ef":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("906f")),i=r(n("2df3"));function r(e){return e&&e.__esModule?e:{default:e}}var u,a,l=function(){return n.e("components/Loading/index").then(n.bind(null,"c7fb"))},s=function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"f4e7"))},c={components:{loading:l,uniNavBar:s},data:function(){return{user:e.getStorageSync("user"),bills:[],loading:!0,products:null,detail:null}},onLoad:function(e){console.log(e),u=this,a=e.id,u.getdetail(a)},methods:{gotoexpressDet:function(){u.user.is_vip?e.navigateTo({url:"../expressDet/expressDet?number="+u.detail.expressNum}):e.showToast({title:"您还不是会员，无法使用",icon:"none"})},priview:function(t){e.previewImage({current:t,urls:u.detail.Images})},show_options:function(){var t=["打印"];-1!=u.detail.type&&1!=u.detail.type||(t=["打印","撤销"]),e.showActionSheet({itemList:t,success:function(e){0==e.tapIndex?i.default.print_operations(u.detail,u.products):1==e.tapIndex&&u.revoke()},fail:function(e){console.log(e.errMsg)}})},getdetail:function(e){var t=o.default.Query("order_opreations");t.include("opreater","custom","producer","stock"),t.get(e).then(function(e){if(console.log(e),u.detail=e,e.detail)u.products=e.detail,u.bills=e.bills,u.loading=!1;else{var t=o.default.Query("order_opreations");t.include("goodsId"),t.field("relations",e.objectId),t.relation("Bills").then(function(e){u.products=e.results,u.loading=!1})}}).catch(function(e){console.log(e)})},revoke:function(){wx.showModal({title:"提示",content:"数据撤销后不可恢复，请谨慎撤销！",success:function(t){if(t.confirm){e.showLoading({title:"撤销中..."});var n=o.default.Query("order_opreations");n.destroy(u.detail.objectId).then(function(e){for(var t=0;t<u.products.length;t++)u.delete_bill(t)}).catch(function(e){console.log(e)})}}})},delete_bill:function(t){var n=u.products[t],i=u.bills[t],r=o.default.Query("Bills");r.destroy(i).then(function(i){var r=o.default.Query("Goods");r.set("id",n.goodsId.objectId),1==n.type?r.set("reserve",n.goodsId.reserve-n.num):-1==n.type&&r.set("reserve",n.goodsId.reserve+n.num),r.save().then(function(n){t==u.products.length-1&&(e.hideLoading(),e.navigateBack({delta:1}),setTimeout(function(){e.showToast({title:"撤销成功"})},1e3))})})}}};t.default=c}).call(this,n("543d")["default"])},"888e":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i})},"9a0a":function(e,t,n){},a169:function(e,t,n){"use strict";var o=n("9a0a"),i=n.n(o);i.a},be9a:function(e,t,n){"use strict";(function(e){n("bc8c"),n("921b");o(n("66fd"));var t=o(n("f253"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},f253:function(e,t,n){"use strict";n.r(t);var o=n("888e"),i=n("5875");for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);n("a169");var u=n("2877"),a=Object(u["a"])(i["default"],o["a"],o["b"],!1,null,null,null);t["default"]=a.exports}},[["be9a","common/runtime","common/vendor"]]]);