(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/commonNew/good_count/count_detail/count_detail"],{"788d":function(e,t,o){"use strict";o.r(t);var s=o("9c3a"),r=o("a503");for(var n in r)"default"!==n&&function(e){o.d(t,e,(function(){return r[e]}))}(n);o("fd4f");var u,a=o("f0c5"),c=Object(a["a"])(r["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],u);t["default"]=c.exports},"84e5":function(e,t,o){"use strict";(function(e){o("a961"),o("921b");s(o("66fd"));var t=s(o("788d"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},"92bd":function(e,t,o){},"9c3a":function(e,t,o){"use strict";var s,r=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},n=[];o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return n})),o.d(t,"a",(function(){return s}))},a503:function(e,t,o){"use strict";o.r(t);var s=o("ec71"),r=o.n(s);for(var n in s)"default"!==n&&function(e){o.d(t,e,(function(){return s[e]}))}(n);t["default"]=r.a},ec71:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,n=c(o("c74b")),u=c(o("df06")),a=c(o("b410"));function c(e){return e&&e.__esModule?e:{default:e}}var d={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,total_num:0,producer:null,stock:{},nowDay:u.default.getDay(0,!0,!0)}},onLoad:function(){r=this,s=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.total_num+=Number(this.products[t].num)},onShow:function(){r.stock=e.getStorageSync("warehouse")?e.getStorageSync("warehouse")[0].stock:""},methods:{bindDateChange:function(e){r.nowDay=e.detail.value+" 00:00:00"},formSubmit:function(t){if(console.log(t),this.button_disabled=!0,e.showLoading({title:"上传中..."}),null==r.stock||""==r.stock||void 0==r.stock)return e.showToast({icon:"none",title:"请选择盘点仓库"}),e.hideLoading(),void(this.button_disabled=!1);for(var o=new Array,c=[],d=[],i=0;i<this.products.length;i++){var l=n.default.Query("Bills"),f={},m=n.default.Pointer("_User"),g=m.set(s),h=n.default.Pointer("Goods"),p=h.set(this.products[i].header?this.products[i].header.objectId:this.products[i].objectId),v=e.getStorageSync("masterId"),_=n.default.Pointer("_User"),b=_.set(v);if(l.set("goodsName",this.products[i].goodsName),l.set("retailPrice",this.products[i].modify_retailPrice.toString()),l.set("num",Number(this.products[i].num)),l.set("reserve",Number(this.products[i].reserve)),l.set("now_reserve",this.products[i].num),l.set("total_money",this.products[i].total_money),l.set("opreater",b),l.set("goodsId",p),l.set("userId",g),l.set("type",3),l.set("createdTime",{__type:"Date",iso:r.nowDay}),r.stock&&r.stock.objectId){var y=n.default.Pointer("stocks"),S=y.set(r.stock.objectId);l.set("stock",S),d.push(r.stock.objectId),f.stock=r.stock.stock_name}var k={};this.products[i].selectd_model&&(k.selected_model=this.products[i].selected_model,k.models=this.products[i].models,f.goodsId=k),f.goodsName=this.products[i].goodsName,f.reserve=this.products[i].reserve,f.now_reserve=this.products[i].num.toString(),f.packingUnit=this.products[i].packingUnit,o.push(l),c.push(f)}n.default.Query("Bills").saveAll(o).then((function(o){var i=n.default.Pointer("_User"),l=i.set(s),f=e.getStorageSync("masterId"),m=n.default.Pointer("_User"),g=m.set(f),h=n.default.Query("order_opreations");h.set("beizhu",t.detail.value.input_beizhu),h.set("detail",c),h.set("type",3),h.set("opreater",g),h.set("master",l),h.set("goodsName",r.products[0].goodsName),h.set("stockIds",d),h.set("createdTime",{__type:"Date",iso:r.nowDay}),h.save().then((function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品盘点成功",icon:"success",success:function(){for(var t=function(t){var s=0,c=n.default.Query("Goods");c.equalTo("header","==",r.products[t].objectId),c.equalTo("stocks","==",r.stock.objectId),c.find().then((function(n){if(0==n.length)u.default.upload_good_withNoCan(r.products[t],r.stock,Number(r.products[t].num)).then((function(s){c.equalTo("header","==",r.products[t].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(s){var n=s[0]._sumReserve;c.set("id",r.products[t].objectId),c.set("reserve",n),c.save().then((function(s){u.default.modifyStockType(r.products[t].objectId),r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout((function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),u.default.log(e.getStorageSync("user").nickName+"盘点了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",3,o),e.getStorageSync("setting").auto_print&&a.default.autoPrint(o),e.navigateBack({delta:2})}),500)}))}))}));else{var d=n[0];if(c.set("id",d.objectId),r.products[t].selectd_model){var i=!0,l=!1,f=void 0;try{for(var m,g=r.products[t].selected_model[Symbol.iterator]();!(i=(m=g.next()).done);i=!0){var h=m.value;delete h.num}}catch(p){l=!0,f=p}finally{try{i||null==g.return||g.return()}finally{if(l)throw f}}c.set("models",r.products[t].selected_model),s=Number(r.products[t].num)}else s=Number(r.products[t].num);c.set("reserve",s),c.save().then((function(s){c.equalTo("header","==",r.products[t].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(s){var n=s[0]._sumReserve;c.get(r.products[t].objectId).then((function(s){s.set("reserve",n),s.save(),u.default.modifyStockType(r.products[t].objectId),r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout((function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),u.default.log(e.getStorageSync("user").nickName+"盘点了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",3,s.objectId),e.getStorageSync("setting").auto_print&&a.default.autoPrint(o),e.navigateBack({delta:2})}),500)}))}))})).catch((function(e){console.log(e)}))}}))},s=0;s<r.products.length;s++)t(s)}})}))}),(function(e){console.log("异常处理")}))}}};t.default=d}).call(this,o("543d")["default"])},fd4f:function(e,t,o){"use strict";var s=o("92bd"),r=o.n(s);r.a}},[["84e5","common/runtime","common/vendor"]]]);