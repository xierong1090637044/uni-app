(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/commonNew/good_allocation/allocation_detail/allocation_detail"],{"535f":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,s=c(o("c74b")),u=c(o("df06"));c(o("da3f")),c(o("b410")),c(o("428b"));function c(e){return e&&e.__esModule?e:{default:e}}var a={data:function(){return{products:[],in_stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[],all_money:0,real_money:0,total_num:0,nowDay:u.default.getDay(0,!0,!0)}},onLoad:function(){n=this,r=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.total_num+=Number(this.products[t].num);this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){n.in_stock=e.getStorageSync("in_warehouse")?e.getStorageSync("in_warehouse")[0].stock:"",n.out_stock=e.getStorageSync("out_warehouse")?e.getStorageSync("out_warehouse")[0].stock:""},methods:{showHideFunction:function(){n.button_disabled=!1,e.hideLoading(),e.setStorageSync("is_option",!0),e.removeStorageSync("warehouse"),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),e.showToast({title:"调拨成功"}),setTimeout((function(){e.navigateBack({delta:2})}),500)},formSubmit:function(t){if(this.button_disabled=!0,""==n.out_stock||null==n.out_stock)return e.showToast({title:"请选择调入仓库",icon:"none"}),void(this.button_disabled=!1);n.addTbRecord(t)},addTbRecord:function(t){e.showLoading({title:"请勿退出..."});for(var o=s.default.Pointer("stocks"),c=s.default.Pointer("stocks"),a=c.set(n.out_stock.objectId),d=o.set(n.in_stock.objectId),l=new Array,i=[],f=0;f<n.products.length;f++){var m=s.default.Query("Bills"),h={},_=s.default.Pointer("_User"),v=_.set(r),b=s.default.Pointer("_User"),p=b.set(e.getStorageSync("masterId")),y=s.default.Pointer("Goods"),g=y.set(this.products[f].objectId);m.set("goodsName",this.products[f].goodsName),m.set("retailPrice",this.products[f].modify_retailPrice),m.set("num",Number(this.products[f].num)),m.set("total_money",Number(this.products[f].total_money)),m.set("goodsId",g),m.set("userId",v),m.set("type",-2),m.set("opreater",p),m.set("stock",d),m.set("out_stock",a);var S={};h.goodsName=this.products[f].goodsName,h.stock=n.in_stock.stock_name,h.out_stock=n.out_stock.stock_name,h.reserve=this.products[f].reserve,S.objectId=this.products[f].objectId,this.products[f].selectd_model&&(S.selected_model=this.products[f].selected_model,S.models=this.products[f].models),h.goodsId=S,h.num=Number(this.products[f].num),h.type=-2,l.push(m),i.push(h)}s.default.Query("Bills").saveAll(l).then((function(o){for(var c=[],l=0;l<o.length;l++)c.push(o[l].success.objectId);var f=s.default.Pointer("_User"),m=f.set(r),h=e.getStorageSync("masterId"),_=s.default.Pointer("_User"),v=_.set(h),b=s.default.Query("order_opreations");b.set("detail",i),b.set("bills",c),b.set("beizhu",t.detail.value.input_beizhu),b.set("type",-2),b.set("opreater",v),b.set("stock",d),b.set("out_stock",a),b.set("master",m),b.set("goodsName",n.products[0].goodsName),b.save().then((function(e){e.objectId;for(var t=function(e){var t=s.default.Query("Goods");t.equalTo("header","==",n.products[e].objectId),t.equalTo("userId","==",r),t.equalTo("stocks","==",n.out_stock.objectId),t.find().then((function(o){var s,c=o;if(0==c.length)u.default.upload_good_withNoCan(n.products[e],n.out_stock,Number(n.products[e].num),"allocation").then((function(o){t.equalTo("header","==",n.products[e].objectId),t.equalTo("userId","==",r),t.equalTo("stocks","==",n.in_stock.objectId),t.find().then((function(o){if(s=o,0==s.length)u.default.upload_good_withNoCan(n.products[e],n.in_stock,0-Number(n.products[e].num),"allocation").then((function(t){e==n.products.length-1&&n.showHideFunction()}));else{if(n.products[e].selected_model){var r=!0,c=!1,a=void 0;try{for(var d,l=n.products[e].selectd_model[Symbol.iterator]();!(r=(d=l.next()).done);r=!0){var i=d.value,f=!0,m=!1,h=void 0;try{for(var _,v=s[0].models[Symbol.iterator]();!(f=(_=v.next()).done);f=!0){var b=_.value;b.id==i.id&&(b.reserve=Number(b.reserve)-Number(i.num)),delete b.num}}catch(p){m=!0,h=p}finally{try{f||null==v.return||v.return()}finally{if(m)throw h}}}}catch(p){c=!0,a=p}finally{try{r||null==l.return||l.return()}finally{if(c)throw a}}t.set("models",s[0].models)}t.set("reserve",Number(s[0].reserve)-Number(n.products[e].num)),t.set("id",s[0].objectId),t.save().then((function(t){e==n.products.length-1&&n.showHideFunction()})).catch((function(e){console.log(e)}))}}))}));else{if(n.products[e].selected_model){var a=!0,d=!1,l=void 0;try{for(var i,f=n.products[e].selectd_model[Symbol.iterator]();!(a=(i=f.next()).done);a=!0){var m=i.value,h=!0,_=!1,v=void 0;try{for(var b,p=c[0].models[Symbol.iterator]();!(h=(b=p.next()).done);h=!0){var y=b.value;y.id==m.id&&(y.reserve=Number(y.reserve)+Number(m.num)),delete y.num}}catch(g){_=!0,v=g}finally{try{h||null==p.return||p.return()}finally{if(_)throw v}}}}catch(g){d=!0,l=g}finally{try{a||null==f.return||f.return()}finally{if(d)throw l}}t.set("models",c[0].models)}t.set("reserve",Number(c[0].reserve)+Number(n.products[e].num)),t.set("id",c[0].objectId),t.save().then((function(o){t.equalTo("header","==",n.products[e].objectId),t.equalTo("userId","==",r),t.equalTo("stocks","==",n.in_stock.objectId),t.find().then((function(o){if(s=o,0==s.length)u.default.upload_good_withNoCan(n.products[e],n.in_stock,Number(n.products[e].num),"allocation").then((function(t){e==n.products.length-1&&n.showHideFunction()}));else{if(n.products[e].selected_model){var r=!0,c=!1,a=void 0;try{for(var d,l=n.products[e].selectd_model[Symbol.iterator]();!(r=(d=l.next()).done);r=!0){var i=d.value,f=!0,m=!1,h=void 0;try{for(var _,v=s[0].models[Symbol.iterator]();!(f=(_=v.next()).done);f=!0){var b=_.value;b.id==i.id&&(b.reserve=Number(b.reserve)-Number(i.num)),delete b.num}}catch(g){m=!0,h=g}finally{try{f||null==v.return||v.return()}finally{if(m)throw h}}}}catch(g){c=!0,a=g}finally{try{r||null==l.return||l.return()}finally{if(c)throw a}}t.set("models",s[0].models)}t.set("reserve",Number(s[0].reserve)-Number(n.products[e].num)),t.set("id",s[0].objectId),t.save().then((function(t){e==n.products.length-1&&n.showHideFunction()})).catch((function(e){console.log(e)}))}}))})).catch((function(e){console.log(e)}))}}))},o=0;o<n.products.length;o++)t(o)}))}),(function(e){console.log("异常处理")}))}}};t.default=a}).call(this,o("543d")["default"])},"55cb":function(e,t,o){"use strict";o.r(t);var r=o("535f"),n=o.n(r);for(var s in r)"default"!==s&&function(e){o.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},"572b":function(e,t,o){"use strict";var r,n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},s=[];o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return r}))},"5dec":function(e,t,o){"use strict";o.r(t);var r=o("572b"),n=o("55cb");for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);o("68a0");var u,c=o("f0c5"),a=Object(c["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],u);t["default"]=a.exports},"68a0":function(e,t,o){"use strict";var r=o("fc05"),n=o.n(r);n.a},fc05:function(e,t,o){},fc3f:function(e,t,o){"use strict";(function(e){o("a961"),o("921b");r(o("66fd"));var t=r(o("5dec"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])}},[["fc3f","common/runtime","common/vendor"]]]);