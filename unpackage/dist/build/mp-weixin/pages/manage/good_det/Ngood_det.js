(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/manage/good_det/Ngood_det"],{"1b19":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=s(t("9546")),r=s(t("856d")),d=s(t("7fd5"));function s(e){return e&&e.__esModule?e:{default:e}}var c,a,u=function(){return t.e("components/kilvn-fa-icon/fa-icon").then(t.bind(null,"4d52"))},i=function(){return Promise.all([t.e("common/vendor"),t.e("components/tki-qrcode/tki-qrcode")]).then(t.bind(null,"13d4"))},l=function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"7aeb"))},f={components:{uniPopup:l,faIcon:u,tkiQrcode:i},data:function(){return{user:e.getStorageSync("user"),badnum:{num:"",desc:""},bad_numshow:!1,loading:!0,select_qrcode:"",get_reserve_checked:!0,product:{},is_show:!1,bar_code_show:!1,selected_item:""}},onLoad:function(o){c=this,a=e.getStorageSync("uid"),e.removeStorageSync("now_model"),e.removeStorageSync("warehouse"),console.log(o),o.id?c.getDetail_byId(o.id,o.type):c.getDetail_noId()},onShow:function(){if(e.getStorageSync("warehouse")){var o=e.getStorageSync("warehouse");e.showModal({title:"提示",content:"是否将该产品添加到"+o[0].stock.stock_name+"这个仓库",success:function(t){if(t.confirm){var r=n.default.Query("Goods");r.equalTo("userId","==",a),r.equalTo("header","==",c.product.objectId),r.equalTo("stocks","==",o[0].stock.objectId),r.find().then(function(t){console.log(t),0==t.length?c.upload_good_withNoCan(c.product,o[0].stock).then(function(o){o[0]&&(e.removeStorageSync("warehouse"),e.showToast({title:"关联成功",icon:"none"}),c.getDetail_noId())}):e.showToast({title:"该仓库已有此产品",icon:"none"})})}else t.cancel&&e.removeStorageSync("warehouse")}})}},onShareAppMessage:function(e){return"button"===e.from&&console.log(e.target),{title:"库存表-"+c.product.goodsName+"的详情",path:"/pages/manage/good_det/good_det?id="+c.product.objectId+'&type="false"'}},methods:{upload_good_withNoCan:function(o,t){return new Promise(function(r,d){var s=e.getStorageSync("uid"),c=n.default.Pointer("_User"),a=c.set(s),u=n.default.Pointer("stocks"),i=u.set(t.objectId),l=n.default.Pointer("Goods"),f=l.set(o.objectId),g=n.default.Query("Goods");if(g.set("goodsName",o.goodsName),g.set("costPrice",o.costPrice),g.set("retailPrice",o.retailPrice),o.models){var _=!0,m=!1,h=void 0;try{for(var v,p=o.models[Symbol.iterator]();!(_=(v=p.next()).done);_=!0){var b=v.value;b.reserve=0}}catch(y){m=!0,h=y}finally{try{_||null==p.return||p.return()}finally{if(m)throw h}}g.set("models",o.models)}g.set("reserve",0),g.set("stocks",i),g.set("header",f),g.set("order",1),g.set("userId",a),g.save().then(function(e){console.log(e),r([!0,e])}).catch(function(e){console.log(e)})})},delete_singlegood:function(o){e.showModal({title:"提示",content:"是否删除该商品",success:function(e){if(e.confirm){var t=n.default.Query("Goods");t.destroy(o).then(function(e){console.log(e);var o=n.default.Query("Goods");o.equalTo("header","==",c.product.objectId),o.equalTo("order","==",1),o.statTo("sum","reserve"),o.find().then(function(e){var o=e[0]._sumReserve,t=n.default.Query("Goods");t.set("reserve",o),t.set("id",c.product.objectId),t.save().then(function(e){d.default.modifyStockType(c.product.objectId),c.getDetail_noId()})})}).catch(function(e){console.log(e)})}}})},getDetail_byId:function(o,t){var r=this;c.select_qrcode="";var s=[];e.showLoading({title:"加载中..."});var u=n.default.Query("Goods");"false"==t?u.equalTo("objectId","==",o):u.equalTo("productCode","==",o),u.equalTo("userId","==",a),u.find().then(function(o){console.log(o),r.product=o[0];var t=o[0],n=0;e.setStorageSync("now_product",t),u.equalTo("userId","==",a),u.equalTo("status","!=",-1),u.include("stocks","goodsClass","second_class"),u.equalTo("goodsName","==",t.goodsName),u.find().then(function(o){var a=!0,u=!1,i=void 0;try{for(var l,f=o[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var g=l.value;if(0!=g.order){var _={};_.stock_name=g.stocks.stock_name,_.objectId=g.stocks.objectId,_.reserve=g.reserve.toFixed(e.getStorageSync("setting").show_float),_.good_id=g.objectId,_.now_model=g.models,g.stocks=_,n+=g.reserve,s.push(g.stocks)}}}catch(m){u=!0,i=m}finally{try{a||null==f.return||f.return()}finally{if(u)throw i}}2==c.user.identity&&c.user.rights&&-1!=c.user.rights.othercurrent.indexOf("0")&&(t.costPrice=0),r.product=t,r.product.nousetime&&(r.product.nousetime=d.default.js_date_time(r.product.nousetime)),r.product.all_reserve=n.toFixed(e.getStorageSync("setting").show_float),r.product.reserve=n.toFixed(e.getStorageSync("setting").show_float),r.product.stocks=s,c.select_qrcode=t.productCode?t.productCode+"-"+!0+"-new":t.objectId+"-"+!1+"-new",c.loading=!1,e.hideLoading()})})},getDetail_noId:function(){var o=this,t=[];c.select_qrcode="";var r=e.getStorageSync("now_product"),s=0;e.showLoading({title:"加载中..."});var u=n.default.Query("Goods");u.equalTo("userId","==",a),u.equalTo("status","!=",-1),u.include("stocks","goodsClass","second_class"),u.equalTo("goodsName","==",r.goodsName),u.find().then(function(n){var a=!0,u=!1,i=void 0;try{for(var l,f=n[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var g=l.value;if(0!=g.order){var _={};_.stock_name=g.stocks.stock_name,_.objectId=g.stocks.objectId,_.reserve=g.reserve.toFixed(e.getStorageSync("setting").show_float),_.good_id=g.objectId,_.now_model=g.models,g.stocks=_,s+=g.reserve,t.push(g.stocks)}}}catch(m){u=!0,i=m}finally{try{a||null==f.return||f.return()}finally{if(u)throw i}}2==c.user.identity&&c.user.rights&&-1!=c.user.rights.othercurrent.indexOf("0")&&(r.costPrice=0),o.product=r,o.product.nousetime&&(o.product.nousetime=d.default.js_date_time(o.product.nousetime)),o.product.all_reserve=s.toFixed(e.getStorageSync("setting").show_float),o.product.reserve=s.toFixed(e.getStorageSync("setting").show_float),o.product.stocks=t,c.select_qrcode=r.productCode?r.productCode+"-"+!0+"-new":r.objectId+"-"+!1+"-new",c.loading=!1,e.hideLoading(),e.setStorageSync("now_product",o.product)})},confrim_badnum:function(){if(console.log(c.selected_item),c.badnum.num){var o=n.default.Pointer("_User"),t=o.set(e.getStorageSync("masterId")),r=n.default.Pointer("Goods"),d=r.set(c.selected_item.objectId),s=c.selected_item.objectId,a=Number(c.selected_item.bad_num?c.selected_item.bad_num:0),u=a+Number(c.badnum.num),i=n.default.Query("bad_goods");i.set("bad_num",c.badnum.num),i.set("beizhu_text",c.badnum.desc),i.set("operater",t),i.set("goods",d),i.equalTo("order","!=",0),i.save().then(function(o){var t=n.default.Query("Goods");t.set("id",s),t.set("bad_num",Number(u)),t.save().then(function(o){c.bad_numshow=!1,e.showToast({title:"记录成功"})}),c.getDetail_noId()})}else e.showToast({title:"请输入货损数量",icon:"none"})},add_badnum:function(e){c.bad_numshow=!0,c.selected_item=e},show_qrcode:function(e){c.is_show=!0,c.select_qrcode=e.productCode?e.productCode+"-"+!0+"-new":e.objectId+"-"+!1+"-new"},change_state:function(e){c.get_reserve_checked=e.detail.value},print_info:function(e){console.log(e),r.default.print_goodDet(e)},modify:function(){e.navigateTo({url:"../good_add/good_add?type=more"})},qrR:function(e){this.src=e},bcR:function(e){this.src=e},saveBccode:function(){this.$refs.barcode._saveCode()},saveQrcode:function(){this.$refs.qrcode._saveCode()},delete_good:function(o){var t=e.getStorageSync("uid");e.showModal({title:"提示",content:"是否删除该商品",success:function(r){if(r.confirm){e.setStorageSync("is_add",!0);var d=n.default.Query("Goods");d.destroy(o).then(function(r){var d=n.default.Query("Goods");d.equalTo("header","==",o),d.equalTo("userId","==",t),d.find().then(function(o){o.destroyAll().then(function(o){console.log(o,"ok"),e.navigateBack({delta:1}),setTimeout(function(){e.showToast({title:"删除成功"})},1e3)}).catch(function(e){console.log(e)})})}).catch(function(e){console.log(e)})}}})}}};o.default=f}).call(this,t("543d")["default"])},6551:function(e,o,t){},"7c07":function(e,o,t){"use strict";var n=t("6551"),r=t.n(n);r.a},8621:function(e,o,t){"use strict";t.r(o);var n=t("be44"),r=t("c51d");for(var d in r)"default"!==d&&function(e){t.d(o,e,function(){return r[e]})}(d);t("7c07");var s,c=t("f0c5"),a=Object(c["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);o["default"]=a.exports},aa9a:function(e,o,t){"use strict";(function(e){t("d510"),t("921b");n(t("66fd"));var o=n(t("8621"));function n(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,t("543d")["createPage"])},be44:function(e,o,t){"use strict";var n,r=function(){var e=this,o=e.$createElement;e._self._c;e._isMounted||(e.e0=function(o){e.bad_numshow=!1})},d=[];t.d(o,"b",function(){return r}),t.d(o,"c",function(){return d}),t.d(o,"a",function(){return n})},c51d:function(e,o,t){"use strict";t.r(o);var n=t("1b19"),r=t.n(n);for(var d in n)"default"!==d&&function(e){t.d(o,e,function(){return n[e]})}(d);o["default"]=r.a}},[["aa9a","common/runtime","common/vendor"]]]);