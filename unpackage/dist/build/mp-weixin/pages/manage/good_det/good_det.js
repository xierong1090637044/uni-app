(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/manage/good_det/good_det"],{"0185":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(o("93d5")),d=r(o("844a")),c=r(o("2839"));function r(e){return e&&e.__esModule?e:{default:e}}var u,a,s=function(){return o.e("components/kilvn-fa-icon/fa-icon").then(o.bind(null,"d7ee"))},i=function(){return Promise.all([o.e("common/vendor"),o.e("components/tki-qrcode/tki-qrcode")]).then(o.bind(null,"8ae0"))},l=function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"5810"))},f={components:{uniPopup:l,faIcon:s,tkiQrcode:i},data:function(){return{user:e.getStorageSync("user"),badnum:{num:"",desc:""},bad_numshow:!1,loading:!0,select_qrcode:"",get_reserve_checked:!0,product:{},is_show:!1,bar_code_show:!1,selected_item:""}},onLoad:function(t){u=this,a=e.getStorageSync("uid"),e.removeStorageSync("now_model"),console.log(t),t.id?u.getDetail_byId(t.id,t.type):u.getDetail_noId()},onShareAppMessage:function(e){return"button"===e.from&&console.log(e.target),{title:"高明燃气库存管理-"+product.goodsName+"的详情",path:"/pages/manage/good_det/good_det?id="+product.objectId+'&type="false"'}},methods:{getDetail_byId:function(t,o){var d=this,r=[];e.showLoading({title:"加载中..."});var s=n.default.Query("NGoods");"false"==o?s.equalTo("objectId","==",t):s.equalTo("productCode","==",t),s.equalTo("userId","==",a),s.equalTo("order","!=",1),s.find().then(function(t){console.log(t),d.product=t[0];var o=t[0],n=0;e.setStorageSync("now_product",o),s.equalTo("userId","==",a),s.equalTo("status","!=",-1),s.include("stocks","goodsClass","second_class"),s.equalTo("header","==",o.objectId),s.find().then(function(t){var a=!0,s=!1,i=void 0;try{for(var l,f=t[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var _=l.value;if(1==_.order){var g={};g.stock_name=_.stocks.stock_name,g.objectId=_.stocks.objectId,g.reserve=_.reserve.toFixed(e.getStorageSync("setting").show_float),g.good_id=_.objectId,_.stocks=g,n+=_.reserve,r.push(_.stocks)}}}catch(m){s=!0,i=m}finally{try{a||null==f.return||f.return()}finally{if(s)throw i}}d.product.nousetime&&(d.product.nousetime=c.default.js_date_time(d.product.nousetime)),d.product.all_reserve=n.toFixed(e.getStorageSync("setting").show_float),d.product.stocks=r,u.select_qrcode=o.productCode?o.productCode:o.objectId+"-"+!1,u.loading=!1,e.hideLoading(),console.log(d.product)})})},getDetail_noId:function(){var t=this,o=[],d=e.getStorageSync("now_product"),r=0;e.showLoading({title:"加载中..."});var s=n.default.Query("NGoods");s.equalTo("userId","==",a),s.equalTo("status","!=",-1),s.include("stocks","goodsClass","second_class"),s.equalTo("header","==",d.objectId),s.find().then(function(n){var a=!0,s=!1,i=void 0;try{for(var l,f=n[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var _=l.value;if(1==_.order){var g={};g.stock_name=_.stocks.stock_name,g.objectId=_.stocks.objectId,g.reserve=_.reserve.toFixed(e.getStorageSync("setting").show_float),g.good_id=_.objectId,_.stocks=g,r+=_.reserve,o.push(_.stocks)}}}catch(m){s=!0,i=m}finally{try{a||null==f.return||f.return()}finally{if(s)throw i}}t.product=d,t.product.nousetime&&(t.product.nousetime=c.default.js_date_time(t.product.nousetime)),t.product.all_reserve=r.toFixed(e.getStorageSync("setting").show_float),t.product.stocks=o,u.select_qrcode=d.productCode?d.productCode:d.objectId+"-"+!1,u.loading=!1,e.hideLoading(),e.setStorageSync("now_product",t.product),console.log(t.product)})},confrim_badnum:function(){if(console.log(u.selected_item),u.badnum.num){var t=n.default.Pointer("_User"),o=t.set(e.getStorageSync("masterId")),d=n.default.Pointer("NGoods"),c=d.set(u.selected_item.objectId),r=u.selected_item.objectId,a=Number(u.selected_item.bad_num?u.selected_item.bad_num:0),s=a+Number(u.badnum.num),i=n.default.Query("bad_goods");i.set("bad_num",u.badnum.num),i.set("beizhu_text",u.badnum.desc),i.set("operater",o),i.set("goods",c),i.equalTo("order","!=",0),i.save().then(function(t){var o=n.default.Query("NGoods");o.set("id",r),o.set("bad_num",Number(s)),o.save().then(function(t){u.bad_numshow=!1,e.showToast({title:"记录成功"})}),u.getDetail_noId()})}else e.showToast({title:"请输入货损数量",icon:"none"})},add_badnum:function(e){u.bad_numshow=!0,u.selected_item=e},show_qrcode:function(e){u.is_show=!0,u.select_qrcode=e.productCode?e.productCode:e.objectId+"-"+!1},change_state:function(e){u.get_reserve_checked=e.detail.value},print_info:function(e){d.default.print_goodDet(e)},modify:function(){e.navigateTo({url:"../good_add/good_add"})},qrR:function(e){this.src=e},bcR:function(e){this.src=e},saveBccode:function(){this.$refs.barcode._saveCode()},saveQrcode:function(){this.$refs.qrcode._saveCode()},delete_good:function(t){var o=e.getStorageSync("uid");e.showModal({title:"提示",content:"是否删除该商品",success:function(d){if(d.confirm){e.setStorageSync("is_add",!0);var c=n.default.Query("NGoods");c.destroy(t).then(function(d){var c=n.default.Query("NGoods");c.equalTo("header","==",t),c.equalTo("userId","==",o),c.find().then(function(t){t.destroyAll().then(function(t){console.log(t,"ok"),e.navigateBack({delta:1}),setTimeout(function(){e.showToast({title:"删除成功"})},1e3)}).catch(function(e){console.log(e)})})}).catch(function(e){console.log(e)})}}})}}};t.default=f}).call(this,o("543d")["default"])},"621a":function(e,t,o){"use strict";var n,d=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.bad_numshow=!1})},c=[];o.d(t,"b",function(){return d}),o.d(t,"c",function(){return c}),o.d(t,"a",function(){return n})},"6e7a":function(e,t,o){},c781:function(e,t,o){"use strict";(function(e){o("9787"),o("921b");n(o("66fd"));var t=n(o("f460"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},e19e:function(e,t,o){"use strict";o.r(t);var n=o("0185"),d=o.n(n);for(var c in n)"default"!==c&&function(e){o.d(t,e,function(){return n[e]})}(c);t["default"]=d.a},f460:function(e,t,o){"use strict";o.r(t);var n=o("621a"),d=o("e19e");for(var c in d)"default"!==c&&function(e){o.d(t,e,function(){return d[e]})}(c);o("f671");var r,u=o("f0c5"),a=Object(u["a"])(d["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);t["default"]=a.exports},f671:function(e,t,o){"use strict";var n=o("6e7a"),d=o.n(n);d.a}},[["c781","common/runtime","common/vendor"]]]);