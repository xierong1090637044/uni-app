(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/manage/goods_add/goods_add"],{"24cf":function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement;e._self._c;e._isMounted||(e.e0=function(o){e.stocks=""})},c=[];t.d(o,"a",function(){return n}),t.d(o,"b",function(){return c})},"2d5d":function(e,o,t){"use strict";t.r(o);var n=t("edca"),c=t.n(n);for(var s in n)"default"!==s&&function(e){t.d(o,e,function(){return n[e]})}(s);o["default"]=c.a},"349c":function(e,o,t){"use strict";var n=t("e565"),c=t.n(n);c.a},"391e":function(e,o,t){"use strict";t.r(o);var n=t("24cf"),c=t("2d5d");for(var s in c)"default"!==s&&function(e){t.d(o,e,function(){return c[e]})}(s);t("349c");var a=t("2877"),r=Object(a["a"])(c["default"],n["a"],n["b"],!1,null,null,null);o["default"]=r.exports},ddd7:function(e,o,t){"use strict";(function(e){t("a961"),t("921b");n(t("66fd"));var o=n(t("391e"));function n(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,t("543d")["createPage"])},e565:function(e,o,t){},edca:function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=s(t("df06")),c=s(t("c74b"));function s(e){return e&&e.__esModule?e:{default:e}}var a,r,u=function(){return t.e("components/kilvn-fa-icon/fa-icon").then(t.bind(null,"0914"))},d=function(){return t.e("components/uni-collapse/uni-collapse").then(t.bind(null,"bd14"))},i=function(){return t.e("components/uni-collapse-item/uni-collapse-item").then(t.bind(null,"18d6"))},l="",g="",f={components:{uniCollapse:d,uniCollapseItem:i,faIcon:u},data:function(){return{goodsName:"",costPrice:"",retailPrice:"",packageContent:"",packingUnit:"",warning_num:"",producer:"",regNumber:"",position:"",product_info:"",productCode:"",category:"",goodsIcon:"",stocks:[],producttime:"",nousetime:"",product_state:!1}},onLoad:function(o){a=this,r=e.getStorageSync("uid"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),e.removeStorageSync("is_add")},onShow:function(){if(e.getStorageSync("warehouse")&&(a.stocks=e.getStorageSync("warehouse")),e.getStorageSync("category")){a.category=e.getStorageSync("category");var o=c.default.Pointer("class_user");l=o.set(a.category.parent.objectId);var t=c.default.Pointer("second_class");g=t.set(a.category.objectId),console.log(a.category.parent.objectId,a.category.objectId)}},onUnload:function(){"",l="",g="",n.default.handleData()},methods:{upload_image:function(){e.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){console.log(e),a.goodsIcon=e.tempFilePaths[0]}})},change_reserve:function(o,t){a.stocks[t].reserve=o.detail.value,e.setStorageSync("warehouse",a.stocks)},change_warningnum:function(o,t){a.stocks[t].warning_num=o.detail.value,e.setStorageSync("warehouse",a.stocks)},remove_stock:function(o){a.stocks.splice(o,1),e.setStorageSync("warehouse",a.stocks)},scan_by_id:function(e){console.log(e),wx.showLoading({title:"加载中..."}),wx.request({url:"https://route.showapi.com/66-22",data:{showapi_appid:"84916",showapi_sign:"ad4b63369c834759b411a9d7fcb07ed7",code:e},header:{"content-type":"application/json"},success:function(o){wx.hideLoading();var t=o.data.showapi_res_body;console.log(t),a.goodsName=t.goodsName,a.producer=t.manuName,a.goodsIcon=t.img,a.product_info=t.note,a.productCode=e}})},scan_code:function(){e.scanCode({onlyFromCamera:!0,success:function(e){console.log("条码类型："+e.scanType),console.log("条码内容："+e.result),a.productCode=e.result}})},bindproducttimeChange:function(e){a.producttime=e.target.value},bindDateChange:function(e){a.nousetime=e.target.value},formSubmit:function(o){console.log(o.detail.value);var t,n=o.detail.value;""==n.goodsName?e.showToast({title:"请输入产品名称",icon:"none"}):a.goodsIcon?(t=c.default.File(n.goodsName+".png",a.goodsIcon),t.save().then(function(e){console.log("图片地址",e),a.goodsIcon=e[0].url,a.upload_good(n)})):a.upload_good(n)},upload_good:function(o){e.showLoading({title:"上传中..."});var t=c.default.Query("Goods");t.equalTo("userId","==",r),t.equalTo("goodsName","==",o.goodsName),t.find().then(function(t){t.length>=1?e.showToast({title:"你的库存中已存在此产品",icon:"none"}):a.add_good(o,"add")})},add_good:function(o,t){var s=c.default.Pointer("_User"),u=s.set(r),d=function(t){var s=a.stocks[t].stock.objectId,r=c.default.Pointer("stocks"),d=r.set(s),i=c.default.Query("Goods");i.set("goodsIcon",a.goodsIcon),i.set("goodsName",o.goodsName),i.set("costPrice",o.costPrice?o.costPrice:"0"),i.set("retailPrice",o.retailPrice?o.retailPrice:"0"),i.set("regNumber",o.regNumber),i.set("reserve",Number(a.stocks[t].reserve)),i.set("productCode",o.productCode),i.set("stocks",d),i.set("product_info",o.product_info),i.set("producer",o.producer),i.set("packingUnit",o.packingUnit),i.set("packageContent",o.packageContent),i.set("position",o.position),i.set("warning_num",Number(a.stocks[t].warning_num)),i.set("stocktype",Number(a.stocks[t].warning_num)>=Number(a.stocks[t].reserve)?0:1),i.set("order",Number(t)),t>0&&i.set("accessory",!0),i.set("product_state",o.product_state),e.getStorageSync("category")&&(i.set("second_class",g),i.set("goodsClass",l)),i.set("userId",u),i.set("id",e.getStorageSync("now_product")?e.getStorageSync("now_product").objectId:""),i.save().then(function(c){e.hideLoading(),t==a.stocks.length-1&&n.default.log(e.getStorageSync("user").nickName+"增加了产品'"+o.goodsName+"'",6,c.objectId),e.setStorageSync("is_add",!0),e.showToast({title:"上传成功"})}).catch(function(e){console.log(e)})};for(var i in a.stocks)d(i)},handledata:function(){a.goodsName="",a.costPrice="",a.retailPrice="",a.packageContent="",a.packingUnit="",a.warning_num="",a.producer="",a.regNumber="",a.position="",a.product_info="",a.productCode="",a.category="",a.reserve=0,a.goodsIcon="",a.stocks="",a.stock_name="",a.producttime="",a.nousetime=""}}};o.default=f}).call(this,t("543d")["default"])}},[["ddd7","common/runtime","common/vendor"]]]);