(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/goods-select/goods-select"],{"10b1":function(o,t,e){"use strict";e.r(t);var n=e("70da"),r=e("bfcd");for(var i in r)"default"!==i&&function(o){e.d(t,o,function(){return r[o]})}(i);e("d431");var a=e("2877"),c=Object(a["a"])(r["default"],n["a"],n["b"],!1,null,null,null);t["default"]=c.exports},"29f2":function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(e("c74b"));function r(o){return o&&o.__esModule?o:{default:o}}var i,a,c=function(){return e.e("components/kilvn-fa-icon/fa-icon").then(e.bind(null,"0914"))},l=function(){return e.e("components/Loading/index").then(e.bind(null,"524a"))},u=function(){return e.e("components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"b92d"))},s=function(){return e.e("components/uni-icon/uni-icon").then(e.bind(null,"5753"))},d=function(){return e.e("components/uni-pagination/uni-pagination").then(e.bind(null,"2bfc"))},g=[],f=[],y=[],_="",h=30,m=1,p={components:{loading:l,uniNavBar:u,faIcon:c,uniIcon:s,uniPagination:d},data:function(){return{selectd_model:"",models_good:"",models_good_key:"",page_num:1,search_text:"",url:null,showOptions:!1,loading:!0,productList:null,checked_option:"createdAt",category:"",stock:"",type:""}},onLoad:function(t){a=this,this.handle_data(),"entering"==t.type?this.url="../good_confrim/good_confrim":"delivery"==t.type?this.url="../goods_out/goods_out":"returing"==t.type?this.url="../good_return/good_return":"counting"==t.type?this.url="../good_count/good_count":"allocation"==t.type&&(this.url="../good_allocation/good_allocation"),this.type=t.type,i=o.getStorageSync("uid"),a.get_productList()},onShow:function(){o.removeStorageSync("products"),o.getStorageSync("category")&&(a.showOptions=!0,a.category=o.getStorageSync("category")),o.getStorageSync("warehouse")&&(a.showOptions=!0,a.stock=o.getStorageSync("warehouse")[o.getStorageSync("warehouse").length-1].stock),o.getStorageSync("is_option")&&(this.productList=[],a.get_productList())},onHide:function(){_="",h=30,g=[],y=[],f=[],o.removeStorageSync("is_option")},onUnload:function(){_="",h=30,g=[],y=[],f=[],o.removeStorageSync("is_option")},methods:{hide_mask:function(){a.models_good=""},change_page:function(o){m=o.current,a.get_productList()},shaixuan:function(){a.showOptions=!0},confirm:function(o){_=o.detail.value,a.search_text=o.detail.value,a.page_num=1,m=1,a.get_productList()},confrim_this:function(){this.go_goodsconfrim()},option_reset:function(){this.productList=[],o.removeStorageSync("category"),o.removeStorageSync("warehouse"),a.category="",a.stock="",a.showOptions=!1,a.get_productList()},option_confrim:function(){this.productList=[],o.getStorageSync("category")&&(a.category=o.getStorageSync("category")),o.getStorageSync("warehouse")&&(a.stock=o.getStorageSync("warehouse")[o.getStorageSync("warehouse").length-1].stock),a.showOptions=!1,a.get_productList()},selectd:function(o){h=30,a.checked_option=o,a.get_productList()},modelChange:function(o){a.selectd_model=o.detail.value,console.log(o.detail.value)},confrim_thismodel:function(){if(a.selectd_model){console.log(a.models_good);var t=a.models_good.key;y.splice(a.models_good_key-1,1),a.models_good.is_selected=!0,a.models_good.selectd_model=JSON.stringify(a.selectd_model),y.push(JSON.stringify(a.models_good)),a.productList.splice(t,1,a.models_good),a.models_good=""}else o.showToast({title:"请选择规格",icon:"none"})},radioChange:function(o){console.log(o);var t=0;if(_?f[m-1]=o.detail.value:g[m-1]=o.detail.value,y=f.concat(g),y=y.reduce(function(o,t){return o.concat(t)}),"allocation"!=this.type){var e=!0,n=!1,r=void 0;try{for(var i,c=y[Symbol.iterator]();!(e=(i=c.next()).done);e=!0){var l=i.value;l=JSON.parse(l),console.log(l),t+=1,l.models&&l.models.length>0&&1!=l.is_selected&&(a.models_good=l,a.models_good_key=t)}}catch(u){n=!0,r=u}finally{try{e||null==c.return||c.return()}finally{if(n)throw r}}}},go_goodsconfrim:function(){console.log(y),0==y.length?o.showToast({title:"请选择产品",icon:"none"}):"allocation"==this.type?this.stock?this.confrim_next():o.showToast({title:"请在筛选中选择调拨的仓库",icon:"none"}):"counting"==this.type?this.stock?this.confrim_next():o.showToast({title:"请在筛选中选择要盘点的仓库",icon:"none"}):this.confrim_next()},confrim_next:function(){var t=0;if("entering"==this.type){var e=!0,n=!1,r=void 0;try{for(var i,a=y[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var c=i.value;y[t]=JSON.parse(c),y[t].num=1,y[t].total_money=1*y[t].costPrice,y[t].modify_retailPrice=y[t].costPrice,t+=1}}catch(_){n=!0,r=_}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}else{var l=!0,u=!1,s=void 0;try{for(var d,g=y[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var f=d.value;y[t]=JSON.parse(f),y[t].num=1,y[t].total_money=1*y[t].retailPrice,y[t].modify_retailPrice=y[t].retailPrice,t+=1}}catch(_){u=!0,s=_}finally{try{l||null==g.return||g.return()}finally{if(u)throw s}}}o.setStorageSync("products",y),o.navigateTo({url:this.url})},get_productList:function(){var o=this;a.productList=[];var t=n.default.Query("Goods");t.include("stocks"),t.equalTo("userId","==",i),t.equalTo("stocks","==",a.stock.objectId),t.equalTo("status","!=",-1),t.equalTo("second_class","==",a.category.objectId);var e=t.equalTo("goodsName","==",{$regex:_+".*"}),r=t.equalTo("packageContent","==",{$regex:_+".*"});t.or(e,r),t.limit(h),t.skip(h*(m-1)),t.order("-"+a.checked_option),t.find().then(function(t){var e=0;if(y.length>=1){var n=!0,r=!1,i=void 0;try{for(var a,c=y[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value,u=!0,s=!1,d=void 0;try{for(var g,f=t[Symbol.iterator]();!(u=(g=f.next()).done);u=!0){var _=g.value;_.objectId==JSON.parse(l).objectId&&(_.checked=!0,_.key=e,e+=1)}}catch(w){s=!0,d=w}finally{try{u||null==f.return||f.return()}finally{if(s)throw d}}}}catch(w){r=!0,i=w}finally{try{n||null==c.return||c.return()}finally{if(r)throw i}}}else{var h=!0,m=!1,p=void 0;try{for(var v,S=t[Symbol.iterator]();!(h=(v=S.next()).done);h=!0){var b=v.value;b.key=e,e+=1}}catch(w){m=!0,p=w}finally{try{h||null==S.return||S.return()}finally{if(m)throw p}}}o.productList=t,o.loading=!1})},handle_data:function(){o.removeStorageSync("category"),o.removeStorageSync("warehouse"),o.removeStorageSync("out_warehouse"),o.removeStorageSync("shop"),_="",h=30}}};t.default=p}).call(this,e("543d")["default"])},"70da":function(o,t,e){"use strict";var n=function(){var o=this,t=o.$createElement,e=(o._self._c,o.__map(o.productList,function(t,e){var n=JSON.stringify(t);return{$orig:o.__get_orig(t),g0:n}})),n=o.__map(o.models_good.models,function(t,e){var n=JSON.stringify(t);return{$orig:o.__get_orig(t),g1:n}});o.$mp.data=Object.assign({},{$root:{l0:e,l1:n}})},r=[];e.d(t,"a",function(){return n}),e.d(t,"b",function(){return r})},"82b8":function(o,t,e){},b5e1:function(o,t,e){"use strict";(function(o){e("a961"),e("921b");n(e("66fd"));var t=n(e("10b1"));function n(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,e("543d")["createPage"])},bfcd:function(o,t,e){"use strict";e.r(t);var n=e("29f2"),r=e.n(n);for(var i in n)"default"!==i&&function(o){e.d(t,o,function(){return n[o]})}(i);t["default"]=r.a},d431:function(o,t,e){"use strict";var n=e("82b8"),r=e.n(n);r.a}},[["b5e1","common/runtime","common/vendor"]]]);