(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/goods-select/goods-select"],{3439:function(e,o,t){"use strict";t.r(o);var n=t("853f"),r=t.n(n);for(var i in n)"default"!==i&&function(e){t.d(o,e,function(){return n[e]})}(i);o["default"]=r.a},"463d":function(e,o,t){"use strict";var n=t("be2e"),r=t.n(n);r.a},"61ed":function(e,o,t){"use strict";t.r(o);var n=t("ea63"),r=t("3439");for(var i in r)"default"!==i&&function(e){t.d(o,e,function(){return r[e]})}(i);t("463d");var c=t("2877"),a=Object(c["a"])(r["default"],n["a"],n["b"],!1,null,null,null);o["default"]=a.exports},"853f":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=r(t("906f"));function r(e){return e&&e.__esModule?e:{default:e}}var i,c,a=function(){return t.e("components/kilvn-fa-icon/fa-icon").then(t.bind(null,"eaf0"))},l=function(){return t.e("components/Loading/index").then(t.bind(null,"c7fb"))},s=function(){return t.e("components/uni-nav-bar/uni-nav-bar").then(t.bind(null,"f4e7"))},u=function(){return t.e("components/uni-icon/uni-icon").then(t.bind(null,"36cf"))},d=function(){return t.e("components/uni-pagination/uni-pagination").then(t.bind(null,"69ef"))},g=[],f=[],y=[],_="",h=30,m=1,p=1,v={components:{loading:l,uniNavBar:s,faIcon:a,uniIcon:u,uniPagination:d},data:function(){return{identity:e.getStorageSync("identity"),selectd_model:"",models_good:"",models_good_key:"",page_num:1,search_text:"",url:null,showOptions:!1,loading:!0,productList:null,checked_option:"createdAt",category:"",stock:"",type:"",is_selected:!1}},onLoad:function(o){c=this,this.handle_data(),"entering"==o.type?this.url="../good_confrim/good_confrim":"delivery"==o.type?this.url="../goods_out/goods_out":"returing"==o.type?this.url="../good_return/good_return":"counting"==o.type?this.url="../good_count/good_count":"allocation"==o.type&&(this.url="../good_allocation/good_allocation"),this.type=o.type,i=e.getStorageSync("uid"),c.get_productList()},onShow:function(){e.getStorageSync("category")&&(c.showOptions=!0,c.category=e.getStorageSync("category")),e.getStorageSync("warehouse")&&(c.showOptions=!0,c.stock=e.getStorageSync("warehouse")[e.getStorageSync("warehouse").length-1].stock),e.getStorageSync("is_option")&&(_="",h=30,p=1,y=[],g=[],f=[],this.productList=[],c.get_productList())},onUnload:function(){_="",h=30,p=1,y=[],g=[],f=[],e.removeStorageSync("is_option")},methods:{hide_mask:function(){c.models_good=""},reserveTo:function(){e.showModal({title:"提示（暂时只支持500条）",content:"是否将所有库存都归0，归0后不可恢复",success:function(e){if(e.confirm){var o=n.default.Query("Goods");o.equalTo("userId","==",i),o.equalTo("status","!=",-1),o.limit(500),o.find().then(function(e){e.set("reserve",0),e.saveAll().then(function(e){console.log(e,"ok")}).catch(function(e){console.log(e)})})}else e.cancel&&console.log("用户点击取消")}})},change_page:function(e){m=e.current,_&&m>1&&(p+=1),c.get_productList()},shaixuan:function(){c.showOptions=!0},confirm:function(e){_=e.detail.value,c.search_text=e.detail.value,c.page_num=1,m=1,p+=1,c.get_productList()},confrim_this:function(){this.go_goodsconfrim()},option_reset:function(){this.productList=[],e.removeStorageSync("category"),e.removeStorageSync("warehouse"),c.category="",c.stock="",c.showOptions=!1,c.get_productList()},option_confrim:function(){e.getStorageSync("category")&&(p+=1,c.is_selected=!0,c.category=e.getStorageSync("category")),e.getStorageSync("warehouse")&&(p+=1,c.is_selected=!0,c.stock=e.getStorageSync("warehouse")[e.getStorageSync("warehouse").length-1].stock),c.showOptions=!1,c.get_productList()},selectd:function(e){h=30,c.checked_option=e,c.get_productList()},modelChange:function(e){c.selectd_model=e.detail.value,console.log(e.detail.value)},confrim_thismodel:function(){if(c.selectd_model){console.log(c.models_good);var o=c.models_good.key;y.splice(c.models_good_key-1,1),c.models_good.is_selected=!0,c.models_good.selectd_model=JSON.stringify(c.selectd_model),y.push(JSON.stringify(c.models_good)),c.productList.splice(o,1,c.models_good),c.models_good=""}else e.showToast({title:"请选择规格",icon:"none"})},radioChange:function(e){var o=0;if(_||c.is_selected?f[p-1]=e.detail.value:g[m-1]=e.detail.value,y=f.concat(g),y=y.reduce(function(e,o){return e.concat(o)}),y=Array.from(new Set(y)),"allocation"!=this.type){var t=!0,n=!1,r=void 0;try{for(var i,a=y[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var l=i.value;l="object"==typeof l?l:JSON.parse(l),o+=1,l.models&&l.models.length>0&&1!=l.is_selected&&(c.models_good=l,c.models_good_key=o)}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},go_goodsconfrim:function(){console.log(y),0==y.length?e.showToast({title:"请选择产品",icon:"none"}):"allocation"==this.type?this.stock?this.confrim_next():e.showToast({title:"请在筛选中选择调拨的仓库",icon:"none"}):this.confrim_next()},confrim_next:function(){var o=0;if("entering"==this.type){var t=!0,n=!1,r=void 0;try{for(var i,c=y[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var a=i.value;y[o]="object"==typeof a?a:JSON.parse(a),y[o].num=1,y[o].total_money=1*y[o].costPrice,y[o].really_total_money=1*y[o].costPrice,y[o].modify_retailPrice=y[o].costPrice,o+=1}}catch(_){n=!0,r=_}finally{try{t||null==c.return||c.return()}finally{if(n)throw r}}}else{var l=!0,s=!1,u=void 0;try{for(var d,g=y[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var f=d.value;y[o]="object"==typeof f?f:JSON.parse(f),y[o].num=1,y[o].total_money=1*y[o].retailPrice,y[o].really_total_money=1*y[o].retailPrice,y[o].modify_retailPrice=y[o].retailPrice,o+=1}}catch(_){s=!0,u=_}finally{try{l||null==g.return||g.return()}finally{if(s)throw u}}}e.setStorageSync("products",y),e.navigateTo({url:this.url})},get_productList:function(){var e=this;c.productList=[];var o=n.default.Query("Goods");o.include("stocks"),o.equalTo("userId","==",i),o.equalTo("stocks","==",c.stock.objectId),o.equalTo("status","!=",-1),1==c.category.type?o.equalTo("goodsClass","==",c.category.objectId):o.equalTo("second_class","==",c.category.objectId);var t=o.equalTo("goodsName","==",{$regex:_+".*"}),r=o.equalTo("packageContent","==",{$regex:_+".*"});o.or(t,r),o.limit(h),o.skip(h*(m-1)),o.order("-"+c.checked_option),o.find().then(function(o){console.log(y);var t=0;if(y.length>=1&&0==c.showOptions&&0==c.is_selected&&""==c.search_text){var n=!0,r=!1,i=void 0;try{for(var a,l=y[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var s=a.value,u=!0,d=!1,g=void 0;try{for(var f,_=o[Symbol.iterator]();!(u=(f=_.next()).done);u=!0){var h=f.value;h.objectId==("object"==typeof s?s.objectId:JSON.parse(s).objectId)&&(h.checked=!0,h.key=t,t+=1)}}catch(k){d=!0,g=k}finally{try{u||null==_.return||_.return()}finally{if(d)throw g}}}}catch(k){r=!0,i=k}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}}else{var m=!0,p=!1,v=void 0;try{for(var S,b=o[Symbol.iterator]();!(m=(S=b.next()).done);m=!0){var w=S.value;w.key=t,t+=1}}catch(k){p=!0,v=k}finally{try{m||null==b.return||b.return()}finally{if(p)throw v}}}e.productList=o,e.loading=!1})},handle_data:function(){e.removeStorageSync("products"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("shop"),_="",h=30,p=1}}};o.default=v}).call(this,t("543d")["default"])},be2e:function(e,o,t){},ea63:function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement,t=(e._self._c,e.__map(e.productList,function(o,t){var n=JSON.stringify(o);return{$orig:e.__get_orig(o),g0:n}})),n=e.__map(e.models_good.models,function(o,t){var n=JSON.stringify(o);return{$orig:e.__get_orig(o),g1:n}});e.$mp.data=Object.assign({},{$root:{l0:t,l1:n}})},r=[];t.d(o,"a",function(){return n}),t.d(o,"b",function(){return r})},f9ec:function(e,o,t){"use strict";(function(e){t("bc8c"),t("921b");n(t("66fd"));var o=n(t("61ed"));function n(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,t("543d")["createPage"])}},[["f9ec","common/runtime","common/vendor"]]]);