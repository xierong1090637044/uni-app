(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/good_count/count_detail/count_detail"],{"6a1e":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s,a=d(o("c74b")),n=d(o("df06")),u=d(o("b410"));function d(e){return e&&e.__esModule?e:{default:e}}var c={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,total_num:0,producer:null,nowDay:n.default.getDay(0,!0,!0)}},onLoad:function(){s=this,r=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.total_num+=Number(this.products[t].num)},methods:{bindDateChange:function(e){s.nowDay=e.detail.value+" 00:00:00"},formSubmit:function(t){console.log(t),this.button_disabled=!0,e.showLoading({title:"上传中..."});for(var o=new Array,d=[],c=[],i=0;i<this.products.length;i++){var l=a.default.Query("Bills"),f={},p=a.default.Pointer("_User"),g=p.set(r),m=a.default.Pointer("Goods"),h=m.set(this.products[i].header?this.products[i].header.objectId:this.products[i].objectId),v=e.getStorageSync("masterId"),y=a.default.Pointer("_User"),_=y.set(v);if(l.set("goodsName",this.products[i].goodsName),l.set("retailPrice",this.products[i].modify_retailPrice.toString()),l.set("num",Number(this.products[i].num)),l.set("reserve",Number(this.products[i].reserve)),l.set("now_reserve",this.products[i].num.toString()),l.set("total_money",this.products[i].total_money),l.set("opreater",_),l.set("goodsId",h),l.set("userId",g),l.set("type",3),l.set("createdTime",{__type:"Date",iso:s.nowDay}),s.products[i].stocks&&s.products[i].stocks.objectId){var b=a.default.Pointer("stocks"),S=b.set(s.products[i].stocks.objectId);l.set("stock",S),c.push(this.products[i].stocks.objectId),f.stock=s.products[i].stocks.stock_name}var k={};this.products[i].selectd_model&&(k.selected_model=this.products[i].selected_model,k.models=this.products[i].models,f.goodsId=k),f.goodsName=this.products[i].goodsName,f.reserve=this.products[i].reserve,f.now_reserve=this.products[i].num.toString(),f.packingUnit=this.products[i].packingUnit,o.push(l),d.push(f)}a.default.Query("Bills").saveAll(o).then((function(o){var i=a.default.Pointer("_User"),l=i.set(r),f=e.getStorageSync("masterId"),p=a.default.Pointer("_User"),g=p.set(f),m=a.default.Query("order_opreations");m.set("beizhu",t.detail.value.input_beizhu),m.set("detail",d),m.set("type",3),m.set("opreater",g),m.set("master",l),m.set("goodsName",s.products[0].goodsName),m.set("stockIds",c),m.set("createdTime",{__type:"Date",iso:s.nowDay}),m.save().then((function(t){var o=0,r=t.objectId;e.hideLoading();for(var d=function(t){var d=0,c=a.default.Query("Goods");if(c.set("id",s.products[t].objectId),s.products[t].selectd_model){var i=!0,l=!1,f=void 0;try{for(var p,g=s.products[t].selected_model[Symbol.iterator]();!(i=(p=g.next()).done);i=!0){var m=p.value;delete m.num}}catch(h){l=!0,f=h}finally{try{i||null==g.return||g.return()}finally{if(l)throw f}}c.set("models",s.products[t].selected_model),d=Number(s.products[t].num)}else d=Number(s.products[t].num);c.set("reserve",d),c.save().then((function(d){if(s.products[t].header){var i=a.default.Query("Goods");i.equalTo("header","==",s.products[t].header.objectId),i.equalTo("order","==",1),i.statTo("sum","reserve"),i.find().then((function(a){var d=a[0]._sumReserve;c.set("id",s.products[t].header.objectId),c.set("reserve",d),c.save().then((function(a){o+=1,n.default.modifyStockType(s.products[t].header.objectId),console.log(o,s.products.length),o==s.products.length&&(s.button_disabled=!1,e.setStorageSync("is_option",!0),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"盘点了'"+s.products[0].goodsName+"'等"+s.products.length+"商品",3,r),e.getStorageSync("setting").auto_print&&u.default.autoPrint(r),e.navigateBack({delta:2}),setTimeout((function(){e.showToast({title:"盘点成功"})}),500))}))}))}else o+=1,n.default.modifyStockType(s.products[t].header.objectId),o==s.products.length&&(s.button_disabled=!1,e.setStorageSync("is_option",!0),e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"盘点了'"+s.products[0].goodsName+"'等"+s.products.length+"商品",3,d.objectId),e.getStorageSync("setting").auto_print&&u.default.autoPrint(r),e.navigateBack({delta:2}),setTimeout((function(){e.showToast({title:"盘点成功"})}),500))})).catch((function(e){console.log(e)}))},c=0;c<s.products.length;c++)d(c)}))}),(function(e){console.log("异常处理")}))}}};t.default=c}).call(this,o("543d")["default"])},"9a54":function(e,t,o){"use strict";o.r(t);var r=o("6a1e"),s=o.n(r);for(var a in r)"default"!==a&&function(e){o.d(t,e,(function(){return r[e]}))}(a);t["default"]=s.a},"9fb9":function(e,t,o){"use strict";o.r(t);var r=o("aa4b"),s=o("9a54");for(var a in s)"default"!==a&&function(e){o.d(t,e,(function(){return s[e]}))}(a);o("fc44");var n,u=o("f0c5"),d=Object(u["a"])(s["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],n);t["default"]=d.exports},aa4b:function(e,t,o){"use strict";var r,s=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},a=[];o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return r}))},dc57:function(e,t,o){},f163:function(e,t,o){"use strict";(function(e){o("a961"),o("921b");r(o("66fd"));var t=r(o("9fb9"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},fc44:function(e,t,o){"use strict";var r=o("dc57"),s=o.n(r);s.a}},[["f163","common/runtime","common/vendor"]]]);