(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/good_allocation/allocation_detail/allocation_detail"],{"169e":function(e,t,o){},"444e":function(e,t,o){"use strict";var s=o("169e"),r=o.n(s);r.a},"53ba":function(e,t,o){"use strict";var s=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},r=[];o.d(t,"a",function(){return s}),o.d(t,"b",function(){return r})},"60c3":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,u=c(o("c74b")),n=c(o("df06")),a=(c(o("da3f")),c(o("b410")));c(o("428b"));function c(e){return e&&e.__esModule?e:{default:e}}var d={data:function(){return{products:[],stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[],all_money:0,real_money:0,total_num:0,nowDay:n.default.getDay(0,!0,!0)}},onLoad:function(){r=this,s=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.total_num+=Number(this.products[t].num);this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){r.stock=e.getStorageSync("warehouse")[0].stock,r.out_stock=e.getStorageSync("out_warehouse")?e.getStorageSync("out_warehouse")[0].stock:""},methods:{formSubmit:function(t){if(console.log(t),this.button_disabled=!0,""==r.out_stock||null==r.out_stock)return e.showToast({title:"请选择调入仓库",icon:"none"}),void(this.button_disabled=!1);r.add_tb_record(t)},add_tb_record:function(t){var o=this;e.showLoading({title:"上传中..."});for(var c=u.default.Pointer("stocks"),d=c.set(r.stock.objectId),i=c.set(r.out_stock.objectId),l=new Array,g=[],m=function(c){var m=u.default.Query("Goods");m.equalTo("goodsName","==",r.products[c].goodsName),m.equalTo("userId","==",s),m.equalTo("stocks","==",r.out_stock.objectId),m.find().then(function(m){console.log(m);var f,_,b=[];if(0==m.length)n.default.upload_good_withNoCan(r.products[c],r.out_stock,Number(o.products[c].num),"allocation").then(function(m){console.log(m);var p={};p.objectId=m[1].objectId,p.reserve=Number(o.products[c].num),b[0]=p,f=Number(o.products[c].reserve)-Number(o.products[c].num),_=Number(o.products[c].num);var v=u.default.Query("Goods");v.get(r.products[c].objectId).then(function(e){console.log(e),e.set("reserve",f),e.save(),v.get(b[0].objectId).then(function(e){e.set("reserve",_),e.save()})});var h=u.default.Query("Bills"),y={},S=u.default.Pointer("_User"),k=S.set(s),I=u.default.Pointer("_User"),N=I.set(e.getStorageSync("masterId")),j=u.default.Pointer("Goods"),w=j.set(o.products[c].objectId);h.set("goodsName",o.products[c].goodsName),h.set("retailPrice",o.products[c].modify_retailPrice),h.set("num",Number(o.products[c].num)),h.set("total_money",Number(o.products[c].total_money)),h.set("goodsId",w),h.set("userId",k),h.set("type",-2),h.set("opreater",N),h.set("stock",d),h.set("out_stock",i);var P={};y.goodsName=o.products[c].goodsName,y.stock=r.stock.stock_name,y.out_stock=r.out_stock.stock_name,y.reserve=o.products[c].reserve,y.out_reserve=b[0].reserve,P.objectId=o.products[c].objectId,P.out_objectId=b[0].objectId,P.reserve=f,P.out_reserve=_,y.goodsId=P,y.num=Number(o.products[c].num),y.type=-2,l.push(h),g.push(y),c==o.products.length-1&&u.default.Query("Bills").saveAll(l).then(function(o){for(var c=[],l=0;l<o.length;l++)c.push(o[l].success.objectId);var m=u.default.Pointer("_User"),f=m.set(s),_=e.getStorageSync("masterId"),b=u.default.Pointer("_User"),p=b.set(_),v=u.default.Query("order_opreations");v.set("detail",g),v.set("bills",c),v.set("beizhu",t.detail.value.input_beizhu),v.set("type",-2),v.set("opreater",p),v.set("stock",d),v.set("out_stock",i),v.set("master",f),v.set("goodsName",r.products[0].goodsName),v.save().then(function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品调拨成功",icon:"success",success:function(){r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout(function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"调拨了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&a.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})});else{b=m,f=Number(o.products[c].reserve)-Number(o.products[c].num),_=Number(b[0].reserve)+Number(o.products[c].num);var p=u.default.Query("Goods");p.get(r.products[c].objectId).then(function(e){console.log(e),e.set("reserve",f),e.save(),p.get(b[0].objectId).then(function(e){e.set("reserve",_),e.save()})});var v=u.default.Query("Bills"),h={},y=u.default.Pointer("_User"),S=y.set(s),k=u.default.Pointer("_User"),I=k.set(e.getStorageSync("masterId")),N=u.default.Pointer("Goods"),j=N.set(o.products[c].objectId);v.set("goodsName",o.products[c].goodsName),v.set("num",Number(o.products[c].num)),v.set("goodsId",j),v.set("userId",S),v.set("type",-2),v.set("opreater",I),v.set("stock",d),v.set("out_stock",i);var w={};h.goodsName=o.products[c].goodsName,h.stock=r.stock.stock_name,h.out_stock=r.out_stock.stock_name,h.reserve=o.products[c].reserve,h.out_reserve=b[0].reserve,w.objectId=o.products[c].objectId,w.out_objectId=b[0].objectId,w.reserve=f,w.out_reserve=_,h.goodsId=w,h.num=Number(o.products[c].num),h.type=-2,l.push(v),g.push(h),c==o.products.length-1&&u.default.Query("Bills").saveAll(l).then(function(o){for(var c=[],l=0;l<o.length;l++)c.push(o[l].success.objectId);var m=u.default.Pointer("_User"),f=m.set(s),_=e.getStorageSync("masterId"),b=u.default.Pointer("_User"),p=b.set(_),v=u.default.Query("order_opreations");v.set("detail",g),v.set("bills",c),v.set("beizhu",t.detail.value.input_beizhu),v.set("type",-2),v.set("opreater",p),v.set("stock",d),v.set("out_stock",i),v.set("master",f),v.set("goodsName",r.products[0].goodsName),v.save().then(function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品调拨成功",icon:"success",success:function(){r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout(function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"调拨了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&a.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})}})},f=0;f<this.products.length;f++)m(f)}}};t.default=d}).call(this,o("543d")["default"])},"7b3c":function(e,t,o){"use strict";(function(e){o("a961"),o("921b");s(o("66fd"));var t=s(o("aedb"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},a833:function(e,t,o){"use strict";o.r(t);var s=o("60c3"),r=o.n(s);for(var u in s)"default"!==u&&function(e){o.d(t,e,function(){return s[e]})}(u);t["default"]=r.a},aedb:function(e,t,o){"use strict";o.r(t);var s=o("53ba"),r=o("a833");for(var u in r)"default"!==u&&function(e){o.d(t,e,function(){return r[e]})}(u);o("444e");var n=o("2877"),a=Object(n["a"])(r["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports}},[["7b3c","common/runtime","common/vendor"]]]);