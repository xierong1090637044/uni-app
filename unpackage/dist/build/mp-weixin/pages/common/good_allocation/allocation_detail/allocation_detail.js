(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/good_allocation/allocation_detail/allocation_detail"],{"199a":function(e,t,o){"use strict";var s,r=function(){var e=this,t=e.$createElement;e._self._c},u=[];o.d(t,"b",function(){return r}),o.d(t,"c",function(){return u}),o.d(t,"a",function(){return s})},"228c":function(e,t,o){"use strict";o.r(t);var s=o("ccff"),r=o.n(s);for(var u in s)"default"!==u&&function(e){o.d(t,e,function(){return s[e]})}(u);t["default"]=r.a},"578c":function(e,t,o){"use strict";var s=o("e22a"),r=o.n(s);r.a},ccff:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,r,u=a(o("93d5")),n=a(o("2839")),c=(a(o("0279")),a(o("844a")));a(o("156c"));function a(e){return e&&e.__esModule?e:{default:e}}var d={data:function(){return{products:[],stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[],all_money:0,real_money:0}},onLoad:function(){r=this,s=e.getStorageSync("uid"),this.products=e.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2));this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){r.stock=e.getStorageSync("warehouse")[0].stock,r.out_stock=e.getStorageSync("out_warehouse")?e.getStorageSync("out_warehouse")[0].stock:""},methods:{formSubmit:function(t){if(console.log(t),this.button_disabled=!0,""==r.out_stock||null==r.out_stock)return e.showToast({title:"请选择调入仓库",icon:"none"}),void(this.button_disabled=!1);r.add_tb_record(t)},add_tb_record:function(t){var o=this;e.showLoading({title:"上传中..."});for(var a=u.default.Pointer("stocks"),d=a.set(r.stock.objectId),i=a.set(r.out_stock.objectId),l=new Array,f=[],g=function(a){var g=u.default.Query("NGoods");g.equalTo("goodsName","==",r.products[a].goodsName),g.equalTo("userId","==",s),g.equalTo("stocks","==",r.out_stock.objectId),g.find().then(function(g){console.log(g);var m,_,p=[];if(0==g.length)n.default.upload_good_withNoCan(r.products[a],r.out_stock,Number(o.products[a].num),"allocation").then(function(g){console.log(g);var v={};v.objectId=g[1].objectId,v.reserve=Number(o.products[a].num),p[0]=v,m=Number(o.products[a].reserve)-Number(o.products[a].num),_=Number(o.products[a].num);var b=u.default.Query("NGoods");b.get(r.products[a].objectId).then(function(e){console.log(e),e.set("reserve",m),e.save(),b.get(p[0].objectId).then(function(e){e.set("reserve",_),e.save()})});var h=u.default.Query("NBills"),y={},S=u.default.Pointer("_User"),N=S.set(s),k=u.default.Pointer("_User"),I=k.set(e.getStorageSync("masterId")),j=u.default.Pointer("NGoods"),w=j.set(o.products[a].objectId);h.set("goodsName",o.products[a].goodsName),h.set("retailPrice",Number(o.products[a].modify_retailPrice)),h.set("num",Number(o.products[a].num)),h.set("total_money",Number(o.products[a].total_money)),h.set("goodsId",w),h.set("userId",N),h.set("type",-2),h.set("opreater",I),h.set("stock",d),h.set("out_stock",i);var P={};y.goodsName=o.products[a].goodsName,y.stock=r.stock.stock_name,y.out_stock=r.out_stock.stock_name,y.reserve=o.products[a].reserve,y.out_reserve=p[0].reserve,P.objectId=o.products[a].objectId,P.out_objectId=p[0].objectId,P.reserve=m,P.out_reserve=_,y.goodsId=P,y.num=Number(o.products[a].num),y.type=-2,l.push(h),f.push(y),a==o.products.length-1&&u.default.Query("NBills").saveAll(l).then(function(o){for(var a=[],l=0;l<o.length;l++)a.push(o[l].success.objectId);var g=u.default.Pointer("_User"),m=g.set(s),_=e.getStorageSync("masterId"),p=u.default.Pointer("_User"),v=p.set(_),b=u.default.Query("order_opreations");b.set("detail",f),b.set("bills",a),b.set("beizhu",t.detail.value.input_beizhu),b.set("type",-2),b.set("opreater",v),b.set("stock",d),b.set("out_stock",i),b.set("master",m),b.set("goodsName",r.products[0].goodsName),b.save().then(function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品调拨成功",icon:"success",success:function(){r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout(function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"调拨了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&c.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})});else{p=g,m=Number(o.products[a].reserve)-Number(o.products[a].num),_=Number(p[0].reserve)+Number(o.products[a].num);var v=u.default.Query("NGoods");v.get(r.products[a].objectId).then(function(e){console.log(e),e.set("reserve",m),e.save(),v.get(p[0].objectId).then(function(e){e.set("reserve",_),e.save()})});var b=u.default.Query("NBills"),h={},y=u.default.Pointer("_User"),S=y.set(s),N=u.default.Pointer("_User"),k=N.set(e.getStorageSync("masterId")),I=u.default.Pointer("NGoods"),j=I.set(o.products[a].objectId);b.set("goodsName",o.products[a].goodsName),b.set("num",Number(o.products[a].num)),b.set("goodsId",j),b.set("userId",S),b.set("type",-2),b.set("opreater",k),b.set("stock",d),b.set("out_stock",i);var w={};h.goodsName=o.products[a].goodsName,h.stock=r.stock.stock_name,h.out_stock=r.out_stock.stock_name,h.reserve=o.products[a].reserve,h.out_reserve=p[0].reserve,w.objectId=o.products[a].objectId,w.out_objectId=p[0].objectId,w.reserve=m,w.out_reserve=_,h.goodsId=w,h.num=Number(o.products[a].num),h.type=-2,l.push(b),f.push(h),a==o.products.length-1&&u.default.Query("NBills").saveAll(l).then(function(o){for(var a=[],l=0;l<o.length;l++)a.push(o[l].success.objectId);var g=u.default.Pointer("_User"),m=g.set(s),_=e.getStorageSync("masterId"),p=u.default.Pointer("_User"),v=p.set(_),b=u.default.Query("order_opreations");b.set("detail",f),b.set("bills",a),b.set("beizhu",t.detail.value.input_beizhu),b.set("type",-2),b.set("opreater",v),b.set("stock",d),b.set("out_stock",i),b.set("master",m),b.set("goodsName",r.products[0].goodsName),b.save().then(function(t){var o=t.objectId;e.hideLoading(),e.showToast({title:"产品调拨成功",icon:"success",success:function(){r.button_disabled=!1,e.setStorageSync("is_option",!0),setTimeout(function(){e.removeStorageSync("_warehouse"),e.removeStorageSync("out_warehouse"),e.removeStorageSync("category"),e.removeStorageSync("warehouse"),n.default.log(e.getStorageSync("user").nickName+"调拨了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",-2,t.objectId),e.getStorageSync("setting").auto_print&&c.default.autoPrint(o),e.navigateBack({delta:2})},500)}})})},function(e){console.log("异常处理")})}})},m=0;m<this.products.length;m++)g(m)}}};t.default=d}).call(this,o("543d")["default"])},e22a:function(e,t,o){},e360:function(e,t,o){"use strict";o.r(t);var s=o("199a"),r=o("228c");for(var u in r)"default"!==u&&function(e){o.d(t,e,function(){return r[e]})}(u);o("578c");var n,c=o("f0c5"),a=Object(c["a"])(r["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],n);t["default"]=a.exports},ffd0:function(e,t,o){"use strict";(function(e){o("9787"),o("921b");s(o("66fd"));var t=s(o("e360"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])}},[["ffd0","common/runtime","common/vendor"]]]);