(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/finance/outRecord/outRecord"],{"2df5":function(e,t,o){"use strict";var n=o("2fcd"),a=o.n(n);a.a},"2fcd":function(e,t,o){},"7f9d":function(e,t,o){"use strict";(function(e){o("d510"),o("921b");n(o("66fd"));var t=n(o("d4ad"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},d4ad:function(e,t,o){"use strict";o.r(t);var n=o("e697"),a=o("f301");for(var r in a)"default"!==r&&function(e){o.d(t,e,function(){return a[e]})}(r);o("2df5");var c,u=o("f0c5"),s=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);t["default"]=s.exports},e697:function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},r=[];o.d(t,"b",function(){return a}),o.d(t,"c",function(){return r}),o.d(t,"a",function(){return n})},f301:function(e,t,o){"use strict";o.r(t);var n=o("f527"),a=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);t["default"]=a.a},f527:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a,r,c,u=d(o("9546")),s=d(o("7fd5")),i=d(o("7faa"));function d(e){return e&&e.__esModule?e:{default:e}}var l={data:function(){return{producer:{},user:e.getStorageSync("user"),identity:e.getStorageSync("identity"),Images:[],account:"",button_disabled:!1,beizhu_text:"",real_money:"",nowDay:s.default.getDay(0,!0,!0),type:"",category:""}},onLoad:function(t){a=this,n=e.getStorageSync("uid"),a.type=t.type||"","record"==t.type&&e.removeStorageSync("producer")},onShow:function(){if(a.producer=e.getStorageSync("producer"),a.account=e.getStorageSync("account"),e.getStorageSync("category"))if(a.category=e.getStorageSync("category"),2==a.category.type){var t=u.default.Pointer("financeFristClass");r=t.set(a.category.parent.objectId);var o=u.default.Pointer("financeSecondClass");c=o.set(a.category.objectId)}else{var n=u.default.Pointer("financeFristClass");r=n.set(a.category.objectId)}},methods:{bindDateChange:function(e){a.nowDay=e.detail.value+" 00:00:00"},removeImg:function(e){a.Images.splice(e,1),a.Images=a.Images},upload_image:function(){a.user.is_vip?e.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var t,o=Date.parse(new Date),n=e.tempFilePaths,r=!0,c=!1,s=void 0;try{for(var i,d=n[Symbol.iterator]();!(r=(i=d.next()).done);r=!0){var l=i.value;t=u.default.File(o+".jpg",l)}}catch(f){c=!0,s=f}finally{try{r||null==d.return||d.return()}finally{if(c)throw s}}t.save().then(function(e){var t=!0,o=!1,n=void 0;try{for(var r,c=e[Symbol.iterator]();!(t=(r=c.next()).done);t=!0){var u=r.value;a.Images.push(u.url)}}catch(f){o=!0,n=f}finally{try{t||null==c.return||c.return()}finally{if(o)throw n}}})}}):e.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(t){var o=this;if(a.button_disabled=!0,"record"==a.type){if(""==e.getStorageSync("category")||void 0==e.getStorageSync("category"))return e.showToast({icon:"none",title:"请选择支出类别"}),void(this.button_disabled=!1)}else if(""==e.getStorageSync("producer")||void 0==e.getStorageSync("producer"))return e.showToast({icon:"none",title:"请选择供货商"}),void(this.button_disabled=!1);if(""==e.getStorageSync("account")||void 0==e.getStorageSync("account"))return e.showToast({icon:"none",title:"请选择付款账户"}),void(this.button_disabled=!1);if(""==a.real_money)return e.showToast({icon:"none",title:"请输入本次实付"}),void(this.button_disabled=!1);if("record"==a.type){var d=u.default.Query("accounts");d.get(a.account.objectId).then(function(t){t.set("money",t.money-Number(a.real_money)),t.save().then(function(t){var i=u.default.Pointer("accounts"),d=i.set(a.account.objectId),l=u.default.Pointer("_User"),f=l.set(n),y=e.getStorageSync("masterId"),g=u.default.Pointer("_User"),m=g.set(y),b=u.default.Query("order_opreations");b.set("account",d),b.set("master",f),b.set("opreater",m),b.set("real_money",Number(a.real_money)),b.set("beizhu",a.beizhu_text),b.set("createdTime",{__type:"Date",iso:a.nowDay}),b.set("type",1),b.set("extra_type",6),b.set("Images",a.Images),1==a.category.type?b.set("fristClass",r):b.set("secondClass",c),b.save().then(function(t){o.button_disabled=!1,e.removeStorageSync("account"),a.producer=t,s.default.log(e.getStorageSync("user").nickName+"记录了付款￥"+a.real_money+"元",6,t.objectId),e.navigateBack({delta:1}),setTimeout(function(){e.showToast({icon:"none",title:"付款成功"})},1e3)}).catch(function(e){console.log(e)})})})}else{var l=u.default.Query("producers");l.get(a.producer.objectId).then(function(t){t.debt-Number(a.real_money)<0?(e.showToast({icon:"none",title:"付款金额过大"}),o.button_disabled=!1):(t.set("debt",t.debt-Number(a.real_money)),t.save().then(function(t){var r=u.default.Query("accounts");r.get(a.account.objectId).then(function(t){t.set("money",t.money-Number(a.real_money)),t.save().then(function(t){var r=u.default.Pointer("producers"),c=r.set(a.producer.objectId),d=u.default.Pointer("accounts"),l=d.set(a.account.objectId),f=u.default.Pointer("_User"),y=f.set(n),g=e.getStorageSync("masterId"),m=u.default.Pointer("_User"),b=m.set(g),p=u.default.Query("order_opreations");p.set("account",l),p.set("producer",c),p.set("master",y),p.set("opreater",b),p.set("real_money",Number(a.real_money)),p.set("beizhu",a.beizhu_text),p.set("debt",a.producer.debt||0),p.set("createdTime",{__type:"Date",iso:a.nowDay}),p.set("type",1),p.set("extra_type",5),p.set("Images",a.Images),p.save().then(function(t){o.button_disabled=!1,i.default.producer_detail(a.producer.objectId).then(function(t){e.removeStorageSync("account"),a.producer=t,s.default.log(e.getStorageSync("user").nickName+"操作'"+a.producer.producer_name+"'供货商付款￥"+a.real_money+"元",6,t.objectId),e.navigateBack({delta:1}),setTimeout(function(){e.showToast({icon:"none",title:"付款成功"})},1e3)})}).catch(function(e){console.log(e)})})})}))}).catch(function(e){console.log(e)})}}}};t.default=l}).call(this,o("543d")["default"])}},[["7f9d","common/runtime","common/vendor"]]]);