(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/finance/InRecord/InRecord"],{"0ee9":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a,c,r,s=l(o("c74b")),u=l(o("df06")),i=l(o("c315"));function l(e){return e&&e.__esModule?e:{default:e}}var d={data:function(){return{custom:{},user:e.getStorageSync("user"),identity:e.getStorageSync("identity"),Images:[],account:"",button_disabled:!1,beizhu_text:"",real_money:"",nowDay:u.default.getDay(0,!0,!0),type:"",category:""}},onLoad:function(t){a=this,n=e.getStorageSync("uid"),a.type=t.type||"","record"==t.type&&e.removeStorageSync("custom")},onShow:function(){if(a.custom=e.getStorageSync("custom"),a.account=e.getStorageSync("account"),e.getStorageSync("category"))if(a.category=e.getStorageSync("category"),2==a.category.type){var t=s.default.Pointer("financeFristClass");c=t.set(a.category.parent.objectId);var o=s.default.Pointer("financeSecondClass");r=o.set(a.category.objectId)}else{var n=s.default.Pointer("financeFristClass");c=n.set(a.category.objectId)}},methods:{bindDateChange:function(e){a.nowDay=e.detail.value+" 00:00:00"},removeImg:function(e){a.Images.splice(e,1),a.Images=a.Images},upload_image:function(){a.user.is_vip?e.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var t,o=Date.parse(new Date),n=e.tempFilePaths,c=!0,r=!1,u=void 0;try{for(var i,l=n[Symbol.iterator]();!(c=(i=l.next()).done);c=!0){var d=i.value;t=s.default.File(o+".jpg",d)}}catch(f){r=!0,u=f}finally{try{c||null==l.return||l.return()}finally{if(r)throw u}}t.save().then((function(e){var t=!0,o=!1,n=void 0;try{for(var c,r=e[Symbol.iterator]();!(t=(c=r.next()).done);t=!0){var s=c.value;a.Images.push(s.url)}}catch(f){o=!0,n=f}finally{try{t||null==r.return||r.return()}finally{if(o)throw n}}}))}}):e.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(t){var o=this;if(a.button_disabled=!0,"record"==a.type){if(""==e.getStorageSync("category")||void 0==e.getStorageSync("category"))return e.showToast({icon:"none",title:"请选择收入类别"}),void(this.button_disabled=!1)}else if(""==e.getStorageSync("custom")||void 0==e.getStorageSync("custom"))return e.showToast({icon:"none",title:"请选择客户"}),void(this.button_disabled=!1);if(""==e.getStorageSync("account")||void 0==e.getStorageSync("account"))return e.showToast({icon:"none",title:"请选择收款账户"}),void(this.button_disabled=!1);if(""==a.real_money)return e.showToast({icon:"none",title:"请输入本次实收"}),void(this.button_disabled=!1);if("record"==a.type){var l=s.default.Query("accounts");l.get(a.account.objectId).then((function(t){t.set("money",t.money+Number(a.real_money)),t.save().then((function(t){var i=s.default.Pointer("accounts"),l=i.set(a.account.objectId),d=s.default.Pointer("_User"),f=d.set(n),y=e.getStorageSync("masterId"),m=s.default.Pointer("_User"),g=m.set(y),b=s.default.Query("order_opreations");b.set("account",l),b.set("master",f),b.set("opreater",g),b.set("real_money",Number(a.real_money)),b.set("beizhu",a.beizhu_text),b.set("createdTime",{__type:"Date",iso:a.nowDay}),b.set("type",-1),b.set("extra_type",6),b.set("Images",a.Images),1==a.category.type?b.set("fristClass",c):b.set("secondClass",r),b.save().then((function(t){o.button_disabled=!1,u.default.log(e.getStorageSync("user").nickName+"记录了收款￥"+a.real_money+"元",6,t.objectId),e.navigateBack({delta:1}),setTimeout((function(){e.showToast({icon:"none",title:"收款成功"})}),1e3)})).catch((function(e){console.log(e)}))}))}))}else{var d=s.default.Query("customs");d.get(a.custom.objectId).then((function(t){t.debt-Number(a.real_money)<0?(e.showToast({icon:"none",title:"收款金额过大"}),o.button_disabled=!1):(t.set("debt",t.debt-Number(a.real_money)),t.save().then((function(t){var c=s.default.Query("accounts");c.get(a.account.objectId).then((function(t){t.set("money",t.money+Number(a.real_money)),t.save().then((function(t){var c=s.default.Pointer("customs"),r=c.set(a.custom.objectId),l=s.default.Pointer("accounts"),d=l.set(a.account.objectId),f=s.default.Pointer("_User"),y=f.set(n),m=e.getStorageSync("masterId"),g=s.default.Pointer("_User"),b=g.set(m),v=s.default.Query("order_opreations");v.set("account",d),v.set("custom",r),v.set("master",y),v.set("opreater",b),v.set("real_money",Number(a.real_money)),v.set("beizhu",a.beizhu_text),v.set("debt",a.custom.debt||0),v.set("createdTime",{__type:"Date",iso:a.nowDay}),v.set("type",-1),v.set("extra_type",5),v.set("Images",a.Images),v.save().then((function(t){o.button_disabled=!1,i.default.custom_detail(a.custom.objectId).then((function(t){a.custom=t,u.default.log(e.getStorageSync("user").nickName+"操作'"+a.custom.custom_name+"'客户还款￥"+a.real_money+"元",6,t.objectId),e.navigateBack({delta:1}),setTimeout((function(){e.showToast({icon:"none",title:"收款成功"})}),1e3)}))})).catch((function(e){console.log(e)}))}))}))})))})).catch((function(e){console.log(e)}))}}}};t.default=d}).call(this,o("543d")["default"])},"31cf":function(e,t,o){},"5fa8":function(e,t,o){"use strict";var n,a=function(){var e=this,t=e.$createElement,o=(e._self._c,e.nowDay.split(" "));e.$mp.data=Object.assign({},{$root:{g0:o}})},c=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return c})),o.d(t,"a",(function(){return n}))},b6e5:function(e,t,o){"use strict";var n=o("31cf"),a=o.n(n);a.a},b721:function(e,t,o){"use strict";o.r(t);var n=o("0ee9"),a=o.n(n);for(var c in n)"default"!==c&&function(e){o.d(t,e,(function(){return n[e]}))}(c);t["default"]=a.a},d078:function(e,t,o){"use strict";(function(e){o("a961"),o("921b");n(o("66fd"));var t=n(o("f704"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},f704:function(e,t,o){"use strict";o.r(t);var n=o("5fa8"),a=o("b721");for(var c in a)"default"!==c&&function(e){o.d(t,e,(function(){return a[e]}))}(c);o("b6e5");var r,s=o("f0c5"),u=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);t["default"]=u.exports}},[["d078","common/runtime","common/vendor"]]]);