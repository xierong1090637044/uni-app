(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-production-matterDet-matterDet"],{"0a6b":function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".opion_item[data-v-cf8c967a]{color:#118fff;font-weight:700;padding:0 %?20?% 0 0}.page[data-v-cf8c967a]{height:100vh;overflow:scroll;font-size:%?28?%}.popup_content[data-v-cf8c967a]{width:%?500?%}.popup_button[data-v-cf8c967a]{background:#426ab3;color:#fff}.frist[data-v-cf8c967a]{text-align:center;width:100%;height:%?300?%;padding:%?30?% 0;background:#fff}.second[data-v-cf8c967a]{padding:0 %?30?%;border-top:%?1?% solid#DDDDDD;background:#fff}.second_one[data-v-cf8c967a]{padding:%?20?% 0;border-bottom:%?1?% solid#DDDDDD;line-height:%?60?%;font-size:%?26?%;color:#999}.second_right_text[data-v-cf8c967a]{color:#3d3d3d;margin-left:%?20?%}.thrid[data-v-cf8c967a]{padding:%?20?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center;margin-top:%?30?%;font-size:%?28?%;border-bottom:%?1?% solid#DDDDDD;background:#fff;border-bottom:1px solid#DDDDDD}.four[data-v-cf8c967a]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;margin:%?30?% 0 %?60?%}.qrimg[data-v-cf8c967a]{position:fixed;top:0;left:0;width:100%;height:100%;background:#426ab3;text-align:center}",""])},"28eb":function(t,e,o){"use strict";o.r(e);var i=o("bba2"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"740d":function(t,e,o){"use strict";var i=o("8b07"),n=o.n(i);n.a},"8b07":function(t,e,o){var i=o("0a6b");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=o("4f06").default;n("15f4b06e",i,!0,{sourceMap:!1,shadowMode:!1})},bba2:function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("c5f6");var n=i(o("5d73"));o("7514");var s,a,c=i(o("9546")),u=i(o("856d")),d=i(o("7fd5")),r=i(o("4d52")),l=i(o("13d4")),v=i(o("e5a1")),_=i(o("2b82")),f=i(o("7aeb")),p={components:{uniPopup:f.default,faIcon:r.default,tkiQrcode:l.default,tkiBarcode:v.default,uniFab:_.default},data:function(){return{user:uni.getStorageSync("user"),badnum:{num:"",desc:""},bad_numshow:!1,loading:!0,select_qrcode:"",get_reserve_checked:!0,product:{},is_show:!1,bar_code_show:!1,selected_item:""}},onLoad:function(t){s=this,a=uni.getStorageSync("uid"),uni.removeStorageSync("now_model"),t.id?s.getDetail_byId(t.id,t.type):s.getDetail_noId()},methods:{getDetail_byId:function(e,o){var i=this,u=[];uni.showLoading({title:"加载中..."});var r=c.default.Query("Matters");"false"==o?r.equalTo("objectId","==",e):r.equalTo("productCode","==",e),r.equalTo("userId","==",a),r.find().then(function(e){t.log(e);var o=e[0],c=0;uni.setStorageSync("now_product",o),r.equalTo("userId","==",a),r.equalTo("status","!=",-1),r.include("stocks","fristClass","secondClass"),r.equalTo("goodsName","==",o.goodsName),r.find().then(function(e){var a=!0,r=!1,l=void 0;try{for(var v,_=(0,n.default)(e);!(a=(v=_.next()).done);a=!0){var f=v.value,p={};f.stocks?(p.stock_name=f.stocks.stock_name,p.stock_objectid=f.stocks.objectId):(p.stock_name="",p.stock_objectid=""),p.reserve=f.reserve.toFixed(uni.getStorageSync("setting").show_float),p.models=f.models?f.models:"",p.warning_num=f.warning_num,p.bad_num=f.bad_num?f.bad_num:0,p.good_id=f.objectId,p.accessory=f.accessory?f.accessory:"",p.productCode=f.productCode?f.productCode:f.objectId+"-"+!1,f.stocks=p,c+=f.reserve,u.push(f.stocks)}}catch(g){r=!0,l=g}finally{try{a||null==_.return||_.return()}finally{if(r)throw l}}i.product=o,i.product.nousetime&&(i.product.nousetime=d.default.js_date_time(i.product.nousetime)),i.product.all_reserve=c.toFixed(uni.getStorageSync("setting").show_float),i.product.stocks=u,s.loading=!1,uni.hideLoading(),t.log(i.product)})})},getDetail_noId:function(){var e=this,o=[],i=uni.getStorageSync("now_product"),u=0;uni.showLoading({title:"加载中..."});var r=c.default.Query("Matters");r.equalTo("userId","==",a),r.equalTo("status","!=",-1),r.include("stocks","goodsClass","second_class"),r.equalTo("goodsName","==",i.goodsName),r.find().then(function(i){var a=!0,c=!1,r=void 0;try{for(var l,v=(0,n.default)(i);!(a=(l=v.next()).done);a=!0){var _=l.value,f={};_.stocks?(f.stock_name=_.stocks.stock_name,f.stock_objectid=_.stocks.objectId):(f.stock_name="",f.stock_objectid=""),f.reserve=_.reserve.toFixed(uni.getStorageSync("setting").show_float),f.models=_.models,f.warning_num=_.warning_num,f.bad_num=_.bad_num?_.bad_num:0,f.good_id=_.objectId,f.accessory=_.accessory?_.accessory:"",f.productCode=_.productCode?_.productCode:_.objectId+"-"+!1,_.stocks=f,u+=_.reserve,o.push(_.stocks)}}catch(p){c=!0,r=p}finally{try{a||null==v.return||v.return()}finally{if(c)throw r}}e.product=uni.getStorageSync("now_product"),e.product.nousetime&&(e.product.nousetime=d.default.js_date_time(e.product.nousetime)),e.product.all_reserve=u.toFixed(uni.getStorageSync("setting").show_float),e.product.stocks=o,s.loading=!1,uni.hideLoading(),t.log(e.product)})},confrim_badnum:function(){if(t.log(s.selected_item),s.badnum.num){var e=c.default.Pointer("_User"),o=e.set(uni.getStorageSync("masterId")),i=c.default.Pointer("Matters"),n=i.set(s.selected_item.good_id),a=c.default.Pointer("_User"),u=a.set(uni.getStorageSync("uid")),d=s.selected_item.good_id,r=Number(s.selected_item.bad_num),l=r+Number(s.badnum.num),v=c.default.Query("bad_goods");v.set("bad_num",s.badnum.num),v.set("beizhu_text",s.badnum.desc),v.set("operater",o),v.set("matters",n),v.set("master",u),v.save().then(function(t){var e=c.default.Query("Matters");e.set("id",d),e.set("bad_num",l),e.save().then(function(t){s.bad_numshow=!1,uni.showToast({title:"记录成功"})}),s.getDetail_noId()})}else uni.showToast({title:"请输入货损数量",icon:"none"})},add_badnum:function(t){s.bad_numshow=!0,s.selected_item=t},show_qrcode:function(t){s.is_show=!0,s.select_qrcode=t.productCode},change_state:function(t){s.get_reserve_checked=t.detail.value},print_info:function(t){u.default.print_goodDet(t)},modify:function(e){t.log(e);var o=uni.getStorageSync("now_product");o.objectId=e.good_id,o.reserve=e.reserve,o.warning_num=e.warning_num?e.warning_num:0,o.bad_num=e.bad_num?e.bad_num:0,uni.navigateTo({url:"../editInfo/editInfo"})},showcode_option:function(){uni.showActionSheet({itemList:["二维码","条形码"],success:function(e){t.log("选中了第"+(e.tapIndex+1)+"个按钮"),0==e.tapIndex?s.is_show=!0:s.bar_code_show=!0},fail:function(e){t.log(e.errMsg)}})},qrR:function(t){this.src=t},bcR:function(t){this.src=t},saveBccode:function(){this.$refs.barcode._saveCode()},saveQrcode:function(){this.$refs.qrcode._saveCode()},delete_good:function(e,o,i){uni.showModal({title:"提示",content:"是否删除该商品",success:function(n){if(n.confirm){uni.setStorageSync("is_add",!0);var a=c.default.Query("Matters");a.set("id",e),a.set("status",-1),a.save().then(function(e){if(o)uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"删除成功"})},1e3);else if(s.product.stocks.length>1){var n=s.product.stocks[i+1].good_id,a=c.default.Query("Matters");a.get(n).then(function(e){t.log(e),e.set("accessory",!1),e.save(),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"删除成功"})},1e3)}).catch(function(e){t.log(e)})}else uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"删除成功"})},1e3)}).catch(function(e){t.log(e)})}}})}}};e.default=p}).call(this,o("5a52")["default"])},c39c:function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",{staticClass:"page"},[t.loading?o("loading"):o("v-uni-view",[o("v-uni-view",{staticClass:"frist"},[t.product.goodsIcon?o("v-uni-image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.product.goodsIcon,mode:"aspectFit"}}):o("v-uni-image",{staticStyle:{height:"100%"},attrs:{src:"/static/goods-default.png",mode:"aspectFit"}})],1),o("v-uni-view",{staticClass:"second"},[o("v-uni-view",{staticClass:"second_one"},[o("v-uni-view",{staticStyle:{color:"#3d3d3d","font-weight":"bold","font-size":"34rpx"}},[t._v(t._s(t.product.goodsName))]),t.user.rights&&"0"!=t.user.rights.othercurrent[0]?o("v-uni-view"):o("v-uni-view",[t._v("成本价:"),o("v-uni-text",{staticStyle:{color:"#FD2E32","margin-left":"20rpx"}},[t._v(t._s(t.product.costPrice?t.product.costPrice:"未填写"))])],1),o("v-uni-view",[t._v("零售价:"),o("v-uni-text",{staticStyle:{color:"#FD2E32","margin-left":"20rpx"}},[t._v(t._s(t.product.retailPrice?t.product.retailPrice:"未填写"))])],1)],1),o("v-uni-view",{staticClass:"second_one"},[o("v-uni-view",[t._v("材质:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(t.product.packingModel?t.product.packingModel:"未填写"))])],1),o("v-uni-view",[t._v("规格:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(t.product.packageContent?t.product.packageContent:"未填写"))])],1),o("v-uni-view",[t._v("单位:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(t.product.packingUnit?t.product.packingUnit:"未填写"))])],1),o("v-uni-view",[t._v("简介:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(t.product.product_info?t.product.product_info:"未填写"))])],1),t.product.nousetime?o("v-uni-view",[t._v("过期时间:"),o("v-uni-text",{staticStyle:{"margin-left":"20rpx",color:"#3D3D3D"}},[t._v(t._s(t.product.nousetime))])],1):t._e(),t.product.fristClass&&t.product.fristClass.class_text?o("v-uni-view",[t._v("所属一级分类"),o("v-uni-text",{staticStyle:{"margin-left":"20rpx",color:"#3D3D3D"}},[t._v(t._s(t.product.fristClass.class_text))])],1):t._e(),t.product.secondClass&&t.product.secondClass.class_text?o("v-uni-view",[t._v("所属二级分类"),o("v-uni-text",{staticStyle:{"margin-left":"20rpx",color:"#3D3D3D"}},[t._v(t._s(t.product.secondClass.class_text))])],1):t._e()],1),o("v-uni-view",{staticClass:"second_one display_flex_bet"},[o("v-uni-view",[t._v("总库存:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(t.product.all_reserve))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-text",{staticStyle:{"margin-right":"10rpx"}},[t._v("分库存")]),o("v-uni-switch",{attrs:{checked:t.get_reserve_checked},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.change_state.apply(void 0,arguments)}}})],1)],1),t._l(t.product.stocks,function(e,i){return t.get_reserve_checked?o("v-uni-view",{key:i,staticClass:"second_one"},[o("v-uni-view",[t._v("存放仓库:"),o("v-uni-text",{staticStyle:{"margin-left":"20rpx",color:"#3D3D3D"}},[t._v(t._s(e.stock_name?e.stock_name:"未填写"))])],1),o("v-uni-view",[t._v("当前库存:"),o("v-uni-text",{staticStyle:{color:"#FD2E32","margin-left":"20rpx"}},[t._v(t._s(e.reserve))])],1),e.models?o("v-uni-view",{staticStyle:{color:"#3D3D3D"}},t._l(e.models,function(e,i){return o("v-uni-view",{key:i,staticClass:"display_flex_bet"},[o("v-uni-view",{staticStyle:{"font-size":"24rpx"}},[t._v(t._s(e.custom1.value)+t._s(e.custom2.value)+t._s(e.custom3.value)+t._s(e.custom4.value))]),o("v-uni-view",{staticStyle:{color:"#FD2E32","font-size":"24rpx"}},[t._v("库存:"+t._s(e.reserve))])],1)}),1):t._e(),o("v-uni-view",[t._v("预警数量:"),o("v-uni-text",{staticStyle:{color:"#FD2E32","margin-left":"20rpx"}},[t._v(t._s(e.warning_num?e.warning_num:0))])],1),o("v-uni-navigator",{staticClass:"display_flex_bet",attrs:{"hover-class":"none",url:"/pages/manage/good_det/bad_history/bad_history?id="+e.good_id+"&type=matter"}},[o("v-uni-view",[t._v("货损数量:"),o("v-uni-text",{staticStyle:{color:"#FD2E32","margin-left":"20rpx"}},[t._v(t._s(e.bad_num?e.bad_num:0))])],1),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1),o("v-uni-view",[t._v("条码:"),o("v-uni-text",{staticClass:"second_right_text"},[t._v(t._s(e.productCode))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-view",{staticClass:"opion_item",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.show_qrcode(e)}}},[t._v("生成二维码")]),o("v-uni-view",{staticClass:"opion_item",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.add_badnum(e)}}},[t._v("记录货损")])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-view",{staticClass:"opion_item",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.print_info(e)}}},[t._v("打印")]),o("v-uni-view",{staticClass:"opion_item",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.modify(e)}}},[t._v("编辑")]),o("v-uni-view",{staticClass:"opion_item",on:{click:function(o){arguments[0]=o=t.$handleEvent(o),t.delete_good(e.good_id,e.accessory,i)}}},[t._v("删除")])],1)],1):t._e()})],2),t.is_show?o("v-uni-view",{staticClass:"qrimg"},[o("v-uni-view",{staticStyle:{"text-align":"right","margin-right":"20rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.is_show=!1}}},[o("fa-icon",{attrs:{type:"times-circle",size:"20",color:"#fff"}})],1),o("v-uni-view",{staticStyle:{"margin-top":"20%"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saveQrcode.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{padding:"20rpx",background:"#fff"}},[o("tki-qrcode",{ref:"qrcode",attrs:{cid:"qrcode",val:t.select_qrcode,size:200,loadMake:!0,usingComponents:!0,unit:"rpx"},on:{result:function(e){arguments[0]=e=t.$handleEvent(e),t.qrR.apply(void 0,arguments)}}})],1),o("v-uni-view",{staticStyle:{color:"#fff","margin-top":"30rpx","font-size":"32rpx"}},[t._v("物料:"+t._s(t.product.goodsName))]),o("v-uni-view",{staticStyle:{color:"#fff","margin-top":"20rpx","font-size":"24rpx"}},[t._v("(点击二维码可下载)")])],1)],1):t._e(),o("uni-popup",{staticClass:"popup",attrs:{show:t.bad_numshow,type:"top",mode:"fixed"},on:{hidePopup:function(e){arguments[0]=e=t.$handleEvent(e),t.bad_numshow=!1}}},[o("v-uni-view",{staticClass:"popup_content"},[o("v-uni-view",{staticClass:"popup_title",staticStyle:{"text-align":"center","margin-bottom":"20rpx"}},[t._v("记录货损")]),o("v-uni-view",{staticStyle:{"margin-bottom":"20rpx"}},[o("v-uni-input",{staticClass:"popup_input",attrs:{placeholder:"请输入该物料的货损数量"},model:{value:t.badnum.num,callback:function(e){t.$set(t.badnum,"num",e)},expression:"badnum.num"}})],1),o("v-uni-view",{staticStyle:{"margin-bottom":"20rpx"}},[o("v-uni-input",{staticClass:"popup_input",attrs:{placeholder:"请输入备注"},model:{value:t.badnum.desc,callback:function(e){t.$set(t.badnum,"desc",e)},expression:"badnum.desc"}})],1),o("v-uni-view",[o("v-uni-button",{staticClass:"popup_button",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.confrim_badnum.apply(void 0,arguments)}}},[t._v("确认")])],1)],1)],1)],1)],1)},n=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return n})},ee3c:function(t,e,o){"use strict";o.r(e);var i=o("c39c"),n=o("28eb");for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);o("740d");var a=o("f0c5"),c=Object(a["a"])(n["default"],i["a"],i["b"],!1,null,"cf8c967a",null);e["default"]=c.exports}}]);