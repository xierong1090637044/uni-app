(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-manage-custom-producer_detail-producer_detail"],{"02a8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={name:"UniPopup",props:{show:{type:Boolean,default:!1},position:{type:String,default:"middle"},mode:{type:String,default:"insert"},msg:{type:String,default:""},h5Top:{type:Boolean,default:!1},buttonMode:{type:String,default:"bottom"}},data:function(){return{offsetTop:0}},watch:{h5Top:function(e){this.offsetTop=e?44:0}},created:function(){var e=0;e=this.h5Top?0:44,this.offsetTop=e},methods:{hide:function(){"insert"===this.mode&&"middle"===this.position||this.$emit("hidePopup")},closeMask:function(){"insert"===this.mode&&this.$emit("hidePopup")},moveHandle:function(){}}};t.default=o},"33f5":function(e,t,n){"use strict";var o=n("3fd0"),a=n.n(o);a.a},"3e09":function(e,t,n){"use strict";(function(e){var o=n("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("c5f6");var a,i=o(n("c74b")),r=o(n("5fbc")),u=o(n("df06")),s=o(n("0914")),d=o(n("db37")),l=o(n("524a")),c={components:{faIcon:s.default,loading:l.default,uniPopup:d.default},data:function(){return{loading:!0,modal_show:!1,producer:{},modal_sk:{sk_number:"",beizhu:""}}},onLoad:function(t){a=this,r.default.producer_detail(t.id).then(function(t){e.log(t),t.debt||(t.debt=0),a.producer=t,a.loading=!1})},methods:{show_options:function(){uni.showActionSheet({itemList:["编辑","删除"],success:function(e){0==e.tapIndex?a.edit(a.producer):1==e.tapIndex&&a.delete_this(a.producer.objectId)},fail:function(t){e.log(t.errMsg)}})},edit:function(e){uni.setStorageSync("customs",e),uni.setStorageSync("custom_type","producers"),uni.navigateTo({url:"../add/add"})},delete_this:function(e){uni.showModal({title:"提示",content:"是否删除此客户",success:function(t){t.confirm&&a.delete_data("producers",e)}})},delete_data:function(t,n){e.log(n);var o=i.default.Query(t);o.destroy(n).then(function(t){e.log(t),uni.showToast({title:"删除成功",icon:"none"}),uni.navigateBack({delta:1})}).catch(function(t){e.log(t)})},confrim_sk:function(){e.log(a.modal_sk);var t=a.modal_sk.sk_number,n=a.modal_sk.beizhu,o=a.producer.objectId;if(null==t||0==t.length)uni.showToast({title:"请输入还款金额",icon:"none"});else{uni.showLoading({title:"加载中..."}),a.modal_show=!1;var s=i.default.Query("producers");s.get(o).then(function(s){if(s.debt-Number(t)<0)uni.hideLoading(),uni.showToast({icon:"none",title:"还款金额超出"});else if(null==s.debt||0==s.debt)uni.hideLoading(),uni.showToast({icon:"none",title:"没有欠款"});else{s.set("debt",s.debt-Number(t)),s.save();var d=i.default.Pointer("producers"),l=d.set(o),c=i.default.Pointer("_User"),f=c.set(uni.getStorageSync("uid")),v=i.default.Pointer("_User"),p=v.set(uni.getStorageSync("masterId")),m=i.default.Query("debt_history");m.set("producer",l),m.set("master",f),m.set("operater",p),m.set("debt_number",Number(t)),m.set("beizhu",n),m.save().then(function(n){e.log(n),u.default.log(uni.getStorageSync("user").nickName+"操作'"+a.producer.producer_name+"'供货商收款￥"+t+"元",6,n.objectId),uni.hideLoading(),r.default.producer_detail(a.producer.objectId).then(function(t){e.log(t),a.producer=t,uni.showToast({title:"还款成功"})})}).catch(function(t){e.log(t)})}}).catch(function(t){e.log(t)})}}}};t.default=c}).call(this,n("5a52")["default"])},"3fd0":function(e,t,n){var o=n("a868");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("fcfbf626",o,!0,{sourceMap:!1,shadowMode:!1})},"4e00":function(e,t,n){"use strict";n.r(t);var o=n("02a8"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},"532d":function(e,t,n){var o=n("a190");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("f38772bc",o,!0,{sourceMap:!1,shadowMode:!1})},"5fbc":function(e,t,n){"use strict";(function(e){var o=n("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("c5f6");var a=o(n("f499"));n("7514");var i=o(n("795b")),r=o(n("c74b")),u={get_producerList:function(e,t){return new i.default(function(n,o){var i=JSON.parse(localStorage.getItem("bmob")).objectId,u=r.default.Query("producers");u.order("num"),u.equalTo("parent","==",i),u.equalTo("disabled","==",e),t&&u.equalTo("name","==",{$regex:t+".*"}),u.find().then(function(e){localStorage.setItem("shops",(0,a.default)(e)),n(e)})})},add_producer:function(t){e.log(t);var n=JSON.parse(localStorage.getItem("bmob")).objectId;return new i.default(function(o,a){var i=r.default.Pointer("_User"),u=i.set(n);if(t.objectId){var s=r.default.Query("producers");s.set("producer_name",t.producer_name),s.set("debt",Number(t.debt)),s.set("producer_address",t.producer_address),s.set("producer_phone",t.producer_phone),s.set("parent",u),s.set("disabled",!t.disabled),s.set("id",t.objectId),s.save().then(function(e){o(e)}).catch(function(t){e.log(t)})}else{var d=r.default.Query("producers");d.equalTo("parent","==",n),d.equalTo("name","==",t.producer_name),d.find().then(function(n){if(e.log(n),0==n.length){var a=r.default.Query("producers");a.set("producer_name",t.producer_name),a.set("debt",Number(t.debt)),a.set("producer_address",t.producer_address),a.set("producer_phone",t.producer_phone),a.set("have_out",0),a.set("disabled",!t.disabled),a.set("parent",u),a.save().then(function(e){o(e)}).catch(function(t){e.log(t)})}else o(!1)})}})},delete_producer:function(t){return new i.default(function(n,o){var a=r.default.Query("producers");a.destroy(t).then(function(e){n(e)}).catch(function(t){e.log(t)})})},producer_detail:function(t){return new i.default(function(n,o){var a=r.default.Query("producers");a.get(t).then(function(e){n(e)}).catch(function(t){e.log(t)})})},get_moneyList:function(t){return new i.default(function(n,o){var a=r.default.Query("debt_history");a.equalTo("producer","==",t),a.include("operater"),a.find().then(function(t){e.log(t),n(t)})})}};t.default=u}).call(this,n("5a52")["default"])},"6eb0":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"uni-mask",style:{top:e.offsetTop+"px"},on:{click:function(t){t=e.$handleEvent(t),e.hide(t)},touchmove:function(t){t.stopPropagation(),t.preventDefault(),t=e.$handleEvent(t),e.moveHandle(t)}}}),n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"uni-popup",class:"uni-popup-"+e.position+" uni-popup-"+e.mode},[e._v(e._s(e.msg)),e._t("default"),"middle"===e.position&&"insert"===e.mode?n("v-uni-view",{staticClass:" uni-icon uni-icon-close",class:{"uni-close-bottom":"bottom"===e.buttonMode,"uni-close-right":"right"===e.buttonMode},on:{click:function(t){t=e.$handleEvent(t),e.closeMask(t)}}}):e._e()],2)],1)},a=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a})},"80dc":function(e,t,n){"use strict";n.r(t);var o=n("811f"),a=n("9ba9");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("e854");var r=n("2877"),u=Object(r["a"])(a["default"],o["a"],o["b"],!1,null,"e99890de",null);t["default"]=u.exports},"811f":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[e.loading?n("loading"):n("v-uni-view",[n("uni-nav-bar",{attrs:{fixed:!0,color:"#333333","background-color":"#FFFFFF","right-text":"操作"},on:{"click-right":function(t){t=e.$handleEvent(t),e.show_options(t)}}}),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[e._v("供货商昵称")]),n("v-uni-view",[e._v(e._s(e.producer.producer_name))])],1),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[e._v("联系电话")]),e.producer.producer_phone?n("v-uni-view",[e._v(e._s(e.producer.producer_phone))]):n("v-uni-view",[e._v("未填写")])],1),n("v-uni-navigator",{staticClass:"display_flex_bet list_item border_bottom",attrs:{"hover-class":"none",url:"debt_history/debt_history?id="+e.producer.objectId+"&name="+e.producer.producer_name}},[n("v-uni-view",{staticClass:"left_desc"},[e._v("欠供应商款")]),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-text",{staticStyle:{"margin-right":"20rpx"}},[e._v("￥"+e._s(e.producer.debt))]),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[e._v("建立时间")]),n("v-uni-view",[e._v(e._s(e.producer.createdAt))])],1),n("v-uni-navigator",{staticClass:"list_item display_flex_bet",staticStyle:{margin:"20rpx 0"},attrs:{"hover-class":"none",url:"history/history?id="+e.producer.objectId}},[n("v-uni-text",{staticClass:"left_desc"},[e._v("交易历史")]),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1),n("uni-popup",{attrs:{show:e.modal_show,position:"middle",mode:"fixed"},on:{hidePopup:function(t){t=e.$handleEvent(t),e.modal_show=!1}}},[n("v-uni-view",{staticStyle:{width:"500rpx"}},[n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-view",{staticStyle:{width:"160rpx",color:"#999"}},[e._v("本次还款：")]),n("v-uni-input",{staticClass:"uni-input",attrs:{placeholder:"请输入本次还款金额",type:"digit"},model:{value:e.modal_sk.sk_number,callback:function(t){e.$set(e.modal_sk,"sk_number",t)},expression:"modal_sk.sk_number"}})],1),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-view",{staticStyle:{width:"160rpx",color:"#999"}},[e._v("备注：")]),n("v-uni-input",{staticClass:"uni-input",attrs:{placeholder:"请输入备注信息"},model:{value:e.modal_sk.beizhu,callback:function(t){e.$set(e.modal_sk,"beizhu",t)},expression:"modal_sk.beizhu"}})],1),n("v-uni-view",{staticClass:"modal_confrimbutton",on:{click:function(t){t=e.$handleEvent(t),e.confrim_sk(t)}}},[e._v("确定")])],1)],1),n("v-uni-view",{staticClass:"getmoney_button",on:{click:function(t){t=e.$handleEvent(t),e.modal_show=!0}}},[e._v("还款")])],1)],1)},a=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a})},"9ba9":function(e,t,n){"use strict";n.r(t);var o=n("3e09"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},a190:function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,"uni-page-body[data-v-e99890de]{color:#3d3d3d}.modal_confrimbutton[data-v-e99890de]{background:#426ab3;color:#fff;width:60%;padding:%?20?% 0;text-align:center;margin-left:20%;border-radius:%?8?%;margin-top:%?30?%}.list_item[data-v-e99890de]{padding:%?20?% %?30?%;background:#fff}.left_desc[data-v-e99890de]{color:#999}.border_bottom[data-v-e99890de]{border-bottom:%?1?% solid#DDDDDD}.getmoney_button[data-v-e99890de]{width:100%;background:#426ab3;color:#fff;padding:%?20?% 0;text-align:center;position:fixed;bottom:0;left:0}",""])},a868:function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,'.uni-mask[data-v-aaf92358]{position:fixed;z-index:998;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.3)}.uni-popup[data-v-aaf92358]{position:fixed;z-index:999;background-color:#fff}.uni-popup-middle[data-v-aaf92358]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.uni-popup-middle.uni-popup-insert[data-v-aaf92358]{min-width:%?380?%;min-height:%?380?%;max-width:100%;max-height:80%;-webkit-transform:translate(-50%,-65%);-ms-transform:translate(-50%,-65%);transform:translate(-50%,-65%);background:none;-webkit-box-shadow:none;box-shadow:none}.uni-popup-middle.uni-popup-fixed[data-v-aaf92358]{border-radius:%?10?%;padding:%?30?%}.uni-close-bottom[data-v-aaf92358],.uni-close-right[data-v-aaf92358]{position:absolute;bottom:%?-180?%;text-align:center;border-radius:50%;color:#f5f5f5;font-size:%?60?%;font-weight:700;opacity:.8;z-index:-1}.uni-close-bottom[data-v-aaf92358]{margin:auto;left:0;right:0}.uni-close-right[data-v-aaf92358]{right:%?-60?%;top:%?-80?%}.uni-close-bottom[data-v-aaf92358]:after{content:"";position:absolute;width:0;border:1px #f5f5f5 solid;top:%?-200?%;bottom:%?56?%;left:50%;-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%);opacity:.8}.uni-popup-bottom[data-v-aaf92358],.uni-popup-top[data-v-aaf92358]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.uni-popup-top[data-v-aaf92358]{top:0;left:0;width:100%;height:%?100?%;line-height:%?100?%;text-align:center}.uni-popup-bottom[data-v-aaf92358]{left:0;bottom:0;width:100%;min-height:%?100?%;line-height:%?100?%;text-align:center}',""])},db37:function(e,t,n){"use strict";n.r(t);var o=n("6eb0"),a=n("4e00");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("33f5");var r=n("2877"),u=Object(r["a"])(a["default"],o["a"],o["b"],!1,null,"aaf92358",null);t["default"]=u.exports},df06:function(e,t,n){"use strict";(function(t){var o=n("288e");n("6b54"),n("87b3"),n("7514");var a=o(n("5d73"));n("c5f6");var i=o(n("795b")),r=o(n("c74b"));e.exports={enterAddGoodNum:function(e){return new i.default(function(n,o){for(var i=function(o){var i=0,u=r.default.Query("Goods");u.get(e[o].objectId).then(function(r){if(t.log(e[o]),e[o].selectd_model){var u=!0,s=!1,d=void 0;try{for(var l,c=(0,a.default)(e[o].selected_model);!(u=(l=c.next()).done);u=!0){var f=l.value,v=!0,p=!1,m=void 0;try{for(var h,b=(0,a.default)(e[o].models);!(v=(h=b.next()).done);v=!0){var g=h.value;g.id==f.id&&(g.reserve=Number(g.reserve)+Number(f.num)),delete g.num}}catch(_){p=!0,m=_}finally{try{v||null==b.return||b.return()}finally{if(p)throw m}}}}catch(_){s=!0,d=_}finally{try{u||null==c.return||c.return()}finally{if(s)throw d}}i=Number(e[o].reserve)+Number(e[o].num),r.set("models",e[o].models)}else i=Number(e[o].reserve)+Number(e[o].num);r.set("reserve",i),r.set("stocktype",i>e[o].warning_num?1:0),r.save(),o==e.length-1&&n(!0)}).catch(function(e){t.log(e)})},u=0;u<e.length;u++)i(u)})},outRedGoodNum:function(e){var n=this;return new i.default(function(o,i){for(var u=function(i){var u=0,s=r.default.Query("Goods");s.get(e[i].objectId).then(function(t){if(e[i].selectd_model){var r=!0,s=!1,d=void 0;try{for(var l,c=(0,a.default)(e[i].selected_model);!(r=(l=c.next()).done);r=!0){var f=l.value,v=!0,p=!1,m=void 0;try{for(var h,b=(0,a.default)(e[i].models);!(v=(h=b.next()).done);v=!0){var g=h.value;u+=Number(g.reserve),g.id==f.id&&(g.reserve=Number(g.reserve)-Number(f.num)),delete g.num}}catch(_){p=!0,m=_}finally{try{v||null==b.return||b.return()}finally{if(p)throw m}}}}catch(_){s=!0,d=_}finally{try{r||null==c.return||c.return()}finally{if(s)throw d}}u=Number(e[i].reserve)-Number(e[i].num),t.set("models",e[i].models)}else u=Number(e[i].reserve)-Number(e[i].num);t.set("reserve",u),t.set("stocktype",u>=e[i].warning_num?1:0),t.save(),e[i].warning_num>=u&&n.log(e[i].goodsName+"出库了"+e[i].num+"件，已经低于预警数量"+e[i].warning_num,-2,e[i].objectId),n.record_staffOut(Number(e[i].num)),i==e.length-1&&o(!0)}).catch(function(e){t.log(e)})},s=0;s<e.length;s++)u(s)})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,n,o){var a=r.default.Pointer("_User"),i=a.set(uni.getStorageSync("uid")),u=r.default.Query("logs");u.set("parent",i),u.set("log",e),u.set("detail_id",o),u.set("type",n),u.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_shopOut:function(e,n){t.log(e,n);var o=r.default.Query("shops");o.set("id",e),o.set("have_out",n),o.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var n=r.default.Query("staffs");n.set("id",uni.getStorageSync("user").objectId),n.set("have_out",Number(e)+uni.getStorageSync("user").have_out),n.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var n=r.default.Query("Goods");n.equalTo("userId","==",e),n.find().then(function(e){t.log(e);var n=!0,o=!1,i=void 0;try{for(var r,u=(0,a.default)(e);!(n=(r=u.next()).done);n=!0){var s=r.value;t.log(s),Number(s.costPrice)*s.reserve,s.reserve}}catch(d){o=!0,i=d}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}})},getDay:function(e,t){var n=this,o=new Date,a=o.getTime()+864e5*e;o.setTime(a);var i=o.getFullYear(),r=o.getMonth(),u=o.getDate();return r=n.handleMonth(r+1),u=n.handleMonth(u),t?i+"-"+r+"-"+u+" 00:00:00":i+"-"+r+"-"+u},js_date_time:function(e,t){var n=new Date(e),o=n.getFullYear(),a=n.getMonth()+1;a=a<10?"0"+a:a;var i=n.getDate();i=i<10?"0"+i:i;var r=n.getHours();r=r<10?"0"+r:r;var u=n.getMinutes(),s=n.getSeconds();return u=u<10?"0"+u:u,s=s<10?"0"+s:s,t?o+"-"+a+"-"+i+" "+r+":"+u:o+"-"+a+"-"+i},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,n("5a52")["default"])},e854:function(e,t,n){"use strict";var o=n("532d"),a=n.n(o);a.a}}]);