(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_confrim-good_enter-good_enter"],{"1c9b":function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,".page[data-v-7b3c64e2]{color:#4d4d4d;background:#f6f5ec;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-7b3c64e2]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-7b3c64e2]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-7b3c64e2]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-7b3c64e2]{width:-webkit-calc(100% - %?40?%);width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-7b3c64e2]{background:#aa2116\t;color:#fff;font-weight:700;font-size:%?32?%}",""])},"3e05":function(e,t,o){"use strict";var n=i(o("e21e"));function i(e){return e&&e.__esModule?e:{default:e}}e.exports={log:function(e){var t=n.default.Pointer("_User"),o=t.set(uni.getStorageSync("uid")),i=n.default.Query("logs");i.set("parent",o),i.set("log",e),i.save().then(function(e){console.log(e)}).catch(function(e){console.log(e)})}}},"4bae":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i,a=r(o("e21e")),s=r(o("3e05"));function r(e){return e&&e.__esModule?e:{default:e}}var u={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,producer:null}},onLoad:function(){i=this,n=uni.getStorageSync("uid"),uni.removeStorageSync("producer"),this.products=uni.getStorageSync("products");for(var e=0;e<this.products.length;e++)this.all_money=this.products[e].total_money+this.all_money;this.real_money=this.all_money},onShow:function(){i.producer=uni.getStorageSync("producer")},methods:{formSubmit:function(e){var t=this;console.log(e),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var o=[],r=new Array,u=function(e){var o=Number(t.products[e].reserve)+t.products[e].num,i=a.default.Query("Goods");i.get(t.products[e].objectId).then(function(n){n.set("reserve",o),n.set("stocktype",o>t.products[e].warning_num?1:0),n.save()}).catch(function(e){console.log(e)});var s=a.default.Query("Bills"),u=a.default.Pointer("_User"),l=u.set(n),c=a.default.Pointer("Goods"),d=c.set(t.products[e].objectId);s.set("goodsName",t.products[e].goodsName),s.set("retailPrice",t.products[e].modify_retailPrice.toString()),s.set("num",t.products[e].num),s.set("total_money",t.products[e].total_money),s.set("goodsId",d),s.set("userId",l),s.set("type",1),r.push(s)},l=0;l<this.products.length;l++)u(l);a.default.Query("Bills").saveAll(r).then(function(t){for(var r=0;r<t.length;r++)if(o.push(t[r].success.objectId),r==t.length-1){var u=a.default.Relation("Bills"),l=u.add(o),c=a.default.Pointer("_User"),d=c.set(n),v=void 0;if(1==uni.getStorageSync("identity")){var f=uni.getStorageSync("masterId"),p=a.default.Pointer("_User");v=p.set(f)}var _=a.default.Query("order_opreations");if(_.set("relations",l),_.set("beizhu",e.detail.value.input_beizhu),_.set("type",1),_.set("opreater",v),_.set("master",d),_.set("goodsName",i.products[0].goodsName),_.set("real_money",Number(i.real_money)),_.set("debt",i.all_money-Number(i.real_money)),i.producer){var g=a.default.Pointer("producers"),m=g.set(i.producer.objectId);if(_.set("producer",m),i.all_money-Number(i.real_money)>0){var b=a.default.Query("producers");b.get(i.producer.objectId).then(function(e){var t=null==e.debt?0:e.debt;t+=i.all_money-Number(i.real_money),console.log(t);var o=a.default.Query("producers");o.get(i.producer.objectId).then(function(e){e.set("debt",t),e.save()})})}}_.set("all_money",i.all_money),_.save().then(function(e){console.log("添加操作历史记录成功",e),uni.hideLoading(),uni.showToast({title:"产品入库成功",icon:"success",success:function(){i.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){s.default.log(uni.getStorageSync("user").nickName+"入库了'"+i.products[0].goodsName+"'等"+i.products.length+"商品"),uni.navigateBack({delta:2})},500)}})})}},function(e){console.log("异常处理")})}}};t.default=u},"8a58":function(e,t,o){"use strict";o.r(t);var n=o("4bae"),i=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);t["default"]=i.a},"9adf":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[e._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},e._l(e.products,function(t,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[e._v("产品："+e._s(t.goodsName))]),o("v-uni-view",[e._v("期初进货价：￥"+e._s(t.costPrice))])],1),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[e._v("实际进货价：￥"+e._s(t.modify_retailPrice)+"（X"+e._s(t.num)+"）")]),o("v-uni-view",[e._v("合计：￥"+e._s(t.total_money))])],1)],1)}),1),o("v-uni-view",{staticClass:"pro_allmoney"},[e._v("总计：￥"+e._s(e.all_money))]),o("v-uni-form",{on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[e._v("开单明细（用于记录是否有无欠款）")]),o("v-uni-view",{staticClass:"kaidan_detail"},[o("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=producer"}},[o("v-uni-view",[e._v("供应商姓名")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择供货商",disabled:"true",value:e.producer.producer_name}})],1)],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-view",[e._v("实际应付")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择供货商",disabled:"true",value:e.all_money}})],1)],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-view",[e._v("实际付款（可修改）")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入实际付款金额",type:"digit"},model:{value:e.real_money,callback:function(t){e.real_money=t},expression:"real_money"}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit"}},[e._v("确认入库")])],1)],1)],1)],1)},i=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})},b50e:function(e,t,o){"use strict";var n=o("e190"),i=o.n(n);i.a},e190:function(e,t,o){var n=o("1c9b");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=o("4f06").default;i("01bd49f7",n,!0,{sourceMap:!1,shadowMode:!1})},f0b2:function(e,t,o){"use strict";o.r(t);var n=o("9adf"),i=o("8a58");for(var a in i)"default"!==a&&function(e){o.d(t,e,function(){return i[e]})}(a);o("b50e");var s=o("2877"),r=Object(s["a"])(i["default"],n["a"],n["b"],!1,null,"7b3c64e2",null);t["default"]=r.exports}}]);