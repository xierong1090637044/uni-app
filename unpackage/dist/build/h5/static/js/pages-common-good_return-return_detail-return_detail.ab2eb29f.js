(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_return-return_detail-return_detail"],{"172c":function(e,t,r){"use strict";r.r(t);var n=r("8d02"),o=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},"1e73":function(e,t,r){"use strict";r.r(t);var n=r("82a8"),o=r("172c");for(var a in o)"default"!==a&&function(e){r.d(t,e,function(){return o[e]})}(a);r("c333");var i=r("2877"),u=Object(i["a"])(o["default"],n["a"],n["b"],!1,null,"6e5dad34",null);t["default"]=u.exports},"2d3a":function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".page[data-v-6e5dad34]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-6e5dad34]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-6e5dad34]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-6e5dad34]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-6e5dad34]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-6e5dad34]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},"82a8":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",[r("v-uni-view",{staticClass:"page"},[r("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[e._v("已选产品")]),r("v-uni-view",e._l(e.products,function(t,n){return r("v-uni-view",{key:n,staticClass:"pro_listitem"},[r("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[r("v-uni-view",{staticStyle:{width:"calc(100% - 200rpx)"}},[e._v("产品："+e._s(t.goodsName))]),r("v-uni-view",[e._v("零售价：￥"+e._s(t.retailPrice?t.retailPrice:0))])],1),r("v-uni-view",{staticClass:"pro_list"},[r("v-uni-view",[e._v("退货数量：X"+e._s(t.num))]),r("v-uni-view",[e._v("合计：￥"+e._s(t.total_money))])],1)],1)}),1),r("v-uni-view",{staticClass:"pro_allmoney"},[e._v("总计：￥"+e._s(e.all_money))]),r("v-uni-form",{on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[r("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[r("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[e._v("开单明细（用于记录退货客户）")]),r("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[r("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[r("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("选择门店")]),r("v-uni-view",{staticClass:"kaidan_rightinput"},[r("v-uni-input",{attrs:{placeholder:"选择门店",disabled:"true",value:e.shop_name}})],1)],1),r("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[r("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("客户姓名")]),r("v-uni-view",{staticClass:"kaidan_rightinput"},[r("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:e.custom.custom_name}})],1)],1)],1)],1),r("v-uni-view",{staticStyle:{"margin-top":"20px"}},[r("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),r("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[r("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit"}},[e._v("确认退货")])],1)],1)],1)],1)},o=[];r.d(t,"a",function(){return n}),r.d(t,"b",function(){return o})},"8d02":function(e,t,r){"use strict";(function(e){var n=r("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("5d73"));r("6b54"),r("87b3"),r("c5f6"),r("7f7f");var a,i,u,s,c=n(r("c74b")),l=n(r("df06")),d=n(r("b410")),f={data:function(){return{shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null}},onLoad:function(){i=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var e=0;e<this.products.length;e++)this.all_money=this.products[e].total_money+this.all_money},onShow:function(){if(i.custom=uni.getStorageSync("custom"),s=uni.getStorageSync("shop"),s){i.shop_name=s.name;var e=c.default.Pointer("shops");u=e.set(s.objectId)}},methods:{formSubmit:function(t){e.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var r=new Array,n=[],f=0;f<this.products.length;f++){Number(this.products[f].reserve),this.products[f].num;var v=c.default.Query("Bills"),m={},g=c.default.Pointer("_User"),p=g.set(a),y=c.default.Pointer("Goods"),h=y.set(this.products[f].objectId),_=uni.getStorageSync("masterId"),b=c.default.Pointer("_User"),B=b.set(_);v.set("goodsName",this.products[f].goodsName),v.set("retailPrice",this.products[f].modify_retailPrice.toString()),v.set("num",Number(this.products[f].num)),v.set("total_money",this.products[f].total_money),v.set("goodsId",h),v.set("opreater",B),v.set("userId",p),v.set("type",2);var S={};m.goodsName=this.products[f].goodsName,m.modify_retailPrice=this.products[f].modify_retailPrice.toString(),m.retailPrice=this.products[f].retailPrice,m.total_money=this.products[f].total_money,S.costPrice=this.products[f].costPrice,S.retailPrice=this.products[f].retailPrice,m.goodsId=S,m.num=this.products[f].num,s&&v.set("shop",u),r.push(v),n.push(m)}c.default.Query("Bills").saveAll(r).then(function(r){var u=c.default.Pointer("_User"),s=u.set(a),f=uni.getStorageSync("masterId"),v=c.default.Pointer("_User"),m=v.set(f),g=c.default.Query("order_opreations");if(g.set("beizhu",t.detail.value.input_beizhu),g.set("detail",n),g.set("type",2),g.set("opreater",m),g.set("master",s),g.set("goodsName",i.products[0].goodsName),g.set("real_money",Number(i.real_money)),g.set("debt",i.all_money-Number(i.real_money)),i.custom){var p=c.default.Pointer("customs"),y=p.set(i.custom.objectId);g.set("custom",y)}g.set("all_money",i.all_money),g.save().then(function(t){e.log("添加操作历史记录成功",t);var r=t.objectId;uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品退货成功",icon:"success",success:function(){for(var n=function(t){var r=0,n=c.default.Query("Goods");n.get(i.products[t].objectId).then(function(e){if(i.products[t].selectd_model){var n=!0,a=!1,u=void 0;try{for(var s,c=(0,o.default)(JSON.parse(i.products[t].selectd_model));!(n=(s=c.next()).done);n=!0){var l=s.value,d=!0,f=!1,v=void 0;try{for(var m,g=(0,o.default)(i.products[t].models);!(d=(m=g.next()).done);d=!0){var p=m.value;r+=Number(p.reserve),p.id==JSON.parse(l).id&&(p.reserve=Number(p.reserve)+Number(i.products[t].num))}}catch(y){f=!0,v=y}finally{try{d||null==g.return||g.return()}finally{if(f)throw v}}}}catch(y){a=!0,u=y}finally{try{n||null==c.return||c.return()}finally{if(a)throw u}}r+=Number(i.products[t].num),e.set("models",i.products[t].models)}else r=Number(i.products[t].reserve)+Number(i.products[t].num);e.set("reserve",r),e.set("stocktype",r>i.products[t].warning_num?1:0),e.save()}).catch(function(t){e.log(t)})},a=0;a<i.products.length;a++)n(a);i.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),l.default.log(uni.getStorageSync("user").nickName+"处理了'"+i.products[0].goodsName+"'等"+i.products.length+"商品的退货",2,t.objectId),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(r),uni.navigateBack({delta:2})},500)}})})},function(t){e.log("异常处理")})}}};t.default=f}).call(this,r("5a52")["default"])},b410:function(e,t,r){"use strict";(function(e){var n=r("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r("5d73")),a=n(r("c74b")),i={autoPrint:function(t){var r=this;e.log("sssss",t);var n=a.default.Query("order_opreations");n.include("opreater","custom","producer","stock"),n.get(t).then(function(t){e.log(t),r.print_operations(t,t.detail)})},print_goodDet:function(e){var t,r=uni.getStorageSync("now_product");r.objectId=e.good_id,r.stocks=e,r.productCode=e.productCode,t="<CB>商品信息</CB><BR>",t+="--------------------------------<BR>",t+="产品名称：　　 "+r.goodsName+"<BR>",r.stocks&&(t+="存放仓库：　　 "+r.stocks.stock_name+"<BR>"),r.position&&(t+="货架位置：　　 "+r.position+"<BR>"),r.producttime&&(t+="生产日期：　　 "+r.producttime+"<BR>"),r.nousetime&&(t+="失效日期：　　 "+r.nousetime+"<BR>"),t+="当前库存：　　 "+r.reserve+"<BR>",t+="产品规格:　　　"+r.packageContent+"*"+r.packingUnit+"<BR>",t+="进货价格:      "+r.costPrice+"<BR>",t+="零售价格:      "+r.retailPrice+"<BR>",r.bad_num&&(t+="货损数量:      "+r.bad_num+"<BR>"),t+="--------------------------------<BR>",t+="产品二维码：<BR>",t+="<QR>"+r.productCode+"</QR>",this.print_by_code(t)},print_operations:function(t,r){if(e.log(t),3==t.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var n=0;n<r.length;n++)v+="产品名称："+r[n].goodsName+"<BR>",v+="盘点前库存："+r[n].reserve+"<BR>",v+="盘点后库存："+r[n].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==t.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var a=0;a<r.length;a++){v+="产品名称："+r[a].goodsName+"<BR>",v+="调拨数量："+r[a].num+"<BR>",v+="--------------------------------<BR>";var i=!0,u=!1,s=void 0;try{for(var c,l=(0,o.default)(t.detail);!(i=(c=l.next()).done);i=!0){var d=c.value;v+="调出仓库："+d.stock+"<BR>",v+="<RIGHT>当前库存："+(d.reserve-d.num)+"</RIGHT><BR>",v+="调入仓库："+d.out_stock+"<BR>",v+="<RIGHT>当前库存："+(d.out_reserve+d.num)+"</RIGHT><BR>"}}catch(g){u=!0,s=g}finally{try{i||null==l.return||l.return()}finally{if(u)throw s}}}v+="--------------------------------<BR>"}else if(2==t.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var f=0;f<r.length;f++)v+="产品名称："+r[f].goodsName+"<BR>",v+="零售价："+r[f].retailPrice+"<BR>",v+="数量    ：X"+r[f].num+"<BR>",v+="<RIGHT>总计："+r[f].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=t.custom?v+="客户姓名："+t.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==t.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var m=0;m<r.length;m++)v+="产品名称："+r[m].goodsName+"<BR>",v+="实际单价："+r[m].retailPrice+"<BR>",v+="数量    ：X"+r[m].num+"<BR>",v+="<RIGHT>总计："+r[m].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==t.type&&(v+="开单明细：<BR>",v+="<BR>",null!=t.producer&&(v+="供货商姓名："+t.producer.producer_name+"<BR>"),null==t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款："+t.debt+"<BR>"),v+="--------------------------------<BR>"),-1==t.type&&(v+="开单明细：<BR>",v+="<BR>",t.custom&&(v+="客户姓名："+t.custom.custom_name+"<BR>"),t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款  ："+t.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+t.opreater.nickName+"<BR>",v+="备注："+t.beizhu+"<BR>",v+="操作时间："+t.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(t){var r=uni.getStorageSync("setting").USER,n=uni.getStorageSync("setting").UKEY,o=uni.getStorageSync("setting").number,a="api.feieyun.cn",i="/Api/Open/",u=(new Date).getTime(),s=l(r+n+u);h(o,t,1);var c=0;function l(e){return y(d(p(e)))}function d(e){for(var t=e,r=Array(80),n=1732584193,o=-271733879,a=-1732584194,i=271733878,u=-1009589776,s=0;s<t.length;s+=16){for(var c=n,l=o,d=a,p=i,y=u,h=0;h<80;h++){r[h]=h<16?t[s+h]:g(r[h-3]^r[h-8]^r[h-14]^r[h-16],1);var _=m(m(g(n,5),f(h,o,a,i)),m(m(u,r[h]),v(h)));u=i,i=a,a=g(o,30),o=n,n=_}n=m(n,c),o=m(o,l),a=m(a,d),i=m(i,p),u=m(u,y)}return new Array(n,o,a,i,u)}function f(e,t,r,n){return e<20?t&r|~t&n:e<40?t^r^n:e<60?t&r|t&n|r&n:t^r^n}function v(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function m(e,t){var r=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(r>>16);return n<<16|65535&r}function g(e,t){return e<<t|e>>>32-t}function p(e){for(var t=1+(e.length+8>>6),r=new Array(16*t),n=0;n<16*t;n++)r[n]=0;for(n=0;n<e.length;n++)r[n>>2]|=e.charCodeAt(n)<<24-8*(3&n);return r[n>>2]|=128<<24-8*(3&n),r[16*t-1]=8*e.length,r}function y(e){for(var t=c?"0123456789ABCDEF":"0123456789abcdef",r="",n=0;n<4*e.length;n++)r+=t.charAt(e[n>>2]>>8*(3-n%4)+4&15)+t.charAt(e[n>>2]>>8*(3-n%4)&15);return r}function h(t,n,o){uni.request({url:"https://"+a+i,data:{user:r,stime:u,sig:s,apiname:"Open_printMsg",sn:t,content:n,times:o},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t.data),0!=t.data.ret?uni.showToast({icon:"none",title:t.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};t.default=i}).call(this,r("5a52")["default"])},c333:function(e,t,r){"use strict";var n=r("c6c4"),o=r.n(n);o.a},c6c4:function(e,t,r){var n=r("2d3a");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=r("4f06").default;o("016070cc",n,!0,{sourceMap:!1,shadowMode:!1})},df06:function(e,t,r){"use strict";(function(t){var n=r("288e");r("6b54"),r("87b3"),r("7514");var o=n(r("5d73"));r("c5f6");var a=n(r("795b")),i=n(r("c74b"));e.exports={enterAddGoodNum:function(e){return new a.default(function(r,n){for(var a=function(n){var a=0,u=i.default.Query("Goods");u.get(e[n].objectId).then(function(i){if(t.log(e[n]),e[n].selectd_model){var u=!0,s=!1,c=void 0;try{for(var l,d=(0,o.default)(e[n].selected_model);!(u=(l=d.next()).done);u=!0){var f=l.value,v=!0,m=!1,g=void 0;try{for(var p,y=(0,o.default)(e[n].models);!(v=(p=y.next()).done);v=!0){var h=p.value;h.id==f.id&&(h.reserve=Number(h.reserve)+Number(f.num)),delete h.num}}catch(_){m=!0,g=_}finally{try{v||null==y.return||y.return()}finally{if(m)throw g}}}}catch(_){s=!0,c=_}finally{try{u||null==d.return||d.return()}finally{if(s)throw c}}a=Number(e[n].reserve)+Number(e[n].num),i.set("models",e[n].models)}else a=Number(e[n].reserve)+Number(e[n].num);i.set("reserve",a),i.set("stocktype",a>e[n].warning_num?1:0),i.save(),n==e.length-1&&r(!0)}).catch(function(e){t.log(e)})},u=0;u<e.length;u++)a(u)})},outRedGoodNum:function(e){var r=this;return new a.default(function(n,a){for(var u=function(a){var u=0,s=i.default.Query("Goods");s.get(e[a].objectId).then(function(t){if(e[a].selectd_model){var i=!0,s=!1,c=void 0;try{for(var l,d=(0,o.default)(e[a].selected_model);!(i=(l=d.next()).done);i=!0){var f=l.value,v=!0,m=!1,g=void 0;try{for(var p,y=(0,o.default)(e[a].models);!(v=(p=y.next()).done);v=!0){var h=p.value;u+=Number(h.reserve),h.id==f.id&&(h.reserve=Number(h.reserve)-Number(f.num)),delete h.num}}catch(_){m=!0,g=_}finally{try{v||null==y.return||y.return()}finally{if(m)throw g}}}}catch(_){s=!0,c=_}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}u=Number(e[a].reserve)-Number(e[a].num),t.set("models",e[a].models)}else u=Number(e[a].reserve)-Number(e[a].num);t.set("reserve",u),t.set("stocktype",u>=e[a].warning_num?1:0),t.save(),e[a].warning_num>=u&&r.log(e[a].goodsName+"出库了"+e[a].num+"件，已经低于预警数量"+e[a].warning_num,-2,e[a].objectId),r.record_staffOut(Number(e[a].num)),a==e.length-1&&n(!0)}).catch(function(e){t.log(e)})},s=0;s<e.length;s++)u(s)})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,r,n){var o=i.default.Pointer("_User"),a=o.set(uni.getStorageSync("uid")),u=i.default.Query("logs");u.set("parent",a),u.set("log",e),u.set("detail_id",n),u.set("type",r),u.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_shopOut:function(e,r){t.log(e,r);var n=i.default.Query("shops");n.set("id",e),n.set("have_out",r),n.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var r=i.default.Query("staffs");r.set("id",uni.getStorageSync("user").objectId),r.set("have_out",Number(e)+uni.getStorageSync("user").have_out),r.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var r=i.default.Query("Goods");r.equalTo("userId","==",e),r.find().then(function(e){t.log(e);var r=!0,n=!1,a=void 0;try{for(var i,u=(0,o.default)(e);!(r=(i=u.next()).done);r=!0){var s=i.value;t.log(s),Number(s.costPrice)*s.reserve,s.reserve}}catch(c){n=!0,a=c}finally{try{r||null==u.return||u.return()}finally{if(n)throw a}}})},getDay:function(e,t){var r=this,n=new Date,o=n.getTime()+864e5*e;n.setTime(o);var a=n.getFullYear(),i=n.getMonth(),u=n.getDate();return i=r.handleMonth(i+1),u=r.handleMonth(u),t?a+"-"+i+"-"+u+" 00:00:00":a+"-"+i+"-"+u},js_date_time:function(e,t){var r=new Date(e),n=r.getFullYear(),o=r.getMonth()+1;o=o<10?"0"+o:o;var a=r.getDate();a=a<10?"0"+a:a;var i=r.getHours();i=i<10?"0"+i:i;var u=r.getMinutes(),s=r.getSeconds();return u=u<10?"0"+u:u,s=s<10?"0"+s:s,t?n+"-"+o+"-"+a+" "+i+":"+u:n+"-"+o+"-"+a},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,r("5a52")["default"])}}]);