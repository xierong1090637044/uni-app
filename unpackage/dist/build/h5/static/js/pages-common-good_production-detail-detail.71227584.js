(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_production-detail-detail"],{"0090":function(t,e,i){var a=i("1692");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("7e42d796",a,!0,{sourceMap:!1,shadowMode:!1})},1692:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,".page[data-v-6a9b906d]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-6a9b906d]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%}.pro_list[data-v-6a9b906d]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-6a9b906d]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-6a9b906d]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-6a9b906d]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-6a9b906d]{padding:0 %?50?%;background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset}",""])},"1a39":function(t,e,i){"use strict";i.r(e);var a=i("69a9"),n=i("8ed4");for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);i("fc8d");var s=i("f0c5"),r=Object(s["a"])(n["default"],a["a"],a["b"],!1,null,"6a9b906d",null);e["default"]=r.exports},"69a9":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"page"},[i("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),i("v-uni-view",t._l(t.products,function(e,a){return i("v-uni-view",{key:a,staticClass:"pro_listitem"},[i("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[i("v-uni-view",{staticStyle:{width:"calc(100% - 200rpx)"}},[t._v("产品："+t._s(e.goodsName))]),i("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),e.selected_model?i("v-uni-view",t._l(e.selected_model,function(e,a){return e.num>0?i("v-uni-view",{key:a,staticClass:"display_flex_bet"},[e?i("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[t._v(t._s(e.custom1.value+e.custom2.value+e.custom3.value+e.custom4.value))]):t._e(),e?i("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[t._v(t._s(e.num))]):t._e()],1):t._e()}),1):t._e(),i("v-uni-view",{staticClass:"pro_list"},[i("v-uni-view",[t._v("实际零售价：￥"+t._s(e.modify_retailPrice)+"（X"+t._s(e.num)+"）")]),i("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),i("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[i("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[i("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("生产明细")]),i("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx",padding:"0 20rpx"}},[i("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("客户姓名")]),i("v-uni-view",{staticClass:"kaidan_rightinput"},[i("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1),i("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("开工时间")]),i("v-uni-picker",{attrs:{mode:"date"},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindstartChange.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[i("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[i("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.startDay))]),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),i("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("计划完成")]),i("v-uni-picker",{attrs:{mode:"date"},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindendChange.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[i("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[i("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.endDay))]),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1)],1)],1),i("v-uni-view",{staticStyle:{"margin-top":"20px"}},[i("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu",fixed:"true"}})],1),i("v-uni-view",{staticStyle:{"margin-top":"20px",background:"#fff",padding:"10rpx"}},[i("v-uni-view",{staticClass:"notice_text"},[t._v("上传生产记录图(会员可用)")]),i("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[i("v-uni-view",{staticClass:"upload_image display_flex"},[t._l(t.Images,function(e,a){return t.Images&&t.Images.length>0?i("v-uni-view",{key:a,staticStyle:{position:"relative"}},[i("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:e}}),i("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeImg(a)}}})],1):t._e()}),t.Images.length<3?i("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.upload_image.apply(void 0,arguments)}}},[i("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):t._e()],2)],1)],1),i("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx"}},[i("v-uni-view",[i("v-uni-text",[t._v("合计数量："+t._s(t.total_num))])],1),i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit","data-type":"2"}},[t._v("生产")])],1)],1)],1)],1)],1)},n=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return n})},"8ed4":function(t,e,i){"use strict";i.r(e);var a=i("9d2d"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);e["default"]=n.a},"9d2d":function(t,e,i){"use strict";(function(t){var a=i("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("a481"),i("6b54");var n=a(i("5d73"));i("c5f6");var o,s,r=a(i("9546")),u=a(i("7fd5")),d=(a(i("9f50")),a(i("856d")),{data:function(){return{startDay:u.default.getDay(0,!1),endDay:u.default.getDay(1,!1),user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),othercurrent:"",Images:[],stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null,outType:"",discount:"",total_num:0}},onLoad:function(){s=this,o=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products"),s.user.rights&&s.user.rights.othercurrent&&(s.othercurrent=s.user.rights.othercurrent)},onShow:function(){this.really_total_money=0,this.all_money=0,this.real_money=0,s.custom=uni.getStorageSync("custom");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[t].really_total_money+this.really_total_money).toFixed(2)),this.total_num+=Number(this.products[t].num);this.real_money=Number(this.all_money.toFixed(2))},methods:{bindstartChange:function(t){s.startDay=t.detail.value},bindendChange:function(t){s.endDay=t.detail.value},removeImg:function(t){s.Images.splice(t,1),s.Images=s.Images},upload_image:function(){s.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){t.log(e);var i,a=Date.parse(new Date),o=e.tempFilePaths,u=!0,d=!1,l=void 0;try{for(var c,p=(0,n.default)(o);!(u=(c=p.next()).done);u=!0){var m=c.value;i=r.default.File(a+".jpg",m)}}catch(v){d=!0,l=v}finally{try{u||null==p.return||p.return()}finally{if(d)throw l}}i.save().then(function(t){var e=!0,i=!1,a=void 0;try{for(var o,r=(0,n.default)(t);!(e=(o=r.next()).done);e=!0){var u=o.value;s.Images.push(u.url)}}catch(v){i=!0,a=v}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(e){t.log(e);uni.getStorageSync("identity");this.button_disabled=!0;e.detail.formId;uni.showLoading({title:"上传中..."});for(var i=r.default.Pointer("stocks"),a=i.set(s.stock?s.stock.objectId:""),n=new Array,d=[],l=0;l<this.products.length;l++){var c=Number(this.products[l].reserve)-this.products[l].num,p=r.default.Query("Bills"),m={},v=r.default.Pointer("_User"),g=v.set(o),f=r.default.Pointer("_User"),y=f.set(uni.getStorageSync("masterId")),h=r.default.Pointer("Goods"),_=h.set(this.products[l].objectId);if(uni.getStorageSync("custom")){var w=r.default.Pointer("customs"),b=w.set(uni.getStorageSync("custom").objectId);p.set("custom",b)}p.set("goodsName",this.products[l].goodsName),p.set("retailPrice",this.products[l].modify_retailPrice.toString()),p.set("num",Number(this.products[l].num)),p.set("total_money",this.products[l].total_money),p.set("really_total_money",this.products[l].really_total_money),p.set("goodsId",_),p.set("userId",g),p.set("type",5),p.set("opreater",y),p.set("status",!1);var S={};m.goodsName=this.products[l].goodsName,m.modify_retailPrice=this.products[l].modify_retailPrice.toString(),m.retailPrice=this.products[l].retailPrice,m.total_money=this.products[l].total_money,S.costPrice=this.products[l].costPrice,S.retailPrice=this.products[l].retailPrice,S.objectId=this.products[l].objectId,S.reserve=c,this.products[l].selectd_model&&(S.selected_model=this.products[l].selected_model,S.models=this.products[l].models),m.goodsId=S,m.type=5,m.num=this.products[l].num,m.warning_num=this.products[l].warning_num,n.push(p),d.push(m)}r.default.Query("Bills").saveAll(n).then(function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].success.objectId);var l=r.default.Pointer("_User"),c=l.set(o),p=uni.getStorageSync("masterId"),m=r.default.Pointer("_User"),v=m.set(p),g=r.default.Query("order_opreations");if(g.set("detail",d),g.set("bills",i),g.set("beizhu",e.detail.value.input_beizhu),g.set("type",5),g.set("opreater",v),g.set("stock",a),g.set("master",c),g.set("real_num",s.total_num),s.discount&&g.set("discount",s.discount),g.set("goodsName",s.products[0].goodsName),g.set("real_money",Number(s.real_money)),g.set("debt",s.all_money-Number(s.real_money)),s.custom){var f=r.default.Pointer("customs"),y=f.set(s.custom.objectId);g.set("custom",y)}g.set("all_money",s.all_money),g.set("Images",s.Images),g.set("status",!1),g.set("matterStatus",!1),g.set("startDay",new Date(s.startDay.replace(/-/g,"/")).getTime()),g.set("endDay",new Date(s.endDay.replace(/-/g,"/")).getTime()),g.save().then(function(t){var e=t.objectId;uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"生产单创建成功",icon:"success",success:function(){s.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),u.default.log(uni.getStorageSync("user").nickName+"创建了'"+s.products[0].goodsName+"'等"+s.products.length+"商品的生产单",5,e),uni.navigateBack({delta:2})},500)}})})},function(e){t.log("异常处理")})}}});e.default=d}).call(this,i("5a52")["default"])},"9f50":function(t,e,i){"use strict";(function(t){var a=i("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("9546")),o={sendTempMini:function(t,e){if("enter"==e){var i={thing1:{value:t.goodsName+"...等",color:"#173177"},number2:{value:t.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},date4:{value:t.createdAt}};i.id=t.operationId,this.send_in_mini(i)}else if("out"==e){var a={thing1:{value:t.goodsName+"...等",color:"#173177"},number2:{value:t.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},time4:{value:t.createdAt}};a.id=t.operationId,this.send_out_mini(a)}},send_in:function(e){var i=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:i,frist:e.frist,data1:e.data1,data2:e.data2,remark:e.remark,url:e.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_noconfrim:function(e){var i=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:i,frist:e.frist,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:e.remark,url:e.url,type:"in_noconfrim"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_mini:function(e){var i={touser:uni.getStorageSync("openid"),template_id:"G2UJEDEyAtGuBdO-Yv96yBi-UnTLhaInr-KzEXqZ-48",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,data:e,emphasis_keyword:""};n.default.sendWeAppMessage(i).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_out_mini:function(e){var i={touser:uni.getStorageSync("openid"),template_id:"BKT2_0OuWF3mLZGvFmpRzWFa_Dyr4EIppl_LFF1uRLE",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,data:e,emphasis_keyword:""};n.default.sendWeAppMessage(i).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_temp:function(e){var i=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:i,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:"备注:"+e.remark,url:e.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})}};e.default=o}).call(this,i("5a52")["default"])},fc8d:function(t,e,i){"use strict";var a=i("0090"),n=i.n(a);n.a}}]);