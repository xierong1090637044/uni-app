(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_count-count_detail-count_detail"],{"07bc":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",[r("v-uni-view",{staticClass:"page"},[r("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[e._v("已选产品")]),r("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},e._l(e.products,function(t,o){return r("v-uni-view",{key:o,staticClass:"pro_listitem"},[r("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[r("v-uni-view",[e._v("产品："+e._s(t.goodsName))])],1),r("v-uni-view",{staticClass:"pro_list"},[r("v-uni-view",[e._v("盘点前库存："+e._s(t.reserve))]),r("v-uni-view",[e._v("盘点后库存："+e._s(t.num))])],1)],1)}),1),r("v-uni-form",{on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[r("v-uni-view",{staticStyle:{"margin-top":"20px"}},[r("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),r("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[r("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit"}},[e._v("确认盘点")])],1)],1)],1)],1)},n=[];r.d(t,"a",function(){return o}),r.d(t,"b",function(){return n})},"9a54":function(e,t,r){"use strict";r.r(t);var o=r("9db1"),n=r.n(o);for(var a in o)"default"!==a&&function(e){r.d(t,e,function(){return o[e]})}(a);t["default"]=n.a},"9db1":function(e,t,r){"use strict";(function(e){var o=r("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("5d73"));r("c5f6"),r("6b54"),r("87b3");var a,u,s=o(r("c74b")),i=o(r("df06")),c=o(r("b410")),d={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,producer:null}},onLoad:function(){u=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products")},methods:{formSubmit:function(t){e.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var r=new Array,o=[],d=0;d<this.products.length;d++){var l=s.default.Query("Bills"),f={},v=s.default.Pointer("_User"),g=v.set(a),m=s.default.Pointer("Goods"),p=m.set(this.products[d].objectId),h=uni.getStorageSync("masterId"),y=s.default.Pointer("_User"),b=y.set(h);if(l.set("goodsName",this.products[d].goodsName),l.set("retailPrice",this.products[d].modify_retailPrice.toString()),l.set("num",Number(this.products[d].num)),l.set("reserve",this.products[d].reserve),l.set("now_reserve",this.products[d].num.toString()),l.set("total_money",this.products[d].total_money),l.set("opreater",b),l.set("goodsId",p),l.set("userId",g),l.set("type",3),u.products[d].stocks&&u.products[d].stocks.objectId){var _=s.default.Pointer("stocks"),B=_.set(u.products[d].stocks.objectId);l.set("stock",B)}f.goodsName=this.products[d].goodsName,f.reserve=this.products[d].reserve,f.now_reserve=this.products[d].num.toString(),r.push(l),o.push(f)}s.default.Query("Bills").saveAll(r).then(function(r){var d=s.default.Pointer("_User"),l=d.set(a),f=uni.getStorageSync("masterId"),v=s.default.Pointer("_User"),g=v.set(f),m=s.default.Query("order_opreations");if(m.set("beizhu",t.detail.value.input_beizhu),m.set("detail",o),m.set("type",3),m.set("opreater",g),m.set("master",l),m.set("goodsName",u.products[0].goodsName),u.products[0].stocks&&u.products[0].stocks.objectId){var p=s.default.Pointer("stocks"),h=p.set(u.products[0].stocks.objectId);m.set("stock",h)}m.save().then(function(t){var r=t.objectId;uni.hideLoading(),uni.showToast({title:"产品盘点成功",icon:"success",success:function(){for(var o=function(t){var r=0,o=s.default.Query("Goods");o.get(u.products[t].objectId).then(function(e){if(u.products[t].selectd_model){var o=!0,a=!1,s=void 0;try{for(var i,c=(0,n.default)(JSON.parse(u.products[t].selectd_model));!(o=(i=c.next()).done);o=!0){var d=i.value,l=!0,f=!1,v=void 0;try{for(var g,m=(0,n.default)(u.products[t].models);!(l=(g=m.next()).done);l=!0){var p=g.value;p.id==JSON.parse(d).id?(p.reserve=Number(u.products[t].num),r+=Number(u.products[t].num)):r+=Number(p.reserve)}}catch(h){f=!0,v=h}finally{try{l||null==m.return||m.return()}finally{if(f)throw v}}}}catch(h){a=!0,s=h}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}e.set("models",u.products[t].models)}else r=Number(u.products[t].num);e.set("reserve",r),e.set("stocktype",r>u.products[t].warning_num?1:0),e.save()}).catch(function(t){e.log(t)})},a=0;a<u.products.length;a++)o(a);u.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),i.default.log(uni.getStorageSync("user").nickName+"盘点了'"+u.products[0].goodsName+"'等"+u.products.length+"商品",3,t.objectId),uni.getStorageSync("setting").auto_print&&c.default.autoPrint(r),uni.navigateBack({delta:2})},500)}})})},function(t){e.log("异常处理")})}}};t.default=d}).call(this,r("5a52")["default"])},"9fb9":function(e,t,r){"use strict";r.r(t);var o=r("07bc"),n=r("9a54");for(var a in n)"default"!==a&&function(e){r.d(t,e,function(){return n[e]})}(a);r("c9bf");var u=r("2877"),s=Object(u["a"])(n["default"],o["a"],o["b"],!1,null,"b11bead4",null);t["default"]=s.exports},b410:function(e,t,r){"use strict";(function(e){var o=r("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("5d73")),a=o(r("c74b")),u={autoPrint:function(t){var r=this;e.log("sssss",t);var o=a.default.Query("order_opreations");o.include("opreater","custom","producer","stock"),o.get(t).then(function(t){e.log(t),r.print_operations(t,t.detail)})},print_goodDet:function(e){var t,r=uni.getStorageSync("now_product");r.objectId=e.good_id,r.stocks=e,r.productCode=e.productCode,t="<CB>商品信息</CB><BR>",t+="--------------------------------<BR>",t+="产品名称：　　 "+r.goodsName+"<BR>",r.stocks&&(t+="存放仓库：　　 "+r.stocks.stock_name+"<BR>"),r.position&&(t+="货架位置：　　 "+r.position+"<BR>"),r.producttime&&(t+="生产日期：　　 "+r.producttime+"<BR>"),r.nousetime&&(t+="失效日期：　　 "+r.nousetime+"<BR>"),t+="当前库存：　　 "+r.reserve+"<BR>",t+="产品规格:　　　"+r.packageContent+"*"+r.packingUnit+"<BR>",t+="进货价格:      "+r.costPrice+"<BR>",t+="零售价格:      "+r.retailPrice+"<BR>",r.bad_num&&(t+="货损数量:      "+r.bad_num+"<BR>"),t+="--------------------------------<BR>",t+="产品二维码：<BR>",t+="<QR>"+r.productCode+"</QR>",this.print_by_code(t)},print_operations:function(t,r){if(e.log(t),3==t.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var o=0;o<r.length;o++)v+="产品名称："+r[o].goodsName+"<BR>",v+="盘点前库存："+r[o].reserve+"<BR>",v+="盘点后库存："+r[o].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==t.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var a=0;a<r.length;a++){v+="产品名称："+r[a].goodsName+"<BR>",v+="调拨数量："+r[a].num+"<BR>",v+="--------------------------------<BR>";var u=!0,s=!1,i=void 0;try{for(var c,d=(0,n.default)(t.detail);!(u=(c=d.next()).done);u=!0){var l=c.value;v+="调出仓库："+l.stock+"<BR>",v+="<RIGHT>当前库存："+(l.reserve-l.num)+"</RIGHT><BR>",v+="调入仓库："+l.out_stock+"<BR>",v+="<RIGHT>当前库存："+(l.out_reserve+l.num)+"</RIGHT><BR>"}}catch(m){s=!0,i=m}finally{try{u||null==d.return||d.return()}finally{if(s)throw i}}}v+="--------------------------------<BR>"}else if(2==t.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var f=0;f<r.length;f++)v+="产品名称："+r[f].goodsName+"<BR>",v+="零售价："+r[f].retailPrice+"<BR>",v+="数量    ：X"+r[f].num+"<BR>",v+="<RIGHT>总计："+r[f].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=t.custom?v+="客户姓名："+t.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==t.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var g=0;g<r.length;g++)v+="产品名称："+r[g].goodsName+"<BR>",v+="实际单价："+r[g].retailPrice+"<BR>",v+="数量    ：X"+r[g].num+"<BR>",v+="<RIGHT>总计："+r[g].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==t.type&&(v+="开单明细：<BR>",v+="<BR>",null!=t.producer&&(v+="供货商姓名："+t.producer.producer_name+"<BR>"),null==t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款："+t.debt+"<BR>"),v+="--------------------------------<BR>"),-1==t.type&&(v+="开单明细：<BR>",v+="<BR>",t.custom&&(v+="客户姓名："+t.custom.custom_name+"<BR>"),t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款  ："+t.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+t.opreater.nickName+"<BR>",v+="备注："+t.beizhu+"<BR>",v+="操作时间："+t.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(t){var r=uni.getStorageSync("setting").USER,o=uni.getStorageSync("setting").UKEY,n=uni.getStorageSync("setting").number,a="api.feieyun.cn",u="/Api/Open/",s=(new Date).getTime(),i=d(r+o+s);y(n,t,1);var c=0;function d(e){return h(l(p(e)))}function l(e){for(var t=e,r=Array(80),o=1732584193,n=-271733879,a=-1732584194,u=271733878,s=-1009589776,i=0;i<t.length;i+=16){for(var c=o,d=n,l=a,p=u,h=s,y=0;y<80;y++){r[y]=y<16?t[i+y]:m(r[y-3]^r[y-8]^r[y-14]^r[y-16],1);var b=g(g(m(o,5),f(y,n,a,u)),g(g(s,r[y]),v(y)));s=u,u=a,a=m(n,30),n=o,o=b}o=g(o,c),n=g(n,d),a=g(a,l),u=g(u,p),s=g(s,h)}return new Array(o,n,a,u,s)}function f(e,t,r,o){return e<20?t&r|~t&o:e<40?t^r^o:e<60?t&r|t&o|r&o:t^r^o}function v(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function g(e,t){var r=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(r>>16);return o<<16|65535&r}function m(e,t){return e<<t|e>>>32-t}function p(e){for(var t=1+(e.length+8>>6),r=new Array(16*t),o=0;o<16*t;o++)r[o]=0;for(o=0;o<e.length;o++)r[o>>2]|=e.charCodeAt(o)<<24-8*(3&o);return r[o>>2]|=128<<24-8*(3&o),r[16*t-1]=8*e.length,r}function h(e){for(var t=c?"0123456789ABCDEF":"0123456789abcdef",r="",o=0;o<4*e.length;o++)r+=t.charAt(e[o>>2]>>8*(3-o%4)+4&15)+t.charAt(e[o>>2]>>8*(3-o%4)&15);return r}function y(t,o,n){uni.request({url:"https://"+a+u,data:{user:r,stime:s,sig:i,apiname:"Open_printMsg",sn:t,content:o,times:n},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t.data),0!=t.data.ret?uni.showToast({icon:"none",title:t.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};t.default=u}).call(this,r("5a52")["default"])},c9bf:function(e,t,r){"use strict";var o=r("e894"),n=r.n(o);n.a},d7c4:function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".page[data-v-b11bead4]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-b11bead4]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-b11bead4]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-b11bead4]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-b11bead4]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-b11bead4]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},df06:function(e,t,r){"use strict";(function(t){var o=r("288e");r("6b54"),r("87b3"),r("7514");var n=o(r("5d73"));r("c5f6");var a=o(r("795b")),u=o(r("c74b"));e.exports={enterAddGoodNum:function(e){return new a.default(function(r,o){for(var a=function(o){var a=0,s=u.default.Query("Goods");s.get(e[o].objectId).then(function(u){if(t.log(e[o]),e[o].selectd_model){var s=!0,i=!1,c=void 0;try{for(var d,l=(0,n.default)(e[o].selected_model);!(s=(d=l.next()).done);s=!0){var f=d.value,v=!0,g=!1,m=void 0;try{for(var p,h=(0,n.default)(e[o].models);!(v=(p=h.next()).done);v=!0){var y=p.value;y.id==f.id&&(y.reserve=Number(y.reserve)+Number(f.num))}}catch(b){g=!0,m=b}finally{try{v||null==h.return||h.return()}finally{if(g)throw m}}}}catch(b){i=!0,c=b}finally{try{s||null==l.return||l.return()}finally{if(i)throw c}}a=Number(e[o].reserve)+Number(e[o].num),u.set("models",e[o].models)}else a=Number(e[o].reserve)+Number(e[o].num);u.set("reserve",a),u.set("stocktype",a>e[o].warning_num?1:0),u.save(),o==e.length-1&&r(!0)}).catch(function(e){t.log(e)})},s=0;s<e.length;s++)a(s)})},outRedGoodNum:function(e){var r=this;return new a.default(function(o,a){for(var s=function(a){var s=0,i=u.default.Query("Goods");i.get(e[a].objectId).then(function(t){if(e[a].selectd_model){var u=!0,i=!1,c=void 0;try{for(var d,l=(0,n.default)(e[a].selectd_model);!(u=(d=l.next()).done);u=!0){var f=d.value,v=!0,g=!1,m=void 0;try{for(var p,h=(0,n.default)(e[a].models);!(v=(p=h.next()).done);v=!0){var y=p.value;s+=Number(y.reserve),y.id==f.id&&(y.reserve=Number(y.reserve)-Number(f.num))}}catch(b){g=!0,m=b}finally{try{v||null==h.return||h.return()}finally{if(g)throw m}}}}catch(b){i=!0,c=b}finally{try{u||null==l.return||l.return()}finally{if(i)throw c}}s=Number(e[a].reserve)-Number(e[a].num),t.set("models",e[a].models)}else s=Number(e[a].reserve)-Number(e[a].num);t.set("reserve",s),t.set("stocktype",s>=e[a].warning_num?1:0),t.save(),e[a].warning_num>=s&&r.log(e[a].goodsName+"出库了"+e[a].num+"件，已经低于预警数量"+e[a].warning_num,-2,e[a].objectId),r.record_staffOut(Number(e[a].num)),a==e.length-1&&o(!0)}).catch(function(e){t.log(e)})},i=0;i<e.length;i++)s(i)})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,r,o){var n=u.default.Pointer("_User"),a=n.set(uni.getStorageSync("uid")),s=u.default.Query("logs");s.set("parent",a),s.set("log",e),s.set("detail_id",o),s.set("type",r),s.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_shopOut:function(e,r){t.log(e,r);var o=u.default.Query("shops");o.set("id",e),o.set("have_out",r),o.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var r=u.default.Query("staffs");r.set("id",uni.getStorageSync("user").objectId),r.set("have_out",Number(e)+uni.getStorageSync("user").have_out),r.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var r=u.default.Query("Goods");r.equalTo("userId","==",e),r.find().then(function(e){t.log(e);var r=!0,o=!1,a=void 0;try{for(var u,s=(0,n.default)(e);!(r=(u=s.next()).done);r=!0){var i=u.value;t.log(i),Number(i.costPrice)*i.reserve,i.reserve}}catch(c){o=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}})},getDay:function(e,t){var r=this,o=new Date,n=o.getTime()+864e5*e;o.setTime(n);var a=o.getFullYear(),u=o.getMonth(),s=o.getDate();return u=r.handleMonth(u+1),s=r.handleMonth(s),t?a+"-"+u+"-"+s+" 00:00:00":a+"-"+u+"-"+s},js_date_time:function(e,t){var r=new Date(e),o=r.getFullYear(),n=r.getMonth()+1;n=n<10?"0"+n:n;var a=r.getDate();a=a<10?"0"+a:a;var u=r.getHours();u=u<10?"0"+u:u;var s=r.getMinutes(),i=r.getSeconds();return s=s<10?"0"+s:s,i=i<10?"0"+i:i,t?o+"-"+n+"-"+a+" "+u+":"+s:o+"-"+n+"-"+a},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,r("5a52")["default"])},e894:function(e,t,r){var o=r("d7c4");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var n=r("4f06").default;n("29ae92cc",o,!0,{sourceMap:!1,shadowMode:!1})}}]);