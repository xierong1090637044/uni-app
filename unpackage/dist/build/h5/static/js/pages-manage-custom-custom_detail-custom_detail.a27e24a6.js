(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-manage-custom-custom_detail-custom_detail"],{"02a8":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={name:"UniPopup",props:{show:{type:Boolean,default:!1},position:{type:String,default:"middle"},mode:{type:String,default:"insert"},msg:{type:String,default:""},h5Top:{type:Boolean,default:!1},buttonMode:{type:String,default:"bottom"}},data:function(){return{offsetTop:0}},watch:{h5Top:function(t){this.offsetTop=t?44:0}},created:function(){var t=0;t=this.h5Top?0:44,this.offsetTop=t},methods:{hide:function(){"insert"===this.mode&&"middle"===this.position||this.$emit("hidePopup")},closeMask:function(){"insert"===this.mode&&this.$emit("hidePopup")},moveHandle:function(){}}};e.default=o},"0e3f":function(t,e,n){"use strict";n.r(e);var o=n("3633"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=a.a},"212e":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[t.loading?n("loading"):n("v-uni-view",[n("uni-nav-bar",{attrs:{fixed:!0,color:"#333333","background-color":"#FFFFFF","right-text":"操作"},on:{"click-right":function(e){e=t.$handleEvent(e),t.show_options(e)}}}),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[t._v("客户昵称")]),n("v-uni-view",[t._v(t._s(t.custom.custom_name))])],1),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[t._v("联系电话")]),t.custom.custom_phone?n("v-uni-view",[t._v(t._s(t.custom.custom_phone))]):n("v-uni-view",[t._v("未填写")])],1),n("v-uni-navigator",{staticClass:"display_flex_bet list_item border_bottom",attrs:{"hover-class":"none",url:"debt_history/debt_history?id="+t.custom.objectId+"&name="+t.custom.custom_name}},[n("v-uni-view",{staticClass:"left_desc"},[t._v("客户欠款")]),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-text",{staticStyle:{"margin-right":"20rpx"}},[t._v("￥"+t._s(t.custom.debt?t.custom.debt:0))]),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),n("v-uni-view",{staticClass:"display_flex_bet list_item border_bottom"},[n("v-uni-view",{staticClass:"left_desc"},[t._v("建立时间")]),n("v-uni-view",[t._v(t._s(t.custom.createdAt))])],1),n("v-uni-navigator",{staticClass:"list_item display_flex_bet",staticStyle:{margin:"20rpx 0"},attrs:{"hover-class":"none",url:"history/history?id="+t.custom.objectId}},[n("v-uni-text",{staticClass:"left_desc"},[t._v("交易历史")]),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1),n("uni-popup",{attrs:{show:t.modal_show,position:"middle",mode:"fixed",h5Top:!0},on:{hidePopup:function(e){e=t.$handleEvent(e),t.modal_show=!1}}},[n("v-uni-view",{staticStyle:{width:"500rpx"}},[n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-view",{staticStyle:{width:"160rpx",color:"#999"}},[t._v("本次收款：")]),n("v-uni-input",{staticClass:"uni-input",attrs:{placeholder:"请输入本次收款金额",type:"digit"},model:{value:t.modal_sk.sk_number,callback:function(e){t.$set(t.modal_sk,"sk_number",e)},expression:"modal_sk.sk_number"}})],1),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-view",{staticStyle:{width:"160rpx",color:"#999"}},[t._v("备注：")]),n("v-uni-input",{staticClass:"uni-input",attrs:{placeholder:"请输入备注信息"},model:{value:t.modal_sk.beizhu,callback:function(e){t.$set(t.modal_sk,"beizhu",e)},expression:"modal_sk.beizhu"}})],1),n("v-uni-view",{staticClass:"modal_confrimbutton",on:{click:function(e){e=t.$handleEvent(e),t.confrim_sk(e)}}},[t._v("确定")])],1)],1),n("v-uni-view",{staticClass:"getmoney_button",on:{click:function(e){e=t.$handleEvent(e),t.modal_show=!0}}},[t._v("收款")])],1)],1)},a=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a})},"292d":function(t,e,n){var o=n("e568");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var a=n("4f06").default;a("28f373ba",o,!0,{sourceMap:!1,shadowMode:!1})},"33f5":function(t,e,n){"use strict";var o=n("3fd0"),a=n.n(o);a.a},3633:function(t,e,n){"use strict";(function(t){var o=n("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("c5f6");var a,i=o(n("c74b")),u=o(n("c315")),s=o(n("df06")),r=o(n("0914")),l=o(n("db37")),c=o(n("524a")),d={components:{faIcon:r.default,loading:c.default,uniPopup:l.default},data:function(){return{loading:!0,modal_show:!1,custom:{},modal_sk:{sk_number:"",beizhu:""}}},onLoad:function(e){a=this,u.default.custom_detail(e.id).then(function(e){t.log(e),a.custom=e,a.loading=!1})},methods:{show_options:function(){uni.showActionSheet({itemList:["编辑","删除"],success:function(t){0==t.tapIndex?a.edit(a.custom):1==t.tapIndex&&a.delete_this(a.custom.objectId)},fail:function(e){t.log(e.errMsg)}})},edit:function(t){uni.setStorageSync("customs",t),uni.setStorageSync("custom_type","customs"),uni.navigateTo({url:"../add/add"})},delete_this:function(t){uni.showModal({title:"提示",content:"是否删除此客户",success:function(e){e.confirm&&a.delete_data("customs",t)}})},delete_data:function(e,n){t.log(n);var o=i.default.Query(e);o.destroy(n).then(function(e){t.log(e),uni.showToast({title:"删除成功",icon:"none"}),uni.navigateBack({delta:1})}).catch(function(e){t.log(e)})},confrim_sk:function(){t.log(a.modal_sk);var e=a.modal_sk.sk_number,n=a.modal_sk.beizhu,o=a.custom.objectId;if(null==e||0==e.length)uni.showToast({title:"请输入收款金额",icon:"none"});else{uni.showLoading({title:"加载中..."}),a.modal_show=!1;var r=i.default.Query("customs");r.get(o).then(function(r){if(r.debt-Number(e)<0)uni.hideLoading(),uni.showToast({icon:"none",title:"收款金额过大"});else if(null==r.debt||0==r.debt)uni.hideLoading(),uni.showToast({icon:"none",title:"该客户没有欠款"});else{r.set("debt",r.debt-Number(e)),r.save();var l=i.default.Pointer("customs"),c=l.set(o),d=i.default.Pointer("_User"),f=d.set(uni.getStorageSync("uid")),m=i.default.Pointer("_User"),v=m.set(uni.getStorageSync("masterId")),h=i.default.Query("debt_history");h.set("custom",c),h.set("master",f),h.set("operater",v),h.set("debt_number",Number(e)),h.set("beizhu",n),h.save().then(function(n){t.log(n),s.default.log(uni.getStorageSync("user").nickName+"操作'"+a.custom.custom_name+"'客户还款￥"+e+"元",6,n.objectId),uni.hideLoading(),u.default.custom_detail(a.custom.objectId).then(function(e){t.log(e),a.custom=e,uni.showToast({title:"收款成功"})})}).catch(function(e){t.log(e)})}}).catch(function(e){t.log(e)})}}}};e.default=d}).call(this,n("5a52")["default"])},"3fd0":function(t,e,n){var o=n("a868");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var a=n("4f06").default;a("fcfbf626",o,!0,{sourceMap:!1,shadowMode:!1})},"4e00":function(t,e,n){"use strict";n.r(e);var o=n("02a8"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=a.a},"6eb0":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"uni-mask",style:{top:t.offsetTop+"px"},on:{click:function(e){e=t.$handleEvent(e),t.hide(e)},touchmove:function(e){e.stopPropagation(),e.preventDefault(),e=t.$handleEvent(e),t.moveHandle(e)}}}),n("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"uni-popup",class:"uni-popup-"+t.position+" uni-popup-"+t.mode},[t._v(t._s(t.msg)),t._t("default"),"middle"===t.position&&"insert"===t.mode?n("v-uni-view",{staticClass:" uni-icon uni-icon-close",class:{"uni-close-bottom":"bottom"===t.buttonMode,"uni-close-right":"right"===t.buttonMode},on:{click:function(e){e=t.$handleEvent(e),t.closeMask(e)}}}):t._e()],2)],1)},a=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a})},"7be9":function(t,e,n){"use strict";n.r(e);var o=n("212e"),a=n("0e3f");for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);n("e8e8");var u=n("2877"),s=Object(u["a"])(a["default"],o["a"],o["b"],!1,null,"26adfe3c",null);e["default"]=s.exports},a868:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,'.uni-mask[data-v-aaf92358]{position:fixed;z-index:998;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.3)}.uni-popup[data-v-aaf92358]{position:fixed;z-index:999;background-color:#fff}.uni-popup-middle[data-v-aaf92358]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.uni-popup-middle.uni-popup-insert[data-v-aaf92358]{min-width:%?380?%;min-height:%?380?%;max-width:100%;max-height:80%;-webkit-transform:translate(-50%,-65%);-ms-transform:translate(-50%,-65%);transform:translate(-50%,-65%);background:none;-webkit-box-shadow:none;box-shadow:none}.uni-popup-middle.uni-popup-fixed[data-v-aaf92358]{border-radius:%?10?%;padding:%?30?%}.uni-close-bottom[data-v-aaf92358],.uni-close-right[data-v-aaf92358]{position:absolute;bottom:%?-180?%;text-align:center;border-radius:50%;color:#f5f5f5;font-size:%?60?%;font-weight:700;opacity:.8;z-index:-1}.uni-close-bottom[data-v-aaf92358]{margin:auto;left:0;right:0}.uni-close-right[data-v-aaf92358]{right:%?-60?%;top:%?-80?%}.uni-close-bottom[data-v-aaf92358]:after{content:"";position:absolute;width:0;border:1px #f5f5f5 solid;top:%?-200?%;bottom:%?56?%;left:50%;-webkit-transform:translate(-50%);-ms-transform:translate(-50%);transform:translate(-50%);opacity:.8}.uni-popup-bottom[data-v-aaf92358],.uni-popup-top[data-v-aaf92358]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center}.uni-popup-top[data-v-aaf92358]{top:0;left:0;width:100%;height:%?100?%;line-height:%?100?%;text-align:center}.uni-popup-bottom[data-v-aaf92358]{left:0;bottom:0;width:100%;min-height:%?100?%;line-height:%?100?%;text-align:center}',""])},c315:function(t,e,n){"use strict";(function(t){var o=n("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("c5f6");var a=o(n("5d73"));n("7514");var i=o(n("795b")),u=o(n("c74b")),s={get_customList:function(t,e){return new i.default(function(n,o){var a=uni.getStorageSync("uid"),i=u.default.Query("customs");i.order("num"),i.equalTo("parent","==",a),i.equalTo("disabled","==",t),e&&i.equalTo("name","==",{$regex:e+".*"}),i.find().then(function(t){n(t)})})},get_customCount:function(){return new i.default(function(t,e){var n=uni.getStorageSync("uid"),o=u.default.Query("customs");o.equalTo("parent","==",n),o.find().then(function(e){var n=e,o=!0,i=!1,s=void 0;try{for(var r,l=function(){var t=r.value,e=u.default.Query("Bills");e.equalTo("type","==",-1),e.equalTo("custom","==",t.objectId),e.find().then(function(e){t.relations=e})},c=(0,a.default)(n);!(o=(r=c.next()).done);o=!0)l()}catch(d){i=!0,s=d}finally{try{o||null==c.return||c.return()}finally{if(i)throw s}}t(n)})})},add_custom:function(e){t.log(e);var n=JSON.parse(localStorage.getItem("bmob")).objectId;return new i.default(function(o,a){var i=u.default.Pointer("_User"),s=i.set(n);if(e.objectId){var r=u.default.Query("customs");r.set("custom_name",e.custom_name),r.set("debt",Number(e.debt)),r.set("custom_address",e.custom_address),r.set("custom_phone",e.custom_phone),r.set("parent",s),r.set("disabled",!e.disabled),r.set("id",e.objectId),r.save().then(function(t){o(t)}).catch(function(e){t.log(e)})}else{var l=u.default.Query("customs");l.equalTo("parent","==",n),l.equalTo("name","==",e.custom_name),l.find().then(function(n){if(t.log(n),0==n.length){var a=u.default.Query("customs");a.set("custom_name",e.custom_name),a.set("debt",Number(e.debt)),a.set("custom_address",e.custom_address),a.set("custom_phone",e.custom_phone),a.set("have_out",0),a.set("disabled",!e.disabled),a.set("parent",s),a.save().then(function(t){o(t)}).catch(function(e){t.log(e)})}else o(!1)})}})},delete_custom:function(e){return new i.default(function(n,o){var a=u.default.Query("customs");a.destroy(e).then(function(t){n(t)}).catch(function(e){t.log(e)})})},custom_detail:function(e){return new i.default(function(n,o){var a=u.default.Query("customs");a.get(e).then(function(t){n(t)}).catch(function(e){t.log(e)})})},get_moneyList:function(e){return new i.default(function(n,o){var a=u.default.Query("debt_history");a.equalTo("custom","==",e),a.include("operater"),a.find().then(function(e){t.log(e),n(e)})})}};e.default=s}).call(this,n("5a52")["default"])},db37:function(t,e,n){"use strict";n.r(e);var o=n("6eb0"),a=n("4e00");for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);n("33f5");var u=n("2877"),s=Object(u["a"])(a["default"],o["a"],o["b"],!1,null,"aaf92358",null);e["default"]=s.exports},df06:function(t,e,n){"use strict";(function(e){var o=n("288e");n("6b54"),n("87b3"),n("7514");var a=o(n("5d73"));n("c5f6");var i=o(n("795b")),u=o(n("c74b"));t.exports={enterAddGoodNum:function(t){return new i.default(function(n,o){for(var i=function(o){var i=0,s=u.default.Query("Goods");s.get(t[o].objectId).then(function(u){if(e.log(t[o]),t[o].selectd_model){var s=!0,r=!1,l=void 0;try{for(var c,d=(0,a.default)(t[o].selected_model);!(s=(c=d.next()).done);s=!0){var f=c.value,m=!0,v=!1,h=void 0;try{for(var p,b=(0,a.default)(t[o].models);!(m=(p=b.next()).done);m=!0){var g=p.value;g.id==f.id&&(g.reserve=Number(g.reserve)+Number(f.num)),delete g.num}}catch(_){v=!0,h=_}finally{try{m||null==b.return||b.return()}finally{if(v)throw h}}}}catch(_){r=!0,l=_}finally{try{s||null==d.return||d.return()}finally{if(r)throw l}}i=Number(t[o].reserve)+Number(t[o].num),u.set("models",t[o].models)}else i=Number(t[o].reserve)+Number(t[o].num);u.set("reserve",i),u.set("stocktype",i>t[o].warning_num?1:0),u.save(),o==t.length-1&&n(!0)}).catch(function(t){e.log(t)})},s=0;s<t.length;s++)i(s)})},outRedGoodNum:function(t){var n=this;return new i.default(function(o,i){for(var s=function(i){var s=0,r=u.default.Query("Goods");r.get(t[i].objectId).then(function(e){if(t[i].selectd_model){var u=!0,r=!1,l=void 0;try{for(var c,d=(0,a.default)(t[i].selected_model);!(u=(c=d.next()).done);u=!0){var f=c.value,m=!0,v=!1,h=void 0;try{for(var p,b=(0,a.default)(t[i].models);!(m=(p=b.next()).done);m=!0){var g=p.value;s+=Number(g.reserve),g.id==f.id&&(g.reserve=Number(g.reserve)-Number(f.num)),delete g.num}}catch(_){v=!0,h=_}finally{try{m||null==b.return||b.return()}finally{if(v)throw h}}}}catch(_){r=!0,l=_}finally{try{u||null==d.return||d.return()}finally{if(r)throw l}}s=Number(t[i].reserve)-Number(t[i].num),e.set("models",t[i].models)}else s=Number(t[i].reserve)-Number(t[i].num);e.set("reserve",s),e.set("stocktype",s>=t[i].warning_num?1:0),e.save(),t[i].warning_num>=s&&n.log(t[i].goodsName+"出库了"+t[i].num+"件，已经低于预警数量"+t[i].warning_num,-2,t[i].objectId),n.record_staffOut(Number(t[i].num)),i==t.length-1&&o(!0)}).catch(function(t){e.log(t)})},r=0;r<t.length;r++)s(r)})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,n,o){var a=u.default.Pointer("_User"),i=a.set(uni.getStorageSync("uid")),s=u.default.Query("logs");s.set("parent",i),s.set("log",t),s.set("detail_id",o),s.set("type",n),s.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_shopOut:function(t,n){e.log(t,n);var o=u.default.Query("shops");o.set("id",t),o.set("have_out",n),o.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_staffOut:function(t){if(e.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var n=u.default.Query("staffs");n.set("id",uni.getStorageSync("user").objectId),n.set("have_out",Number(t)+uni.getStorageSync("user").have_out),n.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");e.log(t);var n=u.default.Query("Goods");n.equalTo("userId","==",t),n.find().then(function(t){e.log(t);var n=!0,o=!1,i=void 0;try{for(var u,s=(0,a.default)(t);!(n=(u=s.next()).done);n=!0){var r=u.value;e.log(r),Number(r.costPrice)*r.reserve,r.reserve}}catch(l){o=!0,i=l}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}})},getDay:function(t,e){var n=this,o=new Date,a=o.getTime()+864e5*t;o.setTime(a);var i=o.getFullYear(),u=o.getMonth(),s=o.getDate();return u=n.handleMonth(u+1),s=n.handleMonth(s),e?i+"-"+u+"-"+s+" 00:00:00":i+"-"+u+"-"+s},js_date_time:function(t,e){var n=new Date(t),o=n.getFullYear(),a=n.getMonth()+1;a=a<10?"0"+a:a;var i=n.getDate();i=i<10?"0"+i:i;var u=n.getHours();u=u<10?"0"+u:u;var s=n.getMinutes(),r=n.getSeconds();return s=s<10?"0"+s:s,r=r<10?"0"+r:r,e?o+"-"+a+"-"+i+" "+u+":"+s:o+"-"+a+"-"+i},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}}).call(this,n("5a52")["default"])},e568:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,"uni-page-body[data-v-26adfe3c]{color:#3d3d3d}.modal_confrimbutton[data-v-26adfe3c]{background:#426ab3;color:#fff;width:60%;padding:%?20?% 0;text-align:center;margin-left:20%;border-radius:%?8?%;margin-top:%?30?%}.list_item[data-v-26adfe3c]{padding:%?20?% %?30?%;background:#fff}.left_desc[data-v-26adfe3c]{color:#999}.border_bottom[data-v-26adfe3c]{border-bottom:%?1?% solid#DDDDDD}.getmoney_button[data-v-26adfe3c]{width:100%;background:#426ab3;color:#fff;padding:%?20?% 0;text-align:center;position:fixed;bottom:0;left:0}",""])},e8e8:function(t,e,n){"use strict";var o=n("292d"),a=n.n(o);a.a}}]);