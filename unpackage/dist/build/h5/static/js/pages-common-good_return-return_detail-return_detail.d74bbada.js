(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_return-return_detail-return_detail"],{"074e":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("退货数量：X"+t._s(e.num))]),o("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),o("v-uni-view",{staticClass:"pro_allmoney"},[t._v("总计：￥"+t._s(t.all_money))]),o("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细（用于记录退货客户）")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("选择门店")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择门店",disabled:"true",value:t.shop_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("客户姓名")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("确认退货")])],1)],1)],1)],1)},r=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return r})},"227b":function(t,e,o){var n=o("7628");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=o("4f06").default;r("7eec3638",n,!0,{sourceMap:!1,shadowMode:!1})},"243a":function(t,e,o){"use strict";var n=o("227b"),r=o.n(n);r.a},"2df3":function(t,e,o){"use strict";(function(t){var n=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(o("5d73")),a=n(o("906f")),i={autoPrint:function(e){var o=this;t.log("sssss",e);var n=a.default.Query("order_opreations");n.include("opreater","custom","producer","stock"),n.get(e).then(function(e){t.log(e),o.print_operations(e,e.detail)})},print_goodDet:function(t){var e,o=uni.getStorageSync("now_product");o.objectId=t.good_id,o.stocks=t,o.productCode=t.productCode,e="<CB>商品信息</CB><BR>",e+="--------------------------------<BR>",e+="产品名称：　　 "+o.goodsName+"<BR>",o.stocks&&(e+="存放仓库：　　 "+o.stocks.stock_name+"<BR>"),o.position&&(e+="货架位置：　　 "+o.position+"<BR>"),o.producttime&&(e+="生产日期：　　 "+o.producttime+"<BR>"),o.nousetime&&(e+="失效日期：　　 "+o.nousetime+"<BR>"),e+="当前库存：　　 "+o.reserve+"<BR>",e+="产品规格:　　　"+o.packageContent+"*"+o.packingUnit+"<BR>",e+="进货价格:      "+o.costPrice+"<BR>",e+="零售价格:      "+o.retailPrice+"<BR>",o.bad_num&&(e+="货损数量:      "+o.bad_num+"<BR>"),e+="--------------------------------<BR>",e+="产品二维码：<BR>",e+="<QR>"+o.productCode+"</QR>",this.print_by_code(e)},print_operations:function(e,o){if(t.log(e),3==e.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var n=0;n<o.length;n++)v+="产品名称："+o[n].goodsName+"<BR>",v+="盘点前库存："+o[n].reserve+"<BR>",v+="盘点后库存："+o[n].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==e.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var a=0;a<o.length;a++){v+="产品名称："+o[a].goodsName+"<BR>",v+="调拨数量："+o[a].num+"<BR>",v+="--------------------------------<BR>";var i=!0,s=!1,u=void 0;try{for(var c,l=(0,r.default)(e.detail);!(i=(c=l.next()).done);i=!0){var d=c.value;v+="调出仓库："+d.stock+"<BR>",v+="<RIGHT>当前库存："+(d.reserve-d.num)+"</RIGHT><BR>",v+="调入仓库："+d.out_stock+"<BR>",v+="<RIGHT>当前库存："+(d.out_reserve+d.num)+"</RIGHT><BR>"}}catch(p){s=!0,u=p}finally{try{i||null==l.return||l.return()}finally{if(s)throw u}}}v+="--------------------------------<BR>"}else if(2==e.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var f=0;f<o.length;f++)v+="产品名称："+o[f].goodsName+"<BR>",v+="零售价："+o[f].retailPrice+"<BR>",v+="数量    ：X"+o[f].num+"<BR>",v+="<RIGHT>总计："+o[f].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=e.custom?v+="客户姓名："+e.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+e.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==e.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var g=0;g<o.length;g++)v+="产品名称："+o[g].goodsName+"<BR>",v+="实际单价："+o[g].retailPrice+"<BR>",v+="数量    ：X"+o[g].num+"<BR>",v+="<RIGHT>总计："+o[g].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+e.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==e.type&&(v+="开单明细：<BR>",v+="<BR>",null!=e.producer&&(v+="供货商姓名："+e.producer.producer_name+"<BR>"),null==e.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+e.real_money+"<BR>",e.debt>0&&(v+="本次欠款："+e.debt+"<BR>"),v+="--------------------------------<BR>"),-1==e.type&&(v+="开单明细：<BR>",v+="<BR>",e.custom&&(v+="客户姓名："+e.custom.custom_name+"<BR>"),e.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+e.real_money+"<BR>",e.debt>0&&(v+="本次欠款  ："+e.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+e.opreater.nickName+"<BR>",v+="备注："+e.beizhu+"<BR>",v+="操作时间："+e.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(e){var o=uni.getStorageSync("setting").USER,n=uni.getStorageSync("setting").UKEY,r=uni.getStorageSync("setting").number,a="api.feieyun.cn",i="/Api/Open/",s=(new Date).getTime(),u=l(o+n+s);y(r,e,1);var c=0;function l(t){return h(d(m(t)))}function d(t){for(var e=t,o=Array(80),n=1732584193,r=-271733879,a=-1732584194,i=271733878,s=-1009589776,u=0;u<e.length;u+=16){for(var c=n,l=r,d=a,m=i,h=s,y=0;y<80;y++){o[y]=y<16?e[u+y]:p(o[y-3]^o[y-8]^o[y-14]^o[y-16],1);var _=g(g(p(n,5),f(y,r,a,i)),g(g(s,o[y]),v(y)));s=i,i=a,a=p(r,30),r=n,n=_}n=g(n,c),r=g(r,l),a=g(a,d),i=g(i,m),s=g(s,h)}return new Array(n,r,a,i,s)}function f(t,e,o,n){return t<20?e&o|~e&n:t<40?e^o^n:t<60?e&o|e&n|o&n:e^o^n}function v(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function g(t,e){var o=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(o>>16);return n<<16|65535&o}function p(t,e){return t<<e|t>>>32-e}function m(t){for(var e=1+(t.length+8>>6),o=new Array(16*e),n=0;n<16*e;n++)o[n]=0;for(n=0;n<t.length;n++)o[n>>2]|=t.charCodeAt(n)<<24-8*(3&n);return o[n>>2]|=128<<24-8*(3&n),o[16*e-1]=8*t.length,o}function h(t){for(var e=c?"0123456789ABCDEF":"0123456789abcdef",o="",n=0;n<4*t.length;n++)o+=e.charAt(t[n>>2]>>8*(3-n%4)+4&15)+e.charAt(t[n>>2]>>8*(3-n%4)&15);return o}function y(e,n,r){uni.request({url:"https://"+a+i,data:{user:o,stime:s,sig:u,apiname:"Open_printMsg",sn:e,content:n,times:r},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e.data),0!=e.data.ret?uni.showToast({icon:"none",title:e.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};e.default=i}).call(this,o("5a52")["default"])},"712f":function(t,e,o){"use strict";(function(t){var n=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(o("5d73"));o("6b54"),o("87b3"),o("c5f6"),o("7f7f");var a,i,s,u,c=n(o("906f")),l=n(o("93e8")),d=n(o("2df3")),f={data:function(){return{shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null}},onLoad:function(){i=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=this.products[t].total_money+this.all_money},onShow:function(){if(i.custom=uni.getStorageSync("custom"),u=uni.getStorageSync("shop"),u){i.shop_name=u.name;var t=c.default.Pointer("shops");s=t.set(u.objectId)}},methods:{formSubmit:function(e){t.log(e),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var o=new Array,n=[],f=0;f<this.products.length;f++){Number(this.products[f].reserve),this.products[f].num;var v=c.default.Query("Bills"),g={},p=c.default.Pointer("_User"),m=p.set(a),h=c.default.Pointer("Goods"),y=h.set(this.products[f].objectId),_=uni.getStorageSync("masterId"),b=c.default.Pointer("_User"),B=b.set(_);v.set("goodsName",this.products[f].goodsName),v.set("retailPrice",this.products[f].modify_retailPrice.toString()),v.set("num",Number(this.products[f].num)),v.set("total_money",this.products[f].total_money),v.set("goodsId",y),v.set("opreater",B),v.set("userId",m),v.set("type",2);var S={};g.goodsName=this.products[f].goodsName,g.modify_retailPrice=this.products[f].modify_retailPrice.toString(),g.retailPrice=this.products[f].retailPrice,g.total_money=this.products[f].total_money,S.costPrice=this.products[f].costPrice,S.retailPrice=this.products[f].retailPrice,g.goodsId=S,g.num=this.products[f].num,u&&v.set("shop",s),o.push(v),n.push(g)}c.default.Query("Bills").saveAll(o).then(function(o){var s=c.default.Pointer("_User"),u=s.set(a),f=uni.getStorageSync("masterId"),v=c.default.Pointer("_User"),g=v.set(f),p=c.default.Query("order_opreations");if(p.set("beizhu",e.detail.value.input_beizhu),p.set("detail",n),p.set("type",2),p.set("opreater",g),p.set("master",u),p.set("goodsName",i.products[0].goodsName),p.set("real_money",Number(i.real_money)),p.set("debt",i.all_money-Number(i.real_money)),i.custom){var m=c.default.Pointer("customs"),h=m.set(i.custom.objectId);p.set("custom",h)}p.set("all_money",i.all_money),p.save().then(function(e){t.log("添加操作历史记录成功",e);var o=e.objectId;uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品退货成功",icon:"success",success:function(){for(var n=function(e){var o=0,n=c.default.Query("Goods");n.get(i.products[e].objectId).then(function(t){if(i.products[e].selectd_model){var n=!0,a=!1,s=void 0;try{for(var u,c=(0,r.default)(JSON.parse(i.products[e].selectd_model));!(n=(u=c.next()).done);n=!0){var l=u.value,d=!0,f=!1,v=void 0;try{for(var g,p=(0,r.default)(i.products[e].models);!(d=(g=p.next()).done);d=!0){var m=g.value;o+=Number(m.reserve),m.id==JSON.parse(l).id&&(m.reserve=Number(m.reserve)+Number(i.products[e].num))}}catch(h){f=!0,v=h}finally{try{d||null==p.return||p.return()}finally{if(f)throw v}}}}catch(h){a=!0,s=h}finally{try{n||null==c.return||c.return()}finally{if(a)throw s}}o+=Number(i.products[e].num),t.set("models",i.products[e].models)}else o=Number(i.products[e].reserve)+Number(i.products[e].num);t.set("reserve",o),t.set("stocktype",o>i.products[e].warning_num?1:0),t.save()}).catch(function(e){t.log(e)})},a=0;a<i.products.length;a++)n(a);i.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),l.default.log(uni.getStorageSync("user").nickName+"处理了'"+i.products[0].goodsName+"'等"+i.products.length+"商品的退货",2,e.objectId),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(o),uni.navigateBack({delta:2})},500)}})})},function(e){t.log("异常处理")})}}};e.default=f}).call(this,o("5a52")["default"])},7628:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-7c06eb4b]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-7c06eb4b]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-7c06eb4b]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-7c06eb4b]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-7c06eb4b]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-7c06eb4b]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},"93e8":function(t,e,o){"use strict";(function(e){var n=o("288e");o("6b54"),o("87b3"),o("c5f6");var r=n(o("5d73"));o("7514");var a=n(o("906f"));t.exports={handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,o,n){var r=a.default.Pointer("_User"),i=r.set(uni.getStorageSync("uid")),s=a.default.Query("logs");s.set("parent",i),s.set("log",t),s.set("detail_id",n),s.set("type",o),s.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_shopOut:function(t,o){e.log(t,o);var n=a.default.Query("shops");n.set("id",t),n.set("have_out",o),n.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_staffOut:function(t){if(e.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var o=a.default.Query("staffs");o.set("id",uni.getStorageSync("user").objectId),o.set("have_out",t+uni.getStorageSync("user").have_out),o.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");e.log(t);var o=a.default.Query("Goods");o.equalTo("userId","==",t),o.find().then(function(t){e.log(t);var o=!0,n=!1,a=void 0;try{for(var i,s=(0,r.default)(t);!(o=(i=s.next()).done);o=!0){var u=i.value;e.log(u),Number(u.costPrice)*u.reserve,u.reserve}}catch(c){n=!0,a=c}finally{try{o||null==s.return||s.return()}finally{if(n)throw a}}})},getDay:function(t,e){var o=this,n=new Date,r=n.getTime()+864e5*t;n.setTime(r);var a=n.getFullYear(),i=n.getMonth(),s=n.getDate();return i=o.handleMonth(i+1),s=o.handleMonth(s),e?a+"-"+i+"-"+s+" 00:00:00":a+"-"+i+"-"+s},js_date_time:function(t,e){var o=new Date(t),n=o.getFullYear(),r=o.getMonth()+1;r=r<10?"0"+r:r;var a=o.getDate();a=a<10?"0"+a:a;var i=o.getHours();i=i<10?"0"+i:i;var s=o.getMinutes(),u=o.getSeconds();return s=s<10?"0"+s:s,u=u<10?"0"+u:u,e?n+"-"+r+"-"+a+" "+i+":"+s:n+"-"+r+"-"+a},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}}).call(this,o("5a52")["default"])},c875:function(t,e,o){"use strict";o.r(e);var n=o("074e"),r=o("e164");for(var a in r)"default"!==a&&function(t){o.d(e,t,function(){return r[t]})}(a);o("243a");var i=o("2877"),s=Object(i["a"])(r["default"],n["a"],n["b"],!1,null,"7c06eb4b",null);e["default"]=s.exports},e164:function(t,e,o){"use strict";o.r(e);var n=o("712f"),r=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=r.a}}]);