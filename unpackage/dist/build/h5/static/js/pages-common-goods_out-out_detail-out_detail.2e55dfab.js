(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-goods_out-out_detail-out_detail"],{"026d":function(t,e,o){"use strict";o.r(e);var s=o("e697"),n=o.n(s);for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},"2bef":function(t,e,o){"use strict";var s=o("288e");o("6b54"),o("87b3"),o("c5f6");var n=s(o("5d73"));o("7514"),t.exports={handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,e,o){var s=Bmob.Pointer("_User"),n=s.set(uni.getStorageSync("uid")),a=Bmob.Query("logs");a.set("parent",n),a.set("log",t),a.set("detail_id",o),a.set("type",e),a.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_shopOut:function(t,e){console.log(t,e);var o=Bmob.Query("shops");o.set("id",t),o.set("have_out",e),o.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_staffOut:function(t){if(console.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var e=Bmob.Query("staffs");e.set("id",uni.getStorageSync("user").objectId),e.set("have_out",t+uni.getStorageSync("user").have_out),e.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");console.log(t);var e=Bmob.Query("Goods");e.equalTo("userId","==",t),e.find().then(function(t){console.log(t);var e=!0,o=!1,s=void 0;try{for(var a,i=(0,n.default)(t);!(e=(a=i.next()).done);e=!0){var r=a.value;console.log(r),Number(r.costPrice)*r.reserve,r.reserve}}catch(u){o=!0,s=u}finally{try{e||null==i.return||i.return()}finally{if(o)throw s}}})},getDay:function(t,e){var o=this,s=new Date,n=s.getTime()+864e5*t;s.setTime(n);var a=s.getFullYear(),i=s.getMonth(),r=s.getDate();return i=o.handleMonth(i+1),r=o.handleMonth(r),e?a+"-"+i+"-"+r+" 00:00:00":a+"-"+i+"-"+r},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}},"55d3":function(t,e,o){var s=o("8667");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=o("4f06").default;n("6cdcf3a9",s,!0,{sourceMap:!1,shadowMode:!1})},"7b29":function(t,e,o){"use strict";var s=o("55d3"),n=o.n(s);n.a},8667:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-1074c83e]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-1074c83e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-1074c83e]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-1074c83e]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-1074c83e]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-1074c83e]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},"9d5c":function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,s){return o("v-uni-view",{key:s,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("实际零售价：￥"+t._s(e.modify_retailPrice)+"（X"+t._s(e.num)+"）")]),o("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),o("v-uni-view",{staticClass:"pro_allmoney"},[t._v("总计：￥"+t._s(t.all_money))]),o("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细（用于记录是否有无欠款）")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[o("v-uni-view",[t._v("选择仓库")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择仓库",disabled:"true",value:t.stock.stock_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[o("v-uni-view",[t._v("选择门店")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择门店",disabled:"true",value:t.shop_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[o("v-uni-view",[t._v("客户姓名")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1),o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",[t._v("实际应付")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"实际应付",disabled:"true",value:t.all_money}})],1)],1),o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",[t._v("实际付款（可修改）")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入实际付款金额",type:"digit"},model:{value:t.real_money,callback:function(e){t.real_money=e},expression:"real_money"}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("确认出库")])],1)],1)],1)],1)},n=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return n})},b28e:function(t,e,o){"use strict";o.r(e);var s=o("9d5c"),n=o("026d");for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);o("7b29");var i=o("2877"),r=Object(i["a"])(n["default"],s["a"],s["b"],!1,null,"1074c83e",null);e["default"]=r.exports},e2e1:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={send_in:function(t){var e=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:e,frist:t.frist,data1:t.data1,data2:t.data2,remark:t.remark,url:t.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){console.log(t)}})},send_temp:function(t){var e=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:e,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:"备注:"+t.remark,url:t.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){console.log(t)}})}};e.default=s},e697:function(t,e,o){"use strict";var s=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(o("5d73"));o("6b54"),o("87b3"),o("7f7f"),o("c5f6");var a,i,r,u,c=s(o("2bef")),l=s(o("e2e1")),d={data:function(){return{stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null}},onLoad:function(){i=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2));this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){if(i.custom=uni.getStorageSync("custom"),u=uni.getStorageSync("shop"),u){i.shop_name=u.name;var t=Bmob.Pointer("shops");r=t.set(u.objectId)}i.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},methods:{formSubmit:function(t){console.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var e=Bmob.Pointer("stocks"),o=e.set(i.stock?i.stock.objectId:""),s=new Array,d=[],v=0;v<this.products.length;v++){var m=Number(this.products[v].reserve)-this.products[v].num,p=Bmob.Query("Bills"),f={},g=Bmob.Pointer("_User"),h=g.set(a),y=Bmob.Pointer("_User"),_=y.set(uni.getStorageSync("masterId")),b=Bmob.Pointer("Goods"),S=b.set(this.products[v].objectId);if(uni.getStorageSync("custom")){var w=Bmob.Pointer("customs"),x=w.set(uni.getStorageSync("custom").objectId);p.set("custom",x)}p.set("goodsName",this.products[v].goodsName),p.set("retailPrice",this.products[v].modify_retailPrice.toString()),p.set("num",Number(this.products[v].num)),p.set("total_money",this.products[v].total_money),p.set("goodsId",S),p.set("userId",h),p.set("type",-1),p.set("operater",_),p.set("stock",o);var k={};f.goodsName=this.products[v].goodsName,f.modify_retailPrice=this.products[v].modify_retailPrice.toString(),f.retailPrice=this.products[v].retailPrice,f.total_money=this.products[v].total_money,k.costPrice=this.products[v].costPrice,k.retailPrice=this.products[v].retailPrice,k.objectId=this.products[v].objectId,k.reserve=m,f.goodsId=k,f.num=this.products[v].num,f.type=-1,u&&(p.set("shop",r),c.default.record_shopOut(u.objectId,u.have_out+this.products[v].num)),s.push(p),d.push(f),c.default.record_staffOut(this.products[v].num)}Bmob.Query("Bills").saveAll(s).then(function(e){for(var s=[],v=0;v<e.length;v++)s.push(e[v].success.objectId);var m=Bmob.Pointer("_User"),p=m.set(a),f=uni.getStorageSync("masterId"),g=Bmob.Pointer("_User"),h=g.set(f),y=Bmob.Query("order_opreations");if(y.set("detail",d),y.set("bills",s),y.set("beizhu",t.detail.value.input_beizhu),y.set("type",-1),y.set("opreater",h),y.set("stock",o),y.set("master",p),y.set("goodsName",i.products[0].goodsName),y.set("real_money",Number(i.real_money)),y.set("debt",i.all_money-Number(i.real_money)),u&&y.set("shop",r),i.custom){var _=Bmob.Pointer("customs"),b=_.set(i.custom.objectId);if(y.set("custom",b),i.all_money-Number(i.real_money)>0){var S=Bmob.Query("customs");S.get(i.custom.objectId).then(function(t){var e=null==t.debt?0:t.debt;e+=i.all_money-Number(i.real_money),console.log(e);var o=Bmob.Query("customs");o.get(i.custom.objectId).then(function(t){t.set("debt",e),t.save()})})}}y.set("all_money",i.all_money),y.save().then(function(e){console.log("添加操作历史记录成功",e),uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品出库成功",icon:"success",success:function(){for(var o=function(t){var e=0,o=Bmob.Query("Goods");o.get(i.products[t].objectId).then(function(o){if(c.default.log(i.products[t].goodsName+"出库了"+i.products[t].num+"件，已经低于预警数量"+(i.products[t].warning_num?i.products[t].warning_num:0),-2,i.products[t].objectId),i.products[t].selectd_model){var s=!0,a=!1,r=void 0;try{for(var u,l=(0,n.default)(JSON.parse(i.products[t].selectd_model));!(s=(u=l.next()).done);s=!0){var d=u.value,v=!0,m=!1,p=void 0;try{for(var f,g=(0,n.default)(i.products[t].models);!(v=(f=g.next()).done);v=!0){var h=f.value;e+=Number(h.reserve),h.id==JSON.parse(d).id&&(h.reserve=Number(h.reserve)-Number(i.products[t].num))}}catch(y){m=!0,p=y}finally{try{v||null==g.return||g.return()}finally{if(m)throw p}}}}catch(y){a=!0,r=y}finally{try{s||null==l.return||l.return()}finally{if(a)throw r}}e-=Number(i.products[t].num),o.set("models",i.products[t].models)}else e=Number(i.products[t].reserve)-Number(i.products[t].num);o.set("reserve",e),o.set("stocktype",e>i.products[t].warning_num?1:0),o.save()}).catch(function(t){console.log(t)})},s=0;s<i.products.length;s++)o(s);i.button_disabled=!1,uni.setStorageSync("is_option",!0),uni.removeStorageSync("warehouse"),setTimeout(function(){c.default.log(uni.getStorageSync("user").nickName+"出库了'"+i.products[0].goodsName+"'等"+i.products.length+"商品",-1,e.objectId);var o={data1:e.objectId,data2:uni.getStorageSync("user").nickName+"出库了'"+i.products[0].goodsName+"'等"+i.products.length+"商品",data3:i.stock?i.stock.stock_name:"未填写",data4:e.createdAt,remark:t.detail.value.input_beizhu?t.detail.value.input_beizhu:"未填写",url:"https://www.jimuzhou.com/h5/pages/report/EnteringHistory/detail/detail?id="+e.objectId};l.default.send_temp(o),uni.navigateBack({delta:2})},500)}})})},function(t){console.log("异常处理")})}}};e.default=d}}]);