(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-report-EnteringHistory-SellDetail-SellDetail"],{"40f5":function(e,t,i){"use strict";i.r(t);var o=i("dbf5"),a=i.n(o);for(var s in o)"default"!==s&&function(e){i.d(t,e,function(){return o[e]})}(s);t["default"]=a.a},"50ef":function(e,t,i){var o=i("5e7e");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=i("4f06").default;a("20aafb26",o,!0,{sourceMap:!1,shadowMode:!1})},"5e7e":function(e,t,i){t=e.exports=i("2350")(!1),t.push([e.i,".page[data-v-2ade8421]{color:#4d4d4d;background:#fafafa;font-size:%?28?%}.operater_status[data-v-2ade8421]{position:fixed;bottom:0;left:0;width:100%;padding:%?20?% 0;background:#b82626;color:#fff;z-index:100;text-align:center}.pro_list[data-v-2ade8421]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-2ade8421]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-2ade8421]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-2ade8421]{width:100%;background-color:#fff;padding:%?20?%;font-size:%?32?%}.confrim_button[data-v-2ade8421]{width:60%;background:#426ab3;color:#fff;font-size:%?32?%;margin:10% 20%}.detail_bottom[data-v-2ade8421]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%}.avatar[data-v-2ade8421]{width:%?80?%;height:%?80?%;border-radius:50%}.common_style[data-v-2ade8421]{line-height:%?80?%;margin-left:%?20?%;color:#000}.real_color[data-v-2ade8421]{color:#f30!important}.kaidanmx[data-v-2ade8421]{margin-top:%?30?%}.display_flex[data-v-2ade8421]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background:#fff;padding:%?15?% %?30?%}.left_content[data-v-2ade8421]{width:%?150?%}",""])},"628f":function(e,t,i){"use strict";var o=i("50ef"),a=i.n(o);a.a},"991d":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[e.loading?i("loading"):i("v-uni-view",{staticClass:"page"},[i("uni-nav-bar",{attrs:{fixed:!0,color:"#333333","background-color":"#FFFFFF","right-text":"操作"},on:{"click-right":function(t){arguments[0]=t=e.$handleEvent(t),e.show_options.apply(void 0,arguments)}}}),i("v-uni-scroll-view",{staticStyle:{height:"calc(100vh - 80rpx)"},attrs:{"scroll-y":"true"}},[i("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"0 20rpx"}},[e._v("操作产品")]),i("v-uni-view",[i("v-uni-view",e._l(e.products,function(t,o){return i("v-uni-view",{key:o,staticClass:"pro_listitem"},[i("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#000"}},[i("v-uni-view",[e._v("产品："+e._s(t.goodsName)),e.user.rights&&"0"!=e.user.rights.othercurrent[0]||-1==e.detail.type?i("v-uni-text"):i("v-uni-text",[e._v("（成本价：￥"+e._s(t.goodsId.costPrice)+"）")])],1),i("v-uni-view",[e._v("数量：X"+e._s(t.num)+e._s(t.packingUnit||""))])],1),t.goodsId.selected_model?i("v-uni-view",e._l(t.goodsId.selected_model,function(t,o){return t.num>0?i("v-uni-view",{key:o,staticClass:"display_flex_bet"},[i("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[e._v(e._s(t.custom1.value+t.custom2.value+t.custom3.value+t.custom4.value))]),i("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[e._v(e._s(t.num))])],1):e._e()}),1):e._e(),i("v-uni-view",{staticClass:"pro_list"},[i("v-uni-view",[e._v("建议零售价：￥"+e._s(t.goodsId.retailPrice))]),-1==t.type?i("v-uni-view",[e._v("实际卖出价：￥"+e._s(t.modify_retailPrice))]):i("v-uni-view",[e.user.rights&&"0"!=e.user.rights.othercurrent[0]?i("v-uni-text",[e._v("实际进货价：￥0")]):i("v-uni-text",[e._v("实际进货价：￥"+e._s(t.modify_retailPrice))])],1)],1)],1)}),1),i("v-uni-view",{staticClass:"pro_allmoney"},[e._v("总计：￥"+e._s(e.detail.all_money))])],1),-1==e.detail.type?i("v-uni-view",[1==e.detail.extra_type?i("v-uni-view",{staticClass:"kaidanmx"},[i("v-uni-view",{staticStyle:{padding:"10rpx 30rpx"}},[e._v("销售明细")]),e.detail.custom?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("客户姓名")]),i("v-uni-view",[e._v(e._s(e.detail.custom.custom_name))])],1):e._e(),e.detail.discount?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("折扣率")]),i("v-uni-view",[e._v(e._s(e.detail.discount)+"%")])],1):e._e(),e.detail.account?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("结算账户")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.account.name))])],1):e._e(),i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("实际付款")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(null==e.detail.real_money?"未填写":e.detail.real_money))])],1),e.detail.debt>0?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("欠款")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.debt))])],1):e._e(),e.detail.createdTime?i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"left_content"},[e._v("销售时间")]),i("v-uni-view",[e._v(e._s(e.detail.createdTime.iso.split(" ")[0]))])],1):e._e(),e.detail.typeDesc?i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{background:"#fff","border-bottom":"1rpx solid#F7F7F7","margin-top":"20rpx"}},[i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"left_content"},[e._v("发送方式")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.typeDesc))])],1),"物流"==e.detail.typeDesc||"快递"==e.detail.typeDesc?i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.expressNum))])],1):e._e()],1):e._e(),e.detail.expressNum?i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{background:"#fff","justify-content":"flex-end",padding:"0rpx 30rpx","border-bottom":"1rpx solid#F7F7F7"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.gotoexpressDet.apply(void 0,arguments)}}},[i("v-uni-view",{staticStyle:{"margin-right":"10rpx",color:"#0a53c3"}},[e._v("查快递")]),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#0a53c3"}})],1):e._e(),e.detail.shop?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7","margin-top":"20rpx"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("门店")]),i("v-uni-view",[e._v(e._s(e.detail.shop.name))])],1):e._e(),i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7","margin-top":"20rpx"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("出库情况")]),e.detail.status?i("v-uni-view",{staticStyle:{color:"#2ca879"}},[e._v("已出库")]):i("v-uni-view",{staticStyle:{color:"#f30"}},[e._v("未出库"),i("v-uni-text",{staticStyle:{"font-size":"20rpx"}},[e._v("（请点击右上角操作进行入库）")])],1)],1),0==e.detail.status?i("v-uni-navigator",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[i("v-uni-view",{staticClass:"left_content",staticStyle:{width:"150rpx"}},[e._v("出库仓库"),i("v-uni-text",{staticStyle:{color:"#f30"}},[e._v("*")])],1),i("v-uni-view",{staticStyle:{width:"calc(100% - 160rpx)",display:"flex","align-items":"center"}},[i("v-uni-input",{staticStyle:{"text-align":"left","margin-right":"20rpx"},attrs:{placeholder:"请选择要出库的仓库",disabled:"true",value:e.stock.stock_name}}),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1):e._e(),e.detail.status?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("出库仓库")]),i("v-uni-view",{staticStyle:{color:"#2ca879"}},[e._v(e._s(e.detail.stock.stock_name))])],1):e._e(),e.detail.status?i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"left_content"},[e._v("出库时间")]),i("v-uni-view",[e._v(e._s(e.detail.updatedAt))])],1):e._e()],1):e._e()],1):1==e.detail.type?i("v-uni-view",[1==e.detail.extra_type?i("v-uni-view",{staticClass:"kaidanmx"},[i("v-uni-view",{staticStyle:{padding:"10rpx 30rpx"}},[e._v("采购明细")]),e.detail.producer?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("供货商姓名")]),i("v-uni-view",[e._v(e._s(e.detail.producer.producer_name))])],1):e._e(),e.detail.account?i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("结算账户")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.account.name))])],1):e._e(),i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("实际付款")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(null==e.detail.real_money?"未填写":e.detail.real_money))])],1),e.detail.debt>0?i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"left_content"},[e._v("欠款")]),i("v-uni-view",{staticClass:"real_color"},[e._v(e._s(e.detail.debt))])],1):e._e(),i("v-uni-view",{staticClass:"display_flex",staticStyle:{"margin-top":"20rpx"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("入库情况")]),e.detail.status?i("v-uni-view",{staticStyle:{color:"#2ca879"}},[e._v("已入库")]):i("v-uni-view",{staticStyle:{color:"#f30"}},[e._v("未入库"),i("v-uni-text",{staticStyle:{"font-size":"20rpx"}},[e._v("（请点击右上角操作进行入库）")])],1)],1),0==e.detail.status?i("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[i("v-uni-view",{staticClass:"left_content",staticStyle:{width:"150rpx"}},[e._v("入库仓库"),i("v-uni-text",{staticStyle:{color:"#f30"}},[e._v("*")])],1),i("v-uni-view",{staticStyle:{width:"calc(100% - 160rpx)",display:"flex","align-items":"center"}},[i("v-uni-input",{staticStyle:{"text-align":"left","margin-right":"20rpx"},attrs:{placeholder:"请选择要入库的仓库",disabled:"true",value:e.stock.stock_name}}),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1):i("v-uni-view",{staticClass:"display_flex",staticStyle:{"border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticClass:"left_content"},[e._v("入库仓库")]),i("v-uni-view",[e._v(e._s(e.detail.stock.stock_name))])],1),e.detail.status?i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",{staticClass:"left_content"},[e._v("入库时间")]),i("v-uni-view",[e._v(e._s(e.detail.updatedAt))])],1):e._e()],1):e._e()],1):e._e(),i("v-uni-view",{staticClass:"detail_bottom",staticStyle:{"margin-top":"20px"}},[i("v-uni-view",{staticStyle:{display:"flex","border-bottom":"1px solid#ddd","padding-bottom":"20upx"}},[i("v-uni-view",[i("v-uni-image",{staticClass:"avatar",attrs:{src:e.detail.opreater.avatarUrl}})],1),i("v-uni-view",{staticClass:"common_style"},[e._v(e._s(e.detail.opreater.nickName))]),i("v-uni-view",{staticClass:"common_style"},[e._v("（操作者）")])],1),i("v-uni-view",{staticStyle:{padding:"20rpx 0 0"}},[e.detail.beizhu?i("v-uni-view",[e._v("备注："+e._s(e.detail.beizhu))]):i("v-uni-view",[e._v("备注：暂无")]),i("v-uni-view",[e._v("操作时间："+e._s(e.detail.createdAt))]),e.detail.Images&&e.detail.Images.length>0?i("v-uni-view",[i("v-uni-view",{staticClass:"notice_text"},[e._v("凭证图")]),i("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[i("v-uni-view",{staticClass:"upload_image display_flex"},e._l(e.detail.Images,function(t,o){return i("v-uni-view",{key:o,staticStyle:{position:"relative"},on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.priview(t)}}},[i("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:t}})],1)}),1)],1)],1):e._e()],1)],1)],1)],1)],1)},a=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return a})},a9c6:function(e,t,i){"use strict";i.r(t);var o=i("991d"),a=i("40f5");for(var s in a)"default"!==s&&function(e){i.d(t,e,function(){return a[e]})}(s);i("628f");var n=i("f0c5"),l=Object(n["a"])(a["default"],o["a"],o["b"],!1,null,"2ade8421",null);t["default"]=l.exports},dbf5:function(e,t,i){"use strict";(function(e){var o=i("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("c5f6");var a=o(i("5d73"));i("7514");var s,n,l,r=o(i("9546")),d=o(i("856d")),u=o(i("7fd5")),c=o(i("120a")),v=o(i("96bd")),f={components:{loading:c.default,uniNavBar:v.default},data:function(){return{user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),othercurrent:"",bills:[],loading:!0,products:null,detail:null,stock:""}},onLoad:function(t){this.$wechat.share_pyq(),e.log(t),s=this,n=t.id,l=uni.getStorageSync("uid"),s.user.rights&&s.user.rights.othercurrent&&(s.othercurrent=s.user.rights.othercurrent),s.getdetail(n)},onShow:function(){s.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},onShareAppMessage:function(t){return"button"===t.from&&e.log(t.target),{title:"库存表-操作单详情",path:"/pages/report/EnteringHistory/detail/detail?id="+n}},methods:{gotoexpressDet:function(){s.user.is_vip?uni.navigateTo({url:"../expressDet/expressDet?number="+s.detail.expressNum}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},priview:function(e){uni.previewImage({current:e,urls:s.detail.Images})},show_options:function(){var t=["打印"];-1!=s.detail.type&&1!=s.detail.type||(-1!=s.othercurrent.indexOf("1")||1==s.identity&&1==s.detail.extra_type?(t=-1==s.detail.type?["销售出库","撤销","打印"]:["采购入库","撤销","打印"],uni.showActionSheet({itemList:t,success:function(e){if(0==e.tapIndex){if(1==s.detail.type)if(s.detail.status)uni.showToast({title:"该笔采购单已入库",icon:"none"});else{if(""==uni.getStorageSync("warehouse")||void 0==uni.getStorageSync("warehouse"))return void uni.showToast({icon:"none",title:"请选择仓库"});s.confrimOrder()}else if(-1==s.detail.type)if(s.detail.status)uni.showToast({title:"该笔销售单已出库",icon:"none"});else{if(""==uni.getStorageSync("warehouse")||void 0==uni.getStorageSync("warehouse"))return void uni.showToast({icon:"none",title:"请选择仓库"});s.confrimOrder()}uni.setStorageSync("is_option",!0)}else 1==e.tapIndex?(s.revoke(),uni.setStorageSync("is_option",!0)):2==e.tapIndex&&d.default.print_operations(s.detail,s.products)},fail:function(t){e.log(t.errMsg)}})):uni.showToast({title:"暂无操作权限",icon:"none"}))},getdetail:function(t){var i=r.default.Query("order_opreations");i.include("opreater","custom","producer","stock","account"),i.get(t).then(function(t){e.log(t),s.detail=t,s.products=t.detail,s.bills=t.bills,s.loading=!1}).catch(function(t){e.log(t)})},revoke:function(){wx.showModal({title:"提示",content:"数据撤销后不可恢复，请谨慎撤销！",success:function(t){if(t.confirm){uni.showLoading({title:"撤销中..."});var i=r.default.Query("order_opreations");i.destroy(s.detail.objectId).then(function(t){var i=r.default.Query("Bills");i.containedIn("objectId",s.bills),i.find().then(function(t){t.destroyAll().then(function(e){if(s.detail.status)for(var t=0;t<s.products.length;t++)s.delete_bill(t);else uni.hideLoading(),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"撤销成功"})},1e3)}).catch(function(t){e.log(t)})})}).catch(function(t){e.log(t)})}}})},confrimOrder:function(){wx.showModal({title:"提示",content:"确定进行此操作！",success:function(t){if(t.confirm){uni.showLoading({title:"操作中，请勿退出该页面..."});var i=r.default.Pointer("stocks"),o=i.set(s.stock.objectId),l=r.default.Query("order_opreations");l.set("id",n),l.set("stock",o),l.set("status",!0),l.save().then(function(e){var t=0;if(1==s.detail.type){var i=!0,o=!1,n=void 0;try{for(var l,r=(0,a.default)(s.products);!(i=(l=r.next()).done);i=!0){var d=l.value;s.addOrReduceGoodReserve(d,t),t+=1}}catch(y){o=!0,n=y}finally{try{i||null==r.return||r.return()}finally{if(o)throw n}}}else if(-1==s.detail.type){var u=!0,c=!1,v=void 0;try{for(var f,_=(0,a.default)(s.products);!(u=(f=_.next()).done);u=!0){var p=f.value;s.ReduceGoodReserve(p,t),t+=1}}catch(y){c=!0,v=y}finally{try{u||null==_.return||_.return()}finally{if(c)throw v}}}}).catch(function(t){e.log(t)})}}})},addOrReduceGoodReserve:function(t,i){var o=r.default.Query("Goods");o.equalTo("userId","==",l),o.equalTo("header","==",t.goodsId.objectId),o.equalTo("stocks","==",s.stock.objectId),o.find().then(function(l){if(0==l.length)o.get(t.goodsId.objectId).then(function(o){t.objectId=t.goodsId.objectId,t.costPrice=o.costPrice,t.retailPrice=o.retailPrice,u.default.upload_good_withNoCan(o,s.stock,Number(t.num)).then(function(o){var a=r.default.Query("Goods");a.equalTo("header","==",t.goodsId.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then(function(o){var a=o[0]._sumReserve,l=r.default.Query("Goods");l.set("reserve",a),l.set("id",t.goodsId.objectId),l.save().then(function(o){if(u.default.modifyStockType(t.goodsId.objectId),i==s.products.length-1){var a=r.default.Pointer("stocks"),l=a.set(s.stock.objectId),d=r.default.Query("Bills");d.containedIn("objectId",s.bills),d.find().then(function(t){t.set("status",!0),t.set("stock",l),t.saveAll().then(function(e){uni.hideLoading(),s.getdetail(n),setTimeout(function(){uni.removeStorageSync("warehouse"),uni.showToast({title:"采购入库成功"})},1e3)}).catch(function(t){e.log(t)})})}})})})});else{var d=r.default.Query("Goods");d.get(l[0].objectId).then(function(o){if(t.goodsId.selected_model){var l=0,d=!0,c=!1,v=void 0;try{for(var f,_=(0,a.default)(t.goodsId.selected_model);!(d=(f=_.next()).done);d=!0){var p=f.value,y=!0,g=!1,h=void 0;try{for(var m,w=(0,a.default)(o.models);!(y=(m=w.next()).done);y=!0){var b=m.value;b.id==p.id&&(b.reserve=Number(b.reserve)+Number(p.num),l+=Number(p.num))}}catch(x){g=!0,h=x}finally{try{y||null==w.return||w.return()}finally{if(g)throw h}}}}catch(x){c=!0,v=x}finally{try{d||null==_.return||_.return()}finally{if(c)throw v}}o.set("models",o.models),o.set("reserve",o.reserve+l)}else o.set("reserve",o.reserve+t.num);o.save().then(function(o){var a=r.default.Pointer("stocks"),l=a.set(s.stock.objectId),d=r.default.Query("Goods");d.equalTo("header","==",t.goodsId.objectId),d.equalTo("order","==",1),d.statTo("sum","reserve"),d.find().then(function(o){var a=o[0]._sumReserve,d=r.default.Query("Goods");d.set("reserve",a),d.set("id",t.goodsId.objectId),d.save().then(function(o){if(i==s.products.length-1){var a=r.default.Query("Bills");a.containedIn("objectId",s.bills),a.find().then(function(i){i.set("status",!0),i.set("stock",l),i.saveAll().then(function(e){uni.hideLoading(),s.getdetail(n),setTimeout(function(){var e=r.default.Query("Goods");e.equalTo("header","==",t.goodsId.objectId),e.equalTo("order","==",1),e.statTo("sum","reserve"),e.find().then(function(e){u.default.modifyStockType(t.goodsId.objectId);var i=e[0]._sumReserve,o=r.default.Query("Goods");o.set("reserve",i),o.set("id",t.goodsId.objectId),o.save().then(function(e){uni.removeStorageSync("warehouse"),uni.showToast({title:"采购入库成功"})})})},1e3)}).catch(function(t){e.log(t)})})}})})})})}})},ReduceGoodReserve:function(t,i){var o=r.default.Query("Goods");o.equalTo("userId","==",l),o.equalTo("header","==",t.goodsId.objectId),o.equalTo("stocks","==",s.stock.objectId),o.find().then(function(l){if(0==l.length)o.get(t.goodsId.objectId).then(function(o){t.objectId=t.goodsId.objectId,t.costPrice=o.costPrice,t.retailPrice=o.retailPrice,u.default.upload_good_withNoCan(o,s.stock,0-Number(t.num)).then(function(o){e.log(o);var a=r.default.Query("Goods");a.equalTo("header","==",t.goodsId.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then(function(o){var a=o[0]._sumReserve,l=r.default.Query("Goods");l.set("reserve",a),l.set("id",t.goodsId.objectId),l.save().then(function(o){if(u.default.modifyStockType(t.goodsId.objectId),i==s.products.length-1){var a=r.default.Pointer("stocks"),l=a.set(s.stock.objectId),d=r.default.Query("Bills");d.containedIn("objectId",s.bills),d.find().then(function(t){t.set("status",!0),t.set("stock",l),t.saveAll().then(function(e){uni.hideLoading(),s.getdetail(n),setTimeout(function(){uni.removeStorageSync("warehouse"),uni.showToast({title:"销售出库成功"})},1e3)}).catch(function(t){e.log(t)})})}})})})});else{var d=r.default.Query("Goods");d.get(l[0].objectId).then(function(o){if(t.goodsId.selected_model){var l=0,d=!0,c=!1,v=void 0;try{for(var f,_=(0,a.default)(t.goodsId.selected_model);!(d=(f=_.next()).done);d=!0){var p=f.value,y=!0,g=!1,h=void 0;try{for(var m,w=(0,a.default)(o.models);!(y=(m=w.next()).done);y=!0){var b=m.value;b.id==p.id&&(b.reserve=Number(b.reserve)-Number(p.num),l+=Number(p.num))}}catch(x){g=!0,h=x}finally{try{y||null==w.return||w.return()}finally{if(g)throw h}}}}catch(x){c=!0,v=x}finally{try{d||null==_.return||_.return()}finally{if(c)throw v}}o.set("models",o.models),o.set("reserve",o.reserve-l)}else o.set("reserve",o.reserve-t.num);o.save().then(function(o){var a=r.default.Query("Goods");a.equalTo("header","==",t.goodsId.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then(function(o){var a=o[0]._sumReserve,l=r.default.Query("Goods");l.set("reserve",a),l.set("id",t.goodsId.objectId),l.save().then(function(o){if(u.default.modifyStockType(t.goodsId.objectId),i==s.products.length-1){var a=r.default.Pointer("stocks"),l=a.set(s.stock.objectId),d=r.default.Query("Bills");d.containedIn("objectId",s.bills),d.find().then(function(t){t.set("status",!0),t.set("stock",l),t.saveAll().then(function(e){uni.hideLoading(),s.getdetail(n),setTimeout(function(){uni.removeStorageSync("warehouse"),uni.showToast({title:"销售出库成功"})},1e3)}).catch(function(t){e.log(t)})})}})})})})}})},delete_bill:function(t){var i=s.products[t],o=(s.bills[t],r.default.Query("Goods"));o.equalTo("order","==",1),o.equalTo("header","==",i.goodsId.objectId),o.equalTo("stocks","==",s.detail.stock.objectId),o.find().then(function(n){e.log(n);var l=n[0];if(o.set("id",n[0].objectId),1==i.type)if(i.goodsId.selected_model){var d=0,c=!0,v=!1,f=void 0;try{for(var _,p=(0,a.default)(i.goodsId.selected_model);!(c=(_=p.next()).done);c=!0){var y=_.value,g=!0,h=!1,m=void 0;try{for(var w,b=(0,a.default)(l.models);!(g=(w=b.next()).done);g=!0){var x=w.value;x.id==y.id&&(x.reserve=Number(x.reserve)-Number(y.num),d+=Number(y.num))}}catch(R){h=!0,m=R}finally{try{g||null==b.return||b.return()}finally{if(h)throw m}}}}catch(R){v=!0,f=R}finally{try{c||null==p.return||p.return()}finally{if(v)throw f}}o.set("models",n[0].models),o.set("reserve",n[0].reserve-d)}else o.set("reserve",n[0].reserve-i.num);else if(-1==i.type)if(i.goodsId.selected_model){var I=0,S=!0,k=!1,C=void 0;try{for(var T,F=(0,a.default)(i.goodsId.selected_model);!(S=(T=F.next()).done);S=!0){var j=T.value,Q=!0,q=!1,N=void 0;try{for(var G,P=(0,a.default)(l.models);!(Q=(G=P.next()).done);Q=!0){var z=G.value;z.id==j.id&&(z.reserve=Number(z.reserve)+Number(j.num),I+=Number(j.num))}}catch(R){q=!0,N=R}finally{try{Q||null==P.return||P.return()}finally{if(q)throw N}}}}catch(R){k=!0,C=R}finally{try{S||null==F.return||F.return()}finally{if(k)throw C}}o.set("models",n[0].models),o.set("reserve",n[0].reserve+I)}else o.set("reserve",n[0].reserve+i.num);o.save().then(function(i){if(l.header){var o=r.default.Query("Goods");o.equalTo("header","==",l.header.objectId),o.equalTo("order","==",1),o.statTo("sum","reserve"),o.find().then(function(i){e.log("dasds",i);var o=i[0]._sumReserve,a=r.default.Query("Goods");a.set("reserve",o),a.set("id",l.header.objectId),a.save().then(function(e){u.default.modifyStockType(l.header.objectId),t==s.products.length-1&&(uni.hideLoading(),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"撤销成功"})},1e3))})})}else u.default.modifyStockType(l.objectId),t==s.products.length-1&&(uni.hideLoading(),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({title:"撤销成功"})},1e3))})}).catch(function(t){e.log(t)})}}};t.default=f}).call(this,i("5a52")["default"])}}]);