(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-goods_out-goodSell-goodSell"],{"0198":function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0",color:"#3D3D3D","font-weight":"bold"}},[t._v("已选产品")]),o("v-uni-view",t._l(t.products,function(e,i){return o("v-uni-view",{key:i,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",{staticStyle:{width:"calc(100% - 200rpx)"}},[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[t._v("出库仓库："),e.stocks&&e.stocks.stock_name?o("v-uni-text",[t._v(t._s(e.stocks.stock_name))]):o("v-uni-text",[t._v("未填写")])],1),o("v-uni-view",[t._v("数量：X"+t._s(e.num))])],1),e.selected_model?o("v-uni-view",t._l(e.selected_model,function(e,i){return e.num>0?o("v-uni-view",{key:i,staticClass:"display_flex_bet"},[e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[t._v(t._s(e.custom1.value+e.custom2.value+e.custom3.value+e.custom4.value))]):t._e(),e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[t._v(t._s(e.num))]):t._e()],1):t._e()}),1):t._e(),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("实际零售价：￥"+t._s(e.modify_retailPrice)+"（X"+t._s(e.num)+"）")]),o("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),o("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 20rpx",color:"#3D3D3D","font-weight":"bold"}},[t._v("销售明细")]),o("v-uni-view",{staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("客户"),o("v-uni-text",{staticStyle:{color:"#f30"}},[t._v("*")])],1),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex"},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}}),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx",background:"#fff","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("选择门店")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{"justify-content":"flex-end"}},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择门店",disabled:"true",value:t.shop_name}}),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"},attrs:{"hover-class":"none",url:"/pages/finance/account/account?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("结算账户")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex"},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择结算账户",disabled:"true",value:t.account.name}}),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),t.custom.discount?o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("折扣率")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex"},[o("v-uni-input",{staticStyle:{color:"#d71345","text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"输入折扣率",value:t.discount,type:"number"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.getDiscount.apply(void 0,arguments)}}}),t._v("%")],1)],1):t._e(),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"}},[o("v-uni-view",[t._v("是否欠款")]),o("v-uni-view",{staticClass:"kaidan_rightinput",staticStyle:{"text-align":"right"}},[o("v-uni-switch",{attrs:{checked:t.wetherDebt},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeDebtStatus.apply(void 0,arguments)}}})],1)],1),t.wetherDebt?o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"}},[o("v-uni-view",[t._v("实际收款")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{staticStyle:{color:"#d71345","text-align":"right","margin-right":"20rpx","font-size":"30rpx"},attrs:{placeholder:"输入实际收款金额",type:"digit"},model:{value:t.real_money,callback:function(e){t.real_money=e},expression:"real_money"}})],1)],1):t._e(),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff","margin-top":"20rpx"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("发货方式")]),o("v-uni-picker",{staticClass:"kaidan_rightinput",attrs:{range:t.pickerTypes,"range-key":"desc"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.select_outType.apply(void 0,arguments)}}},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"请选择发货方式",disabled:"true"},model:{value:t.outType.desc,callback:function(e){t.$set(t.outType,"desc",e)},expression:"outType.desc"}})],1)],1),2==t.outType.type||3==t.outType.type?o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("快递单号")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex",attrs:{range:t.pickerTypes,"range-key":"desc"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.select_outType.apply(void 0,arguments)}}},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"请输入快递单号"},model:{value:t.expressNum,callback:function(e){t.expressNum=e},expression:"expressNum"}}),o("fa-icon",{attrs:{type:"clone",size:"16",color:"#426ab3"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.scan_code.apply(void 0,arguments)}}})],1)],1):t._e(),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx","border-bottom":"1rpx solid#F7F7F7",background:"#fff","margin-top":"20rpx"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("销售时间")]),o("v-uni-picker",{attrs:{mode:"date",value:t.nowDay,end:t.nowDay},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindDateChange.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.nowDay.split(" ")[0]))]),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 20rpx",background:"#fff","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("备注")]),o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1)],1)],1),o("v-uni-view",{staticStyle:{background:"#fff",padding:"10rpx"}},[o("v-uni-view",{staticStyle:{width:"100%"}},[o("v-uni-view",{staticClass:"upload_image display_flex"},[t._l(t.Images,function(e,i){return t.Images&&t.Images.length>0?o("v-uni-view",{key:i,staticStyle:{position:"relative"}},[o("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:e}}),o("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeImg(i)}}})],1):t._e()}),t.Images.length<3?o("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.upload_image.apply(void 0,arguments)}}},[o("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):t._e()],2)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx"}},[o("v-uni-view",[o("v-uni-view",[t._v("合计：￥"+t._s(t.real_money))]),o("v-uni-view",[t._v("总数："+t._s(t.total_num))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",staticStyle:{background:"#a1aa16"},attrs:{disabled:t.button_disabled,"form-type":"submit","data-type":"1"}},[t._v("销售")])],1)],1)],1)],1)],1)},a=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return a})},4992:function(t,e,o){"use strict";var i=o("d801"),a=o.n(i);a.a},9016:function(t,e,o){"use strict";o.r(e);var i=o("0198"),a=o("e8bc");for(var s in a)"default"!==s&&function(t){o.d(e,t,function(){return a[t]})}(s);o("4992");var n=o("f0c5"),r=Object(n["a"])(a["default"],i["a"],i["b"],!1,null,"03e605a4",null);e["default"]=r.exports},"9f50":function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(o("9546")),s={sendTempMini:function(t,e){if("enter"==e){var o={thing1:{value:t.goodsName+"...等",color:"#173177"},number2:{value:t.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},date4:{value:t.createdAt}};o.id=t.operationId,this.send_in_mini(o)}else if("out"==e){var i={thing1:{value:t.goodsName+"...等",color:"#173177"},number2:{value:t.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},time4:{value:t.createdAt}};i.id=t.operationId,this.send_out_mini(i)}},send_in:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:e.frist,data1:e.data1,data2:e.data2,remark:e.remark,url:e.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_noconfrim:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:e.frist,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:e.remark,url:e.url,type:"in_noconfrim"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"G2UJEDEyAtGuBdO-Yv96yBi-UnTLhaInr-KzEXqZ-48",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,data:e,emphasis_keyword:""};a.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_out_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"BKT2_0OuWF3mLZGvFmpRzWFa_Dyr4EIppl_LFF1uRLE",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,data:e,emphasis_keyword:""};a.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_temp:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:"备注:"+e.remark,url:e.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})}};e.default=s}).call(this,o("5a52")["default"])},a2fc:function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(o("f499"));o("c5f6"),o("7514");var s=i(o("5d73")),n=i(o("795b")),r=i(o("9546")),u={delete_goods:function(e){return new n.default(function(o,i){var a=0,n=!0,u=!1,c=void 0;try{for(var l,d=(0,s.default)(e);!(n=(l=d.next()).done);n=!0){var p=l.value,m=r.default.Query("Goods");m.destroy(p.objectId).then(function(t){a+=1,a==e.length&&o(!0)}).catch(function(e){t.log(e)})}}catch(f){u=!0,c=f}finally{try{n||null==d.return||d.return()}finally{if(u)throw c}}})},upload_good_withNoCan:function(e,o){return new n.default(function(i,a){var s=uni.getStorageSync("uid"),n=r.default.Pointer("_User"),u=n.set(s),c=e.reserve,l=r.default.Pointer("stocks"),d=l.set(o.objectId),p=r.default.Query("Goods");p.equalTo("userId","==",s),p.equalTo("goodsName","==",e.goodsName),p.equalTo("stocks","==",o.objectId),p.find().then(function(o){if(t.log(o),o.length>=1)i([!1,"该商品存在此仓库中"]);else{var a=r.default.Query("Goods");if(a.set("goodsName",e.goodsName),a.set("goodsIcon",e.goodsIcon),a.set("costPrice",e.costPrice),a.set("retailPrice",e.retailPrice),a.set("reserve",Number(e.reserve)),a.set("productCode",e.productCode?e.productCode:""),a.set("stocks",d),a.set("product_info",e.product_info?e.product_info:""),a.set("producer",e.producer?e.producer:""),a.set("packingUnit",e.packingUnit?e.packingUnit:""),a.set("packageContent",e.packageContent?e.packageContent:""),a.set("warning_num",Number(e.warning_num?e.warning_num:0)),a.set("stocktype",Number(e.warning_num?e.warning_num:0)>=Number(c)?0:1),e.second_class){var s=r.default.Pointer("class_user"),n=s.set(e.goodsClass);a.set("second_class",p);var l=r.default.Pointer("second_class"),p=l.set(e.second_class);a.set("goodsClass",n)}a.set("userId",u),a.save().then(function(e){t.log(e),i([!0,e])}).catch(function(e){t.log(e)})}})})},upload_good:function(e){return new n.default(function(o,i){var a=JSON.parse(localStorage.getItem("bmob")).objectId,s=r.default.Pointer("_User"),n=s.set(a),u=r.default.Pointer("class_user"),c=u.set(e.goodsClass),l=r.default.Pointer("second_class"),d=l.set(e.second_class),p=r.default.Query("Goods");p.equalTo("userId","==",a),p.equalTo("goodsName","==",e.goodsName),p.equalTo("position","==",e.position),p.equalTo("stocks","==",e.stocks),p.find().then(function(i){if(t.log(i),i.length>=1)o([!1,i]);else{var a=e.reserve,s=r.default.Pointer("stocks"),u=s.set(e.stocks),l=r.default.Query("Goods");l.set("goodsName",e.goodsName),l.set("goodsIcon",e.goodsIcon),l.set("costPrice",e.costPrice),l.set("retailPrice",e.retailPrice),l.set("producttime",e.producttime),l.set("nousetime",e.nousetime),l.set("regNumber",e.regNumber),l.set("reserve",Number(e.reserve)),l.set("productCode",e.productCode),l.set("stocks",u),l.set("product_info",e.product_info),l.set("producer",e.producer),l.set("packingUnit",e.packingUnit),l.set("packageContent",e.packageContent),l.set("warning_num",Number(e.warning_num)),l.set("stocktype",Number(e.warning_num)>=Number(a)?0:1),l.set("second_class",d),l.set("goodsClass",c),l.set("userId",n),l.save().then(function(e){t.log(e),o([!0,e])}).catch(function(e){t.log(e)})}})})},get_fristclass:function(){var t=JSON.parse(localStorage.getItem("bmob")).objectId;return new n.default(function(e,o){var i=r.default.Query("class_user");i.equalTo("parent","==",t),i.find().then(function(t){localStorage.setItem("frist_class",(0,a.default)(t)),e(t)})})},get_secondclass:function(t){return new n.default(function(e,o){var i=r.default.Query("class_user");i.field("second",t),i.relation("second_class").then(function(t){e(t.results)})})},getstock_list:function(t){var e=JSON.parse(localStorage.getItem("bmob")).objectId;return new n.default(function(o,i){var s=r.default.Query("stocks");s.order("-num"),s.include("charge","shop"),s.equalTo("parent","==",e),t&&s.equalTo("stock_name","==",{$regex:t+".*"}),s.limit(500),s.find().then(function(t){localStorage.setItem("stocks",(0,a.default)(t)),o(t)})})}};e.default=u}).call(this,o("5a52")["default"])},ce58:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-03e605a4]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-03e605a4]{font-weight:700;position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%}.pro_list[data-v-03e605a4]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-03e605a4]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-03e605a4]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-03e605a4]{text-align:right;width:calc(100% - %?40?%);background-color:#fff;padding:%?10?% 0;max-height:%?100?%}.confrim_button[data-v-03e605a4]{padding:0 %?50?%;background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset}",""])},d0ef:function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("6b54");var a=i(o("5d73"));o("c5f6");var s,n,r,u,c=i(o("9546")),l=i(o("7fd5")),d=i(o("9f50")),p=(i(o("856d")),i(o("a2fc")),{data:function(){return{user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),othercurrent:"",Images:[],stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",really_total_money:0,real_money:0,all_money:0,allCostPrice:0,custom:null,account:"",outType:"",discount:"",pickerTypes:[{desc:"自提",type:1},{desc:"快递",type:2},{desc:"物流",type:3},{desc:"送货上门",type:4}],expressNum:"",total_num:0,nowDay:l.default.getDay(0,!0,!0),canOpretion:!0,wetherDebt:!1}},onLoad:function(){n=this,s=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products"),n.user.rights&&n.user.rights.othercurrent&&(n.othercurrent=n.user.rights.othercurrent)},onShow:function(){if(this.really_total_money=0,this.all_money=0,this.real_money=0,this.total_num=0,n.allCostPrice=0,n.custom=uni.getStorageSync("custom"),u=uni.getStorageSync("shop"),n.account=uni.getStorageSync("account"),u){n.shop_name=u.name;var t=c.default.Pointer("shops");r=t.set(u.objectId)}if(n.custom.discount){n.discount=n.custom.discount;for(var e=0;e<this.products.length;e++)this.all_money=Number((this.products[e].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[e].really_total_money+this.really_total_money).toFixed(2)),this.total_num+=Number(this.products[e].num),n.allCostPrice=n.allCostPrice+Number(n.products[e].num)*Number(n.products[e].costPrice);this.really_total_money=this.really_total_money*n.discount/100,this.real_money=Number(this.all_money.toFixed(2))*n.discount/100,this.all_money=this.all_money*n.discount/100}else{for(var o=0;o<this.products.length;o++)this.all_money=Number((this.products[o].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[o].really_total_money+this.really_total_money).toFixed(2)),this.total_num+=Number(this.products[o].num),n.allCostPrice=n.allCostPrice+Number(n.products[o].num)*Number(n.products[o].costPrice);this.real_money=Number(this.all_money.toFixed(2))}n.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},methods:{changeDebtStatus:function(t){0==t.detail.value&&(this.real_money=Number(this.all_money.toFixed(2))),n.wetherDebt=t.detail.value},changeStatus:function(t){n.canOpretion=t.detail.value},scan_code:function(){this.$wechat.scanQRCode().then(function(t){n.expressNum=t.result})},bindDateChange:function(t){n.nowDay=t.detail.value+" 00:00:00"},removeImg:function(t){n.Images.splice(t,1),n.Images=n.Images},upload_image:function(){n.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){t.log(e);var o,i=Date.parse(new Date),s=e.tempFilePaths,r=!0,u=!1,l=void 0;try{for(var d,p=(0,a.default)(s);!(r=(d=p.next()).done);r=!0){var m=d.value;o=c.default.File(i+".jpg",m)}}catch(f){u=!0,l=f}finally{try{r||null==p.return||p.return()}finally{if(u)throw l}}o.save().then(function(t){var e=!0,o=!1,i=void 0;try{for(var s,r=(0,a.default)(t);!(e=(s=r.next()).done);e=!0){var u=s.value;n.Images.push(u.url)}}catch(f){o=!0,i=f}finally{try{e||null==r.return||r.return()}finally{if(o)throw i}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},getDiscount:function(t){var e=Number(t.detail.value);e>=100?n.discount=100:(n.discount=e,n.real_money=Number(this.all_money.toFixed(2))*e/100)},select_outType:function(t){n.outType=n.pickerTypes[t.detail.value],2==n.outType.type&&3==n.outType.type||(n.expressNum="")},formSubmit:function(e){if(!this.button_disabled){uni.getStorageSync("identity");this.button_disabled=!0;e.detail.formId;var o=1;if(uni.showLoading({title:"请勿退出..."}),""==uni.getStorageSync("custom")||void 0==uni.getStorageSync("custom"))return uni.showToast({icon:"none",title:"请选择客户"}),void(this.button_disabled=!1);for(var i=new Array,a=[],p=[],m=[],f=0;f<this.products.length;f++){var g=Number(this.products[f].reserve)-this.products[f].num,v=c.default.Query("Bills"),_={},y=c.default.Pointer("_User"),h=y.set(s),b=c.default.Pointer("_User"),w=b.set(uni.getStorageSync("masterId")),x=c.default.Pointer("Goods"),S=x.set(this.products[f].header?this.products[f].header.objectId:this.products[f].objectId);if(uni.getStorageSync("custom")){var k=c.default.Pointer("customs"),N=k.set(uni.getStorageSync("custom").objectId);v.set("custom",N)}v.set("goodsName",this.products[f].goodsName),v.set("retailPrice",this.products[f].modify_retailPrice.toString()),v.set("num",Number(this.products[f].num)),v.set("total_money",this.products[f].total_money),v.set("really_total_money",this.products[f].really_total_money),v.set("goodsId",S),v.set("userId",h),v.set("allCostPrice",Number(n.products[f].num)*Number(n.products[f].costPrice)),v.set("type",-1),v.set("count",1),v.set("extra_type",o),v.set("opreater",w),v.set("status",n.canOpretion),v.set("createdTime",{__type:"Date",iso:n.nowDay});var I={};if(this.products[f].stocks&&this.products[f].stocks.objectId){var P=c.default.Pointer("stocks"),C=P.set(this.products[f].stocks.objectId);v.set("stock",C),_.stock=this.products[f].stocks.stock_name,-1==p.indexOf(this.products[f].stocks.objectId)&&(p.push(this.products[f].stocks.objectId),m.push(this.products[f].stocks.stock_name))}_.goodsName=this.products[f].goodsName,_.modify_retailPrice=this.products[f].modify_retailPrice.toString(),_.retailPrice=this.products[f].retailPrice,_.total_money=this.products[f].total_money,I.costPrice=this.products[f].costPrice,I.retailPrice=this.products[f].retailPrice,I.objectId=this.products[f].objectId,I.reserve=g,this.products[f].selectd_model&&(I.selected_model=this.products[f].selected_model,I.models=this.products[f].models),_.goodsId=I,_.type=-1,_.num=this.products[f].num,_.warning_num=this.products[f].warning_num,_.packingUnit=this.products[f].packingUnit,u&&(v.set("shop",r),l.default.record_shopOut(u.objectId,u.have_out+this.products[f].num)),i.push(v),a.push(_)}c.default.Query("Bills").saveAll(i).then(function(i){for(var f=[],g=0;g<i.length;g++)f.push(i[g].success.objectId);var v=c.default.Pointer("_User"),_=v.set(s),y=uni.getStorageSync("masterId"),h=c.default.Pointer("_User"),b=h.set(y),w=c.default.Query("order_opreations");if(w.set("detail",a),w.set("bills",f),w.set("beizhu",e.detail.value.input_beizhu),w.set("type",-1),w.set("extra_type",o),w.set("opreater",b),w.set("stockIds",p),w.set("stockNames",m),w.set("master",_),w.set("real_num",n.total_num),w.set("allCostPrice",n.allCostPrice),w.set("profit",n.all_money-n.allCostPrice),n.discount&&w.set("discount",n.discount),w.set("goodsName",n.products[0].goodsName),w.set("real_money",Number(n.real_money)),w.set("debt",n.all_money-Number(n.real_money)),u&&w.set("shop",r),n.account){var x=c.default.Pointer("accounts"),S=x.set(n.account.objectId);w.set("account",S);var k=c.default.Query("accounts");k.get(n.account.objectId).then(function(t){t.set("money",t.money+Number(n.real_money)),t.save().then(function(t){})})}if(n.custom){var N=c.default.Pointer("customs"),I=N.set(n.custom.objectId);if(w.set("custom",I),n.all_money-Number(n.real_money)>0){var P=c.default.Query("customs");P.get(n.custom.objectId).then(function(e){var o=null==e.debt?0:e.debt;o+=n.all_money-Number(n.real_money),t.log(o);var i=c.default.Query("customs");i.get(n.custom.objectId).then(function(t){t.set("debt",o),t.save()})})}}n.outType&&(w.set("typeDesc",n.outType.desc),w.set("expressNum",n.expressNum)),w.set("all_money",n.all_money),w.set("Images",n.Images),w.set("status",n.canOpretion),w.set("createdTime",{__type:"Date",iso:n.nowDay}),w.save().then(function(t){var e=t.objectId,o=t.createdAt;if(n.canOpretion){n.products;l.default.outRedGoodNum(n.products).then(function(t){uni.hideLoading(),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),uni.setStorageSync("is_option",!0),uni.showToast({title:"产品销售成功"}),setTimeout(function(){var t={};t.goodsName=n.products[0].goodsName,t.total_num=n.total_num,t.createdAt=o,t.operationId=e,d.default.sendTempMini(t,"out"),n.button_disabled=!1,l.default.log(uni.getStorageSync("user").nickName+"销售了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",-1,e),uni.navigateBack({delta:2})},500)})}})},function(e){t.log("异常处理")})}}}});e.default=p}).call(this,o("5a52")["default"])},d801:function(t,e,o){var i=o("ce58");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=o("4f06").default;a("236f5d2c",i,!0,{sourceMap:!1,shadowMode:!1})},e8bc:function(t,e,o){"use strict";o.r(e);var i=o("d0ef"),a=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);e["default"]=a.a}}]);