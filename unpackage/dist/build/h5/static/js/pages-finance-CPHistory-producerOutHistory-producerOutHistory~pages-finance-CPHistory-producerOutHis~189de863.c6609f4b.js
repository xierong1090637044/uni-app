(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-finance-CPHistory-producerOutHistory-producerOutHistory~pages-finance-CPHistory-producerOutHis~189de863"],{"54f8":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return n}));r("a4d3"),r("e01a"),r("d28b"),r("e260"),r("d3b7"),r("3ca3"),r("ddb0");var o=r("dde1");function n(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(o["a"])(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,u=!0,d=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return u=e.done,e},e:function(e){d=!0,a=e},f:function(){try{u||null==n["return"]||n["return"]()}finally{if(d)throw a}}}}},"7faa":function(e,t,r){"use strict";(function(e){var o=r("ee27");r("7db0"),r("a9e3"),r("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("54f8")),a=o(r("9546")),u=uni.getStorageSync("uid"),d={get_producerList:function(e,t){return new Promise((function(r,o){var n=JSON.parse(localStorage.getItem("bmob")).objectId,u=a.default.Query("producers");u.order("num"),u.equalTo("parent","==",n),u.equalTo("disabled","==",e),t&&u.equalTo("name","==",{$regex:t+".*"}),u.find().then((function(e){localStorage.setItem("shops",JSON.stringify(e)),r(e)}))}))},add_producer:function(t){e.log(t);var r=JSON.parse(localStorage.getItem("bmob")).objectId;return new Promise((function(o,n){var u=a.default.Pointer("_User"),d=u.set(r);if(t.objectId){var s=a.default.Query("producers");s.set("producer_name",t.producer_name),s.set("debt",Number(t.debt)),s.set("producer_address",t.producer_address),s.set("producer_phone",t.producer_phone),s.set("parent",d),s.set("disabled",!t.disabled),s.set("id",t.objectId),s.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else{var l=a.default.Query("producers");l.equalTo("parent","==",r),l.equalTo("name","==",t.producer_name),l.find().then((function(r){if(e.log(r),0==r.length){var n=a.default.Query("producers");n.set("producer_name",t.producer_name),n.set("debt",Number(t.debt)),n.set("producer_address",t.producer_address),n.set("producer_phone",t.producer_phone),n.set("have_out",0),n.set("disabled",!t.disabled),n.set("parent",d),n.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else o(!1)}))}}))},delete_producer:function(t){return new Promise((function(r,o){var n=a.default.Query("producers");n.destroy(t).then((function(e){r(e)})).catch((function(t){e.log(t)}))}))},producer_detail:function(t){return new Promise((function(r,o){var n=a.default.Query("producers");n.get(t).then((function(e){r(e)})).catch((function(t){e.log(t)}))}))},get_moneyList:function(t){return new Promise((function(r,o){var n=a.default.Query("order_opreations");n.equalTo("producer","==",t),n.include("opreater","account"),n.find().then((function(t){e.log(t),r(t)}))}))},getProducerSellList:function(e){return new Promise((function(t,r){var o=a.default.Query("order_opreations");o.equalTo("master","==",u),o.equalTo("type","==",-1),o.equalTo("extra_type","==",1),o.equalTo("extra_type","==",1),o.equalTo("producer","==",e.producerId),o.equalTo("status","==",!0),o.equalTo("createdAt",">=",e.startDate),o.equalTo("createdAt","<=",e.endDate),o.limit(50),o.skip(50*(e.pageNum-1)),o.include("opreater","producer","stock"),o.order("-createdAt"),o.find().then((function(e){t(e)}))}))},getAllProducerSellList:function(e){var t={},r=0,o=0,d=0,s=0;return new Promise((function(l,c){var i=a.default.Query("order_opreations");i.equalTo("master","==",u),i.equalTo("type","==",e.type),i.equalTo("extra_type","==",e.extra_type),i.equalTo("producer","==",e.producerId),i.equalTo("status","==",!0),i.equalTo("createdAt",">=",e.startDate+" 00:00:01"),i.equalTo("createdAt","<=",e.endDate+" 00:00:01"),i.count().then((function(a){d=a;var c=0;if(0==d)t.total=r,t.num=d,t.money=o,t.realMoney=0,l(t);else for(var f=0;f<Math.ceil(d/500);f++)i.equalTo("master","==",u),i.equalTo("type","==",e.type),i.equalTo("extra_type","==",e.extra_type),i.equalTo("producer","==",e.producerId),i.equalTo("status","==",!0),i.limit(500),i.skip(500*f),i.include("opreater","producer","stock"),i.order("-createdAt"),i.equalTo("createdAt",">=",e.startDate+" 00:00:01"),i.equalTo("createdAt","<=",e.endDate+" 00:00:01"),i.find().then((function(e){var a,u=(0,n.default)(e);try{for(u.s();!(a=u.n()).done;){var i=a.value;r+=i.real_num,o+=i.all_money,s+=i.real_money,c+=1}}catch(f){u.e(f)}finally{u.f()}c==d&&(t.total=r,t.num=d,t.money=o,t.realMoney=s,l(t))}))}))}))},getAllProducerInRecord:function(e){var t={},r=0,o=0;return new Promise((function(d,s){var l=a.default.Query("order_opreations");l.equalTo("master","==",u),l.equalTo("type","==",1),l.equalTo("extra_type","==",5),l.equalTo("producer","==",e.producerId),l.equalTo("createdAt",">=",e.startDate+" 00:00:01"),l.equalTo("createdAt","<=",e.endDate+" 00:00:01"),l.count().then((function(a){o=a;var s=0;if(0==o)t.num=o,t.money=r,d(t);else for(var c=0;c<Math.ceil(o/500);c++)l.equalTo("master","==",u),l.equalTo("type","==",1),l.equalTo("extra_type","==",5),l.equalTo("producer","==",e.producerId),l.limit(500),l.skip(500*c),l.order("-createdAt"),l.equalTo("createdAt",">=",e.startDate+" 00:00:01"),l.equalTo("createdAt","<=",e.endDate+" 00:00:01"),l.find().then((function(e){var a,u=(0,n.default)(e);try{for(u.s();!(a=u.n()).done;){var l=a.value;r+=l.real_money,s+=1}}catch(c){u.e(c)}finally{u.f()}s==o&&(t.num=o,t.money=r,d(t))}))}))}))}};t.default=d}).call(this,r("5a52")["default"])},"7fd5":function(e,t,r){"use strict";(function(t){var o=r("ee27");r("7db0"),r("a9e3"),r("d3b7"),r("25f0");var n=o(r("54f8")),a=o(r("9546"));e.exports={enterAddGoodNum:function(e,r){var o=this;return new Promise((function(u,d){for(var s=function(d){var s=0,l=a.default.Query("Goods");l.get(e[d].objectId).then((function(c){var i=c;if(e[d].selectd_model){var f,m=(0,n.default)(e[d].selected_model);try{for(m.s();!(f=m.n()).done;){var v,h=f.value,g=(0,n.default)(i.models);try{for(g.s();!(v=g.n()).done;){var y=v.value;y.id==h.id&&(y.reserve=Number(y.reserve)+Number(h.num)),delete y.num}}catch(p){g.e(p)}finally{g.f()}}}catch(p){m.e(p)}finally{m.f()}s=Number(i.reserve)+Number(e[d].num),l.set("models",i.models)}else s=Number(i.reserve)+Number(e[d].num);l.set("reserve",s),l.set("id",e[d].objectId),l.save().then((function(t){if(e[d].header){var n=a.default.Query("Goods");n.equalTo("header","==",e[d].header.objectId),n.equalTo("order","==",1),n.statTo("sum","reserve"),n.find().then((function(t){var n=t[0]._sumReserve,s=a.default.Query("Goods");s.set("reserve",n),"purchase"==r&&s.set("costPrice",e[d].modify_retailPrice),s.set("id",e[d].header.objectId),s.save().then((function(t){o.modifyStockType(e[d].header.objectId),d==e.length-1&&u(!0)}))}))}else o.modifyStockType(e[d].objectId),d==e.length-1&&u(!0)})).catch((function(e){t.log(e)}))}))},l=0;l<e.length;l++)s(l)}))},outRedGoodNum:function(e){var r=this;return new Promise((function(o,u){for(var d=function(u){var d=0,s=a.default.Query("Goods");s.get(e[u].objectId).then((function(l){var c=l;if(e[u].selectd_model){var i,f=(0,n.default)(e[u].selected_model);try{for(f.s();!(i=f.n()).done;){var m,v=i.value,h=(0,n.default)(c.models);try{for(h.s();!(m=h.n()).done;){var g=m.value;d+=Number(g.reserve),g.id==v.id&&(g.reserve=Number(g.reserve)-Number(v.num)),delete g.num}}catch(y){h.e(y)}finally{h.f()}}}catch(y){f.e(y)}finally{f.f()}d=Number(c.reserve)-Number(e[u].num),s.set("models",c.models)}else d=Number(c.reserve)-Number(e[u].num);s.set("reserve",d),s.set("id",e[u].objectId),s.save().then((function(t){if(e[u].header){var n=a.default.Query("Goods");n.equalTo("header","==",e[u].header.objectId),n.equalTo("order","==",1),n.statTo("sum","reserve"),n.find().then((function(t){var n=t[0]._sumReserve,d=a.default.Query("Goods");d.set("reserve",n),d.set("id",e[u].header.objectId),d.save().then((function(t){r.modifyStockType(e[u].header.objectId),u==e.length-1&&o(!0)}))}))}else r.modifyStockType(e[u].objectId),u==e.length-1&&o(!0)})).catch((function(e){t.log(e)}))}))},s=0;s<e.length;s++)d(s)}))},enterAddGoodNumNew:function(e,r){var o=this;return new Promise((function(u,d){for(var s=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",l=uni.getStorageSync("uid"),c=function(d){var c=0,i=a.default.Query("Goods");i.equalTo("userId","==",l),i.equalTo("header","==",e[d].objectId),i.equalTo("stocks","==",s.objectId),i.find().then((function(l){if(0==l.length)o.upload_good_withNoCan(e[d],s,Number(e[d].num)).then((function(t){i.equalTo("header","==",e[d].objectId),i.equalTo("order","==",1),i.statTo("sum","reserve"),i.find().then((function(t){var o=t[0]._sumReserve;i.set("reserve",o),i.set("id",e[d].objectId),"purchase"==r&&i.set("costPrice",e[d].modify_retailPrice),i.save().then((function(t){d==e.length-1&&u(!0)}))}))}));else{var f=l[0],m=a.default.Query("Goods");if(e[d].selected_model){var v,h=(0,n.default)(e[d].selected_model);try{for(h.s();!(v=h.n()).done;){var g,y=v.value,p=(0,n.default)(f.models);try{for(p.s();!(g=p.n()).done;){var b=g.value;b.id==y.id&&(b.reserve=Number(b.reserve)+Number(y.num)),delete b.num}}catch(_){p.e(_)}finally{p.f()}}}catch(_){h.e(_)}finally{h.f()}c=Number(f.reserve)+Number(e[d].num),m.set("models",f.models)}else c=Number(f.reserve)+Number(e[d].num);m.set("reserve",c),m.set("id",f.objectId),m.save().then((function(t){m.equalTo("header","==",e[d].objectId),m.equalTo("order","==",1),m.statTo("sum","reserve"),m.find().then((function(t){var o=t[0]._sumReserve;m.set("reserve",o),"purchase"==r&&m.set("costPrice",e[d].modify_retailPrice.toString()),m.set("id",e[d].objectId),m.save().then((function(t){d==e.length-1&&u(!0)}))}))})).catch((function(e){t.log(e)}))}}))},i=0;i<e.length;i++)c(i)}))},outRedGoodNumNew:function(e){var r=this;return new Promise((function(o,u){for(var d=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",s=uni.getStorageSync("uid"),l=function(u){var l=0,c=a.default.Query("Goods");c.equalTo("userId","==",s),c.equalTo("header","==",e[u].objectId),c.equalTo("stocks","==",d.objectId),c.find().then((function(s){if(0==s.length)r.upload_good_withNoCan(e[u],d,Number(e[u].num),"out").then((function(t){c.equalTo("header","==",e[u].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(t){var r=t[0]._sumReserve;c.set("reserve",r),c.set("id",e[u].objectId),c.save().then((function(t){a.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[u].objectId}).then((function(e){})),u==e.length-1&&o(!0)}))}))}));else{var i=s[0];if(e[u].selected_model){var f,m=(0,n.default)(e[u].selected_model);try{for(m.s();!(f=m.n()).done;){var v,h=f.value,g=(0,n.default)(i.models);try{for(g.s();!(v=g.n()).done;){var y=v.value;y.id==h.id&&(y.reserve=Number(y.reserve)-Number(h.num)),delete y.num}}catch(p){g.e(p)}finally{g.f()}}}catch(p){m.e(p)}finally{m.f()}l=Number(i.reserve)-Number(e[u].num),c.set("models",i.models)}else l=Number(i.reserve)-Number(e[u].num);c.set("reserve",l),c.set("id",i.objectId),c.save().then((function(t){c.equalTo("header","==",e[u].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(t){var r=t[0]._sumReserve;c.set("reserve",r),c.set("id",e[u].objectId),c.save().then((function(t){a.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[u].objectId}).then((function(e){})),u==e.length-1&&o(!0)}))}))})).catch((function(e){t.log(e)}))}}))},c=0;c<e.length;c++)l(c)}))},upload_good_withNoCan:function(e,r,o,u){return new Promise((function(d,s){var l=uni.getStorageSync("uid"),c=a.default.Pointer("_User"),i=c.set(l),f=a.default.Pointer("stocks"),m=f.set(r.objectId),v=a.default.Pointer("Goods"),h="";h=e.header?v.set(e.header.objectId):v.set(e.objectId);var g=a.default.Query("Goods");if(g.set("goodsName",e.goodsName),g.set("goodsIcon",e.goodsIcon),"out"==u){if(g.set("reserve",0-Number(o)),e.goodsId&&e.goodsId.models){var y,p=(0,n.default)(e.goodsId.models);try{for(p.s();!(y=p.n()).done;){var b=y.value;b.reserve=0-Number(b.num)}}catch(x){p.e(x)}finally{p.f()}g.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var _,T=(0,n.default)(e.models);try{for(T.s();!(_=T.n()).done;){var I=_.value;I.reserve=0-Number(I.num)}}catch(x){T.e(x)}finally{T.f()}g.set("models",e.models)}}else if("allocation"==u){if(g.set("reserve",Number(o)),e.selected_model&&e.selected_model.length>0){var S,q=(0,n.default)(e.selected_model);try{for(q.s();!(S=q.n()).done;){var N=S.value;N.reserve=Number(N.num),delete N.num}}catch(x){q.e(x)}finally{q.f()}g.set("models",e.selected_model)}}else if(g.set("reserve",Number(o)),e.goodsId&&e.goodsId.models){var w,j=(0,n.default)(e.goodsId.models);try{for(j.s();!(w=j.n()).done;){var P=w.value;P.reserve=Number(P.num)}}catch(x){j.e(x)}finally{j.f()}g.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var Q,k=(0,n.default)(e.models);try{for(k.s();!(Q=k.n()).done;){var G=Q.value;G.reserve=Number(G.num?G.num:0)}}catch(x){k.e(x)}finally{k.f()}g.set("models",e.models)}g.set("stocks",m),g.set("userId",i),g.set("header",h),g.set("costPrice",""+e.costPrice),g.set("retailPrice",""+e.retailPrice),g.set("order",1),g.save().then((function(e){t.log(e),d([!0,e])})).catch((function(e){t.log(e)}))}))},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,r,o){var n=a.default.Pointer("_User"),u=n.set(uni.getStorageSync("uid"));if(-2==r){var d=a.default.Pointer("Goods"),s=d.set(o),l=a.default.Query("logs");l.equalTo("goodId","==",o),l.find().then((function(o){if(0==o.length){var n=a.default.Query("logs");n.set("parent",u),n.set("goodId",s),n.set("log",e),n.set("type",r),n.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}}))}else{var c=a.default.Query("logs");c.set("parent",u),c.set("log",e),c.set("detail_id",o),c.set("type",r),c.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},modifyStockType:function(e){var r=this,o=a.default.Query("Goods");o.get(e).then((function(e){var t=e;""==t.warning_num&&""==t.max_num?e.set("stocktype",1):void 0==t.warning_num&&void 0==t.max_num?e.set("stocktype",1):null==t.warning_num&&null==t.max_num?e.set("stocktype",1):(""!=t.warning_num&&(t.warning_num>=t.reserve?(e.set("stocktype",0),r.log(t.goodsName+"已经超过设置的最小库存值"+t.warning_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1)),""!=t.max_num&&(t.max_num<=t.reserve?(e.set("stocktype",2),r.log(t.goodsName+"已经超过设置的最大库存值"+t.max_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1))),e.save()})).catch((function(e){t.log(e)}))},record_shopOut:function(e,r){t.log(e,r);var o=a.default.Query("shops");o.set("id",e),o.set("have_out",r),o.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var r=a.default.Query("_User");r.set("id",uni.getStorageSync("user").objectId),r.set("have_out",Number(e)+uni.getStorageSync("user").have_out),r.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var r=a.default.Query("Goods");r.equalTo("userId","==",e),r.find().then((function(e){t.log(e);var r,o=(0,n.default)(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;t.log(a),Number(a.costPrice)*a.reserve,a.reserve}}catch(u){o.e(u)}finally{o.f()}}))},getDay:function(e,t,r){var o=this,n=new Date,a=n.getTime()+864e5*e;n.setTime(a);var u=n.getFullYear(),d=n.getMonth(),s=n.getDate();return d=o.handleMonth(d+1),s=o.handleMonth(s),t?r?u+"-"+d+"-01 00:00:00":u+"-"+d+"-"+s+" 00:00:00":u+"-"+d+"-"+s},js_date_time:function(e,t){var r=new Date(e),o=r.getFullYear(),n=r.getMonth()+1;n=n<10?"0"+n:n;var a=r.getDate();a=a<10?"0"+a:a;var u=r.getHours();u=u<10?"0"+u:u;var d=r.getMinutes(),s=r.getSeconds();return d=d<10?"0"+d:d,s=s<10?"0"+s:s,t?o+"-"+n+"-"+a+" "+u+":"+d:o+"-"+n+"-"+a},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,r("5a52")["default"])}}]);