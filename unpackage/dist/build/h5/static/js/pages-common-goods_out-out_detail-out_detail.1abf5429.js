(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-goods_out-out_detail-out_detail"],{"4d8f":function(t,e,i){"use strict";i.r(e);var o=i("da63"),a=i.n(o);for(var n in o)"default"!==n&&function(t){i.d(e,t,function(){return o[t]})}(n);e["default"]=a.a},5360:function(t,e,i){"use strict";var o=i("96cd"),a=i.n(o);a.a},"5ddc":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"page"},[i("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),i("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,o){return i("v-uni-view",{key:o,staticClass:"pro_listitem"},[i("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[i("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),i("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),i("v-uni-view",{staticClass:"pro_list"},[i("v-uni-view",[t._v("实际进货价：￥"+t._s(e.modify_retailPrice)+"（X"+t._s(e.num)+"）")]),i("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),i("v-uni-view",{staticClass:"pro_allmoney"},[t._v("总计：￥"+t._s(t.all_money))]),i("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[i("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[i("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细（用于记录是否有无欠款）")]),i("v-uni-view",{staticClass:"kaidan_detail"},[i("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[i("v-uni-view",[t._v("客户姓名")]),i("v-uni-view",{staticClass:"kaidan_rightinput"},[i("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1),i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",[t._v("实际应付")]),i("v-uni-view",{staticClass:"kaidan_rightinput"},[i("v-uni-input",{attrs:{placeholder:"选择供货商",disabled:"true",value:t.all_money}})],1)],1),i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-view",[t._v("实际付款（可修改）")]),i("v-uni-view",{staticClass:"kaidan_rightinput"},[i("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入实际付款金额",type:"digit"},model:{value:t.real_money,callback:function(e){t.real_money=e},expression:"real_money"}})],1)],1)],1)],1),i("v-uni-view",{staticStyle:{"margin-top":"20px"}},[i("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),i("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[i("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("确认出库")])],1)],1)],1)],1)},a=[];i.d(e,"a",function(){return o}),i.d(e,"b",function(){return a})},8016:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,".page[data-v-00a33734]{color:#4d4d4d;background:#f6f5ec;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-00a33734]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-00a33734]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-00a33734]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-00a33734]{width:-webkit-calc(100% - %?40?%);width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-00a33734]{background:#aa2116\t;color:#fff;font-weight:700;font-size:%?32?%}",""])},"96cd":function(t,e,i){var o=i("8016");"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var a=i("4f06").default;a("3a8b3a6a",o,!0,{sourceMap:!1,shadowMode:!1})},a916:function(t,e,i){"use strict";i.r(e);var o=i("5ddc"),a=i("4d8f");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("5360");var s=i("2877"),u=Object(s["a"])(a["default"],o["a"],o["b"],!1,null,"00a33734",null);e["default"]=u.exports},da63:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,a,n=s(i("8577"));function s(t){return t&&t.__esModule?t:{default:t}}var u={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null}},onLoad:function(){a=this,o=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=this.products[t].total_money+this.all_money;this.real_money=this.all_money},onShow:function(){a.custom=uni.getStorageSync("custom")},methods:{formSubmit:function(t){var e=this;console.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var i=[],s=new Array,u=function(t){var i=Number(e.products[t].reserve)-e.products[t].num,a=n.default.Query("Goods");a.get(e.products[t].objectId).then(function(o){o.set("reserve",i),o.set("stocktype",i>e.products[t].warning_num?1:0),o.save()}).catch(function(t){console.log(t)});var u=n.default.Query("Bills"),l=n.default.Pointer("_User"),r=l.set(o),c=n.default.Pointer("Goods"),d=c.set(e.products[t].objectId);u.set("goodsName",e.products[t].goodsName),u.set("retailPrice",e.products[t].modify_retailPrice.toString()),u.set("num",e.products[t].num),u.set("total_money",e.products[t].total_money),u.set("goodsId",d),u.set("userId",r),u.set("type",-1),s.push(u)},l=0;l<this.products.length;l++)u(l);n.default.Query("Bills").saveAll(s).then(function(e){for(var s=0;s<e.length;s++)if(i.push(e[s].success.objectId),s==e.length-1){var u=n.default.Relation("Bills"),l=u.add(i),r=n.default.Pointer("_User"),c=r.set(o),d=n.default.Query("order_opreations");if(d.set("relations",l),d.set("beizhu",t.detail.value.input_beizhu),d.set("type",-1),d.set("opreater",c),d.set("master",c),d.set("goodsName",a.products[0].goodsName),d.set("real_money",Number(a.real_money)),d.set("debt",a.all_money-Number(a.real_money)),a.custom){var v=n.default.Pointer("customs"),f=v.set(a.custom.objectId);if(d.set("custom",f),a.all_money-Number(a.real_money)>0){var m=n.default.Query("customs");m.get(a.custom.objectId).then(function(t){var e=null==t.debt?0:t.debt;e+=a.all_money-Number(a.real_money),console.log(e);var i=n.default.Query("customs");i.get(a.custom.objectId).then(function(t){t.set("debt",e),t.save()})})}}d.set("all_money",a.all_money),d.save().then(function(t){console.log("添加操作历史记录成功",t),uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品出库成功",icon:"success",success:function(){a.button_disabled=!1,setTimeout(function(){uni.navigateBack({delta:2})},500)}})})}},function(t){console.log("异常处理")})}}};e.default=u}}]);