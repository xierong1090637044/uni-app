(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_allocation-allocation_detail-allocation_detail"],{"58ec":function(t,e,o){var n=o("a6a3");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=o("4f06").default;s("41773431",n,!0,{sourceMap:!1,shadowMode:!1})},"67e8":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[t._v("调出仓库："+t._s(t.stock.stock_name))]),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("可调库存："+t._s(e.reserve))]),o("v-uni-view",[t._v("调出库存："+t._s(e.num))])],1)],1)}),1),o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=out_choose"}},[o("v-uni-view",[t._v("选择调入仓库")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择调入仓库",disabled:"true",value:t.out_stock.stock_name}})],1)],1)],1)],1),o("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("确认调拨")])],1)],1)],1)],1)},s=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return s})},"9d52":function(t,e,o){"use strict";var n=o("58ec"),s=o.n(n);s.a},a6a3:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-60738718]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-60738718]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-60738718]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-60738718]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-60738718]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-60738718]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},a833:function(t,e,o){"use strict";o.r(e);var n=o("c237"),s=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,function(){return n[t]})}(a);e["default"]=s.a},aedb:function(t,e,o){"use strict";o.r(e);var n=o("67e8"),s=o("a833");for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);o("9d52");var i=o("2877"),r=Object(i["a"])(s["default"],n["a"],n["b"],!1,null,"60738718",null);e["default"]=r.exports},c237:function(t,e,o){"use strict";var n=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("6b54"),o("87b3"),o("7514");var s=n(o("795b"));o("c5f6");var a,i,r=n(o("df06")),u=(n(o("da3f")),{data:function(){return{stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[]}},onLoad:function(){i=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2));this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){i.stock=uni.getStorageSync("warehouse")[0].stock,i.out_stock=uni.getStorageSync("out_warehouse")?uni.getStorageSync("out_warehouse")[0].stock:""},methods:{check:function(){return new s.default(function(t,e){""==i.out_stock||null==i.out_stock?(uni.showToast({title:"请选择调入仓库",icon:"none"}),t(!1)):i.check_goods().then(function(e){1==e?t(!0):uni.showModal({title:"提示",content:"'"+e+"'没有关联到调出仓库",showCancel:!0,success:function(t){console.log(t),t.confirm&&uni.navigateBack({delta:1})},fail:function(){},complete:function(){t(!1)}})})})},check_goods:function(){return new s.default(function(t,e){for(var o=function(e){var o=Bmob.Query("Goods");o.equalTo("goodsName","==",i.products[e].goodsName),o.equalTo("userId","==",a),o.equalTo("stocks","==",i.out_stock.objectId),o.find().then(function(o){console.log(o),0==o.length?t(i.products[e].goodsName):(i.out_products=i.out_products.concat(o),t(!0))})},n=0;n<i.products.length;n++)o(n)})},formSubmit:function(t){console.log(t),this.button_disabled=!0,i.check().then(function(e){console.log(e),e?i.add_tb_record(t):i.button_disabled=!1})},add_tb_record:function(t){uni.showLoading({title:"上传中..."});for(var e=Bmob.Pointer("stocks"),o=e.set(i.stock.objectId),n=e.set(i.out_stock.objectId),s=new Array,u=[],c=0;c<this.products.length;c++){var d=Number(this.products[c].reserve)-this.products[c].num,l=Number(this.out_products[c].reserve)+this.products[c].num,f=Bmob.Query("Bills"),v={},p=Bmob.Pointer("_User"),g=p.set(a),h=Bmob.Pointer("_User"),m=h.set(uni.getStorageSync("masterId")),_=Bmob.Pointer("Goods"),b=_.set(this.products[c].objectId);f.set("goodsName",this.products[c].goodsName),f.set("retailPrice",this.products[c].modify_retailPrice.toString()),f.set("num",this.products[c].num),f.set("total_money",this.products[c].total_money),f.set("goodsId",b),f.set("userId",g),f.set("type",-2),f.set("operater",m),f.set("stock",o),f.set("out_stock",n);var y={};v.goodsName=this.products[c].goodsName,v.stock=i.stock.stock_name,v.out_stock=i.out_stock.stock_name,v.reserve=this.products[c].reserve,v.out_reserve=this.out_products[c].reserve,y.objectId=this.products[c].objectId,y.out_objectId=this.out_products[c].objectId,y.reserve=d,y.out_reserve=l,v.goodsId=y,v.num=this.products[c].num,v.type=-2,s.push(f),u.push(v)}Bmob.Query("Bills").saveAll(s).then(function(e){for(var s=[],c=0;c<e.length;c++)s.push(e[c].success.objectId);var d=Bmob.Pointer("_User"),l=d.set(a),f=uni.getStorageSync("masterId"),v=Bmob.Pointer("_User"),p=v.set(f),g=Bmob.Query("order_opreations");g.set("detail",u),g.set("bills",s),g.set("beizhu",t.detail.value.input_beizhu),g.set("type",-2),g.set("opreater",p),g.set("stock",o),g.set("out_stock",n),g.set("master",l),g.set("goodsName",i.products[0].goodsName),g.save().then(function(t){console.log("添加操作历史记录成功",t),uni.hideLoading(),uni.showToast({title:"产品调拨成功",icon:"success",success:function(){for(var e=function(t){var e=Number(i.products[t].reserve)-i.products[t].num,o=Number(i.out_products[t].reserve)+i.products[t].num,n=Bmob.Query("Goods");n.get(i.products[t].objectId).then(function(s){s.set("reserve",e),s.set("stocktype",e>i.products[t].warning_num?1:0),s.save(),n.get(i.out_products[t].objectId).then(function(e){e.set("reserve",o),e.set("stocktype",o>i.out_products[t].warning_num?1:0),e.save()})}).catch(function(t){console.log(t)})},o=0;o<i.products.length;o++)e(o);i.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){r.default.log(uni.getStorageSync("user").nickName+"调拨了'"+i.products[0].goodsName+"'等"+i.products.length+"商品",-2,t.objectId),uni.navigateBack({delta:2})},500)}})})},function(t){console.log("异常处理")})}}});e.default=u},da3f:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={send_in:function(t){var e=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:e,frist:t.frist,data1:t.data1,data2:t.data2,remark:t.remark,url:t.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){console.log(t)}})},send_temp:function(t){var e=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:e,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:"备注:"+t.remark,url:t.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){console.log(t)}})}};e.default=n},df06:function(t,e,o){"use strict";var n=o("288e");o("6b54"),o("87b3"),o("c5f6");var s=n(o("5d73"));o("7514"),t.exports={handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("now_product"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,e,o){var n=Bmob.Pointer("_User"),s=n.set(uni.getStorageSync("uid")),a=Bmob.Query("logs");a.set("parent",s),a.set("log",t),a.set("detail_id",o),a.set("type",e),a.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_shopOut:function(t,e){console.log(t,e);var o=Bmob.Query("shops");o.set("id",t),o.set("have_out",e),o.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_staffOut:function(t){if(console.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var e=Bmob.Query("staffs");e.set("id",uni.getStorageSync("user").objectId),e.set("have_out",t+uni.getStorageSync("user").have_out),e.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");console.log(t);var e=Bmob.Query("Goods");e.equalTo("userId","==",t),e.find().then(function(t){console.log(t);var e=!0,o=!1,n=void 0;try{for(var a,i=(0,s.default)(t);!(e=(a=i.next()).done);e=!0){var r=a.value;console.log(r),Number(r.costPrice)*r.reserve,r.reserve}}catch(u){o=!0,n=u}finally{try{e||null==i.return||i.return()}finally{if(o)throw n}}})},getDay:function(t,e){var o=this,n=new Date,s=n.getTime()+864e5*t;n.setTime(s);var a=n.getFullYear(),i=n.getMonth(),r=n.getDate();return i=o.handleMonth(i+1),r=o.handleMonth(r),e?a+"-"+i+"-"+r+" 00:00:00":a+"-"+i+"-"+r},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}}}]);