(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-finance-CPHistory-customInOrder-customInOrder"],{"0dbd":function(e,t,n){"use strict";var o,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"page"},[n("v-uni-view",{staticClass:"backgroundfff",staticStyle:{padding:"0 20rpx","margin-top":"20rpx"}},[n("v-uni-view",{staticClass:"newOrderTitle borderBot"},[e._v("基础信息")]),n("v-uni-view",[n("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[n("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("客户"),n("v-uni-text",{staticStyle:{color:"#f30"}},[e._v("*")])],1),n("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{width:"100%","justify-content":"flex-end"}},[n("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择客户",disabled:"true",value:e.custom.custom_name}})],1)],1),n("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[n("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("收款日期")]),n("v-uni-picker",{attrs:{mode:"date",value:e.nowDay,end:e.nowDay},on:{change:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.bindDateChange.apply(void 0,arguments)},click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t)}}},[n("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[n("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[e._v(e._s(e.nowDay.split(" ")[0]))]),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1)],1)],1),n("v-uni-view",{staticClass:"backgroundfff",staticStyle:{padding:"0 20rpx","margin-top":"20rpx"}},[n("v-uni-view",{staticClass:"newOrderTitle borderBot"},[e._v("要收款的单据")]),n("v-uni-view",e._l(e.customInOrders,(function(t,o){return n("v-uni-view",{key:o,staticClass:"borderBot",staticStyle:{padding:"20rpx 0",width:"100%"}},[n("v-uni-view",{staticClass:"color333"},[e._v("单据编号："+e._s(t.objectId))]),n("v-uni-view",{staticClass:"color333"},[e._v("单据日期："+e._s(t.createdAt))]),n("v-uni-view",{staticClass:"display_flex_bet"},[n("v-uni-view",{staticClass:"color333"},[e._v("应收金额："+e._s(t.real_money)+"元")]),n("v-uni-view",{staticClass:"moneyIcon"},[e._v("待收：￥"+e._s(t.debt)+"元")])],1),n("v-uni-view",{staticClass:"color333"},[e._v("已收："+e._s(t.haveGetMoney)+"元")]),n("v-uni-view",{staticClass:"display_flex_bet"},[n("v-uni-view",{staticClass:"color333 display_flex"},[e._v("本次收款(可编辑)"),n("v-uni-text",{staticStyle:{color:"#f30","font-size":"20rpx"}},[e._v("*")])],1),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-input",{staticStyle:{"text-align":"right",color:"#f30","font-weight":"bold","font-size":"28rpx"},attrs:{placeholder:"请输入本次收款",type:"digit"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.inputShouldGetMoney(t,o)},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.inputShouldGetMoney(t,o)}},model:{value:t.shouldGetMoney,callback:function(n){e.$set(t,"shouldGetMoney",n)},expression:"item.shouldGetMoney"}}),n("v-uni-text",{staticStyle:{"margin-left":"10rpx"}},[e._v("元")])],1)],1)],1)})),1)],1),n("v-uni-view",{staticClass:"backgroundfff",staticStyle:{padding:"0 20rpx","margin-top":"20rpx"}},[n("v-uni-view",{staticClass:"newOrderTitle borderBot"},[e._v("收款信息")]),n("v-uni-view",[n("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/finance/myData/account/account?type=choose"}},[n("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("收款账户"),n("v-uni-text",{staticStyle:{color:"#f30"}},[e._v("*")])],1),n("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{"justify-content":"flex-end"}},[n("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择收款账户",disabled:"true",value:e.account?e.account.name:""}}),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),n("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[n("v-uni-view",[e._v("收款人"),n("v-uni-text",{staticStyle:{"font-size":"20rpx",color:"#f30"}},[e._v("*")])],1),n("v-uni-view",{staticClass:"kaidan_rightinput",staticStyle:{"text-align":"right"}},[e._v(e._s(e.user.nickName))])],1)],1)],1),n("v-uni-view",{staticClass:"backgroundfff",staticStyle:{padding:"0 20rpx","margin-top":"20rpx"}},[n("v-uni-view",{staticClass:"newOrderTitle borderBot"},[e._v("备注")]),n("v-uni-view",[n("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"},model:{value:e.beizhu_text,callback:function(t){e.beizhu_text=t},expression:"beizhu_text"}})],1)],1),n("v-uni-view",{staticClass:"backgroundfff",staticStyle:{padding:"0 20rpx","margin-top":"20rpx"}},[n("v-uni-view",{staticClass:"newOrderTitle borderBot"},[e._v("上传凭证图(会员可用)")]),n("v-uni-view",[n("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[n("v-uni-view",{staticClass:"upload_image display_flex"},[e._l(e.Images,(function(t,o){return e.Images&&e.Images.length>0?n("v-uni-view",{key:o,staticStyle:{position:"relative"}},[n("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:t}}),n("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.removeImg(o)}}})],1):e._e()})),e.Images.length<3?n("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.upload_image.apply(void 0,arguments)}}},[n("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):e._e()],2)],1)],1)],1),n("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[n("v-uni-view",[n("v-uni-text",[e._v("总计收款：￥"+e._s(e.real_money||0))])],1),n("v-uni-view",{staticClass:"display_flex"},[n("v-uni-button",{staticClass:"confrim_button",staticStyle:{background:"#426ab3"},attrs:{disabled:e.button_disabled},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.formSubmit.apply(void 0,arguments)}}},[e._v("完成")])],1)],1)],1)],1)},r=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}))},"114b":function(e,t,n){"use strict";(function(e){var o=n("ee27");n("7db0"),n("a9e3"),n("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("54f8")),r=o(n("9546")),s=uni.getStorageSync("uid"),u={get_customList:function(e,t){return new Promise((function(n,o){var a=uni.getStorageSync("uid"),s=r.default.Query("customs");s.order("num"),s.equalTo("parent","==",a),s.equalTo("disabled","==",e),t&&s.equalTo("name","==",{$regex:t+".*"}),s.find().then((function(e){n(e)}))}))},get_customCount:function(){return new Promise((function(e,t){var n=uni.getStorageSync("uid"),o=r.default.Query("customs");o.equalTo("parent","==",n),o.find().then((function(t){var n,o=t,s=(0,a.default)(o);try{var u=function(){var e=n.value,t=r.default.Query("Bills");t.equalTo("type","==",-1),t.equalTo("custom","==",e.objectId),t.find().then((function(t){e.relations=t}))};for(s.s();!(n=s.n()).done;)u()}catch(i){s.e(i)}finally{s.f()}e(o)}))}))},add_custom:function(t){e.log(t);var n=JSON.parse(localStorage.getItem("bmob")).objectId;return new Promise((function(o,a){var s=r.default.Pointer("_User"),u=s.set(n);if(t.objectId){var i=r.default.Query("customs");i.set("custom_name",t.custom_name),i.set("debt",Number(t.debt)),i.set("custom_address",t.custom_address),i.set("custom_phone",t.custom_phone),i.set("parent",u),i.set("disabled",!t.disabled),i.set("id",t.objectId),i.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else{var c=r.default.Query("customs");c.equalTo("parent","==",n),c.equalTo("name","==",t.custom_name),c.find().then((function(n){if(e.log(n),0==n.length){var a=r.default.Query("customs");a.set("custom_name",t.custom_name),a.set("debt",Number(t.debt)),a.set("custom_address",t.custom_address),a.set("custom_phone",t.custom_phone),a.set("have_out",0),a.set("disabled",!t.disabled),a.set("parent",u),a.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else o(!1)}))}}))},delete_custom:function(t){return new Promise((function(n,o){var a=r.default.Query("customs");a.destroy(t).then((function(e){n(e)})).catch((function(t){e.log(t)}))}))},custom_detail:function(t){return new Promise((function(n,o){var a=r.default.Query("customs");a.include("customFristClass","customSecondClass"),a.get(t).then((function(e){n(e)})).catch((function(t){e.log(t)}))}))},get_moneyList:function(t){return new Promise((function(n,o){var a=r.default.Query("order_opreations");a.equalTo("custom","==",t),a.include("opreater","account"),a.find().then((function(t){e.log(t),n(t)}))}))},getCustomSellList:function(e){return new Promise((function(t,n){var o=r.default.Query("order_opreations");o.equalTo("master","==",s),o.equalTo("type","==",-1),o.equalTo("extra_type","==",1),o.equalTo("extra_type","==",1),o.equalTo("custom","==",e.customId),o.equalTo("status","==",!0),o.equalTo("createdAt",">=",e.startDate),o.equalTo("createdAt","<=",e.endDate),o.limit(50),o.skip(50*(e.pageNum-1)),o.include("opreater","custom","stock"),o.order("-createdAt"),o.find().then((function(e){t(e)}))}))},getAllCustomSellList:function(e){var t={},n=0,o=0,u=0,i=0,c=0;return new Promise((function(l,d){var f=r.default.Query("order_opreations");f.equalTo("master","==",s),f.equalTo("type","==",e.type),f.equalTo("extra_type","==",e.extra_type),f.equalTo("custom","==",e.customId),f.equalTo("status","==",!0),f.equalTo("createdAt",">=",e.startDate+" 00:00:01"),f.equalTo("createdAt","<=",e.endDate+" 00:00:01"),f.count().then((function(r){u=r;var d=0;if(0==u)t.total=n,t.num=u,t.money=o,t.realMoney=0,t.realCost=0,l(t);else for(var v=0;v<Math.ceil(u/500);v++)f.equalTo("master","==",s),f.equalTo("type","==",e.type),f.equalTo("extra_type","==",e.extra_type),f.equalTo("custom","==",e.customId),f.equalTo("status","==",!0),f.limit(500),f.skip(500*v),f.include("opreater","custom","stock"),f.order("-createdAt"),f.equalTo("createdAt",">=",e.startDate+" 00:00:01"),f.equalTo("createdAt","<=",e.endDate+" 00:00:01"),f.find().then((function(e){var r,s=(0,a.default)(e);try{for(s.s();!(r=s.n()).done;){var f=r.value;n+=f.real_num,o+=f.all_money,i+=f.real_money,c+=f.allCostPrice,d+=1}}catch(v){s.e(v)}finally{s.f()}d==u&&(t.total=n,t.num=u,t.money=o,t.realMoney=i,t.realCost=c,l(t))}))}))}))},getAllCustomInRecord:function(e){var t={},n=0,o=0;return new Promise((function(u,i){var c=r.default.Query("order_opreations");c.equalTo("master","==",s),c.equalTo("type","==",-1),c.equalTo("extra_type","==",5),c.equalTo("custom","==",e.customId),c.equalTo("createdAt",">=",e.startDate+" 00:00:01"),c.equalTo("createdAt","<=",e.endDate+" 00:00:01"),c.count().then((function(r){o=r;var i=0;if(0==o)t.num=o,t.money=n,u(t);else for(var l=0;l<Math.ceil(o/500);l++)c.equalTo("master","==",s),c.equalTo("type","==",-1),c.equalTo("extra_type","==",5),c.equalTo("custom","==",e.customId),c.limit(500),c.skip(500*l),c.order("-createdAt"),c.equalTo("createdAt",">=",e.startDate+" 00:00:01"),c.equalTo("createdAt","<=",e.endDate+" 00:00:01"),c.find().then((function(e){var r,s=(0,a.default)(e);try{for(s.s();!(r=s.n()).done;){var c=r.value;n+=c.real_money,i+=1}}catch(l){s.e(l)}finally{s.f()}i==o&&(t.num=o,t.money=n,u(t))}))}))}))}};t.default=u}).call(this,n("5a52")["default"])},1172:function(e,t,n){"use strict";n.r(t);var o=n("0dbd"),a=n("256f");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("a7ea");var s,u=n("f0c5"),i=Object(u["a"])(a["default"],o["b"],o["c"],!1,null,"e369fa74",null,!1,o["a"],s);t["default"]=i.exports},1728:function(e,t,n){var o=n("24fb");t=o(!1),t.push([e.i,".page[data-v-e369fa74]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.uni-input-input[data-v-e369fa74]{font-size:%?28?%}.bottomEle[data-v-e369fa74]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%;font-weight:700}.pro_list[data-v-e369fa74]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-e369fa74]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-e369fa74]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-e369fa74]{text-align:left;background-color:#fff;max-height:%?100?%;padding:%?20?% 0}.confrim_button[data-v-e369fa74]{background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset;padding:0 %?50?%}",""]),e.exports=t},"256f":function(e,t,n){"use strict";n.r(t);var o=n("b5ad"),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},"54f8":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n("a4d3"),n("e01a"),n("d28b"),n("e260"),n("d3b7"),n("3ca3"),n("ddb0");var o=n("dde1");function a(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(o["a"])(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r,s=!0,u=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return s=e.done,e},e:function(e){u=!0,r=e},f:function(){try{s||null==a["return"]||a["return"]()}finally{if(u)throw r}}}}},"68fd":function(e,t,n){var o=n("1728");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("1eee6990",o,!0,{sourceMap:!1,shadowMode:!1})},"7fd5":function(e,t,n){"use strict";(function(t){var o=n("ee27");n("7db0"),n("a9e3"),n("d3b7"),n("25f0");var a=o(n("54f8")),r=o(n("9546"));e.exports={enterAddGoodNum:function(e,n){var o=this;return new Promise((function(s,u){for(var i=function(u){var i=0,c=r.default.Query("Goods");c.get(e[u].objectId).then((function(l){var d=l;if(e[u].selectd_model){var f,v=(0,a.default)(e[u].selected_model);try{for(v.s();!(f=v.n()).done;){var m,g=f.value,y=(0,a.default)(d.models);try{for(y.s();!(m=y.n()).done;){var h=m.value;h.id==g.id&&(h.reserve=Number(h.reserve)+Number(g.num)),delete h.num}}catch(p){y.e(p)}finally{y.f()}}}catch(p){v.e(p)}finally{v.f()}i=Number(d.reserve)+Number(e[u].num),c.set("models",d.models)}else i=Number(d.reserve)+Number(e[u].num);c.set("reserve",i),c.set("id",e[u].objectId),c.save().then((function(t){if(e[u].header){var a=r.default.Query("Goods");a.equalTo("header","==",e[u].header.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then((function(t){var a=t[0]._sumReserve,i=r.default.Query("Goods");i.set("reserve",a),"purchase"==n&&i.set("costPrice",e[u].modify_retailPrice),i.set("id",e[u].header.objectId),i.save().then((function(t){o.modifyStockType(e[u].header.objectId),u==e.length-1&&s(!0)}))}))}else o.modifyStockType(e[u].objectId),u==e.length-1&&s(!0)})).catch((function(e){t.log(e)}))}))},c=0;c<e.length;c++)i(c)}))},outRedGoodNum:function(e){var n=this;return new Promise((function(o,s){for(var u=function(s){var u=0,i=r.default.Query("Goods");i.get(e[s].objectId).then((function(c){var l=c;if(e[s].selectd_model){var d,f=(0,a.default)(e[s].selected_model);try{for(f.s();!(d=f.n()).done;){var v,m=d.value,g=(0,a.default)(l.models);try{for(g.s();!(v=g.n()).done;){var y=v.value;u+=Number(y.reserve),y.id==m.id&&(y.reserve=Number(y.reserve)-Number(m.num)),delete y.num}}catch(h){g.e(h)}finally{g.f()}}}catch(h){f.e(h)}finally{f.f()}u=Number(l.reserve)-Number(e[s].num),i.set("models",l.models)}else u=Number(l.reserve)-Number(e[s].num);i.set("reserve",u),i.set("id",e[s].objectId),i.save().then((function(t){if(e[s].header){var a=r.default.Query("Goods");a.equalTo("header","==",e[s].header.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then((function(t){var a=t[0]._sumReserve,u=r.default.Query("Goods");u.set("reserve",a),u.set("id",e[s].header.objectId),u.save().then((function(t){n.modifyStockType(e[s].header.objectId),s==e.length-1&&o(!0)}))}))}else n.modifyStockType(e[s].objectId),s==e.length-1&&o(!0)})).catch((function(e){t.log(e)}))}))},i=0;i<e.length;i++)u(i)}))},enterAddGoodNumNew:function(e,n){var o=this;return new Promise((function(s,u){for(var i=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",c=uni.getStorageSync("uid"),l=function(u){var l=0,d=r.default.Query("Goods");d.equalTo("userId","==",c),d.equalTo("header","==",e[u].objectId),d.equalTo("stocks","==",i.objectId),d.find().then((function(c){if(0==c.length)o.upload_good_withNoCan(e[u],i,Number(e[u].num)).then((function(t){d.equalTo("header","==",e[u].objectId),d.equalTo("order","==",1),d.statTo("sum","reserve"),d.find().then((function(t){var o=t[0]._sumReserve;d.set("reserve",o),d.set("id",e[u].objectId),"purchase"==n&&d.set("costPrice",e[u].modify_retailPrice),d.save().then((function(t){u==e.length-1&&s(!0)}))}))}));else{var f=c[0],v=r.default.Query("Goods");if(e[u].selected_model){var m,g=(0,a.default)(e[u].selected_model);try{for(g.s();!(m=g.n()).done;){var y,h=m.value,p=(0,a.default)(f.models);try{for(p.s();!(y=p.n()).done;){var b=y.value;b.id==h.id&&(b.reserve=Number(b.reserve)+Number(h.num)),delete b.num}}catch(_){p.e(_)}finally{p.f()}}}catch(_){g.e(_)}finally{g.f()}l=Number(f.reserve)+Number(e[u].num),v.set("models",f.models)}else l=Number(f.reserve)+Number(e[u].num);v.set("reserve",l),v.set("id",f.objectId),v.save().then((function(t){v.equalTo("header","==",e[u].objectId),v.equalTo("order","==",1),v.statTo("sum","reserve"),v.find().then((function(t){var o=t[0]._sumReserve;v.set("reserve",o),"purchase"==n&&v.set("costPrice",e[u].modify_retailPrice.toString()),v.set("id",e[u].objectId),v.save().then((function(t){u==e.length-1&&s(!0)}))}))})).catch((function(e){t.log(e)}))}}))},d=0;d<e.length;d++)l(d)}))},outRedGoodNumNew:function(e){var n=this;return new Promise((function(o,s){for(var u=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",i=uni.getStorageSync("uid"),c=function(s){var c=0,l=r.default.Query("Goods");l.equalTo("userId","==",i),l.equalTo("header","==",e[s].objectId),l.equalTo("stocks","==",u.objectId),l.find().then((function(i){if(0==i.length)n.upload_good_withNoCan(e[s],u,Number(e[s].num),"out").then((function(t){l.equalTo("header","==",e[s].objectId),l.equalTo("order","==",1),l.statTo("sum","reserve"),l.find().then((function(t){var n=t[0]._sumReserve;l.set("reserve",n),l.set("id",e[s].objectId),l.save().then((function(t){r.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[s].objectId}).then((function(e){})),s==e.length-1&&o(!0)}))}))}));else{var d=i[0];if(e[s].selected_model){var f,v=(0,a.default)(e[s].selected_model);try{for(v.s();!(f=v.n()).done;){var m,g=f.value,y=(0,a.default)(d.models);try{for(y.s();!(m=y.n()).done;){var h=m.value;h.id==g.id&&(h.reserve=Number(h.reserve)-Number(g.num)),delete h.num}}catch(p){y.e(p)}finally{y.f()}}}catch(p){v.e(p)}finally{v.f()}c=Number(d.reserve)-Number(e[s].num),l.set("models",d.models)}else c=Number(d.reserve)-Number(e[s].num);l.set("reserve",c),l.set("id",d.objectId),l.save().then((function(t){l.equalTo("header","==",e[s].objectId),l.equalTo("order","==",1),l.statTo("sum","reserve"),l.find().then((function(t){var n=t[0]._sumReserve;l.set("reserve",n),l.set("id",e[s].objectId),l.save().then((function(t){r.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[s].objectId}).then((function(e){})),s==e.length-1&&o(!0)}))}))})).catch((function(e){t.log(e)}))}}))},l=0;l<e.length;l++)c(l)}))},upload_good_withNoCan:function(e,n,o,s){return new Promise((function(u,i){var c=uni.getStorageSync("uid"),l=r.default.Pointer("_User"),d=l.set(c),f=r.default.Pointer("stocks"),v=f.set(n.objectId),m=r.default.Pointer("Goods"),g="";g=e.header?m.set(e.header.objectId):m.set(e.objectId);var y=r.default.Query("Goods");if(y.set("goodsName",e.goodsName),y.set("goodsIcon",e.goodsIcon),"out"==s){if(y.set("reserve",0-Number(o)),e.goodsId&&e.goodsId.models){var h,p=(0,a.default)(e.goodsId.models);try{for(p.s();!(h=p.n()).done;){var b=h.value;b.reserve=0-Number(b.num)}}catch(G){p.e(G)}finally{p.f()}y.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var _,S=(0,a.default)(e.models);try{for(S.s();!(_=S.n()).done;){var w=_.value;w.reserve=0-Number(w.num)}}catch(G){S.e(G)}finally{S.f()}y.set("models",e.models)}}else if("allocation"==s){if(y.set("reserve",Number(o)),e.selected_model&&e.selected_model.length>0){var x,I=(0,a.default)(e.selected_model);try{for(I.s();!(x=I.n()).done;){var T=x.value;T.reserve=Number(T.num),delete T.num}}catch(G){I.e(G)}finally{I.f()}y.set("models",e.selected_model)}}else if(y.set("reserve",Number(o)),e.goodsId&&e.goodsId.models){var N,q=(0,a.default)(e.goodsId.models);try{for(q.s();!(N=q.n()).done;){var j=N.value;j.reserve=Number(j.num)}}catch(G){q.e(G)}finally{q.f()}y.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var k,C=(0,a.default)(e.models);try{for(C.s();!(k=C.n()).done;){var P=k.value;P.reserve=Number(P.num?P.num:0)}}catch(G){C.e(G)}finally{C.f()}y.set("models",e.models)}y.set("stocks",v),y.set("userId",d),y.set("header",g),y.set("costPrice",""+e.costPrice),y.set("retailPrice",""+e.retailPrice),y.set("order",1),y.save().then((function(e){t.log(e),u([!0,e])})).catch((function(e){t.log(e)}))}))},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,n,o){var a=r.default.Pointer("_User"),s=a.set(uni.getStorageSync("uid"));if(-2==n){var u=r.default.Pointer("Goods"),i=u.set(o),c=r.default.Query("logs");c.equalTo("goodId","==",o),c.find().then((function(o){if(0==o.length){var a=r.default.Query("logs");a.set("parent",s),a.set("goodId",i),a.set("log",e),a.set("type",n),a.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}}))}else{var l=r.default.Query("logs");l.set("parent",s),l.set("log",e),l.set("detail_id",o),l.set("type",n),l.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},modifyStockType:function(e){var n=this,o=r.default.Query("Goods");o.get(e).then((function(e){var t=e;""==t.warning_num&&""==t.max_num?e.set("stocktype",1):void 0==t.warning_num&&void 0==t.max_num?e.set("stocktype",1):null==t.warning_num&&null==t.max_num?e.set("stocktype",1):(""!=t.warning_num&&(t.warning_num>=t.reserve?(e.set("stocktype",0),n.log(t.goodsName+"已经超过设置的最小库存值"+t.warning_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1)),""!=t.max_num&&(t.max_num<=t.reserve?(e.set("stocktype",2),n.log(t.goodsName+"已经超过设置的最大库存值"+t.max_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1))),e.save()})).catch((function(e){t.log(e)}))},record_shopOut:function(e,n){t.log(e,n);var o=r.default.Query("shops");o.set("id",e),o.set("have_out",n),o.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var n=r.default.Query("_User");n.set("id",uni.getStorageSync("user").objectId),n.set("have_out",Number(e)+uni.getStorageSync("user").have_out),n.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var n=r.default.Query("Goods");n.equalTo("userId","==",e),n.find().then((function(e){t.log(e);var n,o=(0,a.default)(e);try{for(o.s();!(n=o.n()).done;){var r=n.value;t.log(r),Number(r.costPrice)*r.reserve,r.reserve}}catch(s){o.e(s)}finally{o.f()}}))},getDay:function(e,t,n){var o=this,a=new Date,r=a.getTime()+864e5*e;a.setTime(r);var s=a.getFullYear(),u=a.getMonth(),i=a.getDate();return u=o.handleMonth(u+1),i=o.handleMonth(i),t?n?s+"-"+u+"-01 00:00:00":s+"-"+u+"-"+i+" 00:00:00":s+"-"+u+"-"+i},js_date_time:function(e,t){var n=new Date(e),o=n.getFullYear(),a=n.getMonth()+1;a=a<10?"0"+a:a;var r=n.getDate();r=r<10?"0"+r:r;var s=n.getHours();s=s<10?"0"+s:s;var u=n.getMinutes(),i=n.getSeconds();return u=u<10?"0"+u:u,i=i<10?"0"+i:i,t?o+"-"+a+"-"+r+" "+s+":"+u:o+"-"+a+"-"+r},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,n("5a52")["default"])},a7ea:function(e,t,n){"use strict";var o=n("68fd"),a=n.n(o);a.a},b5ad:function(e,t,n){"use strict";(function(e){var o=n("ee27");n("a434"),n("a9e3"),n("d3b7"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r,s=o(n("54f8")),u=o(n("9546")),i=o(n("7fd5")),c=(o(n("114b")),{data:function(){return{custom:{},user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),Images:[],account:"",button_disabled:!1,beizhu_text:"",real_money:0,nowDay:i.default.getDay(0,!0,!0),customInOrders:""}},onLoad:function(e){r=this,a=uni.getStorageSync("uid"),r.customInOrders=uni.getStorageSync("customInOrders");var t,n=(0,s.default)(r.customInOrders);try{for(n.s();!(t=n.n()).done;){var o=t.value;r.real_money+=Number(o.shouldGetMoney)}}catch(u){n.e(u)}finally{n.f()}uni.setNavigationBarTitle({title:"新增收款单"})},onShow:function(){if(r.custom=uni.getStorageSync("custom"),r.account=uni.getStorageSync("account"),uni.getStorageSync("category"))if(r.category=uni.getStorageSync("category"),2==r.category.type){var e=u.default.Pointer("financeFristClass");e.set(r.category.parent.objectId);var t=u.default.Pointer("financeSecondClass");t.set(r.category.objectId)}else{var n=u.default.Pointer("financeFristClass");n.set(r.category.objectId)}},methods:{inputShouldGetMoney:function(e,t){var n=Number(e.detail.value);n>r.customInOrders[t].debt?r.customInOrders[t].shouldGetMoney=r.customInOrders[t].debt:r.customInOrders[t].shouldGetMoney=e.detail.value,r.real_money=0;var o,a=(0,s.default)(r.customInOrders);try{for(a.s();!(o=a.n()).done;){var u=o.value;r.real_money+=Number(u.shouldGetMoney)}}catch(i){a.e(i)}finally{a.f()}},bindDateChange:function(e){r.nowDay=e.detail.value+" 00:00:00"},removeImg:function(e){r.Images.splice(e,1),r.Images=r.Images},upload_image:function(){r.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var t,n,o=Date.parse(new Date),a=e.tempFilePaths,i=(0,s.default)(a);try{for(i.s();!(n=i.n()).done;){var c=n.value;t=u.default.File(o+".jpg",c)}}catch(l){i.e(l)}finally{i.f()}t.save().then((function(e){var t,n=(0,s.default)(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;r.Images.push(o.url)}}catch(l){n.e(l)}finally{n.f()}}))}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(){var t=this;if(r.button_disabled=!0,""==uni.getStorageSync("custom")||void 0==uni.getStorageSync("custom"))return uni.showToast({icon:"none",title:"请选择客户"}),void(this.button_disabled=!1);if(""==uni.getStorageSync("account")||void 0==uni.getStorageSync("account"))return uni.showToast({icon:"none",title:"请选择收款账户"}),void(this.button_disabled=!1);var n=new Promise((function(t,n){var o=u.default.Query("accounts");o.get(r.account.objectId).then((function(n){n.set("money",n.money+Number(r.real_money)),n.save().then((function(n){var o=u.default.Pointer("customs"),s=o.set(r.custom.objectId),c=u.default.Pointer("accounts"),l=c.set(r.account.objectId),d=u.default.Pointer("_User"),f=d.set(a),v=uni.getStorageSync("masterId"),m=u.default.Pointer("_User"),g=m.set(v),y=u.default.Query("order_opreations");y.set("account",l),y.set("custom",s),y.set("master",f),y.set("opreater",g),y.set("real_money",Number(r.real_money)),y.set("beizhu",r.beizhu_text),y.set("customInOrders",r.customInOrders),y.set("createdTime",{__type:"Date",iso:r.nowDay}),y.set("type",-1),y.set("extra_type",5),y.set("Images",r.Images),y.save().then((function(e){i.default.log(uni.getStorageSync("user").nickName+"操作'"+r.custom.custom_name+"'客户还款￥"+r.real_money+"元",6,e.objectId),t("success")})).catch((function(t){e.log(t)}))}))}))})),o=new Promise((function(t,n){var o,a=(0,s.default)(r.customInOrders);try{for(a.s();!(o=a.n()).done;){var i=o.value,c=u.default.Query("order_opreations");c.set("id",i.objectId),c.set("debt",Number(i.debt)-Number(i.shouldGetMoney)),c.set("haveGetMoney",Number(i.haveGetMoney)+Number(i.shouldGetMoney)),c.save().then((function(n){t("success"),e.log(n)})).catch((function(t){e.log(t)}))}}catch(l){a.e(l)}finally{a.f()}}));Promise.all([n,o]).then((function(n){e.log(n),t.button_disabled=!1,uni.navigateBack({delta:1}),setTimeout((function(){uni.showToast({icon:"none",title:"收款成功"})}),1e3)})).catch((function(t){e.log(t)}))}}});t.default=c}).call(this,n("5a52")["default"])}}]);