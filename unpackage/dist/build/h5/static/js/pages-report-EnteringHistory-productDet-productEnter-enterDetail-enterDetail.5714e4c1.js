(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-report-EnteringHistory-productDet-productEnter-enterDetail-enterDetail"],{1245:function(e,t,o){"use strict";var n=o("4315"),a=o.n(n);a.a},4315:function(e,t,o){var n=o("62f0");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=o("4f06").default;a("da50b438",n,!0,{sourceMap:!1,shadowMode:!1})},"62f0":function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,".page[data-v-49cea218]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-49cea218]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%}.pro_list[data-v-49cea218]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-49cea218]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-49cea218]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-49cea218]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-49cea218]{background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset;padding:0 %?50?%}",""])},6427:function(e,t,o){"use strict";o.r(t);var n=o("8734"),a=o.n(n);for(var s in n)"default"!==s&&function(e){o.d(t,e,function(){return n[e]})}(s);t["default"]=a.a},"78eb":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[e._v("已选产品")]),o("v-uni-view",e._l(e.products,function(t,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",{staticStyle:{width:"calc(100% - 260rpx)"}},[e._v("产品："+e._s(t.goodsName))]),e.user.rights&&-1==e.othercurrent.indexOf("1")?o("v-uni-view",[e._v("期初进货价：￥0")]):o("v-uni-view",[e._v("期初进货价：￥"+e._s(t.costPrice))])],1),t.selected_model?o("v-uni-view",e._l(t.selected_model,function(t,n){return t.num>0?o("v-uni-view",{key:n,staticClass:"display_flex_bet"},[t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[e._v(e._s(t.custom1.value+t.custom2.value+t.custom3.value+t.custom4.value))]):e._e(),t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[e._v(e._s(t.num))]):e._e()],1):e._e()}),1):e._e(),e.user.rights&&"0"!=e.user.rights.othercurrent[0]?o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[e._v("实际进货价：￥0（X"+e._s(t.num)+"）")]),o("v-uni-view",[e._v("合计：￥0")])],1):o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[e._v("实际进货价：￥"+e._s(t.modify_retailPrice)+"（X"+e._s(t.num)+"）")]),o("v-uni-view",[e._v("合计：￥"+e._s(t.modify_retailPrice*t.num))])],1)],1)}),1),o("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(t){arguments[0]=t=e.$handleEvent(t),e.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[e._v("开单明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("选择仓库")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择仓库",disabled:"true",value:e.stock.stock_name}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{"margin-top":"20px",background:"#fff",padding:"10rpx"}},[o("v-uni-view",{staticClass:"notice_text"},[e._v("上传凭证图(会员可用)")]),o("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[o("v-uni-view",{staticClass:"upload_image display_flex"},[e._l(e.Images,function(t,n){return e.Images&&e.Images.length>0?o("v-uni-view",{key:n,staticStyle:{position:"relative"}},[o("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:t}}),o("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.removeImg(n)}}})],1):e._e()}),e.Images.length<3?o("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.upload_image.apply(void 0,arguments)}}},[o("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):e._e()],2)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[e.user.rights&&"0"!=e.user.rights.othercurrent[0]?o("v-uni-view",[o("v-uni-text",[e._v("合计：￥0")])],1):o("v-uni-view",[o("v-uni-text",[e._v("合计：￥"+e._s(e.real_money))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit","data-type":"2",value:"2"}},[e._v("入库")])],1)],1)],1)],1)],1)},a=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a})},8734:function(e,t,o){"use strict";(function(e){var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("795b"));o("6b54");var s=n(o("5d73"));o("c5f6");var i,r,u,c=n(o("9546")),d=n(o("7fd5")),l=n(o("a2fc")),f=(n(o("9f50")),n(o("856d")),[]),p={data:function(){return{user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),othercurrent:"",Images:[],stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,really_total_money:0,producer:null,outType:"",pickerTypes:[{desc:"自提",type:1},{desc:"快递",type:2},{desc:"物流",type:3},{desc:"送货上门",type:4}],expressNum:"",total_num:0}},onLoad:function(e){r=this,i=uni.getStorageSync("uid"),f=uni.getStorageSync("detailBills"),u=e.id,this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++){this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[t].really_total_money+this.really_total_money).toFixed(2)),this.total_num+=Number(this.products[t].num);var o=!0,n=!1,a=void 0;try{for(var c,d=(0,s.default)(f);!(o=(c=d.next()).done);o=!0){var l=c.value;l.goodsId.objectId==this.products[t].objectId&&(l.enterNum=this.products[t].num)}}catch(p){n=!0,a=p}finally{try{o||null==d.return||d.return()}finally{if(n)throw a}}}this.real_money=Number(this.all_money.toFixed(2)),r.user.rights&&r.user.rights.othercurrent&&(r.othercurrent=r.user.rights.othercurrent)},onShow:function(){r.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},methods:{scan_code:function(){this.$wechat.scanQRCode().then(function(e){r.expressNum=e.result})},removeImg:function(e){r.Images.splice(e,1),r.Images=r.Images},upload_image:function(){r.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){var t,o=Date.parse(new Date),n=e.tempFilePaths,a=!0,i=!1,u=void 0;try{for(var d,l=(0,s.default)(n);!(a=(d=l.next()).done);a=!0){var f=d.value;t=c.default.File(o+".jpg",f)}}catch(p){i=!0,u=p}finally{try{a||null==l.return||l.return()}finally{if(i)throw u}}t.save().then(function(e){var t=!0,o=!1,n=void 0;try{for(var a,i=(0,s.default)(e);!(t=(a=i.next()).done);t=!0){var u=a.value;r.Images.push(u.url)}}catch(p){o=!0,n=p}finally{try{t||null==i.return||i.return()}finally{if(o)throw n}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},select_outType:function(e){r.outType=r.pickerTypes[e.detail.value],2==r.outType.type&&3==r.outType.type||(r.expressNum="")},formSubmit:function(t){uni.getStorageSync("identity");this.button_disabled=!0;t.detail.formId;uni.showLoading({title:"上传中..."});for(var o=c.default.Pointer("stocks"),n=o.set(r.stock?r.stock.objectId:""),a=new Array,p=[],m=0;m<this.products.length;m++){var g=Number(this.products[m].reserve)+this.products[m].num,v={},_=c.default.Query("Bills"),h=c.default.Pointer("_User"),y=h.set(i),w=c.default.Pointer("Goods"),b=w.set(this.products[m].objectId),S=uni.getStorageSync("masterId"),k=c.default.Pointer("_User"),x=k.set(S);_.set("goodsName",this.products[m].goodsName),_.set("retailPrice",this.products[m].modify_retailPrice.toString()),_.set("num",Number(this.products[m].num)),_.set("total_money",this.products[m].total_money),_.set("really_total_money",this.products[m].really_total_money),_.set("goodsId",b),_.set("userId",y),_.set("opreater",x),_.set("type",1),_.set("extra_type",3),_.set("stock",n),_.set("status",!0);var I={};v.goodsName=this.products[m].goodsName,v.modify_retailPrice=this.products[m].modify_retailPrice.toString(),v.retailPrice=this.products[m].retailPrice,v.total_money=this.products[m].total_money,I.costPrice=this.products[m].costPrice,I.retailPrice=this.products[m].retailPrice,I.objectId=this.products[m].objectId,I.reserve=g,this.products[m].selectd_model&&(I.selected_model=this.products[m].selected_model,I.models=this.products[m].models),v.goodsId=I,v.num=this.products[m].num,v.type=1,a.push(_),p.push(v)}c.default.Query("Bills").saveAll(a).then(function(o){for(var a=[],m=0;m<o.length;m++)a.push(o[m].success.objectId);var g=c.default.Pointer("_User"),v=g.set(i),_=uni.getStorageSync("masterId"),h=c.default.Pointer("_User"),y=h.set(_),w=c.default.Query("order_opreations");w.set("beizhu",t.detail.value.input_beizhu),w.set("detail",p),w.set("real_num",r.total_num),w.set("type",1),w.set("extra_type",3),w.set("bills",a),w.set("opreater",y),w.set("master",v),w.set("stock",n),w.set("goodsName",r.products[0].goodsName),w.set("real_money",Number(r.real_money)),w.set("debt",r.all_money-Number(r.real_money)),r.outType&&(w.set("typeDesc",r.outType.desc),w.set("expressNum",r.expressNum)),w.set("all_money",r.all_money),w.set("Images",r.Images),w.set("status",!0),w.save().then(function(t){var o=t.objectId;uni.hideLoading(),uni.showToast({title:"产品生产入库成功",icon:"success",duration:1e3,complete:function(){var t=c.default.Query("order_opreations");t.set("id",u),t.set("detail",f),t.save().then(function(t){d.default.enterAddGoodNum(r.products).then(function(t){setTimeout(function(){d.default.log(uni.getStorageSync("user").nickName+"生产入库了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",1,o)},500),r.can_addGoods().then(function(t){if(t){var o=uni.getStorageSync("products"),n=uni.getStorageSync("warehouse"),a=!0,i=!1,u=void 0;try{for(var c,d=(0,s.default)(o);!(a=(c=d.next()).done);a=!0){var f=c.value;f.reserve=f.num,l.default.upload_good_withNoCan(f,n[0].stock).then(function(t){e.log(t),t[0]?uni.showToast({title:"添加成功",icon:"none"}):uni.showToast({title:t[1],icon:"none"})})}}catch(p){i=!0,u=p}finally{try{a||null==d.return||d.return()}finally{if(i)throw u}}r.button_disabled=!1,uni.setStorageSync("is_option",!0),uni.removeStorageSync("warehouse"),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),setTimeout(function(){uni.navigateBack({delta:2})},1e3)}else r.button_disabled=!1,uni.setStorageSync("is_option",!0),uni.removeStorageSync("warehouse"),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),setTimeout(function(){uni.navigateBack({delta:2})},1e3)})})})}})})},function(t){e.log("异常处理")})},can_addGoods:function(){return new a.default(function(t,o){var n=uni.getStorageSync("products"),a=uni.getStorageSync("warehouse");if(a){var i=!0,r=!1,u=void 0;try{for(var c,d=(0,s.default)(n);!(i=(c=d.next()).done);i=!0){var l=c.value;""==l.stocks.stock_name||void 0==l.stocks.stock_name||l.stocks.stock_name!=a[0].stock.stock_name?uni.showModal({title:"'"+l.goodsName+"'没有关联到调出仓库",content:"是否将它关联到此仓库",showCancel:!0,success:function(o){e.log(o),o.confirm&&t(!0)},fail:function(){},complete:function(){t(!1)}}):t(!1)}}catch(f){r=!0,u=f}finally{try{i||null==d.return||d.return()}finally{if(r)throw u}}}else t(!1)})}}};t.default=p}).call(this,o("5a52")["default"])},"88e2":function(e,t,o){"use strict";o.r(t);var n=o("78eb"),a=o("6427");for(var s in a)"default"!==s&&function(e){o.d(t,e,function(){return a[e]})}(s);o("1245");var i=o("f0c5"),r=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,"49cea218",null);t["default"]=r.exports},"9f50":function(e,t,o){"use strict";(function(e){var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("9546")),s={send_in:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:t.frist,data1:t.data1,data2:t.data2,remark:t.remark,url:t.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})},send_in_noconfrim:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:t.frist,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:t.remark,url:t.url,type:"in_noconfrim"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})},send_in_mini:function(t){var o={touser:uni.getStorageSync("openid"),template_id:"nqZl9FWDofCo9cxU4de45grLKh2GU-PJcAvWSbJMy9k",page:"/pages/report/EnteringHistory/detail/detail?id="+t.id,form_id:t.form_Id,data:t,emphasis_keyword:""};a.default.sendWeAppMessage(o).then(function(t){e.log(t)}).catch(function(t){e.log(t)})},send_out_mini:function(t){var o={touser:uni.getStorageSync("openid"),template_id:"BKT2_0OuWF3mLZGvFmpRzWFa_Dyr4EIppl_LFF1uRLE",page:"/pages/report/EnteringHistory/detail/detail?id="+t.id,form_id:t.form_Id,data:t,emphasis_keyword:""};a.default.sendWeAppMessage(o).then(function(t){e.log(t)}).catch(function(t){e.log(t)})},send_temp:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:"备注:"+t.remark,url:t.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})}};t.default=s}).call(this,o("5a52")["default"])},a2fc:function(e,t,o){"use strict";(function(e){var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(o("f499"));o("c5f6"),o("7514");var s=n(o("5d73")),i=n(o("795b")),r=n(o("9546")),u={delete_goods:function(t){return new i.default(function(o,n){var a=0,i=!0,u=!1,c=void 0;try{for(var d,l=(0,s.default)(t);!(i=(d=l.next()).done);i=!0){var f=d.value,p=r.default.Query("Goods");p.destroy(f.objectId).then(function(e){a+=1,a==t.length&&o(!0)}).catch(function(t){e.log(t)})}}catch(m){u=!0,c=m}finally{try{i||null==l.return||l.return()}finally{if(u)throw c}}})},upload_good_withNoCan:function(t,o){return new i.default(function(n,a){var s=uni.getStorageSync("uid"),i=r.default.Pointer("_User"),u=i.set(s),c=t.reserve,d=r.default.Pointer("stocks"),l=d.set(o.objectId),f=r.default.Query("Goods");f.equalTo("userId","==",s),f.equalTo("goodsName","==",t.goodsName),f.equalTo("stocks","==",o.objectId),f.find().then(function(o){if(e.log(o),o.length>=1)n([!1,"该商品存在此仓库中"]);else{var a=r.default.Query("Goods");if(a.set("goodsName",t.goodsName),a.set("goodsIcon",t.goodsIcon),a.set("costPrice",t.costPrice),a.set("retailPrice",t.retailPrice),a.set("reserve",Number(t.reserve)),a.set("productCode",t.productCode?t.productCode:""),a.set("stocks",l),a.set("product_info",t.product_info?t.product_info:""),a.set("producer",t.producer?t.producer:""),a.set("packingUnit",t.packingUnit?t.packingUnit:""),a.set("packageContent",t.packageContent?t.packageContent:""),a.set("warning_num",Number(t.warning_num?t.warning_num:0)),a.set("stocktype",Number(t.warning_num?t.warning_num:0)>=Number(c)?0:1),t.second_class){var s=r.default.Pointer("class_user"),i=s.set(t.goodsClass);a.set("second_class",f);var d=r.default.Pointer("second_class"),f=d.set(t.second_class);a.set("goodsClass",i)}a.set("userId",u),a.save().then(function(t){e.log(t),n([!0,t])}).catch(function(t){e.log(t)})}})})},upload_good:function(t){return new i.default(function(o,n){var a=JSON.parse(localStorage.getItem("bmob")).objectId,s=r.default.Pointer("_User"),i=s.set(a),u=r.default.Pointer("class_user"),c=u.set(t.goodsClass),d=r.default.Pointer("second_class"),l=d.set(t.second_class),f=r.default.Query("Goods");f.equalTo("userId","==",a),f.equalTo("goodsName","==",t.goodsName),f.equalTo("position","==",t.position),f.equalTo("stocks","==",t.stocks),f.find().then(function(n){if(e.log(n),n.length>=1)o([!1,n]);else{var a=t.reserve,s=r.default.Pointer("stocks"),u=s.set(t.stocks),d=r.default.Query("Goods");d.set("goodsName",t.goodsName),d.set("goodsIcon",t.goodsIcon),d.set("costPrice",t.costPrice),d.set("retailPrice",t.retailPrice),d.set("producttime",t.producttime),d.set("nousetime",t.nousetime),d.set("regNumber",t.regNumber),d.set("reserve",Number(t.reserve)),d.set("productCode",t.productCode),d.set("stocks",u),d.set("product_info",t.product_info),d.set("producer",t.producer),d.set("packingUnit",t.packingUnit),d.set("packageContent",t.packageContent),d.set("warning_num",Number(t.warning_num)),d.set("stocktype",Number(t.warning_num)>=Number(a)?0:1),d.set("second_class",l),d.set("goodsClass",c),d.set("userId",i),d.save().then(function(t){e.log(t),o([!0,t])}).catch(function(t){e.log(t)})}})})},get_fristclass:function(){var e=JSON.parse(localStorage.getItem("bmob")).objectId;return new i.default(function(t,o){var n=r.default.Query("class_user");n.equalTo("parent","==",e),n.find().then(function(e){localStorage.setItem("frist_class",(0,a.default)(e)),t(e)})})},get_secondclass:function(e){return new i.default(function(t,o){var n=r.default.Query("class_user");n.field("second",e),n.relation("second_class").then(function(e){t(e.results)})})},getstock_list:function(e){var t=JSON.parse(localStorage.getItem("bmob")).objectId;return new i.default(function(o,n){var s=r.default.Query("stocks");s.order("-num"),s.include("charge","shop"),s.equalTo("parent","==",t),e&&s.equalTo("stock_name","==",{$regex:e+".*"}),s.limit(500),s.find().then(function(e){localStorage.setItem("stocks",(0,a.default)(e)),o(e)})})}};t.default=u}).call(this,o("5a52")["default"])}}]);