(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_count-count_detail-count_detail"],{"05a7":function(e,t,o){var n=o("b73b");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=o("4f06").default;r("142f8588",n,!0,{sourceMap:!1,shadowMode:!1})},"668f":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[e._v("已选产品")]),o("v-uni-view",e._l(e.products,function(t,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[e._v("产品："+e._s(t.goodsName))])],1),t.selected_model?o("v-uni-view",e._l(t.selected_model,function(t,n){return o("v-uni-view",{key:n,staticClass:"display_flex_bet"},[t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[e._v(e._s(t.custom1.value+t.custom2.value+t.custom3.value+t.custom4.value))]):e._e(),t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[e._v("盘点后库存："+e._s(t.reserve))]):e._e()],1)}),1):o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[e._v("盘点前库存："+e._s(t.reserve))]),o("v-uni-view",[e._v("盘点后库存："+e._s(t.num))])],1)],1)}),1),o("v-uni-form",{on:{submit:function(t){t=e.$handleEvent(t),e.formSubmit(t)}}},[o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit"}},[e._v("确认盘点")])],1)],1)],1)],1)},r=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return r})},"9a54":function(e,t,o){"use strict";o.r(t);var n=o("9db1"),r=o.n(n);for(var u in n)"default"!==u&&function(e){o.d(t,e,function(){return n[e]})}(u);t["default"]=r.a},"9db1":function(e,t,o){"use strict";(function(e){var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(o("5d73"));o("c5f6"),o("6b54"),o("87b3");var u,a,s=n(o("c74b")),i=n(o("df06")),c=n(o("b410")),l={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,producer:null}},onLoad:function(){a=this,u=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products")},methods:{formSubmit:function(t){e.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var o=new Array,n=[],l=0;l<this.products.length;l++){var d=s.default.Query("Bills"),f={},v=s.default.Pointer("_User"),m=v.set(u),g=s.default.Pointer("Goods"),p=g.set(this.products[l].objectId),h=uni.getStorageSync("masterId"),y=s.default.Pointer("_User"),_=y.set(h);if(d.set("goodsName",this.products[l].goodsName),d.set("retailPrice",this.products[l].modify_retailPrice.toString()),d.set("num",Number(this.products[l].num)),d.set("reserve",this.products[l].reserve),d.set("now_reserve",this.products[l].num.toString()),d.set("total_money",this.products[l].total_money),d.set("opreater",_),d.set("goodsId",p),d.set("userId",m),d.set("type",3),a.products[l].stocks&&a.products[l].stocks.objectId){var b=s.default.Pointer("stocks"),B=b.set(a.products[l].stocks.objectId);d.set("stock",B)}var R={};this.products[l].selectd_model&&(R.selected_model=this.products[l].selected_model,R.models=this.products[l].models,f.goodsId=R),f.goodsName=this.products[l].goodsName,f.reserve=this.products[l].reserve,f.now_reserve=this.products[l].num.toString(),o.push(d),n.push(f)}s.default.Query("Bills").saveAll(o).then(function(o){var l=s.default.Pointer("_User"),d=l.set(u),f=uni.getStorageSync("masterId"),v=s.default.Pointer("_User"),m=v.set(f),g=s.default.Query("order_opreations");if(g.set("beizhu",t.detail.value.input_beizhu),g.set("detail",n),g.set("type",3),g.set("opreater",m),g.set("master",d),g.set("goodsName",a.products[0].goodsName),a.products[0].stocks&&a.products[0].stocks.objectId){var p=s.default.Pointer("stocks"),h=p.set(a.products[0].stocks.objectId);g.set("stock",h)}g.save().then(function(t){var o=t.objectId;uni.hideLoading(),uni.showToast({title:"产品盘点成功",icon:"success",success:function(){for(var n=function(t){var o=0,n=s.default.Query("Goods");n.get(a.products[t].objectId).then(function(e){if(a.products[t].selectd_model){var n=!0,u=!1,s=void 0;try{for(var i,c=(0,r.default)(a.products[t].selected_model);!(n=(i=c.next()).done);n=!0){var l=i.value;delete l.num}}catch(d){u=!0,s=d}finally{try{n||null==c.return||c.return()}finally{if(u)throw s}}e.set("models",a.products[t].selected_model),o=Number(a.products[t].num)}else o=Number(a.products[t].num);e.set("reserve",o),e.set("stocktype",o>a.products[t].warning_num?1:0),e.save()}).catch(function(t){e.log(t)})},u=0;u<a.products.length;u++)n(u);a.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),i.default.log(uni.getStorageSync("user").nickName+"盘点了'"+a.products[0].goodsName+"'等"+a.products.length+"商品",3,t.objectId),uni.getStorageSync("setting").auto_print&&c.default.autoPrint(o),uni.navigateBack({delta:2})},500)}})})},function(t){e.log("异常处理")})}}};t.default=l}).call(this,o("5a52")["default"])},"9fb9":function(e,t,o){"use strict";o.r(t);var n=o("668f"),r=o("9a54");for(var u in r)"default"!==u&&function(e){o.d(t,e,function(){return r[e]})}(u);o("f2df");var a=o("2877"),s=Object(a["a"])(r["default"],n["a"],n["b"],!1,null,"80fce38e",null);t["default"]=s.exports},b410:function(e,t,o){"use strict";(function(e){var n=o("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(o("5d73")),u=n(o("c74b")),a={autoPrint:function(t){var o=this;e.log("sssss",t);var n=u.default.Query("order_opreations");n.include("opreater","custom","producer","stock"),n.get(t).then(function(t){e.log(t),o.print_operations(t,t.detail)})},print_goodDet:function(e){var t,o=uni.getStorageSync("now_product");o.objectId=e.good_id,o.stocks=e,o.productCode=e.productCode,t="<CB>商品信息</CB><BR>",t+="--------------------------------<BR>",t+="产品名称：　　 "+o.goodsName+"<BR>",o.stocks&&(t+="存放仓库：　　 "+o.stocks.stock_name+"<BR>"),o.position&&(t+="货架位置：　　 "+o.position+"<BR>"),o.producttime&&(t+="生产日期：　　 "+o.producttime+"<BR>"),o.nousetime&&(t+="失效日期：　　 "+o.nousetime+"<BR>"),t+="当前库存：　　 "+o.reserve+"<BR>",t+="产品规格:　　　"+o.packageContent+"*"+o.packingUnit+"<BR>",t+="进货价格:      "+o.costPrice+"<BR>",t+="零售价格:      "+o.retailPrice+"<BR>",o.bad_num&&(t+="货损数量:      "+o.bad_num+"<BR>"),t+="--------------------------------<BR>",t+="产品二维码：<BR>",t+="<QR>"+o.productCode+"</QR>",this.print_by_code(t)},print_operations:function(t,o){if(e.log(t),3==t.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var n=0;n<o.length;n++)v+="产品名称："+o[n].goodsName+"<BR>",v+="盘点前库存："+o[n].reserve+"<BR>",v+="盘点后库存："+o[n].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==t.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var u=0;u<o.length;u++){v+="产品名称："+o[u].goodsName+"<BR>",v+="调拨数量："+o[u].num+"<BR>",v+="--------------------------------<BR>";var a=!0,s=!1,i=void 0;try{for(var c,l=(0,r.default)(t.detail);!(a=(c=l.next()).done);a=!0){var d=c.value;v+="调出仓库："+d.stock+"<BR>",v+="<RIGHT>当前库存："+(d.reserve-d.num)+"</RIGHT><BR>",v+="调入仓库："+d.out_stock+"<BR>",v+="<RIGHT>当前库存："+(d.out_reserve+d.num)+"</RIGHT><BR>"}}catch(g){s=!0,i=g}finally{try{a||null==l.return||l.return()}finally{if(s)throw i}}}v+="--------------------------------<BR>"}else if(2==t.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var f=0;f<o.length;f++)v+="产品名称："+o[f].goodsName+"<BR>",v+="零售价："+o[f].retailPrice+"<BR>",v+="数量    ：X"+o[f].num+"<BR>",v+="<RIGHT>总计："+o[f].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=t.custom?v+="客户姓名："+t.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==t.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var m=0;m<o.length;m++)v+="产品名称："+o[m].goodsName+"<BR>",v+="实际单价："+o[m].retailPrice+"<BR>",v+="数量    ：X"+o[m].num+"<BR>",v+="<RIGHT>总计："+o[m].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==t.type&&(v+="开单明细：<BR>",v+="<BR>",null!=t.producer&&(v+="供货商姓名："+t.producer.producer_name+"<BR>"),null==t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款："+t.debt+"<BR>"),v+="--------------------------------<BR>"),-1==t.type&&(v+="开单明细：<BR>",v+="<BR>",t.custom&&(v+="客户姓名："+t.custom.custom_name+"<BR>"),t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款  ："+t.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+t.opreater.nickName+"<BR>",v+="备注："+t.beizhu+"<BR>",v+="操作时间："+t.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(t){var o=uni.getStorageSync("setting").USER,n=uni.getStorageSync("setting").UKEY,r=uni.getStorageSync("setting").number,u="api.feieyun.cn",a="/Api/Open/",s=(new Date).getTime(),i=l(o+n+s);y(r,t,1);var c=0;function l(e){return h(d(p(e)))}function d(e){for(var t=e,o=Array(80),n=1732584193,r=-271733879,u=-1732584194,a=271733878,s=-1009589776,i=0;i<t.length;i+=16){for(var c=n,l=r,d=u,p=a,h=s,y=0;y<80;y++){o[y]=y<16?t[i+y]:g(o[y-3]^o[y-8]^o[y-14]^o[y-16],1);var _=m(m(g(n,5),f(y,r,u,a)),m(m(s,o[y]),v(y)));s=a,a=u,u=g(r,30),r=n,n=_}n=m(n,c),r=m(r,l),u=m(u,d),a=m(a,p),s=m(s,h)}return new Array(n,r,u,a,s)}function f(e,t,o,n){return e<20?t&o|~t&n:e<40?t^o^n:e<60?t&o|t&n|o&n:t^o^n}function v(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function m(e,t){var o=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(o>>16);return n<<16|65535&o}function g(e,t){return e<<t|e>>>32-t}function p(e){for(var t=1+(e.length+8>>6),o=new Array(16*t),n=0;n<16*t;n++)o[n]=0;for(n=0;n<e.length;n++)o[n>>2]|=e.charCodeAt(n)<<24-8*(3&n);return o[n>>2]|=128<<24-8*(3&n),o[16*t-1]=8*e.length,o}function h(e){for(var t=c?"0123456789ABCDEF":"0123456789abcdef",o="",n=0;n<4*e.length;n++)o+=t.charAt(e[n>>2]>>8*(3-n%4)+4&15)+t.charAt(e[n>>2]>>8*(3-n%4)&15);return o}function y(t,n,r){uni.request({url:"https://"+u+a,data:{user:o,stime:s,sig:i,apiname:"Open_printMsg",sn:t,content:n,times:r},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t.data),0!=t.data.ret?uni.showToast({icon:"none",title:t.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};t.default=a}).call(this,o("5a52")["default"])},b73b:function(e,t,o){t=e.exports=o("2350")(!1),t.push([e.i,".page[data-v-80fce38e]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-80fce38e]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-80fce38e]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-80fce38e]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-80fce38e]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-80fce38e]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},df06:function(e,t,o){"use strict";(function(t){var n=o("288e");o("6b54"),o("87b3"),o("7514");var r=n(o("5d73"));o("c5f6");var u=n(o("795b")),a=n(o("c74b"));e.exports={enterAddGoodNum:function(e){return new u.default(function(o,n){for(var u=function(n){var u=0,s=a.default.Query("Goods");s.get(e[n].objectId).then(function(a){if(t.log(e[n]),e[n].selectd_model){var s=!0,i=!1,c=void 0;try{for(var l,d=(0,r.default)(e[n].selected_model);!(s=(l=d.next()).done);s=!0){var f=l.value,v=!0,m=!1,g=void 0;try{for(var p,h=(0,r.default)(e[n].models);!(v=(p=h.next()).done);v=!0){var y=p.value;y.id==f.id&&(y.reserve=Number(y.reserve)+Number(f.num)),delete y.num}}catch(_){m=!0,g=_}finally{try{v||null==h.return||h.return()}finally{if(m)throw g}}}}catch(_){i=!0,c=_}finally{try{s||null==d.return||d.return()}finally{if(i)throw c}}u=Number(e[n].reserve)+Number(e[n].num),a.set("models",e[n].models)}else u=Number(e[n].reserve)+Number(e[n].num);a.set("reserve",u),a.set("stocktype",u>e[n].warning_num?1:0),a.save(),n==e.length-1&&o(!0)}).catch(function(e){t.log(e)})},s=0;s<e.length;s++)u(s)})},outRedGoodNum:function(e){var o=this;return new u.default(function(n,u){for(var s=function(u){var s=0,i=a.default.Query("Goods");i.get(e[u].objectId).then(function(t){if(e[u].selectd_model){var a=!0,i=!1,c=void 0;try{for(var l,d=(0,r.default)(e[u].selected_model);!(a=(l=d.next()).done);a=!0){var f=l.value,v=!0,m=!1,g=void 0;try{for(var p,h=(0,r.default)(e[u].models);!(v=(p=h.next()).done);v=!0){var y=p.value;s+=Number(y.reserve),y.id==f.id&&(y.reserve=Number(y.reserve)-Number(f.num)),delete y.num}}catch(_){m=!0,g=_}finally{try{v||null==h.return||h.return()}finally{if(m)throw g}}}}catch(_){i=!0,c=_}finally{try{a||null==d.return||d.return()}finally{if(i)throw c}}s=Number(e[u].reserve)-Number(e[u].num),t.set("models",e[u].models)}else s=Number(e[u].reserve)-Number(e[u].num);t.set("reserve",s),t.set("stocktype",s>=e[u].warning_num?1:0),t.save(),e[u].warning_num>=s&&o.log(e[u].goodsName+"出库了"+e[u].num+"件，已经低于预警数量"+e[u].warning_num,-2,e[u].objectId),o.record_staffOut(Number(e[u].num)),u==e.length-1&&n(!0)}).catch(function(e){t.log(e)})},i=0;i<e.length;i++)s(i)})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,o,n){var r=a.default.Pointer("_User"),u=r.set(uni.getStorageSync("uid")),s=a.default.Query("logs");s.set("parent",u),s.set("log",e),s.set("detail_id",n),s.set("type",o),s.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_shopOut:function(e,o){t.log(e,o);var n=a.default.Query("shops");n.set("id",e),n.set("have_out",o),n.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var o=a.default.Query("staffs");o.set("id",uni.getStorageSync("user").objectId),o.set("have_out",Number(e)+uni.getStorageSync("user").have_out),o.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var o=a.default.Query("Goods");o.equalTo("userId","==",e),o.find().then(function(e){t.log(e);var o=!0,n=!1,u=void 0;try{for(var a,s=(0,r.default)(e);!(o=(a=s.next()).done);o=!0){var i=a.value;t.log(i),Number(i.costPrice)*i.reserve,i.reserve}}catch(c){n=!0,u=c}finally{try{o||null==s.return||s.return()}finally{if(n)throw u}}})},getDay:function(e,t){var o=this,n=new Date,r=n.getTime()+864e5*e;n.setTime(r);var u=n.getFullYear(),a=n.getMonth(),s=n.getDate();return a=o.handleMonth(a+1),s=o.handleMonth(s),t?u+"-"+a+"-"+s+" 00:00:00":u+"-"+a+"-"+s},js_date_time:function(e,t){var o=new Date(e),n=o.getFullYear(),r=o.getMonth()+1;r=r<10?"0"+r:r;var u=o.getDate();u=u<10?"0"+u:u;var a=o.getHours();a=a<10?"0"+a:a;var s=o.getMinutes(),i=o.getSeconds();return s=s<10?"0"+s:s,i=i<10?"0"+i:i,t?n+"-"+r+"-"+u+" "+a+":"+s:n+"-"+r+"-"+u},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,o("5a52")["default"])},f2df:function(e,t,o){"use strict";var n=o("05a7"),r=o.n(n);r.a}}]);