(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-commonNew-good_count-count_detail-count_detail"],{1288:function(t,e,o){"use strict";var i,s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0",color:"#3D3D3D","font-weight":"bold"}},[t._v("已选产品")]),o("v-uni-view",t._l(t.products,(function(e,i){return o("v-uni-view",{key:i,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#333"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),e.stocks?o("v-uni-view",[t._v("盘点仓库："+t._s(e.stocks.stock_name))]):t._e()],1),e.selected_model?o("v-uni-view",t._l(e.selected_model,(function(e,i){return o("v-uni-view",{key:i,staticClass:"display_flex_bet"},[e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[t._v(t._s(e.custom1.value+e.custom2.value+e.custom3.value+e.custom4.value))]):t._e(),e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[t._v("盘点后库存："+t._s(e.reserve))]):t._e()],1)})),1):o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("盘点前库存："+t._s(e.reserve))]),o("v-uni-view",[t._v("盘点后库存："+t._s(e.num))])],1)],1)})),1),o("v-uni-form",{on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 20rpx",color:"#3D3D3D","font-weight":"bold"}},[t._v("盘点明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[o("v-uni-view",{staticClass:"left_content",staticStyle:{width:"150rpx"}},[t._v("盘点仓库"),o("v-uni-text",{staticStyle:{color:"#f30"}},[t._v("*")])],1),o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"请选择要盘点的仓库",disabled:"true",value:t.stock.stock_name}}),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("盘点时间")]),o("v-uni-picker",{attrs:{mode:"date",value:t.nowDay,end:t.nowDay},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindDateChange2.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.nowDay.split(" ")[0]))]),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("备注")]),o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-view",[t._v("总数："+t._s(t.total_num))]),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("盘点")])],1)],1)],1)],1)],1)},n=[];o.d(e,"b",(function(){return s})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){return i}))},1450:function(t,e,o){var i=o("3b12");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=o("4f06").default;s("74c205ef",i,!0,{sourceMap:!1,shadowMode:!1})},2786:function(t,e,o){"use strict";o.r(e);var i=o("bd08"),s=o.n(i);for(var n in i)"default"!==n&&function(t){o.d(e,t,(function(){return i[t]}))}(n);e["default"]=s.a},"3b12":function(t,e,o){var i=o("24fb");e=i(!1),e.push([t.i,".page[data-v-6840f92e]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-6840f92e]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%;font-weight:700}.pro_list[data-v-6840f92e]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-6840f92e]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-6840f92e]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-6840f92e]{text-align:right;width:calc(100% - %?40?%);background-color:#fff;padding:%?10?% 0;max-height:%?100?%}.confrim_button[data-v-6840f92e]{background:#aa2116;color:#fff;border-radius:unset;font-weight:700;font-size:%?32?%}",""]),t.exports=e},"7b76":function(t,e,o){"use strict";var i=o("1450"),s=o.n(i);s.a},bd08:function(t,e,o){"use strict";(function(t){var i=o("ee27");o("7db0"),o("a15b"),o("a9e3"),o("d3b7"),o("25f0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s,n,a=i(o("54f8")),r=i(o("9546")),u=i(o("7fd5")),c=i(o("856d")),d={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,total_num:0,producer:null,stock:{},nowDay:u.default.getDay(0,!0)}},onLoad:function(){n=this,s=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.total_num+=Number(this.products[t].num)},onShow:function(){n.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},methods:{bindDateChange:function(t){n.nowDay=t.detail.value+" 00:00:00"},formSubmit:function(e){if(t.log(e),this.button_disabled=!0,uni.showLoading({title:"上传中..."}),null==n.stock||""==n.stock||void 0==n.stock)return uni.showToast({icon:"none",title:"请选择盘点仓库"}),uni.hideLoading(),void(this.button_disabled=!1);for(var o=new Array,i=[],d=[],l=[],v=0;v<this.products.length;v++){l.push(this.products[v].goodsName);var f=r.default.Query("Bills"),p={},g=r.default.Pointer("_User"),h=g.set(s),_=r.default.Pointer("Goods"),m=_.set(this.products[v].header?this.products[v].header.objectId:this.products[v].objectId),b=uni.getStorageSync("masterId"),y=r.default.Pointer("_User"),w=y.set(b);if(f.set("goodsName",this.products[v].goodsName),f.set("retailPrice",this.products[v].modify_retailPrice.toString()),f.set("num",Number(this.products[v].num)),f.set("reserve",Number(this.products[v].reserve)),f.set("now_reserve",this.products[v].num),f.set("total_money",this.products[v].total_money),f.set("opreater",w),f.set("goodsId",m),f.set("userId",h),f.set("type",3),f.set("createdTime",{__type:"Date",iso:n.nowDay}),n.stock&&n.stock.objectId){var S=r.default.Pointer("stocks"),k=S.set(n.stock.objectId);f.set("stock",k),d.push(n.stock.objectId),p.stock=n.stock.stock_name}var x={};this.products[v].selectd_model&&(x.selected_model=this.products[v].selected_model,x.models=this.products[v].models,p.goodsId=x),p.goodsName=this.products[v].goodsName,p.reserve=this.products[v].reserve,p.now_reserve=this.products[v].num.toString(),p.packingUnit=this.products[v].packingUnit,o.push(f),i.push(p)}r.default.Query("Bills").saveAll(o).then((function(o){var v=r.default.Pointer("_User"),f=v.set(s),p=uni.getStorageSync("masterId"),g=r.default.Pointer("_User"),h=g.set(p),_=r.default.Query("order_opreations");_.set("beizhu",e.detail.value.input_beizhu),_.set("detail",i),_.set("type",3),_.set("opreater",h),_.set("master",f),_.set("goodsName",l.join(",")),_.set("stockIds",d),_.set("createdTime",{__type:"Date",iso:n.nowDay}),_.save().then((function(e){var o=e.objectId;uni.hideLoading(),uni.showToast({title:"产品盘点成功",icon:"success",success:function(){for(var e=function(e){var i=0,s=r.default.Query("Goods");s.equalTo("header","==",n.products[e].objectId),s.equalTo("stocks","==",n.stock.objectId),s.find().then((function(r){if(0==r.length)u.default.upload_good_withNoCan(n.products[e],n.stock,Number(n.products[e].num)).then((function(t){s.equalTo("header","==",n.products[e].objectId),s.equalTo("order","==",1),s.statTo("sum","reserve"),s.find().then((function(t){var i=t[0]._sumReserve;s.set("id",n.products[e].objectId),s.set("reserve",i),s.save().then((function(t){u.default.modifyStockType(n.products[e].objectId),n.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout((function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),u.default.log(uni.getStorageSync("user").nickName+"盘点了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",3,o),uni.getStorageSync("setting").auto_print&&c.default.autoPrint(o),uni.navigateBack({delta:2})}),500)}))}))}));else{var d=r[0];if(s.set("id",d.objectId),n.products[e].selectd_model){var l,v=(0,a.default)(n.products[e].selected_model);try{for(v.s();!(l=v.n()).done;){var f=l.value;delete f.num}}catch(p){v.e(p)}finally{v.f()}s.set("models",n.products[e].selected_model),i=Number(n.products[e].num)}else i=Number(n.products[e].num);s.set("reserve",i),s.save().then((function(t){s.equalTo("header","==",n.products[e].objectId),s.equalTo("order","==",1),s.statTo("sum","reserve"),s.find().then((function(t){var i=t[0]._sumReserve;s.get(n.products[e].objectId).then((function(t){t.set("reserve",i),t.save(),u.default.modifyStockType(n.products[e].objectId),n.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout((function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),u.default.log(uni.getStorageSync("user").nickName+"盘点了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",3,t.objectId),uni.getStorageSync("setting").auto_print&&c.default.autoPrint(o),uni.navigateBack({delta:2})}),500)}))}))})).catch((function(e){t.log(e)}))}}))},i=0;i<n.products.length;i++)e(i)}})}))}),(function(e){t.log("异常处理")}))}}};e.default=d}).call(this,o("5a52")["default"])},f2ee:function(t,e,o){"use strict";o.r(e);var i=o("1288"),s=o("2786");for(var n in s)"default"!==n&&function(t){o.d(e,t,(function(){return s[t]}))}(n);o("7b76");var a,r=o("f0c5"),u=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"6840f92e",null,!1,i["a"],a);e["default"]=u.exports}}]);