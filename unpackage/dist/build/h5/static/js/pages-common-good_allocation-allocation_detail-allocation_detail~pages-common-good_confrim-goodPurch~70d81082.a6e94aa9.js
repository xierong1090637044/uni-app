(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_allocation-allocation_detail-allocation_detail~pages-common-good_confrim-goodPurch~70d81082"],{"7fd5":function(e,t,r){"use strict";(function(t){var o=r("288e");r("6b54"),r("7514");var n=o(r("5d73"));r("c5f6");var u=o(r("795b")),a=o(r("9546"));e.exports={enterAddGoodNum:function(e){var r=this;return new u.default(function(o,u){for(var l=function(u){var l=0,d=a.default.Query("Goods");d.get(e[u].objectId).then(function(s){var i=s;if(e[u].selectd_model){var c=!0,f=!1,v=void 0;try{for(var m,g=(0,n.default)(e[u].selected_model);!(c=(m=g.next()).done);c=!0){var h=m.value,y=!0,_=!1,R=void 0;try{for(var B,b=(0,n.default)(i.models);!(y=(B=b.next()).done);y=!0){var p=B.value;p.id==h.id&&(p.reserve=Number(p.reserve)+Number(h.num)),delete p.num}}catch(N){_=!0,R=N}finally{try{y||null==b.return||b.return()}finally{if(_)throw R}}}}catch(N){f=!0,v=N}finally{try{c||null==g.return||g.return()}finally{if(f)throw v}}l=Number(i.reserve)+Number(e[u].num),d.set("models",i.models)}else l=Number(i.reserve)+Number(e[u].num);d.set("reserve",l),d.set("id",e[u].objectId),d.save().then(function(n){if(e[u].header){var l=a.default.Query("Goods");l.equalTo("header","==",e[u].header.objectId),l.equalTo("order","==",1),l.statTo("sum","reserve"),l.find().then(function(n){t.log("dasds",n);var l=n[0]._sumReserve,d=a.default.Query("Goods");d.set("reserve",l),d.set("id",e[u].header.objectId),d.save().then(function(t){r.modifyStockType(e[u].header.objectId),u==e.length-1&&o(!0)})})}else r.modifyStockType(e[u].objectId),u==e.length-1&&o(!0)}).catch(function(e){t.log(e)})})},d=0;d<e.length;d++)l(d)})},outRedGoodNum:function(e){var r=this;return new u.default(function(o,u){for(var l=function(u){var l=0,d=a.default.Query("Goods");d.get(e[u].objectId).then(function(s){var i=s;if(e[u].selectd_model){var c=!0,f=!1,v=void 0;try{for(var m,g=(0,n.default)(e[u].selected_model);!(c=(m=g.next()).done);c=!0){var h=m.value,y=!0,_=!1,R=void 0;try{for(var B,b=(0,n.default)(i.models);!(y=(B=b.next()).done);y=!0){var p=B.value;l+=Number(p.reserve),p.id==h.id&&(p.reserve=Number(p.reserve)-Number(h.num)),delete p.num}}catch(N){_=!0,R=N}finally{try{y||null==b.return||b.return()}finally{if(_)throw R}}}}catch(N){f=!0,v=N}finally{try{c||null==g.return||g.return()}finally{if(f)throw v}}l=Number(i.reserve)-Number(e[u].num),d.set("models",i.models)}else l=Number(i.reserve)-Number(e[u].num);d.set("reserve",l),d.set("id",e[u].objectId),d.save().then(function(t){if(e[u].header){var n=a.default.Query("Goods");n.equalTo("header","==",e[u].header.objectId),n.equalTo("order","==",1),n.statTo("sum","reserve"),n.find().then(function(t){var n=t[0]._sumReserve,l=a.default.Query("Goods");l.set("reserve",n),l.set("id",e[u].header.objectId),l.save().then(function(t){r.modifyStockType(e[u].header.objectId),u==e.length-1&&o(!0)})})}else r.modifyStockType(e[u].objectId),u==e.length-1&&o(!0)}).catch(function(e){t.log(e)})})},d=0;d<e.length;d++)l(d)})},enterAddGoodNumNew:function(e){var r=this;return new u.default(function(o,u){for(var l=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",d=uni.getStorageSync("uid"),s=function(u){var s=0,i=a.default.Query("Goods");i.get(e[u].objectId).then(function(i){if(e[u].selectd_model){var c=!0,f=!1,v=void 0;try{for(var m,g=(0,n.default)(e[u].selected_model);!(c=(m=g.next()).done);c=!0){var h=m.value,y=!0,_=!1,R=void 0;try{for(var B,b=(0,n.default)(e[u].models);!(y=(B=b.next()).done);y=!0){var p=B.value;p.id==h.id&&(p.reserve=Number(p.reserve)+Number(h.num)),delete p.num}}catch(I){_=!0,R=I}finally{try{y||null==b.return||b.return()}finally{if(_)throw R}}}}catch(I){f=!0,v=I}finally{try{c||null==g.return||g.return()}finally{if(f)throw v}}s=Number(e[u].reserve)+Number(e[u].num),i.set("models",e[u].models)}else s=Number(e[u].reserve)+Number(e[u].num);i.set("reserve",s),i.save();var N=a.default.Query("Goods");N.equalTo("userId","==",d),N.equalTo("header","==",e[u].objectId),N.equalTo("stocks","==",l.objectId),N.find().then(function(n){if(0==n.length)r.upload_good_withNoCan(e[u],l,Number(e[u].num)).then(function(r){t.log(r),u==e.length-1&&o(!0)});else{var d=a.default.Query("Goods");d.set("id",n[0].objectId),d.set("reserve",n[0].reserve+Number(e[u].num)),d.save().then(function(r){t.log(r),u==e.length-1&&o(!0)}).catch(function(e){t.log(e)})}})}).catch(function(e){t.log(e)})},i=0;i<e.length;i++)s(i)})},outRedGoodNumNew:function(e){var r=this;return new u.default(function(o,u){for(var l=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",d=uni.getStorageSync("uid"),s=function(u){var s=0,i=a.default.Query("Goods");i.get(e[u].objectId).then(function(i){if(e[u].selectd_model){var c=!0,f=!1,v=void 0;try{for(var m,g=(0,n.default)(e[u].selected_model);!(c=(m=g.next()).done);c=!0){var h=m.value,y=!0,_=!1,R=void 0;try{for(var B,b=(0,n.default)(e[u].models);!(y=(B=b.next()).done);y=!0){var p=B.value;p.id==h.id&&(p.reserve=Number(p.reserve)-Number(h.num)),delete p.num}}catch(I){_=!0,R=I}finally{try{y||null==b.return||b.return()}finally{if(_)throw R}}}}catch(I){f=!0,v=I}finally{try{c||null==g.return||g.return()}finally{if(f)throw v}}s=Number(e[u].reserve)-Number(e[u].num),i.set("models",e[u].models)}else s=Number(e[u].reserve)-Number(e[u].num);i.set("reserve",s),i.save();var N=a.default.Query("Goods");N.equalTo("userId","==",d),N.equalTo("header","==",e[u].objectId),N.equalTo("stocks","==",l.objectId),N.find().then(function(n){if(0==n.length)r.upload_good_withNoCan(e[u],l,Number(e[u].num),"out").then(function(r){t.log(r),u==e.length-1&&o(!0)});else{var d=a.default.Query("Goods");d.set("id",n[0].objectId),d.set("reserve",n[0].reserve-Number(e[u].num)),d.save().then(function(r){t.log(r),u==e.length-1&&o(!0)}).catch(function(e){t.log(e)})}})}).catch(function(e){t.log(e)})},i=0;i<e.length;i++)s(i)})},upload_good_withNoCan:function(e,r,o,l){return new u.default(function(u,d){t.log(e);var s=uni.getStorageSync("uid"),i=a.default.Pointer("_User"),c=i.set(s),f=a.default.Pointer("stocks"),v=f.set(r.objectId),m=a.default.Pointer("Goods"),g="";g=e.header?m.set(e.header.objectId):m.set(e.objectId);var h=a.default.Query("Goods");if(h.set("goodsName",e.goodsName),h.set("goodsIcon",e.goodsIcon),"out"==l){if(h.set("reserve",0-Number(o)),e.goodsId&&e.goodsId.models){var y=!0,_=!1,R=void 0;try{for(var B,b=(0,n.default)(e.goodsId.models);!(y=(B=b.next()).done);y=!0){var p=B.value;p.reserve=0-Number(p.num)}}catch(q){_=!0,R=q}finally{try{y||null==b.return||b.return()}finally{if(_)throw R}}h.set("models",e.goodsId.models)}}else if("allocation"==l){if(h.set("reserve",Number(o)),e.selected_model&&e.selected_model.length>0){var N=!0,I=!1,S=void 0;try{for(var w,T=(0,n.default)(e.selected_model);!(N=(w=T.next()).done);N=!0){var G=w.value;G.reserve=Number(G.num),delete G.num}}catch(q){I=!0,S=q}finally{try{N||null==T.return||T.return()}finally{if(I)throw S}}h.set("models",e.selected_model)}}else if(h.set("reserve",Number(o)),e.goodsId&&e.goodsId.models){var k=!0,j=!1,x=void 0;try{for(var Q,C=(0,n.default)(e.goodsId.models);!(k=(Q=C.next()).done);k=!0){var P=Q.value;P.reserve=Number(P.num)}}catch(q){j=!0,x=q}finally{try{k||null==C.return||C.return()}finally{if(j)throw x}}h.set("models",e.goodsId.models)}h.set("stocks",v),h.set("userId",c),h.set("header",g),h.set("costPrice",""+e.costPrice),h.set("retailPrice",""+e.retailPrice),h.set("order",1),h.save().then(function(e){t.log(e),u([!0,e])}).catch(function(e){t.log(e)})})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,r,o){var n=a.default.Pointer("_User"),u=n.set(uni.getStorageSync("uid"));if(-2==r){var l=a.default.Pointer("Goods"),d=l.set(o),s=a.default.Query("logs");s.equalTo("goodId","==",o),s.find().then(function(o){if(0==o.length){var n=a.default.Query("logs");n.set("parent",u),n.set("goodId",d),n.set("log",e),n.set("type",r),n.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}})}else{var i=a.default.Query("logs");i.set("parent",u),i.set("log",e),i.set("detail_id",o),i.set("type",r),i.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},modifyStockType:function(e){var r=this,o=a.default.Query("Goods");o.get(e).then(function(e){var t=e;""==t.warning_num&&""==t.max_num?e.set("stocktype",1):void 0==t.warning_num&&void 0==t.max_num?e.set("stocktype",1):null==t.warning_num&&null==t.max_num?e.set("stocktype",1):(""!=t.warning_num&&(t.warning_num>=t.reserve?(e.set("stocktype",0),r.log(t.goodsName+"已经超过设置的最小库存值"+t.warning_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1)),""!=t.max_num&&(t.max_num<=t.reserve?(e.set("stocktype",2),r.log(t.goodsName+"已经超过设置的最大库存值"+t.max_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1))),e.save()}).catch(function(e){t.log(e)})},record_shopOut:function(e,r){t.log(e,r);var o=a.default.Query("shops");o.set("id",e),o.set("have_out",r),o.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var r=a.default.Query("_User");r.set("id",uni.getStorageSync("user").objectId),r.set("have_out",Number(e)+uni.getStorageSync("user").have_out),r.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var r=a.default.Query("Goods");r.equalTo("userId","==",e),r.find().then(function(e){t.log(e);var r=!0,o=!1,u=void 0;try{for(var a,l=(0,n.default)(e);!(r=(a=l.next()).done);r=!0){var d=a.value;t.log(d),Number(d.costPrice)*d.reserve,d.reserve}}catch(s){o=!0,u=s}finally{try{r||null==l.return||l.return()}finally{if(o)throw u}}})},getDay:function(e,t){var r=this,o=new Date,n=o.getTime()+864e5*e;o.setTime(n);var u=o.getFullYear(),a=o.getMonth(),l=o.getDate();return a=r.handleMonth(a+1),l=r.handleMonth(l),t?u+"-"+a+"-"+l+" 00:00:00":u+"-"+a+"-"+l},js_date_time:function(e,t){var r=new Date(e),o=r.getFullYear(),n=r.getMonth()+1;n=n<10?"0"+n:n;var u=r.getDate();u=u<10?"0"+u:u;var a=r.getHours();a=a<10?"0"+a:a;var l=r.getMinutes(),d=r.getSeconds();return l=l<10?"0"+l:l,d=d<10?"0"+d:d,t?o+"-"+n+"-"+u+" "+a+":"+l:o+"-"+n+"-"+u},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,r("5a52")["default"])},"856d":function(e,t,r){"use strict";(function(e){var o=r("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("5d73")),u=o(r("9546")),a={autoPrint:function(t){var r=this;e.log("sssss",t);var o=u.default.Query("order_opreations");o.include("opreater","custom","producer","stock"),o.get(t).then(function(t){e.log(t),r.print_operations(t,t.detail)})},print_goodDet:function(e){var t,r=uni.getStorageSync("now_product");r.objectId=e.good_id,r.stocks=e,r.productCode=e.productCode,t="<CB>商品信息</CB><BR>",t+="--------------------------------<BR>",t+="产品名称：　　 "+r.goodsName+"<BR>",r.stocks&&(t+="存放仓库：　　 "+r.stocks.stock_name+"<BR>"),r.position&&(t+="货架位置：　　 "+r.position+"<BR>"),r.producttime&&(t+="生产日期：　　 "+r.producttime+"<BR>"),r.nousetime&&(t+="失效日期：　　 "+r.nousetime+"<BR>"),t+="当前库存：　　 "+r.reserve+"<BR>",t+="产品规格:　　　"+r.packageContent+"*"+r.packingUnit+"<BR>",t+="进货价格:      "+r.costPrice+"<BR>",t+="零售价格:      "+r.retailPrice+"<BR>",r.bad_num&&(t+="货损数量:      "+r.bad_num+"<BR>"),t+="--------------------------------<BR>",t+="产品二维码：<BR>",t+="<QR>"+r.productCode+"</QR>",this.print_by_code(t)},print_operations:function(t,r){if(e.log(t),3==t.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var o=0;o<r.length;o++)v+="产品名称："+r[o].goodsName+"<BR>",v+="盘点前库存："+r[o].reserve+"<BR>",v+="盘点后库存："+r[o].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==t.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var u=0;u<r.length;u++){v+="产品名称："+r[u].goodsName+"<BR>",v+="调拨数量："+r[u].num+"<BR>",v+="--------------------------------<BR>";var a=!0,l=!1,d=void 0;try{for(var s,i=(0,n.default)(t.detail);!(a=(s=i.next()).done);a=!0){var c=s.value;v+="调出仓库："+c.stock+"<BR>",v+="<RIGHT>当前库存："+(c.reserve-c.num)+"</RIGHT><BR>",v+="调入仓库："+c.out_stock+"<BR>",v+="<RIGHT>当前库存："+(c.out_reserve+c.num)+"</RIGHT><BR>"}}catch(g){l=!0,d=g}finally{try{a||null==i.return||i.return()}finally{if(l)throw d}}}v+="--------------------------------<BR>"}else if(2==t.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var f=0;f<r.length;f++)v+="产品名称："+r[f].goodsName+"<BR>",v+="零售价："+r[f].retailPrice+"<BR>",v+="数量    ：X"+r[f].num+"<BR>",v+="<RIGHT>总计："+r[f].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=t.custom?v+="客户姓名："+t.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==t.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var m=0;m<r.length;m++)v+="产品名称："+r[m].goodsName+"<BR>",v+="实际单价："+r[m].retailPrice+"<BR>",v+="数量    ：X"+r[m].num+"<BR>",v+="<RIGHT>总计："+r[m].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+t.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==t.type&&(v+="开单明细：<BR>",v+="<BR>",null!=t.producer&&(v+="供货商姓名："+t.producer.producer_name+"<BR>"),null==t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款："+t.debt+"<BR>"),v+="--------------------------------<BR>"),-1==t.type&&(v+="开单明细：<BR>",v+="<BR>",t.custom&&(v+="客户姓名："+t.custom.custom_name+"<BR>"),t.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+t.real_money+"<BR>",t.debt>0&&(v+="本次欠款  ："+t.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+t.opreater.nickName+"<BR>",v+="备注："+t.beizhu+"<BR>",v+="操作时间："+t.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(t){var r=uni.getStorageSync("setting").USER,o=uni.getStorageSync("setting").UKEY,n=uni.getStorageSync("setting").number,u="api.feieyun.cn",a="/Api/Open/",l=(new Date).getTime(),d=i(r+o+l);_(n,t,1);var s=0;function i(e){return y(c(h(e)))}function c(e){for(var t=e,r=Array(80),o=1732584193,n=-271733879,u=-1732584194,a=271733878,l=-1009589776,d=0;d<t.length;d+=16){for(var s=o,i=n,c=u,h=a,y=l,_=0;_<80;_++){r[_]=_<16?t[d+_]:g(r[_-3]^r[_-8]^r[_-14]^r[_-16],1);var R=m(m(g(o,5),f(_,n,u,a)),m(m(l,r[_]),v(_)));l=a,a=u,u=g(n,30),n=o,o=R}o=m(o,s),n=m(n,i),u=m(u,c),a=m(a,h),l=m(l,y)}return new Array(o,n,u,a,l)}function f(e,t,r,o){return e<20?t&r|~t&o:e<40?t^r^o:e<60?t&r|t&o|r&o:t^r^o}function v(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function m(e,t){var r=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(r>>16);return o<<16|65535&r}function g(e,t){return e<<t|e>>>32-t}function h(e){for(var t=1+(e.length+8>>6),r=new Array(16*t),o=0;o<16*t;o++)r[o]=0;for(o=0;o<e.length;o++)r[o>>2]|=e.charCodeAt(o)<<24-8*(3&o);return r[o>>2]|=128<<24-8*(3&o),r[16*t-1]=8*e.length,r}function y(e){for(var t=s?"0123456789ABCDEF":"0123456789abcdef",r="",o=0;o<4*e.length;o++)r+=t.charAt(e[o>>2]>>8*(3-o%4)+4&15)+t.charAt(e[o>>2]>>8*(3-o%4)&15);return r}function _(t,o,n){uni.request({url:"https://"+u+a,data:{user:r,stime:l,sig:d,apiname:"Open_printMsg",sn:t,content:o,times:n},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t.data),0!=t.data.ret?uni.showToast({icon:"none",title:t.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};t.default=a}).call(this,r("5a52")["default"])}}]);