(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-goods_out-out_detail-out_detail"],{"045b":function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,a){return o("v-uni-view",{key:a,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("实际零售价：￥"+t._s(e.modify_retailPrice)+"（X"+t._s(e.num)+"）")]),o("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),o("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细（用于记录是否有无欠款）")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("选择仓库")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择仓库",disabled:"true",value:t.stock.stock_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("选择门店")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择门店",disabled:"true",value:t.shop_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("客户姓名")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1),o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("发货方式")]),o("v-uni-picker",{staticClass:"kaidan_rightinput",attrs:{range:t.pickerTypes,"range-key":"desc"},on:{change:function(e){e=t.$handleEvent(e),t.select_outType(e)}}},[o("v-uni-input",{attrs:{placeholder:"请选择发货方式",disabled:"true"},model:{value:t.outType.desc,callback:function(e){t.$set(t.outType,"desc",e)},expression:"outType.desc"}})],1)],1),2==t.outType.type||3==t.outType.type?o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("快递单号")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex",attrs:{range:t.pickerTypes,"range-key":"desc"},on:{change:function(e){e=t.$handleEvent(e),t.select_outType(e)}}},[o("v-uni-input",{attrs:{placeholder:"请输入快递单号"},model:{value:t.expressNum,callback:function(e){t.expressNum=e},expression:"expressNum"}}),o("fa-icon",{attrs:{type:"clone",size:"16",color:"#426ab3"},on:{click:function(e){e=t.$handleEvent(e),t.scan_code(e)}}})],1)],1):t._e(),t.custom.discount?o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("折扣率")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex"},[o("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入折扣率",value:t.discount,type:"number"},on:{input:function(e){e=t.$handleEvent(e),t.getDiscount(e)}}}),t._v("%")],1)],1):t._e(),o("v-uni-view",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("实际付款")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入实际付款金额",type:"digit"},model:{value:t.real_money,callback:function(e){t.real_money=e},expression:"real_money"}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu",fixed:"true"}})],1),o("v-uni-view",{staticStyle:{"margin-top":"20px",background:"#fff",padding:"10rpx"}},[o("v-uni-view",{staticClass:"notice_text"},[t._v("上传凭证图(会员可用)")]),o("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[o("v-uni-view",{staticClass:"upload_image display_flex"},[t._l(t.Images,function(e,a){return t.Images&&t.Images.length>0?o("v-uni-view",{key:a,staticStyle:{position:"relative"}},[o("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:e}}),o("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(e){e=t.$handleEvent(e),t.removeImg(a)}}})],1):t._e()}),t.Images.length<3?o("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(e){e=t.$handleEvent(e),t.upload_image(e)}}},[o("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):t._e()],2)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx"}},[o("v-uni-view",[o("v-uni-text",[t._v("合计：￥"+t._s(t.all_money))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit","data-type":"2"}},[t._v("出库")])],1)],1)],1)],1)],1)},n=[];o.d(e,"a",function(){return a}),o.d(e,"b",function(){return n})},"11ea":function(t,e,o){"use strict";var a=o("d9fd"),n=o.n(a);n.a},"2df3":function(t,e,o){"use strict";(function(t){var a=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(o("5d73")),i=a(o("906f")),r={autoPrint:function(e){var o=this;t.log("sssss",e);var a=i.default.Query("order_opreations");a.include("opreater","custom","producer","stock"),a.get(e).then(function(e){t.log(e),o.print_operations(e,e.detail)})},print_goodDet:function(t){var e,o=uni.getStorageSync("now_product");o.objectId=t.good_id,o.stocks=t,o.productCode=t.productCode,e="<CB>商品信息</CB><BR>",e+="--------------------------------<BR>",e+="产品名称：　　 "+o.goodsName+"<BR>",o.stocks&&(e+="存放仓库：　　 "+o.stocks.stock_name+"<BR>"),o.position&&(e+="货架位置：　　 "+o.position+"<BR>"),o.producttime&&(e+="生产日期：　　 "+o.producttime+"<BR>"),o.nousetime&&(e+="失效日期：　　 "+o.nousetime+"<BR>"),e+="当前库存：　　 "+o.reserve+"<BR>",e+="产品规格:　　　"+o.packageContent+"*"+o.packingUnit+"<BR>",e+="进货价格:      "+o.costPrice+"<BR>",e+="零售价格:      "+o.retailPrice+"<BR>",o.bad_num&&(e+="货损数量:      "+o.bad_num+"<BR>"),e+="--------------------------------<BR>",e+="产品二维码：<BR>",e+="<QR>"+o.productCode+"</QR>",this.print_by_code(e)},print_operations:function(e,o){if(t.log(e),3==e.type){v="<CB>盘点单</CB><BR>",v+="--------------------------------<BR>";for(var a=0;a<o.length;a++)v+="产品名称："+o[a].goodsName+"<BR>",v+="盘点前库存："+o[a].reserve+"<BR>",v+="盘点后库存："+o[a].now_reserve+"<BR>",v+="--------------------------------<BR>"}else if(-2==e.type){v="<CB>调拨单</CB><BR>",v+="--------------------------------<BR>";for(var i=0;i<o.length;i++){v+="产品名称："+o[i].goodsName+"<BR>",v+="调拨数量："+o[i].num+"<BR>",v+="--------------------------------<BR>";var r=!0,s=!1,u=void 0;try{for(var c,l=(0,n.default)(e.detail);!(r=(c=l.next()).done);r=!0){var d=c.value;v+="调出仓库："+d.stock+"<BR>",v+="<RIGHT>当前库存："+(d.reserve-d.num)+"</RIGHT><BR>",v+="调入仓库："+d.out_stock+"<BR>",v+="<RIGHT>当前库存："+(d.out_reserve+d.num)+"</RIGHT><BR>"}}catch(f){s=!0,u=f}finally{try{r||null==l.return||l.return()}finally{if(s)throw u}}}v+="--------------------------------<BR>"}else if(2==e.type){v="<CB>退货单</CB><BR>",v+="--------------------------------<BR>";for(var p=0;p<o.length;p++)v+="产品名称："+o[p].goodsName+"<BR>",v+="零售价："+o[p].retailPrice+"<BR>",v+="数量    ：X"+o[p].num+"<BR>",v+="<RIGHT>总计："+o[p].total_money+"</RIGHT>",v+="--------------------------------<BR>",v+="退货明细：<BR>",null!=e.custom?v+="客户姓名："+e.custom.custom_name+"<BR>":v+="未记录客户 <BR>";v+="<BOLD><RIGHT>全部总计："+e.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>"}else{var v;v=1==e.type?"<CB>入库单</CB><BR>":"<CB>出库单</CB><BR>",v+="--------------------------------<BR>";for(var m=0;m<o.length;m++)v+="产品名称："+o[m].goodsName+"<BR>",v+="实际单价："+o[m].retailPrice+"<BR>",v+="数量    ：X"+o[m].num+"<BR>",v+="<RIGHT>总计："+o[m].total_money+"</RIGHT>",v+="--------------------------------<BR>";v+="<BOLD><RIGHT>全部总计："+e.all_money+"</RIGHT></BOLD>",v+="--------------------------------<BR>",1==e.type&&(v+="开单明细：<BR>",v+="<BR>",null!=e.producer&&(v+="供货商姓名："+e.producer.producer_name+"<BR>"),null==e.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+e.real_money+"<BR>",e.debt>0&&(v+="本次欠款："+e.debt+"<BR>"),v+="--------------------------------<BR>"),-1==e.type&&(v+="开单明细：<BR>",v+="<BR>",e.custom&&(v+="客户姓名："+e.custom.custom_name+"<BR>"),e.real_money?v+="实际收款：未填写 <BR>":v+="实际收款："+e.real_money+"<BR>",e.debt>0&&(v+="本次欠款  ："+e.debt+"<BR>"),v+="--------------------------------<BR>")}v+="操作者："+e.opreater.nickName+"<BR>",v+="备注："+e.beizhu+"<BR>",v+="操作时间："+e.createdAt+"<BR>",this.print_by_code(v)},print_by_code:function(e){var o=uni.getStorageSync("setting").USER,a=uni.getStorageSync("setting").UKEY,n=uni.getStorageSync("setting").number,i="api.feieyun.cn",r="/Api/Open/",s=(new Date).getTime(),u=l(o+a+s);h(n,e,1);var c=0;function l(t){return g(d(y(t)))}function d(t){for(var e=t,o=Array(80),a=1732584193,n=-271733879,i=-1732584194,r=271733878,s=-1009589776,u=0;u<e.length;u+=16){for(var c=a,l=n,d=i,y=r,g=s,h=0;h<80;h++){o[h]=h<16?e[u+h]:f(o[h-3]^o[h-8]^o[h-14]^o[h-16],1);var _=m(m(f(a,5),p(h,n,i,r)),m(m(s,o[h]),v(h)));s=r,r=i,i=f(n,30),n=a,a=_}a=m(a,c),n=m(n,l),i=m(i,d),r=m(r,y),s=m(s,g)}return new Array(a,n,i,r,s)}function p(t,e,o,a){return t<20?e&o|~e&a:t<40?e^o^a:t<60?e&o|e&a|o&a:e^o^a}function v(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function m(t,e){var o=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(o>>16);return a<<16|65535&o}function f(t,e){return t<<e|t>>>32-e}function y(t){for(var e=1+(t.length+8>>6),o=new Array(16*e),a=0;a<16*e;a++)o[a]=0;for(a=0;a<t.length;a++)o[a>>2]|=t.charCodeAt(a)<<24-8*(3&a);return o[a>>2]|=128<<24-8*(3&a),o[16*e-1]=8*t.length,o}function g(t){for(var e=c?"0123456789ABCDEF":"0123456789abcdef",o="",a=0;a<4*t.length;a++)o+=e.charAt(t[a>>2]>>8*(3-a%4)+4&15)+e.charAt(t[a>>2]>>8*(3-a%4)&15);return o}function h(e,a,n){uni.request({url:"https://"+i+r,data:{user:o,stime:s,sig:u,apiname:"Open_printMsg",sn:e,content:a,times:n},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e.data),0!=e.data.ret?uni.showToast({icon:"none",title:e.data.msg}):uni.showToast({icon:"none",title:"打印成功"})}})}}};e.default=r}).call(this,o("5a52")["default"])},"3cab":function(t,e,o){"use strict";o.r(e);var a=o("045b"),n=o("7825");for(var i in n)"default"!==i&&function(t){o.d(e,t,function(){return n[t]})}(i);o("11ea");var r=o("2877"),s=Object(r["a"])(n["default"],a["a"],a["b"],!1,null,"6195d1b0",null);e["default"]=s.exports},6312:function(t,e,o){"use strict";(function(t){var a=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(o("906f")),i={send_in:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:e.frist,data1:e.data1,data2:e.data2,remark:e.remark,url:e.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"nqZl9FWDofCo9cxU4de45grLKh2GU-PJcAvWSbJMy9k",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,form_id:e.form_Id,data:e,emphasis_keyword:""};n.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_out_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"z0Km0FFiuvnNiUcXtZD046j43ue5_AxR05cDHFLLXPY",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,form_id:e.form_Id,data:e,emphasis_keyword:""};n.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_temp:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:"备注:"+e.remark,url:e.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})}};e.default=i}).call(this,o("5a52")["default"])},7825:function(t,e,o){"use strict";o.r(e);var a=o("8c45"),n=o.n(a);for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);e["default"]=n.a},"8c45":function(t,e,o){"use strict";(function(t){var a=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("6b54"),o("87b3");var n=a(o("5d73"));o("c5f6"),o("7f7f");var i,r,s,u,c=a(o("906f")),l=a(o("93e8")),d=a(o("6312")),p=a(o("2df3")),v={data:function(){return{user:uni.getStorageSync("user"),Images:[],stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null,outType:"",discount:"",pickerTypes:[{desc:"自提",type:1},{desc:"快递",type:2},{desc:"物流",type:3},{desc:"送货上门",type:4}],expressNum:""}},onLoad:function(){r=this,i=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products")},onShow:function(){if(this.really_total_money=0,this.all_money=0,this.real_money=0,r.custom=uni.getStorageSync("custom"),u=uni.getStorageSync("shop"),u){r.shop_name=u.name;var t=c.default.Pointer("shops");s=t.set(u.objectId)}if(r.custom.discount){r.discount=r.custom.discount;for(var e=0;e<this.products.length;e++)this.all_money=Number((this.products[e].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[e].really_total_money+this.really_total_money).toFixed(2));this.really_total_money=this.really_total_money*r.discount/100,this.real_money=Number(this.all_money.toFixed(2))*r.discount/100,this.all_money=this.all_money*r.discount/100}else{for(var o=0;o<this.products.length;o++)this.all_money=Number((this.products[o].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[o].really_total_money+this.really_total_money).toFixed(2));this.real_money=Number(this.all_money.toFixed(2))}r.stock=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:""},methods:{scan_code:function(){this.$wechat.scanQRCode().then(function(t){r.expressNum=t.result})},removeImg:function(t){r.Images.splice(t,1),r.Images=r.Images},upload_image:function(){r.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(e){t.log(e);var o,a=Date.parse(new Date),i=e.tempFilePaths,s=!0,u=!1,l=void 0;try{for(var d,p=(0,n.default)(i);!(s=(d=p.next()).done);s=!0){var v=d.value;o=c.default.File(a+".jpg",v)}}catch(m){u=!0,l=m}finally{try{s||null==p.return||p.return()}finally{if(u)throw l}}o.save().then(function(t){var e=!0,o=!1,a=void 0;try{for(var i,s=(0,n.default)(t);!(e=(i=s.next()).done);e=!0){var u=i.value;r.Images.push(u.url)}}catch(m){o=!0,a=m}finally{try{e||null==s.return||s.return()}finally{if(o)throw a}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},getDiscount:function(t){var e=Number(t.detail.value);e>=100?r.discount=100:(r.discount=e,r.real_money=Number(this.all_money.toFixed(2))*e/100)},select_outType:function(t){r.outType=r.pickerTypes[t.detail.value],2==r.outType.type&&3==r.outType.type||(r.expressNum="")},formSubmit:function(e){t.log(e);var o=e.detail.formId,a=2;this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var v=c.default.Pointer("stocks"),m=v.set(r.stock?r.stock.objectId:""),f=new Array,y=[],g=0;g<this.products.length;g++){var h=Number(this.products[g].reserve)-this.products[g].num,_=c.default.Query("Bills"),b={},w=c.default.Pointer("_User"),S=w.set(i),x=c.default.Pointer("_User"),B=x.set(uni.getStorageSync("masterId")),R=c.default.Pointer("Goods"),k=R.set(this.products[g].objectId);if(uni.getStorageSync("custom")){var I=c.default.Pointer("customs"),N=I.set(uni.getStorageSync("custom").objectId);_.set("custom",N)}_.set("goodsName",this.products[g].goodsName),_.set("retailPrice",this.products[g].modify_retailPrice.toString()),_.set("num",Number(this.products[g].num)),_.set("total_money",this.products[g].total_money),_.set("really_total_money",this.products[g].really_total_money),_.set("goodsId",k),_.set("userId",S),_.set("type",-1),_.set("extra_type",a),_.set("opreater",B),_.set("stock",m);var C={};b.goodsName=this.products[g].goodsName,b.modify_retailPrice=this.products[g].modify_retailPrice.toString(),b.retailPrice=this.products[g].retailPrice,b.total_money=this.products[g].total_money,C.costPrice=this.products[g].costPrice,C.retailPrice=this.products[g].retailPrice,C.objectId=this.products[g].objectId,C.reserve=h,b.goodsId=C,b.num=this.products[g].num,b.type=-1,u&&(_.set("shop",s),l.default.record_shopOut(u.objectId,u.have_out+this.products[g].num)),f.push(_),y.push(b),l.default.record_staffOut(this.products[g].num)}c.default.Query("Bills").saveAll(f).then(function(v){for(var f=[],g=0;g<v.length;g++)f.push(v[g].success.objectId);var h=c.default.Pointer("_User"),_=h.set(i),b=uni.getStorageSync("masterId"),w=c.default.Pointer("_User"),S=w.set(b),x=c.default.Query("order_opreations");if(x.set("detail",y),x.set("bills",f),x.set("beizhu",e.detail.value.input_beizhu),x.set("type",-1),x.set("extra_type",a),x.set("opreater",S),x.set("stock",m),x.set("master",_),r.discount&&x.set("discount",r.discount),x.set("goodsName",r.products[0].goodsName),x.set("real_money",Number(r.real_money)),x.set("debt",r.all_money-Number(r.real_money)),u&&x.set("shop",s),r.custom){var B=c.default.Pointer("customs"),R=B.set(r.custom.objectId);if(x.set("custom",R),r.all_money-Number(r.real_money)>0){var k=c.default.Query("customs");k.get(r.custom.objectId).then(function(e){var o=null==e.debt?0:e.debt;o+=r.all_money-Number(r.real_money),t.log(o);var a=c.default.Query("customs");a.get(r.custom.objectId).then(function(t){t.set("debt",o),t.save()})})}}r.outType&&(x.set("typeDesc",r.outType.desc),x.set("expressNum",r.expressNum)),x.set("all_money",r.all_money),x.set("Images",r.Images),x.save().then(function(a){var i=a.objectId;uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品出库成功",icon:"success",success:function(){for(var s=function(e){var o=0,a=c.default.Query("Goods");a.get(r.products[e].objectId).then(function(t){if(r.products[e].warning_num>=r.products[e].reserve&&l.default.log(r.products[e].goodsName+"出库了"+r.products[e].num+"件，已经低于预警数量"+r.products[e].warning_num,-2,r.products[e].objectId),r.products[e].selectd_model){var a=!0,i=!1,s=void 0;try{for(var u,c=(0,n.default)(JSON.parse(r.products[e].selectd_model));!(a=(u=c.next()).done);a=!0){var d=u.value,p=!0,v=!1,m=void 0;try{for(var f,y=(0,n.default)(r.products[e].models);!(p=(f=y.next()).done);p=!0){var g=f.value;o+=Number(g.reserve),g.id==JSON.parse(d).id&&(g.reserve=Number(g.reserve)-Number(r.products[e].num))}}catch(h){v=!0,m=h}finally{try{p||null==y.return||y.return()}finally{if(v)throw m}}}}catch(h){i=!0,s=h}finally{try{a||null==c.return||c.return()}finally{if(i)throw s}}o-=Number(r.products[e].num),t.set("models",r.products[e].models)}else o=Number(r.products[e].reserve)-Number(r.products[e].num);t.set("reserve",o),t.set("stocktype",o>=r.products[e].warning_num?1:0),t.save()}).catch(function(e){t.log(e)})},u=0;u<r.products.length;u++)s(u);r.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),l.default.log(uni.getStorageSync("user").nickName+"出库了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",-1,a.objectId);var t={data1:a.objectId,data2:uni.getStorageSync("user").nickName+"出库了'"+r.products[0].goodsName+"'等"+r.products.length+"商品",data3:r.stock?r.stock.stock_name:"未填写",data4:a.createdAt,remark:e.detail.value.input_beizhu?e.detail.value.input_beizhu:"未填写",url:"https://www.jimuzhou.com/h5/pages/report/EnteringHistory/detail/detail?id="+a.objectId};d.default.send_temp(t);var n={keyword1:{value:r.products[0].goodsName+"'等",color:"#173177"},keyword2:{value:e.detail.value.input_beizhu?e.detail.value.input_beizhu:"未填写"},keyword3:{value:a.createdAt},keyword4:{value:uni.getStorageSync("user").nickName}};n.form_Id=o,n.id=a.objectId,d.default.send_out_mini(n),uni.getStorageSync("setting").auto_print&&p.default.autoPrint(i),uni.navigateBack({delta:2})},500)}})})},function(e){t.log("异常处理")})}}};e.default=v}).call(this,o("5a52")["default"])},"93e8":function(t,e,o){"use strict";(function(e){var a=o("288e");o("6b54"),o("87b3"),o("c5f6");var n=a(o("5d73"));o("7514");var i=a(o("906f"));t.exports={handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,o,a){var n=i.default.Pointer("_User"),r=n.set(uni.getStorageSync("uid")),s=i.default.Query("logs");s.set("parent",r),s.set("log",t),s.set("detail_id",a),s.set("type",o),s.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_shopOut:function(t,o){e.log(t,o);var a=i.default.Query("shops");a.set("id",t),a.set("have_out",o),a.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})},record_staffOut:function(t){if(e.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var o=i.default.Query("staffs");o.set("id",uni.getStorageSync("user").objectId),o.set("have_out",t+uni.getStorageSync("user").have_out),o.save().then(function(t){e.log(t)}).catch(function(t){e.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");e.log(t);var o=i.default.Query("Goods");o.equalTo("userId","==",t),o.find().then(function(t){e.log(t);var o=!0,a=!1,i=void 0;try{for(var r,s=(0,n.default)(t);!(o=(r=s.next()).done);o=!0){var u=r.value;e.log(u),Number(u.costPrice)*u.reserve,u.reserve}}catch(c){a=!0,i=c}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}})},getDay:function(t,e){var o=this,a=new Date,n=a.getTime()+864e5*t;a.setTime(n);var i=a.getFullYear(),r=a.getMonth(),s=a.getDate();return r=o.handleMonth(r+1),s=o.handleMonth(s),e?i+"-"+r+"-"+s+" 00:00:00":i+"-"+r+"-"+s},js_date_time:function(t,e){var o=new Date(t),a=o.getFullYear(),n=o.getMonth()+1;n=n<10?"0"+n:n;var i=o.getDate();i=i<10?"0"+i:i;var r=o.getHours();r=r<10?"0"+r:r;var s=o.getMinutes(),u=o.getSeconds();return s=s<10?"0"+s:s,u=u<10?"0"+u:u,e?a+"-"+n+"-"+i+" "+r+":"+s:a+"-"+n+"-"+i},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}}).call(this,o("5a52")["default"])},a7a0:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-6195d1b0]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?90?%);overflow:scroll}.bottomEle[data-v-6195d1b0]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%}.pro_list[data-v-6195d1b0]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-6195d1b0]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-6195d1b0]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-6195d1b0]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-6195d1b0]{padding:0 %?50?%;background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset}",""])},d9fd:function(t,e,o){var a=o("a7a0");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=o("4f06").default;n("6f5561d8",a,!0,{sourceMap:!1,shadowMode:!1})}}]);