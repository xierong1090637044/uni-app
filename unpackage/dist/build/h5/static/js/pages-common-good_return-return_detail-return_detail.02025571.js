(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_return-return_detail-return_detail"],{"0661":function(t,e,o){"use strict";var n=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(o("5d73"));o("6b54"),o("87b3"),o("c5f6"),o("7f7f");var r,i,a,u,c=n(o("2bef")),l={data:function(){return{shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,custom:null}},onLoad:function(){i=this,r=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=this.products[t].total_money+this.all_money},onShow:function(){if(i.custom=uni.getStorageSync("custom"),u=uni.getStorageSync("shop"),u){i.shop_name=u.name;var t=Bmob.Pointer("shops");a=t.set(u.objectId)}},methods:{formSubmit:function(t){console.log(t),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var e=new Array,o=[],n=0;n<this.products.length;n++){Number(this.products[n].reserve),this.products[n].num;var l=Bmob.Query("Bills"),d={},v=Bmob.Pointer("_User"),m=v.set(r),f=Bmob.Pointer("Goods"),p=f.set(this.products[n].objectId),g=uni.getStorageSync("masterId"),h=Bmob.Pointer("_User"),b=h.set(g);l.set("goodsName",this.products[n].goodsName),l.set("retailPrice",this.products[n].modify_retailPrice.toString()),l.set("num",Number(this.products[n].num)),l.set("total_money",this.products[n].total_money),l.set("goodsId",p),l.set("operater",b),l.set("userId",m),l.set("type",2);var y={};d.goodsName=this.products[n].goodsName,d.modify_retailPrice=this.products[n].modify_retailPrice.toString(),d.retailPrice=this.products[n].retailPrice,d.total_money=this.products[n].total_money,y.costPrice=this.products[n].costPrice,y.retailPrice=this.products[n].retailPrice,d.goodsId=y,d.num=this.products[n].num,u&&l.set("shop",a),e.push(l),o.push(d)}Bmob.Query("Bills").saveAll(e).then(function(e){var n=Bmob.Pointer("_User"),a=n.set(r),u=uni.getStorageSync("masterId"),l=Bmob.Pointer("_User"),d=l.set(u),v=Bmob.Query("order_opreations");if(v.set("beizhu",t.detail.value.input_beizhu),v.set("detail",o),v.set("type",2),v.set("opreater",d),v.set("master",a),v.set("goodsName",i.products[0].goodsName),v.set("real_money",Number(i.real_money)),v.set("debt",i.all_money-Number(i.real_money)),i.custom){var m=Bmob.Pointer("customs"),f=m.set(i.custom.objectId);v.set("custom",f)}v.set("all_money",i.all_money),v.save().then(function(t){console.log("添加操作历史记录成功",t),uni.hideLoading(),uni.removeStorageSync("customs"),uni.showToast({title:"产品退货成功",icon:"success",success:function(){for(var e=function(t){var e=0,o=Bmob.Query("Goods");o.get(i.products[t].objectId).then(function(o){if(i.products[t].selectd_model){var n=!0,r=!1,a=void 0;try{for(var u,c=(0,s.default)(JSON.parse(i.products[t].selectd_model));!(n=(u=c.next()).done);n=!0){var l=u.value,d=!0,v=!1,m=void 0;try{for(var f,p=(0,s.default)(i.products[t].models);!(d=(f=p.next()).done);d=!0){var g=f.value;e+=Number(g.reserve),g.id==JSON.parse(l).id&&(g.reserve=Number(g.reserve)+Number(i.products[t].num))}}catch(h){v=!0,m=h}finally{try{d||null==p.return||p.return()}finally{if(v)throw m}}}}catch(h){r=!0,a=h}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}e+=Number(i.products[t].num),o.set("models",i.products[t].models)}else e=Number(i.products[t].reserve)+Number(i.products[t].num);o.set("reserve",e),o.set("stocktype",e>i.products[t].warning_num?1:0),o.save()}).catch(function(t){console.log(t)})},o=0;o<i.products.length;o++)e(o);i.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout(function(){c.default.log(uni.getStorageSync("user").nickName+"处理了'"+i.products[0].goodsName+"'等"+i.products.length+"商品的退货",2,t.objectId),uni.navigateBack({delta:2})},500)}})})},function(t){console.log("异常处理")})}}};e.default=l},2442:function(t,e,o){var n=o("43b1");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=o("4f06").default;s("64861492",n,!0,{sourceMap:!1,shadowMode:!1})},"2bef":function(t,e,o){"use strict";var n=o("288e");o("6b54"),o("87b3"),o("c5f6");var s=n(o("5d73"));o("7514"),t.exports={handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(t,e,o){var n=Bmob.Pointer("_User"),s=n.set(uni.getStorageSync("uid")),r=Bmob.Query("logs");r.set("parent",s),r.set("log",t),r.set("detail_id",o),r.set("type",e),r.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_shopOut:function(t,e){console.log(t,e);var o=Bmob.Query("shops");o.set("id",t),o.set("have_out",e),o.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})},record_staffOut:function(t){if(console.log(t,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var e=Bmob.Query("staffs");e.set("id",uni.getStorageSync("user").objectId),e.set("have_out",t+uni.getStorageSync("user").have_out),e.save().then(function(t){console.log(t)}).catch(function(t){console.log(t)})}},get_allCost:function(){var t=uni.getStorageSync("uid");console.log(t);var e=Bmob.Query("Goods");e.equalTo("userId","==",t),e.find().then(function(t){console.log(t);var e=!0,o=!1,n=void 0;try{for(var r,i=(0,s.default)(t);!(e=(r=i.next()).done);e=!0){var a=r.value;console.log(a),Number(a.costPrice)*a.reserve,a.reserve}}catch(u){o=!0,n=u}finally{try{e||null==i.return||i.return()}finally{if(o)throw n}}})},getDay:function(t,e){var o=this,n=new Date,s=n.getTime()+864e5*t;n.setTime(s);var r=n.getFullYear(),i=n.getMonth(),a=n.getDate();return i=o.handleMonth(i+1),a=o.handleMonth(a),e?r+"-"+i+"-"+a+" 00:00:00":r+"-"+i+"-"+a},handleMonth:function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e}}},"43b1":function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-b9b17a5a]{color:#4d4d4d;font-size:%?28?%;height:100vh;overflow:scroll}.pro_list[data-v-b9b17a5a]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between}.pro_listitem[data-v-b9b17a5a]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-b9b17a5a]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-b9b17a5a]{width:calc(100% - %?40?%);background-color:#fff;padding:%?20?%;font-size:%?32?%;max-height:%?100?%}.confrim_button[data-v-b9b17a5a]{background:#aa2116;color:#fff;font-weight:700;font-size:%?32?%}",""])},"68e3":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0"}},[t._v("已选产品")]),o("v-uni-view",{staticStyle:{"max-height":"25vh","overflow-x":"scroll"}},t._l(t.products,function(e,n){return o("v-uni-view",{key:n,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#3D3D3D"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),o("v-uni-view",[t._v("零售价：￥"+t._s(e.retailPrice?e.retailPrice:0))])],1),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("退货数量：X"+t._s(e.num))]),o("v-uni-view",[t._v("合计：￥"+t._s(e.total_money))])],1)],1)}),1),o("v-uni-view",{staticClass:"pro_allmoney"},[t._v("总计：￥"+t._s(t.all_money))]),o("v-uni-form",{on:{submit:function(e){e=t.$handleEvent(e),t.formSubmit(e)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx"}},[t._v("开单明细（用于记录退货客户）")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/shops/shops?type=choose"}},[o("v-uni-view",[t._v("选择门店")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择门店",disabled:"true",value:t.shop_name}})],1)],1),o("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=custom"}},[o("v-uni-view",[t._v("客户姓名")]),o("v-uni-view",{staticClass:"kaidan_rightinput"},[o("v-uni-input",{attrs:{placeholder:"选择客户",disabled:"true",value:t.custom.custom_name}})],1)],1)],1)],1),o("v-uni-view",{staticStyle:{"margin-top":"20px"}},[o("v-uni-textarea",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1),o("v-uni-view",{staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("确认退货")])],1)],1)],1)],1)},s=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return s})},7072:function(t,e,o){"use strict";var n=o("2442"),s=o.n(n);s.a},d2b9:function(t,e,o){"use strict";o.r(e);var n=o("0661"),s=o.n(n);for(var r in n)"default"!==r&&function(t){o.d(e,t,function(){return n[t]})}(r);e["default"]=s.a},f9da:function(t,e,o){"use strict";o.r(e);var n=o("68e3"),s=o("d2b9");for(var r in s)"default"!==r&&function(t){o.d(e,t,function(){return s[t]})}(r);o("7072");var i=o("2877"),a=Object(i["a"])(s["default"],n["a"],n["b"],!1,null,"b9b17a5a",null);e["default"]=a.exports}}]);