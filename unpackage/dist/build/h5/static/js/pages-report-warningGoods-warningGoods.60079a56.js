(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-report-warningGoods-warningGoods"],{"0a52":function(e,t,n){var r=n("b782");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("4f06").default;o("8e650e7e",r,!0,{sourceMap:!1,shadowMode:!1})},"0e2f":function(e,t,n){"use strict";n.r(t);var r=n("5c69"),o=n("e730");for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n("d995");var a=n("f0c5"),u=Object(a["a"])(o["default"],r["a"],r["b"],!1,null,"9158e14e",null);t["default"]=u.exports},1901:function(e,t,n){var r=n("7e64");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=n("4f06").default;o("369ff708",r,!0,{sourceMap:!1,shadowMode:!1})},"25c6":function(e,t,n){"use strict";(function(e){var r=n("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("5d73"));n("7514");var i,a,u=r(n("9546")),d=(r(n("7fd5")),r(n("c952"))),s={components:{uniSegmentedControl:d.default},data:function(){return{productList:[],items:["低库存预警","高库存预警"],current:0,search_text:""}},onLoad:function(){i=this,a=uni.getStorageSync("uid"),i.get_productList(0)},methods:{onClickItem:function(e){i.productList=[],1==e?i.get_productList(2):0==e&&i.get_productList(0)},goDetail:function(t){e.log(t),uni.setStorageSync("now_product",t),0==t.order||1==t.order?uni.navigateTo({url:"/pages/manage/good_det/Ngood_det?id="+t.objectId+"&type=false"}):uni.navigateTo({url:"/pages/manage/good_det/good_det"})},get_productList:function(e){var t=u.default.Query("Goods");t.equalTo("userId","==",a),t.equalTo("status","!=",-1),t.equalTo("order","!=",1),t.equalTo("stocktype","==",e),t.limit(500),t.order("-createdAt"),t.include("goodsClass","stocks","second_class"),t.find().then(function(e){var t=!0,n=!1,r=void 0;try{for(var a,u=(0,o.default)(e);!(t=(a=u.next()).done);t=!0){var d=a.value;d.reserve=d.reserve.toFixed(uni.getStorageSync("setting")?uni.getStorageSync("setting").show_float:0)}}catch(s){n=!0,r=s}finally{try{t||null==u.return||u.return()}finally{if(n)throw r}}i.productList=e})}}};t.default=s}).call(this,n("5a52")["default"])},"5c69":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"uni-common-mt"},[n("uni-segmented-control",{attrs:{current:e.current,values:e.items,"style-type":"button","active-color":"#426ab3"},on:{clickItem:function(t){arguments[0]=t=e.$handleEvent(t),e.onClickItem.apply(void 0,arguments)}}})],1),n("v-uni-scroll-view",{staticClass:"uni-product-list",attrs:{"scroll-y":!0}},[e.productList.length>0?n("v-uni-view",e._l(e.productList,function(t,r){return n("v-uni-view",{key:r,staticClass:"uni-product"},[n("v-uni-view",[t.goodsIcon?n("v-uni-image",{staticClass:"product_image",attrs:{src:t.goodsIcon,mode:"widthFix"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.priviewImg(t.goodsIcon)}}}):n("v-uni-image",{staticClass:"product_image",attrs:{src:"/static/goods-default.png",mode:"widthFix"}})],1),n("v-uni-view",{staticStyle:{"margin-left":"20rpx",width:"100%","line-height":"40rpx"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.goDetail(t)}}},[n("v-uni-view",{staticClass:"product_name",staticStyle:{color:"#f30"}},[e._v(e._s(t.goodsName))]),n("v-uni-view",{staticClass:"product_reserve display_flex_bet",staticStyle:{width:"90%"}},[n("v-uni-view",{staticStyle:{"font-size":"24rpx"}},[e._v("库存数量:"),n("v-uni-text",{staticClass:"text_notice"},[e._v(e._s(t.reserve))])],1),t.warning_num?n("v-uni-view",{staticStyle:{"font-size":"24rpx"}},[e._v("预警数量:"),n("v-uni-text",{staticClass:"text_notice"},[e._v(e._s(t.warning_num))])],1):e._e()],1),t.packageContent&&t.packingUnit?n("v-uni-view",{staticClass:"product_reserve"},[e._v("规格:"),n("v-uni-text",{staticClass:"text_notice"},[e._v(e._s(t.packageContent)+"*"+e._s(t.packingUnit))])],1):e._e()],1),n("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#426ab3"}})],1)}),1):n("v-uni-view",[n("v-uni-view",{staticStyle:{"margin-top":"100rpx",color:"#333","font-weight":"bold","text-align":"center","font-size":"36rpx"}},[e._v("没有商品啦!")])],1)],1)],1)},o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},6916:function(e,t,n){"use strict";var r=n("0a52"),o=n.n(r);o.a},"6edb":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("c5f6");var r={name:"UniSegmentedControl",props:{current:{type:Number,default:0},values:{type:Array,default:function(){return[]}},activeColor:{type:String,default:"#007aff"},styleType:{type:String,default:"button"}},data:function(){return{currentIndex:0}},watch:{current:function(e){e!==this.currentIndex&&(this.currentIndex=e)}},created:function(){this.currentIndex=this.current},methods:{_onClick:function(e){this.currentIndex!==e&&(this.currentIndex=e,this.$emit("clickItem",e))}}};t.default=r},"7c0b":function(e,t,n){"use strict";n.r(t);var r=n("6edb"),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t["default"]=o.a},"7e64":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".uni-common-mt[data-v-9158e14e]{padding:%?20?% 0}.uni-product-list[data-v-9158e14e]{padding:0 %?10?%;width:calc(100% - %?20?%);height:calc(100vh - %?104?%);background:#fff}.uni-product[data-v-9158e14e]{display:-webkit-box;display:-webkit-flex;display:flex;padding:%?10?% 0;border-bottom:1px solid#ddd;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.product_image[data-v-9158e14e]{width:%?80?%;height:%?80?%}.product_name[data-v-9158e14e]{font-weight:700;color:#333}.product_reserve[data-v-9158e14e]{color:#6c757d;font-size:%?24?%;font-weight:700}.title[data-v-9158e14e]{font-size:15px;line-height:20px;color:#333;padding:15px}.city[data-v-9158e14e]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:100%;margin-left:8px;white-space:nowrap}.input-view[data-v-9158e14e]{width:92%;display:-webkit-box;display:-webkit-flex;display:flex;background-color:#e7e7e7;height:30px;border-radius:15px;padding:0 4%;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;margin:%?8?% 0;line-height:30px}.input-view .uni-icon[data-v-9158e14e]{line-height:30px!important}.input-view .input[data-v-9158e14e]{height:30px;line-height:30px;width:94%;padding:0 3%}",""])},"7fd5":function(e,t,n){"use strict";(function(t){var r=n("288e");n("6b54"),n("7514");var o=r(n("5d73"));n("c5f6");var i=r(n("795b")),a=r(n("9546"));e.exports={enterAddGoodNum:function(e){var n=this;return new i.default(function(r,i){for(var u=function(i){var u=0,d=a.default.Query("Goods");d.get(e[i].objectId).then(function(s){var l=s;if(e[i].selectd_model){var c=!0,f=!1,v=void 0;try{for(var g,m=(0,o.default)(e[i].selected_model);!(c=(g=m.next()).done);c=!0){var h=g.value,y=!0,b=!1,p=void 0;try{for(var w,x=(0,o.default)(l.models);!(y=(w=x.next()).done);y=!0){var _=w.value;_.id==h.id&&(_.reserve=Number(_.reserve)+Number(h.num)),delete _.num}}catch(k){b=!0,p=k}finally{try{y||null==x.return||x.return()}finally{if(b)throw p}}}}catch(k){f=!0,v=k}finally{try{c||null==m.return||m.return()}finally{if(f)throw v}}u=Number(l.reserve)+Number(e[i].num),d.set("models",l.models)}else u=Number(l.reserve)+Number(e[i].num);d.set("reserve",u),d.set("id",e[i].objectId),d.save().then(function(o){if(e[i].header){var u=a.default.Query("Goods");u.equalTo("header","==",e[i].header.objectId),u.equalTo("order","==",1),u.statTo("sum","reserve"),u.find().then(function(o){t.log("dasds",o);var u=o[0]._sumReserve,d=a.default.Query("Goods");d.set("reserve",u),d.set("id",e[i].header.objectId),d.save().then(function(t){n.modifyStockType(e[i].header.objectId),i==e.length-1&&r(!0)})})}else n.modifyStockType(e[i].objectId),i==e.length-1&&r(!0)}).catch(function(e){t.log(e)})})},d=0;d<e.length;d++)u(d)})},outRedGoodNum:function(e){var n=this;return new i.default(function(r,i){for(var u=function(i){var u=0,d=a.default.Query("Goods");d.get(e[i].objectId).then(function(s){var l=s;if(e[i].selectd_model){var c=!0,f=!1,v=void 0;try{for(var g,m=(0,o.default)(e[i].selected_model);!(c=(g=m.next()).done);c=!0){var h=g.value,y=!0,b=!1,p=void 0;try{for(var w,x=(0,o.default)(l.models);!(y=(w=x.next()).done);y=!0){var _=w.value;u+=Number(_.reserve),_.id==h.id&&(_.reserve=Number(_.reserve)-Number(h.num)),delete _.num}}catch(k){b=!0,p=k}finally{try{y||null==x.return||x.return()}finally{if(b)throw p}}}}catch(k){f=!0,v=k}finally{try{c||null==m.return||m.return()}finally{if(f)throw v}}u=Number(l.reserve)-Number(e[i].num),d.set("models",l.models)}else u=Number(l.reserve)-Number(e[i].num);d.set("reserve",u),d.set("id",e[i].objectId),d.save().then(function(t){if(e[i].header){var o=a.default.Query("Goods");o.equalTo("header","==",e[i].header.objectId),o.equalTo("order","==",1),o.statTo("sum","reserve"),o.find().then(function(t){var o=t[0]._sumReserve,u=a.default.Query("Goods");u.set("reserve",o),u.set("id",e[i].header.objectId),u.save().then(function(t){n.modifyStockType(e[i].header.objectId),i==e.length-1&&r(!0)})})}else n.modifyStockType(e[i].objectId),i==e.length-1&&r(!0)}).catch(function(e){t.log(e)})})},d=0;d<e.length;d++)u(d)})},enterAddGoodNumNew:function(e){var n=this;return new i.default(function(r,i){for(var u=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",d=uni.getStorageSync("uid"),s=function(i){var s=0,l=a.default.Query("Goods");l.get(e[i].objectId).then(function(l){if(e[i].selectd_model){var c=!0,f=!1,v=void 0;try{for(var g,m=(0,o.default)(e[i].selected_model);!(c=(g=m.next()).done);c=!0){var h=g.value,y=!0,b=!1,p=void 0;try{for(var w,x=(0,o.default)(e[i].models);!(y=(w=x.next()).done);y=!0){var _=w.value;_.id==h.id&&(_.reserve=Number(_.reserve)+Number(h.num)),delete _.num}}catch(S){b=!0,p=S}finally{try{y||null==x.return||x.return()}finally{if(b)throw p}}}}catch(S){f=!0,v=S}finally{try{c||null==m.return||m.return()}finally{if(f)throw v}}s=Number(e[i].reserve)+Number(e[i].num),l.set("models",e[i].models)}else s=Number(e[i].reserve)+Number(e[i].num);l.set("reserve",s),l.save();var k=a.default.Query("Goods");k.equalTo("userId","==",d),k.equalTo("header","==",e[i].objectId),k.equalTo("stocks","==",u.objectId),k.find().then(function(o){if(0==o.length)n.upload_good_withNoCan(e[i],u,Number(e[i].num)).then(function(n){t.log(n),i==e.length-1&&r(!0)});else{var d=a.default.Query("Goods");d.set("id",o[0].objectId),d.set("reserve",o[0].reserve+Number(e[i].num)),d.save().then(function(n){t.log(n),i==e.length-1&&r(!0)}).catch(function(e){t.log(e)})}})}).catch(function(e){t.log(e)})},l=0;l<e.length;l++)s(l)})},outRedGoodNumNew:function(e){var n=this;return new i.default(function(r,i){for(var u=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",d=uni.getStorageSync("uid"),s=function(i){var s=0,l=a.default.Query("Goods");l.get(e[i].objectId).then(function(l){if(e[i].selectd_model){var c=!0,f=!1,v=void 0;try{for(var g,m=(0,o.default)(e[i].selected_model);!(c=(g=m.next()).done);c=!0){var h=g.value,y=!0,b=!1,p=void 0;try{for(var w,x=(0,o.default)(e[i].models);!(y=(w=x.next()).done);y=!0){var _=w.value;_.id==h.id&&(_.reserve=Number(_.reserve)-Number(h.num)),delete _.num}}catch(S){b=!0,p=S}finally{try{y||null==x.return||x.return()}finally{if(b)throw p}}}}catch(S){f=!0,v=S}finally{try{c||null==m.return||m.return()}finally{if(f)throw v}}s=Number(e[i].reserve)-Number(e[i].num),l.set("models",e[i].models)}else s=Number(e[i].reserve)-Number(e[i].num);l.set("reserve",s),l.save();var k=a.default.Query("Goods");k.equalTo("userId","==",d),k.equalTo("header","==",e[i].objectId),k.equalTo("stocks","==",u.objectId),k.find().then(function(o){if(0==o.length)n.upload_good_withNoCan(e[i],u,Number(e[i].num),"out").then(function(n){t.log(n),i==e.length-1&&r(!0)});else{var d=a.default.Query("Goods");d.set("id",o[0].objectId),d.set("reserve",o[0].reserve-Number(e[i].num)),d.save().then(function(n){t.log(n),i==e.length-1&&r(!0)}).catch(function(e){t.log(e)})}})}).catch(function(e){t.log(e)})},l=0;l<e.length;l++)s(l)})},upload_good_withNoCan:function(e,n,r,u){return new i.default(function(i,d){var s=uni.getStorageSync("uid"),l=a.default.Pointer("_User"),c=l.set(s),f=a.default.Pointer("stocks"),v=f.set(n.objectId),g=a.default.Pointer("Goods"),m="";m=e.header?g.set(e.header.objectId):g.set(e.objectId);var h=a.default.Query("Goods");if(h.set("goodsName",e.goodsName),h.set("goodsIcon",e.goodsIcon),"out"==u){if(h.set("reserve",0-Number(r)),e.goodsId&&e.goodsId.models){var y=!0,b=!1,p=void 0;try{for(var w,x=(0,o.default)(e.goodsId.models);!(y=(w=x.next()).done);y=!0){var _=w.value;_.reserve=0-Number(_.num)}}catch(z){b=!0,p=z}finally{try{y||null==x.return||x.return()}finally{if(b)throw p}}h.set("models",e.goodsId.models)}}else if("allocation"==u){if(h.set("reserve",Number(r)),e.selected_model&&e.selected_model.length>0){var k=!0,S=!1,I=void 0;try{for(var N,j=(0,o.default)(e.selected_model);!(k=(N=j.next()).done);k=!0){var T=N.value;T.reserve=Number(T.num),delete T.num}}catch(z){S=!0,I=z}finally{try{k||null==j.return||j.return()}finally{if(S)throw I}}h.set("models",e.selected_model)}}else if(h.set("reserve",Number(r)),e.goodsId&&e.goodsId.models){var C=!0,G=!1,Q=void 0;try{for(var q,M=(0,o.default)(e.goodsId.models);!(C=(q=M.next()).done);C=!0){var P=q.value;P.reserve=Number(P.num)}}catch(z){G=!0,Q=z}finally{try{C||null==M.return||M.return()}finally{if(G)throw Q}}h.set("models",e.goodsId.models)}h.set("stocks",v),h.set("userId",c),h.set("header",m),h.set("costPrice",""+e.costPrice),h.set("retailPrice",""+e.retailPrice),h.set("order",1),h.save().then(function(e){t.log(e),i([!0,e])}).catch(function(e){t.log(e)})})},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,n,r){var o=a.default.Pointer("_User"),i=o.set(uni.getStorageSync("uid"));if(-2==n){var u=a.default.Pointer("Goods"),d=u.set(r),s=a.default.Query("logs");s.equalTo("goodId","==",r),s.find().then(function(r){if(0==r.length){var o=a.default.Query("logs");o.set("parent",i),o.set("goodId",d),o.set("log",e),o.set("type",n),o.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}})}else{var l=a.default.Query("logs");l.set("parent",i),l.set("log",e),l.set("detail_id",r),l.set("type",n),l.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},modifyStockType:function(e){var n=this,r=a.default.Query("Goods");r.get(e).then(function(e){var t=e;""==t.warning_num&&""==t.max_num?e.set("stocktype",1):void 0==t.warning_num&&void 0==t.max_num?e.set("stocktype",1):null==t.warning_num&&null==t.max_num?e.set("stocktype",1):(""!=t.warning_num&&(t.warning_num>=t.reserve?(e.set("stocktype",0),n.log(t.goodsName+"已经超过设置的最小库存值"+t.warning_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1)),""!=t.max_num&&(t.max_num<=t.reserve?(e.set("stocktype",2),n.log(t.goodsName+"已经超过设置的最大库存值"+t.max_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1))),e.save()}).catch(function(e){t.log(e)})},record_shopOut:function(e,n){t.log(e,n);var r=a.default.Query("shops");r.set("id",e),r.set("have_out",n),r.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var n=a.default.Query("_User");n.set("id",uni.getStorageSync("user").objectId),n.set("have_out",Number(e)+uni.getStorageSync("user").have_out),n.save().then(function(e){t.log(e)}).catch(function(e){t.log(e)})}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var n=a.default.Query("Goods");n.equalTo("userId","==",e),n.find().then(function(e){t.log(e);var n=!0,r=!1,i=void 0;try{for(var a,u=(0,o.default)(e);!(n=(a=u.next()).done);n=!0){var d=a.value;t.log(d),Number(d.costPrice)*d.reserve,d.reserve}}catch(s){r=!0,i=s}finally{try{n||null==u.return||u.return()}finally{if(r)throw i}}})},getDay:function(e,t){var n=this,r=new Date,o=r.getTime()+864e5*e;r.setTime(o);var i=r.getFullYear(),a=r.getMonth(),u=r.getDate();return a=n.handleMonth(a+1),u=n.handleMonth(u),t?i+"-"+a+"-"+u+" 00:00:00":i+"-"+a+"-"+u},js_date_time:function(e,t){var n=new Date(e),r=n.getFullYear(),o=n.getMonth()+1;o=o<10?"0"+o:o;var i=n.getDate();i=i<10?"0"+i:i;var a=n.getHours();a=a<10?"0"+a:a;var u=n.getMinutes(),d=n.getSeconds();return u=u<10?"0"+u:u,d=d<10?"0"+d:d,t?r+"-"+o+"-"+i+" "+a+":"+u:r+"-"+o+"-"+i},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,n("5a52")["default"])},b782:function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,".segmented-control[data-v-917140dc]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:75%;font-size:%?28?%;box-sizing:border-box;margin:0 auto;overflow:hidden;border:1px solid;border-radius:%?10?%}.segmented-control.text[data-v-917140dc]{border:0;border-radius:0}.segmented-control-item[data-v-917140dc]{-webkit-box-flex:1;-webkit-flex:1;flex:1;text-align:center;line-height:%?60?%;box-sizing:border-box;border-left:1px solid}.segmented-control-item.active[data-v-917140dc]{color:#fff}.segmented-control-item.text[data-v-917140dc]{border-left:0;color:#000}.segmented-control-item.text.active[data-v-917140dc]{border-bottom-style:solid}.segmented-control-item[data-v-917140dc]:first-child{border-left-width:0}",""])},c952:function(e,t,n){"use strict";n.r(t);var r=n("ca58"),o=n("7c0b");for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);n("6916");var a=n("f0c5"),u=Object(a["a"])(o["default"],r["a"],r["b"],!1,null,"917140dc",null);t["default"]=u.exports},ca58:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"segmented-control",class:{text:"text"===e.styleType},style:{borderColor:"text"===e.styleType?"":e.activeColor}},e._l(e.values,function(t,r){return n("v-uni-view",{key:r,staticClass:"segmented-control-item",class:[{text:"text"===e.styleType},{active:r===e.currentIndex}],style:{color:r===e.currentIndex?"text"===e.styleType?e.activeColor:"#fff":"text"===e.styleType?"#000":e.activeColor,backgroundColor:r===e.currentIndex&&"button"===e.styleType?e.activeColor:""},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e._onClick(r)}}},[e._v(e._s(t))])}),1)},o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},d995:function(e,t,n){"use strict";var r=n("1901"),o=n.n(r);o.a},e730:function(e,t,n){"use strict";n.r(t);var r=n("25c6"),o=n.n(r);for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);t["default"]=o.a}}]);