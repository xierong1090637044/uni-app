(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_confrim-good_enter-good_enter"],{1122:function(t,e,o){var i=o("ee3d");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var s=o("4f06").default;s("eba8695c",i,!0,{sourceMap:!1,shadowMode:!1})},3543:function(t,e,o){"use strict";o.r(e);var i=o("f09e"),s=o.n(i);for(var a in i)"default"!==a&&function(t){o.d(e,t,function(){return i[t]})}(a);e["default"]=s.a},"509d":function(t,e,o){"use strict";o.r(e);var i=o("ebfe"),s=o("3543");for(var a in s)"default"!==a&&function(t){o.d(e,t,function(){return s[t]})}(a);o("badc");var n=o("f0c5"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,"09976746",null);e["default"]=r.exports},"9f50":function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(o("9546")),a={send_in:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:e.frist,data1:e.data1,data2:e.data2,remark:e.remark,url:e.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_noconfrim:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:e.frist,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:e.remark,url:e.url,type:"in_noconfrim"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})},send_in_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"nqZl9FWDofCo9cxU4de45grLKh2GU-PJcAvWSbJMy9k",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,form_id:e.form_Id,data:e,emphasis_keyword:""};s.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_out_mini:function(e){var o={touser:uni.getStorageSync("openid"),template_id:"BKT2_0OuWF3mLZGvFmpRzWFa_Dyr4EIppl_LFF1uRLE",page:"/pages/report/EnteringHistory/detail/detail?id="+e.id,form_id:e.form_Id,data:e,emphasis_keyword:""};s.default.sendWeAppMessage(o).then(function(e){t.log(e)}).catch(function(e){t.log(e)})},send_temp:function(e){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,data1:e.data1,data2:e.data2,data3:e.data3,data4:e.data4,remark:"备注:"+e.remark,url:e.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){t.log(e)}})}};e.default=a}).call(this,o("5a52")["default"])},a2fc:function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(o("f499"));o("c5f6"),o("7514");var a=i(o("5d73")),n=i(o("795b")),r=i(o("9546")),u={delete_goods:function(e){return new n.default(function(o,i){var s=0,n=!0,u=!1,d=void 0;try{for(var c,l=(0,a.default)(e);!(n=(c=l.next()).done);n=!0){var p=c.value,f=r.default.Query("Goods");f.destroy(p.objectId).then(function(t){s+=1,s==e.length&&o(!0)}).catch(function(e){t.log(e)})}}catch(v){u=!0,d=v}finally{try{n||null==l.return||l.return()}finally{if(u)throw d}}})},upload_good_withNoCan:function(e,o){return new n.default(function(i,s){var a=uni.getStorageSync("uid"),n=r.default.Pointer("_User"),u=n.set(a),d=e.reserve,c=r.default.Pointer("stocks"),l=c.set(o.objectId),p=r.default.Query("Goods");p.equalTo("userId","==",a),p.equalTo("goodsName","==",e.goodsName),p.equalTo("stocks","==",o.objectId),p.find().then(function(o){if(t.log(o),o.length>=1)i([!1,"该商品存在此仓库中"]);else{var s=r.default.Query("Goods");if(s.set("goodsName",e.goodsName),s.set("goodsIcon",e.goodsIcon),s.set("costPrice",e.costPrice),s.set("retailPrice",e.retailPrice),s.set("reserve",Number(e.reserve)),s.set("productCode",e.productCode?e.productCode:""),s.set("stocks",l),s.set("product_info",e.product_info?e.product_info:""),s.set("producer",e.producer?e.producer:""),s.set("packingUnit",e.packingUnit?e.packingUnit:""),s.set("packageContent",e.packageContent?e.packageContent:""),s.set("warning_num",Number(e.warning_num?e.warning_num:0)),s.set("stocktype",Number(e.warning_num?e.warning_num:0)>=Number(d)?0:1),e.second_class){var a=r.default.Pointer("class_user"),n=a.set(e.goodsClass);s.set("second_class",p);var c=r.default.Pointer("second_class"),p=c.set(e.second_class);s.set("goodsClass",n)}s.set("userId",u),s.save().then(function(e){t.log(e),i([!0,e])}).catch(function(e){t.log(e)})}})})},upload_good:function(e){return new n.default(function(o,i){var s=JSON.parse(localStorage.getItem("bmob")).objectId,a=r.default.Pointer("_User"),n=a.set(s),u=r.default.Pointer("class_user"),d=u.set(e.goodsClass),c=r.default.Pointer("second_class"),l=c.set(e.second_class),p=r.default.Query("Goods");p.equalTo("userId","==",s),p.equalTo("goodsName","==",e.goodsName),p.equalTo("position","==",e.position),p.equalTo("stocks","==",e.stocks),p.find().then(function(i){if(t.log(i),i.length>=1)o([!1,i]);else{var s=e.reserve,a=r.default.Pointer("stocks"),u=a.set(e.stocks),c=r.default.Query("Goods");c.set("goodsName",e.goodsName),c.set("goodsIcon",e.goodsIcon),c.set("costPrice",e.costPrice),c.set("retailPrice",e.retailPrice),c.set("producttime",e.producttime),c.set("nousetime",e.nousetime),c.set("regNumber",e.regNumber),c.set("reserve",Number(e.reserve)),c.set("productCode",e.productCode),c.set("stocks",u),c.set("product_info",e.product_info),c.set("producer",e.producer),c.set("packingUnit",e.packingUnit),c.set("packageContent",e.packageContent),c.set("warning_num",Number(e.warning_num)),c.set("stocktype",Number(e.warning_num)>=Number(s)?0:1),c.set("second_class",l),c.set("goodsClass",d),c.set("userId",n),c.save().then(function(e){t.log(e),o([!0,e])}).catch(function(e){t.log(e)})}})})},get_fristclass:function(){var t=JSON.parse(localStorage.getItem("bmob")).objectId;return new n.default(function(e,o){var i=r.default.Query("class_user");i.equalTo("parent","==",t),i.find().then(function(t){localStorage.setItem("frist_class",(0,s.default)(t)),e(t)})})},get_secondclass:function(t){return new n.default(function(e,o){var i=r.default.Query("class_user");i.field("second",t),i.relation("second_class").then(function(t){e(t.results)})})},getstock_list:function(t){var e=JSON.parse(localStorage.getItem("bmob")).objectId;return new n.default(function(o,i){var a=r.default.Query("stocks");a.order("-num"),a.include("charge","shop"),a.equalTo("parent","==",e),t&&a.equalTo("stock_name","==",{$regex:t+".*"}),a.limit(500),a.find().then(function(t){localStorage.setItem("stocks",(0,s.default)(t)),o(t)})})}};e.default=u}).call(this,o("5a52")["default"])},badc:function(t,e,o){"use strict";var i=o("1122"),s=o.n(i);s.a},ebfe:function(t,e,o){"use strict";var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0",color:"#3D3D3D","font-weight":"bold"}},[t._v("已选产品")]),o("v-uni-view",t._l(t.products,function(e,i){return o("v-uni-view",{key:i,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",{staticStyle:{width:"calc(100% - 260rpx)"}},[t._v("产品："+t._s(e.goodsName))]),t.user.rights&&-1==t.othercurrent.indexOf("1")?o("v-uni-view",[t._v("期初进货价：￥0")]):o("v-uni-view",[t._v("期初进货价：￥"+t._s(e.costPrice))])],1),o("v-uni-view",{staticClass:"pro_list"},[e.stocks&&e.stocks.stock_name?o("v-uni-view",[t._v("入库仓库："+t._s(e.stocks.stock_name))]):o("v-uni-view",[t._v("入库仓库：未填写")]),o("v-uni-view",[t._v("入库数量：X"+t._s(e.num))])],1),e.selected_model?o("v-uni-view",t._l(e.selected_model,function(e,i){return e.num>0?o("v-uni-view",{key:i,staticClass:"display_flex_bet"},[e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[t._v(t._s(e.custom1.value+e.custom2.value+e.custom3.value+e.custom4.value))]):t._e(),e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[t._v(t._s(e.num))]):t._e()],1):t._e()}),1):t._e(),t.user.rights&&"0"!=t.user.rights.othercurrent[0]?o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("实际进货价：￥0")]),o("v-uni-view",[t._v("合计：￥0")])],1):o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("实际进货价：￥"+t._s(e.modify_retailPrice))]),o("v-uni-view",[t._v("合计：￥"+t._s(e.modify_retailPrice*e.num))])],1)],1)}),1),o("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 20rpx",color:"#3D3D3D","font-weight":"bold"}},[t._v("入库明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("入库时间")]),o("v-uni-picker",{attrs:{mode:"date",value:t.nowDay,end:t.nowDay},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindDateChange.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.nowDay.split(" ")[0]))]),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("备注")]),o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1)],1)],1),o("v-uni-view",{staticStyle:{background:"#fff",padding:"10rpx 20rpx"}},[o("v-uni-view",{staticClass:"notice_text"},[t._v("上传凭证图(会员可用)")]),o("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[o("v-uni-view",{staticClass:"upload_image display_flex"},[t._l(t.Images,function(e,i){return t.Images&&t.Images.length>0?o("v-uni-view",{key:i,staticStyle:{position:"relative"}},[o("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:e}}),o("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeImg(i)}}})],1):t._e()}),t.Images.length<3?o("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.upload_image.apply(void 0,arguments)}}},[o("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):t._e()],2)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[t.user.rights&&"0"!=t.user.rights.othercurrent[0]?o("v-uni-view",[o("v-uni-view",[t._v("合计：￥0")]),o("v-uni-view",[t._v("总数："+t._s(t.total_num))])],1):o("v-uni-view",[o("v-uni-view",[t._v("合计：￥"+t._s(t.real_money))]),o("v-uni-view",[t._v("总数："+t._s(t.total_num))])],1),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit","data-type":"2",value:"2"}},[t._v("入库")])],1)],1)],1)],1)],1)},s=[];o.d(e,"a",function(){return i}),o.d(e,"b",function(){return s})},ee3d:function(t,e,o){e=t.exports=o("2350")(!1),e.push([t.i,".page[data-v-09976746]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-09976746]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%;font-weight:700}.pro_list[data-v-09976746]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-09976746]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-09976746]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-09976746]{width:calc(100% - %?40?%);background-color:#fff;max-height:%?100?%;padding:%?10?% 0;text-align:right}.confrim_button[data-v-09976746]{background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset;padding:0 %?50?%}",""])},f09e:function(t,e,o){"use strict";(function(t){var i=o("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o("6b54");var s=i(o("5d73"));o("c5f6");var a,n,r=i(o("9546")),u=i(o("7fd5")),d=(i(o("a2fc")),i(o("9f50"))),c=i(o("856d")),l={data:function(){return{user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),othercurrent:"",Images:[],stock:"",shop_name:"",products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,really_total_money:0,total_num:0,nowDay:u.default.getDay(0,!0,!0)}},onLoad:function(){n=this,a=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.all_money=Number((this.products[t].total_money+this.all_money).toFixed(2)),this.really_total_money=Number((this.products[t].really_total_money+this.really_total_money).toFixed(2)),this.total_num+=Number(this.products[t].num);this.real_money=Number(this.all_money.toFixed(2)),n.user.rights&&n.user.rights.othercurrent&&(n.othercurrent=n.user.rights.othercurrent)},onShow:function(){},methods:{bindDateChange:function(t){n.nowDay=t.detail.value+" 00:00:00"},removeImg:function(t){n.Images.splice(t,1),n.Images=n.Images},upload_image:function(){n.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var e,o=Date.parse(new Date),i=t.tempFilePaths,a=!0,u=!1,d=void 0;try{for(var c,l=(0,s.default)(i);!(a=(c=l.next()).done);a=!0){var p=c.value;e=r.default.File(o+".jpg",p)}}catch(f){u=!0,d=f}finally{try{a||null==l.return||l.return()}finally{if(u)throw d}}e.save().then(function(t){var e=!0,o=!1,i=void 0;try{for(var a,r=(0,s.default)(t);!(e=(a=r.next()).done);e=!0){var u=a.value;n.Images.push(u.url)}}catch(f){o=!0,i=f}finally{try{e||null==r.return||r.return()}finally{if(o)throw i}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(e){uni.getStorageSync("identity");if(!this.button_disabled){this.button_disabled=!0;var o=e.detail.formId,i=2;uni.showLoading({title:"请勿退出..."});for(var s=new Array,l=[],p=[],f=[],v=0;v<this.products.length;v++){var g=Number(this.products[v].reserve)+this.products[v].num,m={},_=r.default.Query("Bills"),h=r.default.Pointer("_User"),y=h.set(a),w=r.default.Pointer("Goods"),b=w.set(this.products[v].header?this.products[v].header.objectId:this.products[v].objectId),k=uni.getStorageSync("masterId"),S=r.default.Pointer("_User"),x=S.set(k);_.set("goodsName",this.products[v].goodsName),_.set("retailPrice",this.products[v].modify_retailPrice.toString()),_.set("num",Number(this.products[v].num)),_.set("total_money",this.products[v].total_money),_.set("really_total_money",this.products[v].really_total_money),_.set("goodsId",b),_.set("userId",y),_.set("opreater",x),_.set("type",1),_.set("extra_type",i),_.set("createdTime",{__type:"Date",iso:n.nowDay}),_.set("status",!0);var I={};if(this.products[v].stocks&&this.products[v].stocks.objectId){var P=r.default.Pointer("stocks"),N=P.set(this.products[v].stocks.objectId);_.set("stock",N),m.stock=this.products[v].stocks.stock_name,-1==p.indexOf(this.products[v].stocks.objectId)&&(p.push(this.products[v].stocks.objectId),f.push(this.products[v].stocks.stock_name))}m.goodsName=this.products[v].goodsName,m.modify_retailPrice=this.products[v].modify_retailPrice.toString(),m.retailPrice=this.products[v].retailPrice,m.total_money=this.products[v].total_money,m.packingUnit=this.products[v].packingUnit,I.costPrice=this.products[v].costPrice,I.retailPrice=this.products[v].retailPrice,I.objectId=this.products[v].objectId,I.reserve=g,this.products[v].selectd_model&&(I.selected_model=this.products[v].selected_model,I.models=this.products[v].models),m.goodsId=I,m.num=this.products[v].num,m.type=1,s.push(_),l.push(m)}r.default.Query("Bills").saveAll(s).then(function(t){for(var s=[],v=0;v<t.length;v++)s.push(t[v].success.objectId);var g=r.default.Pointer("_User"),m=g.set(a),_=uni.getStorageSync("masterId"),h=r.default.Pointer("_User"),y=h.set(_),w=r.default.Query("order_opreations");w.set("beizhu",e.detail.value.input_beizhu),w.set("detail",l),w.set("real_num",n.total_num),w.set("type",1),w.set("extra_type",i),w.set("bills",s),w.set("opreater",y),w.set("master",m),w.set("stockIds",p),w.set("stockNames",f),w.set("goodsName",n.products[0].goodsName),w.set("real_money",Number(n.real_money)),w.set("debt",0),w.set("all_money",n.all_money),w.set("Images",n.Images),w.set("status",!1),w.set("createdTime",{__type:"Date",iso:n.nowDay}),w.save().then(function(t){var i=t.objectId;u.default.enterAddGoodNum(n.products).then(function(t){var s=r.default.Query("order_opreations");s.set("id",i),s.set("status",!0),s.save().then(function(t){uni.hideLoading();var s={frist:uni.getStorageSync("user").nickName+"入库了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",data1:t.createdAt,data2:n.stock?n.stock.stock_name:"未填写",remark:e.detail.value.input_beizhu?e.detail.value.input_beizhu:"未填写",url:"https://www.jimuzhou.com/h5/pages/report/EnteringHistory/detail/detail?id="+i};d.default.send_in(s);var a={keyword1:{value:n.products[0].goodsName+"'等",color:"#173177"},keyword2:{value:e.detail.value.input_beizhu?e.detail.value.input_beizhu:"未填写"},keyword3:{value:t.createdAt},keyword4:{value:uni.getStorageSync("user").nickName}};a.form_Id=o,a.id=i,d.default.send_in_mini(a),uni.getStorageSync("setting").auto_print&&c.default.autoPrint(i),uni.setStorageSync("is_option",!0),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),uni.showToast({title:"入库成功"}),setTimeout(function(){n.button_disabled=!1,u.default.log(uni.getStorageSync("user").nickName+"入库了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",1,i),uni.navigateBack({delta:2})},500)})})})},function(e){t.log("异常处理")})}}}};e.default=l}).call(this,o("5a52")["default"])}}]);