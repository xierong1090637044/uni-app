(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_count-count_detail-count_detail"],{"0a86":function(t,e,o){var s=o("a818");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var i=o("4f06").default;i("1598b861",s,!0,{sourceMap:!1,shadowMode:!1})},"493b":function(t,e,o){"use strict";var s=o("0a86"),i=o.n(s);i.a},"5d8d":function(t,e,o){"use strict";var s,i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0",color:"#3D3D3D","font-weight":"bold"}},[t._v("已选产品")]),o("v-uni-view",t._l(t.products,(function(e,s){return o("v-uni-view",{key:s,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list",staticStyle:{color:"#333"}},[o("v-uni-view",[t._v("产品："+t._s(e.goodsName))]),e.stocks?o("v-uni-view",[t._v("盘点店仓："+t._s(e.stocks.stock_name))]):t._e()],1),e.selected_model?o("v-uni-view",t._l(e.selected_model,(function(e,s){return o("v-uni-view",{key:s,staticClass:"display_flex_bet"},[e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[t._v(t._s(e.custom1.value+e.custom2.value+e.custom3.value+e.custom4.value))]):t._e(),e?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[t._v("盘点后库存："+t._s(e.reserve))]):t._e()],1)})),1):o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[t._v("盘点前库存："+t._s(e.reserve))]),o("v-uni-view",[t._v("盘点后库存："+t._s(e.num))])],1)],1)})),1),o("v-uni-form",{on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 20rpx",color:"#3D3D3D","font-weight":"bold"}},[t._v("盘点明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("盘点时间")]),o("v-uni-picker",{attrs:{mode:"date",value:t.nowDay,end:t.nowDay},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindDateChange2.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.nowDay.split(" ")[0]))]),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("备注")]),o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-view",[t._v("总数："+t._s(t.total_num))]),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:t.button_disabled,"form-type":"submit"}},[t._v("盘点")])],1)],1)],1)],1)],1)},a=[];o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return s}))},9527:function(t,e,o){"use strict";(function(t){var s=o("ee27");o("7db0"),o("a9e3"),o("d3b7"),o("25f0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,a,n=s(o("54f8")),r=s(o("9546")),u=s(o("7fd5")),d=s(o("856d")),c={data:function(){return{products:null,button_disabled:!1,beizhu_text:"",real_money:0,all_money:0,total_num:0,producer:null,nowDay:u.default.getDay(0,!0)}},onLoad:function(){a=this,i=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var t=0;t<this.products.length;t++)this.total_num+=Number(this.products[t].num)},methods:{bindDateChange:function(t){a.nowDay=t.detail.value+" 00:00:00"},formSubmit:function(e){t.log(e),this.button_disabled=!0,uni.showLoading({title:"上传中..."});for(var o=new Array,s=[],c=[],l=0;l<this.products.length;l++){var v=r.default.Query("Bills"),p={},f=r.default.Pointer("_User"),g=f.set(i),h=r.default.Pointer("Goods"),m=h.set(this.products[l].header?this.products[l].header.objectId:this.products[l].objectId),_=uni.getStorageSync("masterId"),y=r.default.Pointer("_User"),b=y.set(_);if(v.set("goodsName",this.products[l].goodsName),v.set("retailPrice",this.products[l].modify_retailPrice.toString()),v.set("num",Number(this.products[l].num)),v.set("reserve",Number(this.products[l].reserve)),v.set("now_reserve",this.products[l].num.toString()),v.set("total_money",this.products[l].total_money),v.set("opreater",b),v.set("goodsId",m),v.set("userId",g),v.set("type",3),v.set("createdTime",{__type:"Date",iso:a.nowDay}),a.products[l].stocks&&a.products[l].stocks.objectId){var w=r.default.Pointer("stocks"),S=w.set(a.products[l].stocks.objectId);v.set("stock",S),c.push(this.products[l].stocks.objectId),p.stock=a.products[l].stocks.stock_name}var k={};this.products[l].selectd_model&&(k.selected_model=this.products[l].selected_model,k.models=this.products[l].models,p.goodsId=k),p.goodsName=this.products[l].goodsName,p.reserve=this.products[l].reserve,p.now_reserve=this.products[l].num.toString(),p.packingUnit=this.products[l].packingUnit,o.push(v),s.push(p)}r.default.Query("Bills").saveAll(o).then((function(o){var l=r.default.Pointer("_User"),v=l.set(i),p=uni.getStorageSync("masterId"),f=r.default.Pointer("_User"),g=f.set(p),h=r.default.Query("order_opreations");h.set("beizhu",e.detail.value.input_beizhu),h.set("detail",s),h.set("type",3),h.set("opreater",g),h.set("master",v),h.set("goodsName",a.products[0].goodsName),h.set("stockIds",c),h.set("createdTime",{__type:"Date",iso:a.nowDay}),h.save().then((function(e){var o=0,s=e.objectId;uni.hideLoading();for(var i=function(e){var i=0,c=r.default.Query("Goods");if(c.set("id",a.products[e].objectId),a.products[e].selectd_model){var l,v=(0,n.default)(a.products[e].selected_model);try{for(v.s();!(l=v.n()).done;){var p=l.value;delete p.num}}catch(f){v.e(f)}finally{v.f()}c.set("models",a.products[e].selected_model),i=Number(a.products[e].num)}else i=Number(a.products[e].num);c.set("reserve",i),c.save().then((function(i){if(a.products[e].header){var n=r.default.Query("Goods");n.equalTo("header","==",a.products[e].header.objectId),n.equalTo("order","==",1),n.statTo("sum","reserve"),n.find().then((function(i){var n=i[0]._sumReserve;c.set("id",a.products[e].header.objectId),c.set("reserve",n),c.save().then((function(i){o+=1,u.default.modifyStockType(a.products[e].header.objectId),t.log(o,a.products.length),o==a.products.length&&(a.button_disabled=!1,uni.setStorageSync("is_option",!0),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),u.default.log(uni.getStorageSync("user").nickName+"盘点了'"+a.products[0].goodsName+"'等"+a.products.length+"商品",3,s),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(s),uni.navigateBack({delta:2}),setTimeout((function(){uni.showToast({title:"盘点成功"})}),500))}))}))}else o+=1,u.default.modifyStockType(a.products[e].header.objectId),o==a.products.length&&(a.button_disabled=!1,uni.setStorageSync("is_option",!0),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),u.default.log(uni.getStorageSync("user").nickName+"盘点了'"+a.products[0].goodsName+"'等"+a.products.length+"商品",3,i.objectId),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(s),uni.navigateBack({delta:2}),setTimeout((function(){uni.showToast({title:"盘点成功"})}),500))})).catch((function(e){t.log(e)}))},c=0;c<a.products.length;c++)i(c)}))}),(function(e){t.log("异常处理")}))}}};e.default=c}).call(this,o("5a52")["default"])},a818:function(t,e,o){var s=o("24fb");e=s(!1),e.push([t.i,".page[data-v-5e867830]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-5e867830]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%;font-weight:700}.pro_list[data-v-5e867830]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-5e867830]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-5e867830]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-5e867830]{text-align:right;width:calc(100% - %?40?%);background-color:#fff;padding:%?10?% 0;max-height:%?100?%}.confrim_button[data-v-5e867830]{background:#aa2116;color:#fff;border-radius:unset;font-weight:700;font-size:%?32?%}",""]),t.exports=e},dce6:function(t,e,o){"use strict";o.r(e);var s=o("9527"),i=o.n(s);for(var a in s)"default"!==a&&function(t){o.d(e,t,(function(){return s[t]}))}(a);e["default"]=i.a},fc7e:function(t,e,o){"use strict";o.r(e);var s=o("5d8d"),i=o("dce6");for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("493b");var n,r=o("f0c5"),u=Object(r["a"])(i["default"],s["b"],s["c"],!1,null,"5e867830",null,!1,s["a"],n);e["default"]=u.exports}}]);