(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-finance-outRecord-outRecord"],{"329f":function(t,e,i){var a=i("ce21");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("b8f3e600",a,!0,{sourceMap:!1,shadowMode:!1})},"34a2":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("v-uni-view",{staticClass:"page"},[i("v-uni-form",{attrs:{"report-submit":"true"},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.formSubmit.apply(void 0,arguments)}}},[i("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[i("v-uni-view",{staticStyle:{margin:"0 0 10rpx 10rpx","font-size":"32rpx",color:"#333","font-weight":"bold"}},[t._v("基本信息")]),i("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},["record"==t.type?i("v-uni-view",[i("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/finance/outClass/outClass?type=choose"}},[i("v-uni-view",{staticStyle:{width:"160rpx"}},[t._v("支出类别"),i("v-uni-text",{staticStyle:{color:"#f30"}},[t._v("*")])],1),i("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{width:"100%","justify-content":"flex-end"}},[i("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择支出类别",disabled:"true",value:t.category.class_text}}),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1):i("v-uni-view",[i("v-uni-navigator",{staticClass:"display_flex",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/custom/custom?type=producerFinance"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("供货商"),i("v-uni-text",{staticStyle:{color:"#f30"}},[t._v("*")])],1),i("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{width:"100%","justify-content":"flex-end"}},[i("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择供货商",disabled:"true",value:t.producer.producer_name}}),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("应付欠款")]),i("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{"justify-content":"flex-end"}},[i("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"应收欠款",disabled:"true",value:t.producer.debt||0,type:"digit"}})],1)],1)],1),i("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/finance/account/account?type=choose"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("付款账户"),i("v-uni-text",{staticStyle:{color:"#f30"}},[t._v("*")])],1),i("v-uni-view",{staticClass:"kaidan_rightinput display_flex",staticStyle:{"justify-content":"flex-end"}},[i("v-uni-input",{staticStyle:{"text-align":"right","margin-right":"20rpx"},attrs:{placeholder:"选择付款账户",disabled:"true",value:t.account?t.account.name:""}}),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",[t._v("本次实付"),i("v-uni-text",{staticStyle:{"font-size":"20rpx",color:"#f30"}},[t._v("*")])],1),i("v-uni-view",{staticClass:"kaidan_rightinput",staticStyle:{"text-align":"right"}},[i("v-uni-input",{staticStyle:{color:"#d71345"},attrs:{placeholder:"输入实际付款金额",type:"digit"},model:{value:t.real_money,callback:function(e){t.real_money=e},expression:"real_money"}})],1)],1),i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("付款日期")]),i("v-uni-picker",{attrs:{mode:"date",value:t.nowDay,end:t.nowDay},on:{change:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.bindDateChange.apply(void 0,arguments)},click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[i("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[i("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[t._v(t._s(t.nowDay.split(" ")[0]))]),i("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),i("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[i("v-uni-view",{staticStyle:{width:"140rpx"}},[t._v("备注")]),i("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"},model:{value:t.beizhu_text,callback:function(e){t.beizhu_text=e},expression:"beizhu_text"}})],1)],1)],1),i("v-uni-view",{staticStyle:{"margin-top":"20px",background:"#fff",padding:"10rpx"}},[i("v-uni-view",{staticClass:"notice_text"},[t._v("上传凭证图(会员可用)")]),i("v-uni-view",{staticStyle:{width:"100%",padding:"20rpx 0"}},[i("v-uni-view",{staticClass:"upload_image display_flex"},[t._l(t.Images,function(e,a){return t.Images&&t.Images.length>0?i("v-uni-view",{key:a,staticStyle:{position:"relative"}},[i("v-uni-image",{staticStyle:{width:"180rpx",height:"180rpx","margin-right":"10rpx"},attrs:{src:e}}),i("fa-icon",{staticStyle:{position:"absolute",top:"-10rpx",right:"-10rpx"},attrs:{type:"times-circle-o",size:"20",color:"#426ab3"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.removeImg(a)}}})],1):t._e()}),t.Images.length<3?i("v-uni-view",{staticStyle:{width:"180rpx",height:"180rpx","line-height":"220rpx","text-align":"center",border:"1rpx solid#ccc","border-radius":"16rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.upload_image.apply(void 0,arguments)}}},[i("fa-icon",{attrs:{type:"plus-square-o",size:"40",color:"#426ab3"}})],1):t._e()],2)],1)],1),i("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[i("v-uni-view",[i("v-uni-text",[t._v("本次实付：￥"+t._s(t.real_money||0))])],1),i("v-uni-view",{staticClass:"display_flex"},[i("v-uni-button",{staticClass:"confrim_button",staticStyle:{background:"#426ab3"},attrs:{disabled:t.button_disabled,"form-type":"submit","data-type":"1"}},[t._v("生成付款单")])],1)],1)],1)],1)],1)},n=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return n})},"3a15":function(t,e,i){"use strict";(function(t){var a=i("288e");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("c5f6");var n,o,r,s,c=a(i("5d73")),u=a(i("9546")),l=a(i("7fd5")),d=a(i("7faa")),p={data:function(){return{producer:{},user:uni.getStorageSync("user"),identity:uni.getStorageSync("identity"),Images:[],account:"",button_disabled:!1,beizhu_text:"",real_money:"",nowDay:l.default.getDay(0,!0,!0),type:"",category:""}},onLoad:function(t){o=this,n=uni.getStorageSync("uid"),o.type=t.type||"","record"==t.type&&uni.removeStorageSync("producer")},onShow:function(){if(o.producer=uni.getStorageSync("producer"),o.account=uni.getStorageSync("account"),uni.getStorageSync("category"))if(o.category=uni.getStorageSync("category"),2==o.category.type){var t=u.default.Pointer("financeFristClass");r=t.set(o.category.parent.objectId);var e=u.default.Pointer("financeSecondClass");s=e.set(o.category.objectId)}else{var i=u.default.Pointer("financeFristClass");r=i.set(o.category.objectId)}},methods:{bindDateChange:function(t){o.nowDay=t.detail.value+" 00:00:00"},removeImg:function(t){o.Images.splice(t,1),o.Images=o.Images},upload_image:function(){o.user.is_vip?uni.chooseImage({count:3,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){var e,i=Date.parse(new Date),a=t.tempFilePaths,n=!0,r=!1,s=void 0;try{for(var l,d=(0,c.default)(a);!(n=(l=d.next()).done);n=!0){var p=l.value;e=u.default.File(i+".jpg",p)}}catch(f){r=!0,s=f}finally{try{n||null==d.return||d.return()}finally{if(r)throw s}}e.save().then(function(t){var e=!0,i=!1,a=void 0;try{for(var n,r=(0,c.default)(t);!(e=(n=r.next()).done);e=!0){var s=n.value;o.Images.push(s.url)}}catch(f){i=!0,a=f}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}})}}):uni.showToast({title:"您还不是会员，无法使用",icon:"none"})},formSubmit:function(e){var i=this;if(o.button_disabled=!0,"record"==o.type){if(""==uni.getStorageSync("category")||void 0==uni.getStorageSync("category"))return uni.showToast({icon:"none",title:"请选择支出类别"}),void(this.button_disabled=!1)}else if(""==uni.getStorageSync("producer")||void 0==uni.getStorageSync("producer"))return uni.showToast({icon:"none",title:"请选择供货商"}),void(this.button_disabled=!1);if(""==uni.getStorageSync("account")||void 0==uni.getStorageSync("account"))return uni.showToast({icon:"none",title:"请选择付款账户"}),void(this.button_disabled=!1);if(""==o.real_money)return uni.showToast({icon:"none",title:"请输入本次实付"}),void(this.button_disabled=!1);if("record"==o.type){var a=u.default.Query("accounts");a.get(o.account.objectId).then(function(e){e.set("money",e.money-Number(o.real_money)),e.save().then(function(e){var a=u.default.Pointer("accounts"),c=a.set(o.account.objectId),d=u.default.Pointer("_User"),p=d.set(n),f=uni.getStorageSync("masterId"),v=u.default.Pointer("_User"),y=v.set(f),g=u.default.Query("order_opreations");g.set("account",c),g.set("master",p),g.set("opreater",y),g.set("real_money",Number(o.real_money)),g.set("beizhu",o.beizhu_text),g.set("createdTime",{__type:"Date",iso:o.nowDay}),g.set("type",1),g.set("extra_type",6),g.set("Images",o.Images),1==o.category.type?g.set("fristClass",r):g.set("secondClass",s),g.save().then(function(t){i.button_disabled=!1,uni.removeStorageSync("account"),o.producer=t,l.default.log(uni.getStorageSync("user").nickName+"记录了付款￥"+o.real_money+"元",6,t.objectId),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({icon:"none",title:"付款成功"})},1e3)}).catch(function(e){t.log(e)})})})}else{var c=u.default.Query("producers");c.get(o.producer.objectId).then(function(e){e.debt-Number(o.real_money)<0?(uni.showToast({icon:"none",title:"付款金额过大"}),i.button_disabled=!1):(e.set("debt",e.debt-Number(o.real_money)),e.save().then(function(e){var a=u.default.Query("accounts");a.get(o.account.objectId).then(function(e){e.set("money",e.money-Number(o.real_money)),e.save().then(function(e){var a=u.default.Pointer("producers"),r=a.set(o.producer.objectId),s=u.default.Pointer("accounts"),c=s.set(o.account.objectId),p=u.default.Pointer("_User"),f=p.set(n),v=uni.getStorageSync("masterId"),y=u.default.Pointer("_User"),g=y.set(v),b=u.default.Query("order_opreations");b.set("account",c),b.set("producer",r),b.set("master",f),b.set("opreater",g),b.set("real_money",Number(o.real_money)),b.set("beizhu",o.beizhu_text),b.set("debt",o.producer.debt||0),b.set("createdTime",{__type:"Date",iso:o.nowDay}),b.set("type",1),b.set("extra_type",5),b.set("Images",o.Images),b.save().then(function(t){i.button_disabled=!1,d.default.producer_detail(o.producer.objectId).then(function(t){uni.removeStorageSync("account"),o.producer=t,l.default.log(uni.getStorageSync("user").nickName+"操作'"+o.producer.producer_name+"'供货商付款￥"+o.real_money+"元",6,t.objectId),uni.navigateBack({delta:1}),setTimeout(function(){uni.showToast({icon:"none",title:"付款成功"})},1e3)})}).catch(function(e){t.log(e)})})})}))}).catch(function(e){t.log(e)})}}}};e.default=p}).call(this,i("5a52")["default"])},ce21:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,".page[data-v-efb9268c]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-efb9268c]{position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%;font-weight:700}.pro_list[data-v-efb9268c]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-efb9268c]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-efb9268c]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-efb9268c]{text-align:right;width:calc(100% - %?40?%);background-color:#fff;max-height:%?100?%;padding:%?10?% 0}.confrim_button[data-v-efb9268c]{background:#1651aa;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset;padding:0 %?50?%}",""])},d4ad:function(t,e,i){"use strict";i.r(e);var a=i("34a2"),n=i("f301");for(var o in n)"default"!==o&&function(t){i.d(e,t,function(){return n[t]})}(o);i("f307");var r=i("f0c5"),s=Object(r["a"])(n["default"],a["a"],a["b"],!1,null,"efb9268c",null);e["default"]=s.exports},f301:function(t,e,i){"use strict";i.r(e);var a=i("3a15"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);e["default"]=n.a},f307:function(t,e,i){"use strict";var a=i("329f"),n=i.n(a);n.a}}]);