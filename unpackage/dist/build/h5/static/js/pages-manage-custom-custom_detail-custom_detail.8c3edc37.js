(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-manage-custom-custom_detail-custom_detail"],{"0187":function(e,t,n){"use strict";var o,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between",position:"fixed",bottom:"0",background:"#fff","z-index":"100",padding:"12rpx 0","border-top":"1rpx solid#DDDDDD"}},[n("v-uni-view",{staticClass:"Listitem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.edit.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"Icon"},[n("fa-icon",{attrs:{type:"pencil-square-o",size:"18",color:"#426ab3"}})],1),n("v-uni-view",{staticClass:"Notice"},[e._v("编辑")])],1),n("v-uni-view",{staticClass:"Listitem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.gotopay.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"Icon"},[n("fa-icon",{attrs:{type:"money",size:"18",color:"#426ab3"}})],1),n("v-uni-view",{staticClass:"Notice"},[e._v("收款")])],1),n("v-uni-navigator",{staticClass:"Listitem",attrs:{"hover-class":"none",url:"debt_history/debt_history?id="+e.custom.objectId}},[n("v-uni-view",{staticClass:"Icon"},[n("fa-icon",{attrs:{type:"fax",size:"18",color:"#426ab3"}})],1),n("v-uni-view",{staticClass:"Notice"},[e._v("收款记录")])],1),n("v-uni-navigator",{staticClass:"Listitem",attrs:{url:"history/history?id="+e.custom.objectId}},[n("v-uni-view",{staticClass:"Icon"},[n("fa-icon",{attrs:{type:"calendar-check-o",size:"18",color:"#426ab3"}})],1),n("v-uni-view",{staticClass:"Notice"},[e._v("交易记录")])],1),n("v-uni-view",{staticClass:"Listitem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sellRecord.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"Icon"},[n("fa-icon",{attrs:{type:"sign-out",size:"18",color:"#426ab3"}})],1),n("v-uni-view",{staticClass:"Notice"},[e._v("销售单")])],1)],1)},s=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}))},"02a9":function(e,t,n){"use strict";n.r(t);var o=n("2a7d"),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},"0d83":function(e,t,n){"use strict";n.r(t);var o=n("d9d4"),a=n.n(o);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);t["default"]=a.a},"114b":function(e,t,n){"use strict";(function(e){var o=n("ee27");n("7db0"),n("a9e3"),n("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("54f8")),s=o(n("9546")),r=uni.getStorageSync("uid"),i={get_customList:function(e,t){return new Promise((function(n,o){var a=uni.getStorageSync("uid"),r=s.default.Query("customs");r.order("num"),r.equalTo("parent","==",a),r.equalTo("disabled","==",e),t&&r.equalTo("name","==",{$regex:t+".*"}),r.find().then((function(e){n(e)}))}))},get_customCount:function(){return new Promise((function(e,t){var n=uni.getStorageSync("uid"),o=s.default.Query("customs");o.equalTo("parent","==",n),o.find().then((function(t){var n,o=t,r=(0,a.default)(o);try{var i=function(){var e=n.value,t=s.default.Query("Bills");t.equalTo("type","==",-1),t.equalTo("custom","==",e.objectId),t.find().then((function(t){e.relations=t}))};for(r.s();!(n=r.n()).done;)i()}catch(u){r.e(u)}finally{r.f()}e(o)}))}))},add_custom:function(t){e.log(t);var n=JSON.parse(localStorage.getItem("bmob")).objectId;return new Promise((function(o,a){var r=s.default.Pointer("_User"),i=r.set(n);if(t.objectId){var u=s.default.Query("customs");u.set("custom_name",t.custom_name),u.set("debt",Number(t.debt)),u.set("custom_address",t.custom_address),u.set("custom_phone",t.custom_phone),u.set("parent",i),u.set("disabled",!t.disabled),u.set("id",t.objectId),u.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else{var l=s.default.Query("customs");l.equalTo("parent","==",n),l.equalTo("name","==",t.custom_name),l.find().then((function(n){if(e.log(n),0==n.length){var a=s.default.Query("customs");a.set("custom_name",t.custom_name),a.set("debt",Number(t.debt)),a.set("custom_address",t.custom_address),a.set("custom_phone",t.custom_phone),a.set("have_out",0),a.set("disabled",!t.disabled),a.set("parent",i),a.save().then((function(e){o(e)})).catch((function(t){e.log(t)}))}else o(!1)}))}}))},delete_custom:function(t){return new Promise((function(n,o){var a=s.default.Query("customs");a.destroy(t).then((function(e){n(e)})).catch((function(t){e.log(t)}))}))},custom_detail:function(t){return new Promise((function(n,o){var a=s.default.Query("customs");a.include("customFristClass","customSecondClass"),a.get(t).then((function(e){n(e)})).catch((function(t){e.log(t)}))}))},get_moneyList:function(t){return new Promise((function(n,o){var a=s.default.Query("order_opreations");a.equalTo("custom","==",t),a.include("opreater","account"),a.find().then((function(t){e.log(t),n(t)}))}))},getCustomSellList:function(e){return new Promise((function(t,n){var o=s.default.Query("order_opreations");o.equalTo("master","==",r),o.equalTo("type","==",-1),o.equalTo("extra_type","==",1),o.equalTo("extra_type","==",1),o.equalTo("custom","==",e.customId),o.equalTo("status","==",!0),o.equalTo("createdAt",">=",e.startDate),o.equalTo("createdAt","<=",e.endDate),o.limit(50),o.skip(50*(e.pageNum-1)),o.include("opreater","custom","stock"),o.order("-createdAt"),o.find().then((function(e){t(e)}))}))},getAllCustomSellList:function(e){var t={},n=0,o=0,i=0,u=0,l=0;return new Promise((function(c,d){var f=s.default.Query("order_opreations");f.equalTo("master","==",r),f.equalTo("type","==",e.type),f.equalTo("extra_type","==",e.extra_type),f.equalTo("custom","==",e.customId),f.equalTo("status","==",!0),f.equalTo("createdAt",">=",e.startDate+" 00:00:01"),f.equalTo("createdAt","<=",e.endDate+" 00:00:01"),f.count().then((function(s){i=s;var d=0;if(0==i)t.total=n,t.num=i,t.money=o,t.realMoney=0,t.realCost=0,c(t);else for(var v=0;v<Math.ceil(i/500);v++)f.equalTo("master","==",r),f.equalTo("type","==",e.type),f.equalTo("extra_type","==",e.extra_type),f.equalTo("custom","==",e.customId),f.equalTo("status","==",!0),f.limit(500),f.skip(500*v),f.include("opreater","custom","stock"),f.order("-createdAt"),f.equalTo("createdAt",">=",e.startDate+" 00:00:01"),f.equalTo("createdAt","<=",e.endDate+" 00:00:01"),f.find().then((function(e){var s,r=(0,a.default)(e);try{for(r.s();!(s=r.n()).done;){var f=s.value;n+=f.real_num,o+=f.all_money,u+=f.real_money,l+=f.allCostPrice,d+=1}}catch(v){r.e(v)}finally{r.f()}d==i&&(t.total=n,t.num=i,t.money=o,t.realMoney=u,t.realCost=l,c(t))}))}))}))},getAllCustomInRecord:function(e){var t={},n=0,o=0;return new Promise((function(i,u){var l=s.default.Query("order_opreations");l.equalTo("master","==",r),l.equalTo("type","==",-1),l.equalTo("extra_type","==",5),l.equalTo("custom","==",e.customId),l.equalTo("createdAt",">=",e.startDate+" 00:00:01"),l.equalTo("createdAt","<=",e.endDate+" 00:00:01"),l.count().then((function(s){o=s;var u=0;if(0==o)t.num=o,t.money=n,i(t);else for(var c=0;c<Math.ceil(o/500);c++)l.equalTo("master","==",r),l.equalTo("type","==",-1),l.equalTo("extra_type","==",5),l.equalTo("custom","==",e.customId),l.limit(500),l.skip(500*c),l.order("-createdAt"),l.equalTo("createdAt",">=",e.startDate+" 00:00:01"),l.equalTo("createdAt","<=",e.endDate+" 00:00:01"),l.find().then((function(e){var s,r=(0,a.default)(e);try{for(r.s();!(s=r.n()).done;){var l=s.value;n+=l.real_money,u+=1}}catch(c){r.e(c)}finally{r.f()}u==o&&(t.num=o,t.money=n,i(t))}))}))}))}};t.default=i}).call(this,n("5a52")["default"])},"2a7d":function(e,t,n){"use strict";var o=n("ee27");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n("9546")),o(n("7fd5"));var a,s={props:{custom:{type:Object,default:{}}},data:function(){return{}},mounted:function(){a=this},methods:{gotopay:function(){uni.navigateTo({url:"/pages/finance/CPHistory/costomInDet/costomInDet?customId="+a.custom.objectId})},edit:function(){a.custom.customSecondClass?uni.setStorageSync("customCategory",a.custom.customSecondClass):a.custom.customFristClass&&uni.setStorageSync("customCategory",a.custom.customFristClass),uni.setStorageSync("customs",a.custom),uni.navigateTo({url:"../add/add"})},sellRecord:function(){uni.setStorageSync("custom",a.custom),uni.navigateTo({url:"/pages/common/goods-select/goods-select?type=delivery&value=3"})}}};t.default=s},3737:function(e,t,n){"use strict";var o={"uni-nav-bar":n("96bd").default,"uni-segmented-control":n("c952").default,"uni-calendar":n("ef70").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("uni-nav-bar",{attrs:{fixed:!0,color:"#333333","background-color":"#FFFFFF","right-text":"操作"},on:{"click-right":function(t){arguments[0]=t=e.$handleEvent(t),e.show_options.apply(void 0,arguments)}}}),n("v-uni-view",[n("v-uni-view",{staticClass:"display_flex_bet frist",staticStyle:{background:"#fff",padding:"20rpx 30rpx"}},[n("v-uni-view",[e.custom.Images&&e.custom.Images.length>0?n("v-uni-image",{staticStyle:{width:"100rpx",height:"100rpx"},attrs:{src:e.custom.Images[0],mode:"aspectFit"}}):n("v-uni-image",{staticStyle:{height:"100rpx",width:"100rpx"},attrs:{src:"/static/custom.png",mode:"aspectFit"}})],1),n("v-uni-view",{staticStyle:{width:"calc(100% - 120rpx)"}},[n("v-uni-view",{staticStyle:{color:"#3d3d3d","font-weight":"bold"}},[n("v-uni-text",[e._v(e._s(e.custom.custom_name))]),e.custom.orginDebt?n("v-uni-text",{staticStyle:{"font-size":"20rpx",color:"#999"}},[e._v("（期初欠款：￥"+e._s(e.custom.orginDebt)+")")]):e._e()],1),n("v-uni-view",{staticClass:"display_flex_bet"},[n("v-uni-view",{staticClass:"noticeText"},[e._v("地址:"+e._s(e.custom.custom_address||"未填写"))]),n("v-uni-view",{staticClass:"noticeText"},[e._v("电话:"+e._s(e.custom.custom_phone||"未填写"))])],1),n("v-uni-view",{staticClass:"display_flex_bet"},[n("v-uni-view",[e._v("欠款金额："),n("v-uni-text",{staticStyle:{color:"#f30","font-weight":"bold"}},[e._v("￥"+e._s(e.custom.debt))])],1),n("v-uni-view",{staticClass:"display_flex labeNotice",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.makePhoneCall(e.custom.custom_phone)}}},[n("fa-icon",{attrs:{type:"phone",size:"14",color:"#fff"}}),n("v-uni-text",{staticStyle:{"margin-left":"10rpx","font-size":"24rpx"}},[e._v("打电话")])],1)],1)],1)],1),n("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[n("uni-segmented-control",{attrs:{current:e.current,values:e.items,"style-type":"button","active-color":"#426ab3"},on:{clickItem:function(t){arguments[0]=t=e.$handleEvent(t),e.onClickItem.apply(void 0,arguments)}}})],1),0==e.current?n("v-uni-view",[n("v-uni-view",{staticClass:"frist"},[n("v-uni-view",{staticClass:"display_flex_bet header"},[n("v-uni-view",{staticClass:"listItem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showOptions.apply(void 0,arguments)}}},[0==e.sellType?n("v-uni-text",[e._v("销售")]):1==e.sellType?n("v-uni-text",[e._v("退货")]):e._e(),n("fa-icon",{staticStyle:{"margin-left":"6rpx"},attrs:{type:"angle-down",size:"18",color:"#999"}})],1),n("v-uni-view",{staticClass:"display_flex listItem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.open.apply(void 0,arguments)}}},[n("v-uni-view",[n("v-uni-view",{staticStyle:{"font-size":"24rpx","line-height":"28rpx"}},[e._v(e._s(e.sellParams.startDate))]),n("v-uni-view",{staticStyle:{"font-size":"24rpx","line-height":"28rpx"}},[e._v(e._s(e.sellParams.endDate))])],1),n("fa-icon",{staticStyle:{"margin-left":"6rpx"},attrs:{type:"angle-down",size:"18",color:"#999"}})],1)],1)],1),n("v-uni-view",{staticClass:"display_flex_bet second"},[n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v(e._s(e.buyTotal.num||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[0==e.sellType?n("v-uni-text",[e._v("销售笔数")]):e._e(),1==e.sellType?n("v-uni-text",[e._v("退款笔数")]):e._e()],1)],1),n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v(e._s(e.buyTotal.total||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[0==e.sellType?n("v-uni-text",[e._v("销售数量")]):e._e(),1==e.sellType?n("v-uni-text",[e._v("退货数量")]):e._e()],1)],1),0==e.sellType?n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v("￥"+e._s(e.buyTotal.realCost||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[n("v-uni-text",[e._v("销售成本")])],1)],1):1==e.sellType?n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v("￥"+e._s(e.buyTotal.money||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[n("v-uni-text",[e._v("退款金额")])],1)],1):e._e(),0==e.sellType?n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v("￥"+e._s(e.buyTotal.realMoney||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[n("v-uni-text",[e._v("实际销售金额")])],1)],1):e._e()],1)],1):1==e.current?n("v-uni-view",[n("v-uni-view",{staticClass:"frist"},[n("v-uni-view",{staticClass:"display_flex_bet header"},[n("v-uni-view",{staticClass:"listItem"},[n("v-uni-text",[e._v("收款")]),n("fa-icon",{staticStyle:{"margin-left":"6rpx"},attrs:{type:"angle-down",size:"18",color:"#999"}})],1),n("v-uni-view",{staticClass:"display_flex listItem",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.open.apply(void 0,arguments)}}},[n("v-uni-view",[n("v-uni-view",{staticStyle:{"font-size":"24rpx","line-height":"28rpx"}},[e._v(e._s(e.sellParams.startDate))]),n("v-uni-view",{staticStyle:{"font-size":"24rpx","line-height":"28rpx"}},[e._v(e._s(e.sellParams.endDate))])],1),n("fa-icon",{staticStyle:{"margin-left":"6rpx"},attrs:{type:"angle-down",size:"18",color:"#999"}})],1)],1)],1),n("v-uni-view",{staticClass:"display_flex_bet second"},[n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v(e._s(e.getMoney.num||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[n("v-uni-text",[e._v("收款笔数")])],1)],1),n("v-uni-view",{staticClass:"secondItem"},[n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#333","font-weight":"bold"}},[e._v(e._s(e.getMoney.money||0))]),n("v-uni-view",{staticStyle:{"line-height":"40rpx",color:"#999","font-size":"24rpx"}},[n("v-uni-text",[e._v("收款金额")])],1)],1)],1)],1):e._e()],1),n("uni-calendar",{ref:"calendar",attrs:{date:e.sellParams.startDate,insert:!1,lunar:!0,range:!0,endDate:e.sellParams.startDate},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.confirm.apply(void 0,arguments)}}}),n("customDetBottom",{attrs:{custom:e.custom}})],1)},s=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}))},"51ca":function(e,t,n){"use strict";n.r(t);var o=n("0187"),a=n("02a9");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("5427");var r,i=n("f0c5"),u=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"8f097f5c",null,!1,o["a"],r);t["default"]=u.exports},5427:function(e,t,n){"use strict";var o=n("dcb09"),a=n.n(o);a.a},"54f8":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));n("a4d3"),n("e01a"),n("d28b"),n("e260"),n("d3b7"),n("3ca3"),n("ddb0");var o=n("dde1");function a(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=Object(o["a"])(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s,r=!0,i=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return r=e.done,e},e:function(e){i=!0,s=e},f:function(){try{r||null==a["return"]||a["return"]()}finally{if(i)throw s}}}}},"5c1f":function(e,t,n){"use strict";n.r(t);var o=n("3737"),a=n("0d83");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("dd94");var r,i=n("f0c5"),u=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"607de305",null,!1,o["a"],r);t["default"]=u.exports},"772a":function(e,t,n){var o=n("24fb");t=o(!1),t.push([e.i,".Listitem[data-v-8f097f5c]{width:25%;text-align:center}.Icon[data-v-8f097f5c]{line-height:%?40?%}.Notice[data-v-8f097f5c]{line-height:%?32?%;font-size:%?24?%;color:#333}",""]),e.exports=t},"7fd5":function(e,t,n){"use strict";(function(t){var o=n("ee27");n("7db0"),n("a9e3"),n("d3b7"),n("25f0");var a=o(n("54f8")),s=o(n("9546"));e.exports={enterAddGoodNum:function(e,n){var o=this;return new Promise((function(r,i){for(var u=function(i){var u=0,l=s.default.Query("Goods");l.get(e[i].objectId).then((function(c){var d=c;if(e[i].selectd_model){var f,v=(0,a.default)(e[i].selected_model);try{for(v.s();!(f=v.n()).done;){var m,h=f.value,g=(0,a.default)(d.models);try{for(g.s();!(m=g.n()).done;){var y=m.value;y.id==h.id&&(y.reserve=Number(y.reserve)+Number(h.num)),delete y.num}}catch(p){g.e(p)}finally{g.f()}}}catch(p){v.e(p)}finally{v.f()}u=Number(d.reserve)+Number(e[i].num),l.set("models",d.models)}else u=Number(d.reserve)+Number(e[i].num);l.set("reserve",u),l.set("id",e[i].objectId),l.save().then((function(t){if(e[i].header){var a=s.default.Query("Goods");a.equalTo("header","==",e[i].header.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then((function(t){var a=t[0]._sumReserve,u=s.default.Query("Goods");u.set("reserve",a),"purchase"==n&&u.set("costPrice",e[i].modify_retailPrice),u.set("id",e[i].header.objectId),u.save().then((function(t){o.modifyStockType(e[i].header.objectId),i==e.length-1&&r(!0)}))}))}else o.modifyStockType(e[i].objectId),i==e.length-1&&r(!0)})).catch((function(e){t.log(e)}))}))},l=0;l<e.length;l++)u(l)}))},outRedGoodNum:function(e){var n=this;return new Promise((function(o,r){for(var i=function(r){var i=0,u=s.default.Query("Goods");u.get(e[r].objectId).then((function(l){var c=l;if(e[r].selectd_model){var d,f=(0,a.default)(e[r].selected_model);try{for(f.s();!(d=f.n()).done;){var v,m=d.value,h=(0,a.default)(c.models);try{for(h.s();!(v=h.n()).done;){var g=v.value;i+=Number(g.reserve),g.id==m.id&&(g.reserve=Number(g.reserve)-Number(m.num)),delete g.num}}catch(y){h.e(y)}finally{h.f()}}}catch(y){f.e(y)}finally{f.f()}i=Number(c.reserve)-Number(e[r].num),u.set("models",c.models)}else i=Number(c.reserve)-Number(e[r].num);u.set("reserve",i),u.set("id",e[r].objectId),u.save().then((function(t){if(e[r].header){var a=s.default.Query("Goods");a.equalTo("header","==",e[r].header.objectId),a.equalTo("order","==",1),a.statTo("sum","reserve"),a.find().then((function(t){var a=t[0]._sumReserve,i=s.default.Query("Goods");i.set("reserve",a),i.set("id",e[r].header.objectId),i.save().then((function(t){n.modifyStockType(e[r].header.objectId),r==e.length-1&&o(!0)}))}))}else n.modifyStockType(e[r].objectId),r==e.length-1&&o(!0)})).catch((function(e){t.log(e)}))}))},u=0;u<e.length;u++)i(u)}))},enterAddGoodNumNew:function(e,n){var o=this;return new Promise((function(r,i){for(var u=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",l=uni.getStorageSync("uid"),c=function(i){var c=0,d=s.default.Query("Goods");d.equalTo("userId","==",l),d.equalTo("header","==",e[i].objectId),d.equalTo("stocks","==",u.objectId),d.find().then((function(l){if(0==l.length)o.upload_good_withNoCan(e[i],u,Number(e[i].num)).then((function(t){d.equalTo("header","==",e[i].objectId),d.equalTo("order","==",1),d.statTo("sum","reserve"),d.find().then((function(t){var o=t[0]._sumReserve;d.set("reserve",o),d.set("id",e[i].objectId),"purchase"==n&&d.set("costPrice",e[i].modify_retailPrice),d.save().then((function(t){i==e.length-1&&r(!0)}))}))}));else{var f=l[0],v=s.default.Query("Goods");if(e[i].selected_model){var m,h=(0,a.default)(e[i].selected_model);try{for(h.s();!(m=h.n()).done;){var g,y=m.value,p=(0,a.default)(f.models);try{for(p.s();!(g=p.n()).done;){var _=g.value;_.id==y.id&&(_.reserve=Number(_.reserve)+Number(y.num)),delete _.num}}catch(b){p.e(b)}finally{p.f()}}}catch(b){h.e(b)}finally{h.f()}c=Number(f.reserve)+Number(e[i].num),v.set("models",f.models)}else c=Number(f.reserve)+Number(e[i].num);v.set("reserve",c),v.set("id",f.objectId),v.save().then((function(t){v.equalTo("header","==",e[i].objectId),v.equalTo("order","==",1),v.statTo("sum","reserve"),v.find().then((function(t){var o=t[0]._sumReserve;v.set("reserve",o),"purchase"==n&&v.set("costPrice",e[i].modify_retailPrice.toString()),v.set("id",e[i].objectId),v.save().then((function(t){i==e.length-1&&r(!0)}))}))})).catch((function(e){t.log(e)}))}}))},d=0;d<e.length;d++)c(d)}))},outRedGoodNumNew:function(e){var n=this;return new Promise((function(o,r){for(var i=uni.getStorageSync("warehouse")?uni.getStorageSync("warehouse")[0].stock:"",u=uni.getStorageSync("uid"),l=function(r){var l=0,c=s.default.Query("Goods");c.equalTo("userId","==",u),c.equalTo("header","==",e[r].objectId),c.equalTo("stocks","==",i.objectId),c.find().then((function(u){if(0==u.length)n.upload_good_withNoCan(e[r],i,Number(e[r].num),"out").then((function(t){c.equalTo("header","==",e[r].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(t){var n=t[0]._sumReserve;c.set("reserve",n),c.set("id",e[r].objectId),c.save().then((function(t){s.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[r].objectId}).then((function(e){})),r==e.length-1&&o(!0)}))}))}));else{var d=u[0];if(e[r].selected_model){var f,v=(0,a.default)(e[r].selected_model);try{for(v.s();!(f=v.n()).done;){var m,h=f.value,g=(0,a.default)(d.models);try{for(g.s();!(m=g.n()).done;){var y=m.value;y.id==h.id&&(y.reserve=Number(y.reserve)-Number(h.num)),delete y.num}}catch(p){g.e(p)}finally{g.f()}}}catch(p){v.e(p)}finally{v.f()}l=Number(d.reserve)-Number(e[r].num),c.set("models",d.models)}else l=Number(d.reserve)-Number(e[r].num);c.set("reserve",l),c.set("id",d.objectId),c.save().then((function(t){c.equalTo("header","==",e[r].objectId),c.equalTo("order","==",1),c.statTo("sum","reserve"),c.find().then((function(t){var n=t[0]._sumReserve;c.set("reserve",n),c.set("id",e[r].objectId),c.save().then((function(t){s.default.functions("warn_GoodNum",{uid:uni.getStorageSync("uid"),goodId:e[r].objectId}).then((function(e){})),r==e.length-1&&o(!0)}))}))})).catch((function(e){t.log(e)}))}}))},c=0;c<e.length;c++)l(c)}))},upload_good_withNoCan:function(e,n,o,r){return new Promise((function(i,u){var l=uni.getStorageSync("uid"),c=s.default.Pointer("_User"),d=c.set(l),f=s.default.Pointer("stocks"),v=f.set(n.objectId),m=s.default.Pointer("Goods"),h="";h=e.header?m.set(e.header.objectId):m.set(e.objectId);var g=s.default.Query("Goods");if(g.set("goodsName",e.goodsName),g.set("goodsIcon",e.goodsIcon),"out"==r){if(g.set("reserve",0-Number(o)),e.goodsId&&e.goodsId.models){var y,p=(0,a.default)(e.goodsId.models);try{for(p.s();!(y=p.n()).done;){var _=y.value;_.reserve=0-Number(_.num)}}catch(D){p.e(D)}finally{p.f()}g.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var b,w=(0,a.default)(e.models);try{for(w.s();!(b=w.n()).done;){var S=b.value;S.reserve=0-Number(S.num)}}catch(D){w.e(D)}finally{w.f()}g.set("models",e.models)}}else if("allocation"==r){if(g.set("reserve",Number(o)),e.selected_model&&e.selected_model.length>0){var x,T=(0,a.default)(e.selected_model);try{for(T.s();!(x=T.n()).done;){var I=x.value;I.reserve=Number(I.num),delete I.num}}catch(D){T.e(D)}finally{T.f()}g.set("models",e.selected_model)}}else if(g.set("reserve",Number(o)),e.goodsId&&e.goodsId.models){var C,q=(0,a.default)(e.goodsId.models);try{for(q.s();!(C=q.n()).done;){var N=C.value;N.reserve=Number(N.num)}}catch(D){q.e(D)}finally{q.f()}g.set("models",e.goodsId.models)}else if(e.models&&e.models.length>0){var P,j=(0,a.default)(e.models);try{for(j.s();!(P=j.n()).done;){var k=P.value;k.reserve=Number(k.num?k.num:0)}}catch(D){j.e(D)}finally{j.f()}g.set("models",e.models)}g.set("stocks",v),g.set("userId",d),g.set("header",h),g.set("costPrice",""+e.costPrice),g.set("retailPrice",""+e.retailPrice),g.set("order",1),g.save().then((function(e){t.log(e),i([!0,e])})).catch((function(e){t.log(e)}))}))},handleData:function(){uni.removeStorageSync("warehouse"),uni.removeStorageSync("stock"),uni.removeStorageSync("custom"),uni.removeStorageSync("category"),uni.removeStorageSync("class_user"),uni.removeStorageSync("second_class")},log:function(e,n,o){var a=s.default.Pointer("_User"),r=a.set(uni.getStorageSync("uid"));if(-2==n){var i=s.default.Pointer("Goods"),u=i.set(o),l=s.default.Query("logs");l.equalTo("goodId","==",o),l.find().then((function(o){if(0==o.length){var a=s.default.Query("logs");a.set("parent",r),a.set("goodId",u),a.set("log",e),a.set("type",n),a.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}}))}else{var c=s.default.Query("logs");c.set("parent",r),c.set("log",e),c.set("detail_id",o),c.set("type",n),c.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},modifyStockType:function(e){var n=this,o=s.default.Query("Goods");o.get(e).then((function(e){var t=e;""==t.warning_num&&""==t.max_num?e.set("stocktype",1):void 0==t.warning_num&&void 0==t.max_num?e.set("stocktype",1):null==t.warning_num&&null==t.max_num?e.set("stocktype",1):(""!=t.warning_num&&(t.warning_num>=t.reserve?(e.set("stocktype",0),n.log(t.goodsName+"已经超过设置的最小库存值"+t.warning_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1)),""!=t.max_num&&(t.max_num<=t.reserve?(e.set("stocktype",2),n.log(t.goodsName+"已经超过设置的最大库存值"+t.max_num,-2,t.objectId)):t.warning_num<t.reserve&&t.reserve<t.max_num&&e.set("stocktype",1))),e.save()})).catch((function(e){t.log(e)}))},record_shopOut:function(e,n){t.log(e,n);var o=s.default.Query("shops");o.set("id",e),o.set("have_out",n),o.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))},record_staffOut:function(e){if(t.log(e,uni.getStorageSync("user").have_out),1==uni.getStorageSync("identity"));else{var n=s.default.Query("_User");n.set("id",uni.getStorageSync("user").objectId),n.set("have_out",Number(e)+uni.getStorageSync("user").have_out),n.save().then((function(e){t.log(e)})).catch((function(e){t.log(e)}))}},get_allCost:function(){var e=uni.getStorageSync("uid");t.log(e);var n=s.default.Query("Goods");n.equalTo("userId","==",e),n.find().then((function(e){t.log(e);var n,o=(0,a.default)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;t.log(s),Number(s.costPrice)*s.reserve,s.reserve}}catch(r){o.e(r)}finally{o.f()}}))},getDay:function(e,t,n){var o=this,a=new Date,s=a.getTime()+864e5*e;a.setTime(s);var r=a.getFullYear(),i=a.getMonth(),u=a.getDate();return i=o.handleMonth(i+1),u=o.handleMonth(u),t?n?r+"-"+i+"-01 00:00:00":r+"-"+i+"-"+u+" 00:00:00":r+"-"+i+"-"+u},js_date_time:function(e,t){var n=new Date(e),o=n.getFullYear(),a=n.getMonth()+1;a=a<10?"0"+a:a;var s=n.getDate();s=s<10?"0"+s:s;var r=n.getHours();r=r<10?"0"+r:r;var i=n.getMinutes(),u=n.getSeconds();return i=i<10?"0"+i:i,u=u<10?"0"+u:u,t?o+"-"+a+"-"+s+" "+r+":"+i:o+"-"+a+"-"+s},handleMonth:function(e){var t=e;return 1==e.toString().length&&(t="0"+e),t}}}).call(this,n("5a52")["default"])},aad1:function(e,t,n){var o=n("24fb");t=o(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */uni-page-body[data-v-607de305]{color:#3d3d3d}.labeNotice[data-v-607de305]{background:#426ab3;color:#fff;padding:%?2?% %?8?%;border-radius:%?8?%}.frist[data-v-607de305]{background:#fff}.frist .header[data-v-607de305]{padding:%?10?% 0}.frist .listItem[data-v-607de305]{text-align:center;width:33.33%;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.second[data-v-607de305]{background:#fff;border-top:%?1?% solid #ddd;padding:%?20?% 0}.second .secondItem[data-v-607de305]{width:50%;text-align:center}',""]),e.exports=t},d9d4:function(e,t,n){"use strict";(function(e){var o=n("ee27");n("7db0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,s,r=o(n("9546")),i=o(n("7fd5")),u=o(n("114b")),l=o(n("c952")),c=o(n("ef70")),d=o(n("51ca")),f={components:{customDetBottom:d.default,uniCalendar:c.default,uniSegmentedControl:l.default},data:function(){return{items:["销售情况","收款记录"],current:0,sellType:0,custom:{},sellParams:{customId:"",startDate:i.default.getDay(0,!1),endDate:i.default.getDay(1,!1),type:-1,extra_type:1},buyTotal:{},getMoney:{}}},onLoad:function(e){a=this,a.sellParams.customId=e.id,s=uni.getStorageSync("uid")},onShow:function(){u.default.custom_detail(a.sellParams.customId).then((function(e){var t=e,n=r.default.Query("order_opreations");n.equalTo("type","==",-1),n.equalTo("extra_type","==",1),n.equalTo("master","==",s),n.equalTo("custom","==",a.sellParams.customId),n.statTo("sum","debt"),n.find().then((function(e){e.length>0?t.debt=e[0]._sumDebt:t.debt=0,a.custom=t})),a.sellParams.customId=e.objectId,0==a.current?u.default.getAllCustomSellList(a.sellParams).then((function(e){a.buyTotal=e})):1==a.current&&u.default.getAllCustomInRecord(a.sellParams).then((function(e){a.getMoney=e}))}))},methods:{showOptions:function(){uni.showActionSheet({itemList:["销售","退货"],success:function(e){0==e.tapIndex?(a.sellType=0,a.sellParams.type=-1,a.sellParams.extra_type=1):(a.sellType=1,a.sellParams.type=1,a.sellParams.extra_type=4),u.default.getAllCustomSellList(a.sellParams).then((function(e){a.buyTotal=e}))}})},open:function(){a.$refs.calendar.open()},confirm:function(t){e.log(t),0==t.range.data.length?a.sellParams.startDate=t.fulldate:(a.sellParams.startDate=t.range.data[0],a.sellParams.endDate=t.range.data[t.range.data.length-1]),0==a.current?u.default.getAllCustomSellList(a.sellParams).then((function(t){e.log(t),a.buyTotal=t})):1==value&&u.default.getAllCustomInRecord(a.sellParams).then((function(t){e.log(t),a.getMoney=t}))},onClickItem:function(t){a.current=t,0==a.current?u.default.getAllCustomSellList(a.sellParams).then((function(t){e.log(t),a.buyTotal=t})):1==a.current&&u.default.getAllCustomInRecord(a.sellParams).then((function(t){e.log(t),a.getMoney=t}))},makePhoneCall:function(e){e?uni.makePhoneCall({phoneNumber:e}):uni.showToast({icon:"none",title:"未填写联系电话"})},show_options:function(){uni.showActionSheet({itemList:["编辑","删除"],success:function(e){0==e.tapIndex?a.edit(a.custom):1==e.tapIndex&&a.delete_this(a.custom.objectId)},fail:function(t){e.log(t.errMsg)}})},edit:function(e){uni.setStorageSync("customs",e),uni.setStorageSync("custom_type","customs"),uni.navigateTo({url:"../add/add"})},delete_this:function(e){uni.showModal({title:"提示",content:"是否删除此客户",success:function(t){t.confirm&&a.delete_data("customs",e)}})},delete_data:function(t,n){e.log(n);var o=r.default.Query(t);o.destroy(n).then((function(t){e.log(t),uni.showToast({title:"删除成功",icon:"none"}),uni.navigateBack({delta:1})})).catch((function(t){e.log(t)}))}}};t.default=f}).call(this,n("5a52")["default"])},dcb09:function(e,t,n){var o=n("772a");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("d4b89862",o,!0,{sourceMap:!1,shadowMode:!1})},dd94:function(e,t,n){"use strict";var o=n("fe6e"),a=n.n(o);a.a},fe6e:function(e,t,n){var o=n("aad1");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var a=n("4f06").default;a("103f8d06",o,!0,{sourceMap:!1,shadowMode:!1})}}]);