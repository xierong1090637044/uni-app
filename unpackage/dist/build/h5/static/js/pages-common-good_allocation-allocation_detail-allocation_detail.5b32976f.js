(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-common-good_allocation-allocation_detail-allocation_detail"],{3309:function(e,t,o){var s=o("9b07");"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var r=o("4f06").default;r("730bb656",s,!0,{sourceMap:!1,shadowMode:!1})},"408a":function(e,t,o){var s=o("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=s(e))throw TypeError("Incorrect invocation");return+e}},"4a5b":function(e,t,o){"use strict";var s=o("3309"),r=o.n(s);r.a},"64a8":function(e,t,o){"use strict";o.r(t);var s=o("66dd"),r=o("f43f");for(var n in r)"default"!==n&&function(e){o.d(t,e,(function(){return r[e]}))}(n);o("4a5b");var a,u=o("f0c5"),i=Object(u["a"])(r["default"],s["b"],s["c"],!1,null,"2c29b750",null,!1,s["a"],a);t["default"]=i.exports},"66dd":function(e,t,o){"use strict";var s,r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-uni-view",[o("v-uni-view",{staticClass:"page"},[o("v-uni-view",{staticStyle:{"line-height":"70rpx",padding:"20rpx 20rpx 0",color:"#3D3D3D","font-weight":"bold"}},[e._v("已选产品")]),o("v-uni-view",e._l(e.products,(function(t,s){return o("v-uni-view",{key:s,staticClass:"pro_listitem"},[o("v-uni-view",{staticClass:"pro_list"},[e._v("产品："+e._s(t.goodsName))]),o("v-uni-view",{staticClass:"pro_list"},[e._v("调出店仓："+e._s(t.stocks.stock_name))]),o("v-uni-view",{staticClass:"pro_list"},[o("v-uni-view",[e._v("库存："+e._s(t.reserve))]),o("v-uni-view",[e._v("调出库存："+e._s(t.num))])],1),t.selected_model?o("v-uni-view",e._l(t.selected_model,(function(t,s){return t.num>0?o("v-uni-view",{key:s,staticClass:"display_flex_bet"},[t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#999"}},[e._v(e._s(t.custom1.value+t.custom2.value+t.custom3.value+t.custom4.value))]):e._e(),t?o("v-uni-view",{staticStyle:{"font-size":"24rpx",color:"#f30"}},[e._v(e._s(t.num))]):e._e()],1):e._e()})),1):e._e()],1)})),1),o("v-uni-form",{on:{submit:function(t){arguments[0]=t=e.$handleEvent(t),e.formSubmit.apply(void 0,arguments)}}},[o("v-uni-view",{staticStyle:{margin:"30rpx 0"}},[o("v-uni-view",{staticStyle:{margin:"0 0 10rpx 20rpx",color:"#3D3D3D","font-weight":"bold"}},[e._v("调拨明细")]),o("v-uni-view",{staticClass:"kaidan_detail",staticStyle:{"line-height":"70rpx"}},[o("v-uni-navigator",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"},attrs:{"hover-class":"none",url:"/pages/manage/warehouse/warehouse?type=out_choose"}},[o("v-uni-view",[e._v("调入店仓")]),o("v-uni-view",{staticClass:"kaidan_rightinput display_flex"},[o("v-uni-input",{staticStyle:{"margin-right":"20rpx","text-align":"right"},attrs:{placeholder:"选择调入店仓",disabled:"true",value:e.out_stock.stock_name}}),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0","border-bottom":"1rpx solid#F7F7F7"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("调拨时间")]),o("v-uni-picker",{attrs:{mode:"date",value:e.nowDay,end:e.nowDay},on:{change:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.bindDateChange2.apply(void 0,arguments)},click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t)}}},[o("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[o("v-uni-view",{staticStyle:{"margin-right":"20rpx"}},[e._v(e._s(e.nowDay.split(" ")[0]))]),o("fa-icon",{attrs:{type:"angle-right",size:"20",color:"#999"}})],1)],1)],1),o("v-uni-view",{staticClass:"display_flex_bet",staticStyle:{padding:"10rpx 0"}},[o("v-uni-view",{staticStyle:{width:"140rpx"}},[e._v("备注")]),o("v-uni-input",{staticClass:"beizhu_style",attrs:{placeholder:"请输入备注",name:"input_beizhu"}})],1)],1)],1),o("v-uni-view",{staticClass:"bottomEle display_flex_bet",staticStyle:{padding:"0 30rpx","margin-top":"60rpx"}},[o("v-uni-view",[e._v("总数："+e._s(e.total_num))]),o("v-uni-view",{staticClass:"display_flex"},[o("v-uni-button",{staticClass:"confrim_button",attrs:{disabled:e.button_disabled,"form-type":"submit"}},[e._v("调拨")])],1)],1)],1)],1)],1)},n=[];o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return n})),o.d(t,"a",(function(){return s}))},"9b07":function(e,t,o){var s=o("24fb");t=s(!1),t.push([e.i,".page[data-v-2c29b750]{color:#4d4d4d;font-size:%?28?%;height:calc(100vh - %?110?%);overflow:scroll}.bottomEle[data-v-2c29b750]{font-weight:700;position:fixed;bottom:0;left:0;width:calc(100% - %?30?%);background:#fafafa;padding:%?20?% %?0?% %?20?% %?30?%}.pro_list[data-v-2c29b750]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.pro_listitem[data-v-2c29b750]{background-color:#fff;padding:%?10?% %?20?%;border-bottom:%?1?% solid#ddd}.pro_allmoney[data-v-2c29b750]{background-color:#fff;padding:%?10?% %?20?%;text-align:right;font-size:%?32?%;color:#f30}.beizhu_style[data-v-2c29b750]{text-align:right;width:calc(100% - %?40?%);background-color:#fff;padding:%?10?% 0;max-height:%?100?%}.confrim_button[data-v-2c29b750]{background:#644fbb;color:#fff;font-weight:700;font-size:%?32?%;border-radius:unset;padding:0 %?50?%}",""]),e.exports=t},"9f50":function(e,t,o){"use strict";(function(e){var s=o("ee27");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o("9546")),n={sendTempMini:function(e,t){if("enter"==t){var o={thing1:{value:e.goodsName+"...等",color:"#173177"},number2:{value:e.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},date4:{value:e.createdAt}};o.id=e.operationId,this.send_in_mini(o)}else if("out"==t){var s={thing1:{value:e.goodsName+"...等",color:"#173177"},number2:{value:e.total_num,color:"#173177"},name3:{value:uni.getStorageSync("user").nickName},time4:{value:e.createdAt}};s.id=e.operationId,this.send_out_mini(s)}},send_in:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:t.frist,data1:t.data1,data2:t.data2,remark:t.remark,url:t.url,type:"in"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})},send_in_noconfrim:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,frist:t.frist,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:t.remark,url:t.url,type:"in_noconfrim"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})},send_in_mini:function(t){var o={touser:uni.getStorageSync("openid"),template_id:"G2UJEDEyAtGuBdO-Yv96yBi-UnTLhaInr-KzEXqZ-48",page:"/pages/report/EnteringHistory/detail/detail?id="+t.id,data:t,emphasis_keyword:""};r.default.sendWeAppMessage(o).then((function(t){e.log(t)})).catch((function(t){e.log(t)}))},send_out_mini:function(t){var o={touser:uni.getStorageSync("openid"),template_id:"BKT2_0OuWF3mLZGvFmpRzWFa_Dyr4EIppl_LFF1uRLE",page:"/pages/report/EnteringHistory/detail/detail?id="+t.id,data:t,emphasis_keyword:""};r.default.sendWeAppMessage(o).then((function(t){e.log(t)})).catch((function(t){e.log(t)}))},send_temp:function(t){var o=uni.getStorageSync("setting").wx_openid;uni.request({url:"https://www.jimuzhou.com/api/send_temp.php",method:"POST",data:{openid:o,data1:t.data1,data2:t.data2,data3:t.data3,data4:t.data4,remark:"备注:"+t.remark,url:t.url,type:"out"},header:{"content-type":"application/x-www-form-urlencoded"},success:function(t){e.log(t)}})}};t.default=n}).call(this,o("5a52")["default"])},a2fc:function(e,t,o){"use strict";(function(e){var s=o("ee27");o("7db0"),o("a9e3"),o("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(o("54f8")),n=s(o("9546")),a={delete_goods:function(t){return new Promise((function(o,s){var a,u=0,i=(0,r.default)(t);try{for(i.s();!(a=i.n()).done;){var d=a.value,c=n.default.Query("Goods");c.destroy(d.objectId).then((function(e){u+=1,u==t.length&&o(!0)})).catch((function(t){e.log(t)}))}}catch(l){i.e(l)}finally{i.f()}}))},upload_good_withNoCan:function(t,o){return new Promise((function(s,r){var a=uni.getStorageSync("uid"),u=n.default.Pointer("_User"),i=u.set(a),d=t.reserve,c=n.default.Pointer("stocks"),l=c.set(o.objectId),f=n.default.Query("Goods");f.equalTo("userId","==",a),f.equalTo("goodsName","==",t.goodsName),f.equalTo("stocks","==",o.objectId),f.find().then((function(o){if(e.log(o),o.length>=1)s([!1,"该商品存在此店仓中"]);else{var r=n.default.Query("Goods");if(r.set("goodsName",t.goodsName),r.set("goodsIcon",t.goodsIcon),r.set("costPrice",t.costPrice),r.set("retailPrice",t.retailPrice),r.set("reserve",Number(t.reserve)),r.set("productCode",t.productCode?t.productCode:""),r.set("stocks",l),r.set("product_info",t.product_info?t.product_info:""),r.set("producer",t.producer?t.producer:""),r.set("packingUnit",t.packingUnit?t.packingUnit:""),r.set("packageContent",t.packageContent?t.packageContent:""),r.set("warning_num",Number(t.warning_num?t.warning_num:0)),r.set("stocktype",Number(t.warning_num?t.warning_num:0)>=Number(d)?0:1),t.second_class){var a=n.default.Pointer("class_user"),u=a.set(t.goodsClass);r.set("second_class",f);var c=n.default.Pointer("second_class"),f=c.set(t.second_class);r.set("goodsClass",u)}r.set("userId",i),r.save().then((function(t){e.log(t),s([!0,t])})).catch((function(t){e.log(t)}))}}))}))},upload_good:function(t){return new Promise((function(o,s){var r=JSON.parse(localStorage.getItem("bmob")).objectId,a=n.default.Pointer("_User"),u=a.set(r),i=n.default.Pointer("class_user"),d=i.set(t.goodsClass),c=n.default.Pointer("second_class"),l=c.set(t.second_class),f=n.default.Query("Goods");f.equalTo("userId","==",r),f.equalTo("goodsName","==",t.goodsName),f.equalTo("position","==",t.position),f.equalTo("stocks","==",t.stocks),f.find().then((function(s){if(e.log(s),s.length>=1)o([!1,s]);else{var r=t.reserve,a=n.default.Pointer("stocks"),i=a.set(t.stocks),c=n.default.Query("Goods");c.set("goodsName",t.goodsName),c.set("goodsIcon",t.goodsIcon),c.set("costPrice",t.costPrice),c.set("retailPrice",t.retailPrice),c.set("producttime",t.producttime),c.set("nousetime",t.nousetime),c.set("regNumber",t.regNumber),c.set("reserve",Number(t.reserve)),c.set("productCode",t.productCode),c.set("stocks",i),c.set("product_info",t.product_info),c.set("producer",t.producer),c.set("packingUnit",t.packingUnit),c.set("packageContent",t.packageContent),c.set("warning_num",Number(t.warning_num)),c.set("stocktype",Number(t.warning_num)>=Number(r)?0:1),c.set("second_class",l),c.set("goodsClass",d),c.set("userId",u),c.save().then((function(t){e.log(t),o([!0,t])})).catch((function(t){e.log(t)}))}}))}))},get_fristclass:function(){var e=JSON.parse(localStorage.getItem("bmob")).objectId;return new Promise((function(t,o){var s=n.default.Query("class_user");s.equalTo("parent","==",e),s.find().then((function(e){localStorage.setItem("frist_class",JSON.stringify(e)),t(e)}))}))},get_secondclass:function(e){return new Promise((function(t,o){var s=n.default.Query("class_user");s.field("second",e),s.relation("second_class").then((function(e){t(e.results)}))}))},getstock_list:function(e){var t=JSON.parse(localStorage.getItem("bmob")).objectId;return new Promise((function(o,s){var r=n.default.Query("stocks");r.order("-num"),r.include("charge","shop"),r.equalTo("parent","==",t),e&&r.equalTo("stock_name","==",{$regex:e+".*"}),r.limit(500),r.find().then((function(e){localStorage.setItem("stocks",JSON.stringify(e)),o(e)}))}))}};t.default=a}).call(this,o("5a52")["default"])},b6802:function(e,t,o){"use strict";var s=o("23e7"),r=o("a691"),n=o("408a"),a=o("1148"),u=o("d039"),i=1..toFixed,d=Math.floor,c=function(e,t,o){return 0===t?o:t%2===1?c(e,t-1,o*e):c(e*e,t/2,o)},l=function(e){var t=0,o=e;while(o>=4096)t+=12,o/=4096;while(o>=2)t+=1,o/=2;return t},f=i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!u((function(){i.call({})}));s({target:"Number",proto:!0,forced:f},{toFixed:function(e){var t,o,s,u,i=n(this),f=r(e),m=[0,0,0,0,0,0],p="",v="0",g=function(e,t){var o=-1,s=t;while(++o<6)s+=e*m[o],m[o]=s%1e7,s=d(s/1e7)},_=function(e){var t=6,o=0;while(--t>=0)o+=m[t],m[t]=d(o/e),o=o%e*1e7},h=function(){var e=6,t="";while(--e>=0)if(""!==t||0===e||0!==m[e]){var o=String(m[e]);t=""===t?o:t+a.call("0",7-o.length)+o}return t};if(f<0||f>20)throw RangeError("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return String(i);if(i<0&&(p="-",i=-i),i>1e-21)if(t=l(i*c(2,69,1))-69,o=t<0?i*c(2,-t,1):i/c(2,t,1),o*=4503599627370496,t=52-t,t>0){g(0,o),s=f;while(s>=7)g(1e7,0),s-=7;g(c(10,s,1),0),s=t-1;while(s>=23)_(1<<23),s-=23;_(1<<s),g(1,1),_(2),v=h()}else g(0,o),g(1<<-t,0),v=h()+a.call("0",f);return f>0?(u=v.length,v=p+(u<=f?"0."+a.call("0",f-u)+v:v.slice(0,u-f)+"."+v.slice(u-f))):v=p+v,v}})},c942:function(e,t,o){"use strict";(function(e){var s=o("ee27");o("7db0"),o("a9e3"),o("b6802"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,n,a=s(o("54f8")),u=s(o("9546")),i=s(o("7fd5")),d=(s(o("9f50")),s(o("856d"))),c=(s(o("a2fc")),[]),l={data:function(){return{products:[],stock:"",out_stock:"",button_disabled:!1,beizhu_text:"",out_products:[],all_money:0,real_money:0,total_num:0,nowDay:i.default.getDay(0,!0)}},onLoad:function(){n=this,r=uni.getStorageSync("uid"),this.products=uni.getStorageSync("products");for(var e=0;e<this.products.length;e++)this.all_money=Number((this.products[e].total_money+this.all_money).toFixed(2)),this.total_num+=Number(this.products[e].num);this.real_money=Number(this.all_money.toFixed(2))},onShow:function(){n.out_stock=uni.getStorageSync("out_warehouse")?uni.getStorageSync("out_warehouse")[0].stock:""},methods:{formSubmit:function(e){if(this.button_disabled=!0,""==n.out_stock||null==n.out_stock)return uni.showToast({title:"请选择调入店仓",icon:"none"}),void(this.button_disabled=!1);n.unique(n.products),n.addTbRecord(e)},unique:function(t){for(var o=[t[0]],s=1;s<t.length;s++){for(var r=!1,u=0;u<o.length;u++)if(t[s].header.objectId===o[u].header.objectId){if(t[s].selected_model){var i,d=(0,a.default)(t[s].selected_model);try{for(d.s();!(i=d.n()).done;){var l,f=i.value,m=(0,a.default)(o[u].selected_model);try{for(m.s();!(l=m.n()).done;){var p=l.value;p.id==f.id&&(p.num+=Number(f.num))}}catch(v){m.e(v)}finally{m.f()}}}catch(v){d.e(v)}finally{d.f()}}o[u].num+=t[s].num,r=!0}r||o.push(t[s])}e.log(o),n.products=uni.getStorageSync("products"),c=o},addTbRecord:function(t){var o,s=this;uni.showLoading({title:"请勿退出..."});for(var d=u.default.Pointer("stocks"),l=d.set(n.out_stock.objectId),f=new Array,m=[],p=function(e){var t=u.default.Pointer("stocks");o=t.set(s.products[e].stocks.objectId);var i=u.default.Query("Bills"),d={},c=u.default.Pointer("_User"),p=c.set(r),v=u.default.Pointer("_User"),g=v.set(uni.getStorageSync("masterId")),_=u.default.Pointer("Goods"),h=_.set(s.products[e].objectId);i.set("goodsName",s.products[e].goodsName),i.set("retailPrice",s.products[e].modify_retailPrice),i.set("num",Number(s.products[e].num)),i.set("total_money",Number(s.products[e].total_money)),i.set("goodsId",h),i.set("userId",p),i.set("type",-2),i.set("opreater",g),i.set("stock",o),i.set("out_stock",l);var b={};d.goodsName=s.products[e].goodsName,d.stock=s.products[e].stocks.stock_name,d.out_stock=n.out_stock.stock_name,d.reserve=s.products[e].reserve,b.objectId=s.products[e].objectId,s.products[e].selectd_model&&(b.selected_model=s.products[e].selected_model,b.models=s.products[e].models),d.goodsId=b,d.num=Number(s.products[e].num),d.type=-2,f.push(i),m.push(d);var y=u.default.Query("Goods");y.get(n.products[e].objectId).then((function(t){var o=Number(s.products[e].reserve)-Number(s.products[e].num);if(s.products[e].selected_model){var r,n=(0,a.default)(s.products[e].selected_model);try{for(n.s();!(r=n.n()).done;){var u,i=r.value,d=(0,a.default)(s.products[e].models);try{for(d.s();!(u=d.n()).done;){var c=u.value;c.id==i.id&&(c.reserve=Number(c.reserve)-Number(i.num)),delete c.num}}catch(l){d.e(l)}finally{d.f()}}}catch(l){n.e(l)}finally{n.f()}t.set("models",s.products[e].models)}t.set("reserve",o),t.save()}))},v=0;v<n.products.length;v++)p(v);u.default.Query("Bills").saveAll(f).then((function(e){for(var s=[],d=0;d<e.length;d++)s.push(e[d].success.objectId);var f=u.default.Pointer("_User"),p=f.set(r),v=uni.getStorageSync("masterId"),g=u.default.Pointer("_User"),_=g.set(v),h=u.default.Query("order_opreations");h.set("detail",m),h.set("bills",s),h.set("beizhu",t.detail.value.input_beizhu),h.set("type",-2),h.set("opreater",_),h.set("stock",o),h.set("out_stock",l),h.set("master",p),h.set("goodsName",n.products[0].goodsName),h.save().then((function(e){e.objectId;uni.hideLoading(),n.button_disabled=!1,uni.setStorageSync("is_option",!0);for(var t=function(e){var t=u.default.Query("Goods");t.equalTo("goodsName","==",c[e].goodsName),t.equalTo("userId","==",r),t.equalTo("stocks","==",n.out_stock.objectId),t.find().then((function(o){var s=o;0==s.length?i.default.upload_good_withNoCan(c[e],n.out_stock,Number(c[e].num),"allocation").then((function(t){e==c.length-1&&(uni.hideLoading(),uni.removeStorageSync("warehouse"),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),uni.showToast({title:"调拨成功"}),setTimeout((function(){uni.navigateBack({delta:2})}),500))})):t.get(s[0].objectId).then((function(t){if(c[e].selected_model){var o,r=(0,a.default)(c[e].selected_model);try{for(r.s();!(o=r.n()).done;){var n,u=o.value,i=(0,a.default)(s[0].models);try{for(i.s();!(n=i.n()).done;){var d=n.value;d.id==u.id&&(d.reserve=Number(d.reserve)+Number(u.num)),delete d.num}}catch(l){i.e(l)}finally{i.f()}}}catch(l){r.e(l)}finally{r.f()}t.set("models",s[0].models)}t.set("reserve",Number(s[0].reserve)+Number(c[e].num)),t.save(),e==c.length-1&&(uni.hideLoading(),uni.removeStorageSync("warehouse"),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),uni.showToast({title:"调拨成功"}),setTimeout((function(){uni.navigateBack({delta:2})}),500))}))}))},o=0;o<c.length;o++)t(o)}))}),(function(t){e.log("异常处理")}))},add_tb_record:function(t){var o=this;uni.showLoading({title:"上传中..."});for(var s,c=u.default.Pointer("stocks"),l=c.set(n.out_stock.objectId),f=new Array,m=[],p=function(p){s=c.set(o.products[p].stocks.objectId);var v=u.default.Query("Goods");v.equalTo("goodsName","==",n.products[p].goodsName),v.equalTo("userId","==",r),v.equalTo("stocks","==",n.out_stock.objectId),v.find().then((function(c){e.log(c);var v,g,_=[];if(0==c.length){if(n.products[p].selectd_model)return uni.showToast({icon:"none",title:"此多规格产品未关联到此店仓"}),void(o.button_disabled=!1);i.default.upload_good_withNoCan(n.products[p],n.out_stock,Number(o.products[p].num),"allocation").then((function(a){e.log(a);var c={};c.objectId=a[1].objectId,c.reserve=Number(o.products[p].num),_[0]=c,v=Number(o.products[p].reserve)-Number(o.products[p].num),g=Number(o.products[p].num);var h=u.default.Query("Goods");h.get(n.products[p].objectId).then((function(e){e.set("reserve",v),e.save(),h.get(_[0].objectId).then((function(e){e.set("reserve",g),e.save()}))}));var b=u.default.Query("Bills"),y={},w=u.default.Pointer("_User"),S=w.set(r),k=u.default.Pointer("_User"),N=k.set(uni.getStorageSync("masterId")),I=u.default.Pointer("Goods"),x=I.set(o.products[p].objectId);b.set("goodsName",o.products[p].goodsName),b.set("retailPrice",o.products[p].modify_retailPrice),b.set("num",Number(o.products[p].num)),b.set("total_money",Number(o.products[p].total_money)),b.set("goodsId",x),b.set("userId",S),b.set("type",-2),b.set("opreater",N),b.set("stock",s),b.set("out_stock",l);var j={};y.goodsName=o.products[p].goodsName,y.stock=o.products[p].stocks.stock_name,y.out_stock=n.out_stock.stock_name,y.reserve=o.products[p].reserve,y.out_reserve=_[0].reserve,j.objectId=o.products[p].objectId,j.out_objectId=_[0].objectId,j.reserve=v,j.out_reserve=g,o.products[p].selectd_model&&(j.selected_model=o.products[p].selected_model,j.models=o.products[p].models),y.goodsId=j,y.num=Number(o.products[p].num),y.type=-2,f.push(b),m.push(y),p==o.products.length-1&&u.default.Query("Bills").saveAll(f).then((function(e){for(var o=[],a=0;a<e.length;a++)o.push(e[a].success.objectId);var c=u.default.Pointer("_User"),f=c.set(r),p=uni.getStorageSync("masterId"),v=u.default.Pointer("_User"),g=v.set(p),_=u.default.Query("order_opreations");_.set("detail",m),_.set("bills",o),_.set("beizhu",t.detail.value.input_beizhu),_.set("type",-2),_.set("opreater",g),_.set("stock",s),_.set("out_stock",l),_.set("master",f),_.set("goodsName",n.products[0].goodsName),_.save().then((function(e){var t=e.objectId;uni.hideLoading(),uni.showToast({title:"产品调拨成功",icon:"success",success:function(){n.button_disabled=!1,uni.setStorageSync("is_option",!0),setTimeout((function(){uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),i.default.log(uni.getStorageSync("user").nickName+"调拨了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",-2,e.objectId),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(t),uni.navigateBack({delta:2})}),500)}})}))}),(function(t){e.log("异常处理")}))}))}else{if(_=c,v=Number(o.products[p].reserve)-Number(o.products[p].num),g=Number(_[0].reserve)+Number(o.products[p].num),o.products[p].stocks.objectId!=n.out_stock.objectId){var h=u.default.Query("Goods");h.get(_[0].objectId).then((function(t){e.log(t);var s=t;if(o.products[p].selectd_model){var r,u=(0,a.default)(o.products[p].selected_model);try{for(u.s();!(r=u.n()).done;){var i,d=r.value,c=(0,a.default)(s.models);try{for(c.s();!(i=c.n()).done;){var l=i.value;l.id==d.id&&(l.reserve=Number(l.reserve)+Number(d.num)),delete l.num}}catch(f){c.e(f)}finally{c.f()}}}catch(f){u.e(f)}finally{u.f()}t.set("models",s.models)}t.set("reserve",g),t.save(),h.get(n.products[p].objectId).then((function(e){if(o.products[p].selectd_model){var t,s=(0,a.default)(o.products[p].selected_model);try{for(s.s();!(t=s.n()).done;){var r,n=t.value,u=(0,a.default)(o.products[p].models);try{for(u.s();!(r=u.n()).done;){var i=r.value;i.id==n.id&&(i.reserve=Number(i.reserve)-Number(n.num)),delete i.num}}catch(f){u.e(f)}finally{u.f()}}}catch(f){s.e(f)}finally{s.f()}e.set("models",o.products[p].models)}e.set("reserve",v),e.save()}))}))}var b=u.default.Query("Bills"),y={},w=u.default.Pointer("_User"),S=w.set(r),k=u.default.Pointer("_User"),N=k.set(uni.getStorageSync("masterId")),I=u.default.Pointer("Goods"),x=I.set(o.products[p].objectId);b.set("goodsName",o.products[p].goodsName),b.set("num",Number(o.products[p].num)),b.set("goodsId",x),b.set("userId",S),b.set("type",-2),b.set("opreater",N),b.set("stock",s),b.set("out_stock",l);var j={};y.goodsName=o.products[p].goodsName,y.stock=o.products[p].stocks.stock_name,y.out_stock=n.out_stock.stock_name,y.reserve=o.products[p].reserve,y.out_reserve=_[0].reserve,j.objectId=o.products[p].objectId,j.out_objectId=_[0].objectId,j.reserve=v,j.out_reserve=g,o.products[p].selectd_model&&(j.selected_model=o.products[p].selected_model,j.models=o.products[p].models),y.goodsId=j,y.num=Number(o.products[p].num),y.type=-2,f.push(b),m.push(y),p==o.products.length-1&&u.default.Query("Bills").saveAll(f).then((function(e){for(var o=[],a=0;a<e.length;a++)o.push(e[a].success.objectId);var c=u.default.Pointer("_User"),f=c.set(r),p=uni.getStorageSync("masterId"),v=u.default.Pointer("_User"),g=v.set(p),_=u.default.Query("order_opreations");_.set("detail",m),_.set("bills",o),_.set("beizhu",t.detail.value.input_beizhu),_.set("type",-2),_.set("opreater",g),_.set("stock",s),_.set("out_stock",l),_.set("master",f),_.set("goodsName",n.products[0].goodsName),_.save().then((function(e){var t=e.objectId;uni.showToast({title:"产品调拨成功",icon:"success",success:function(){uni.hideLoading(),uni.setStorageSync("is_option",!0),uni.removeStorageSync("_warehouse"),uni.removeStorageSync("out_warehouse"),uni.removeStorageSync("category"),uni.removeStorageSync("warehouse"),setTimeout((function(){n.button_disabled=!1,i.default.log(uni.getStorageSync("user").nickName+"调拨了'"+n.products[0].goodsName+"'等"+n.products.length+"商品",-2,e.objectId),uni.getStorageSync("setting").auto_print&&d.default.autoPrint(t),uni.navigateBack({delta:2})}),500)}})}))}),(function(t){e.log("异常处理")}))}}))},v=0;v<this.products.length;v++)p(v)}}};t.default=l}).call(this,o("5a52")["default"])},f43f:function(e,t,o){"use strict";o.r(t);var s=o("c942"),r=o.n(s);for(var n in s)"default"!==n&&function(e){o.d(t,e,(function(){return s[e]}))}(n);t["default"]=r.a}}]);